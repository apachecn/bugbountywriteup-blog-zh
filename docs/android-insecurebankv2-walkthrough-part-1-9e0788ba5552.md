# Android å®‰å…¨é“¶è¡Œ 2 æ¼”ç»ƒ:ç¬¬ 1 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://infosecwriteups.com/android-insecurebankv2-walkthrough-part-1-9e0788ba5552?source=collection_archive---------0----------------------->

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†çœ‹çœ‹ GitHub ç”¨æˆ· *dineshshetty* åˆ›å»ºçš„ *InsecureBankv2* Android åº”ç”¨ç¨‹åºã€‚æ ¹æ®åˆ›å»ºè€…çš„è¯´æ³•ï¼Œè¿™ä¸ªæ˜“å—æ”»å‡»çš„ Android åº”ç”¨ç¨‹åºæ˜¯ä¸ºäº†è®©å¼€å‘äººå‘˜å’Œå®‰å…¨çˆ±å¥½è€…é€šè¿‡æµ‹è¯•ä¸€ä¸ªæœ‰ç›®çš„çš„æ˜“å—æ”»å‡»çš„ Android åº”ç”¨ç¨‹åºæ¥äº†è§£æ›´å¤šå…³äº Android ä¸å®‰å…¨æ€§çš„ä¿¡æ¯ã€‚æˆ‘åœ¨ä¸‹é¢çš„å‚è€ƒèµ„æ–™ä¸­ç•™ä¸‹äº†åº”ç”¨ç¨‹åº GitHub åº“çš„é“¾æ¥ï¼Œå®ƒæä¾›äº†åº”ç”¨ç¨‹åºä¸­å½“å‰å­˜åœ¨çš„æ‰€æœ‰æ¼æ´çš„åˆ—è¡¨ã€‚

![](img/986c5446f38e14fc9a30a004832033dd.png)

# æ”¾å¼ƒ

å‡ºäºå­¦ä¹ æ›´å¤šå…³äº Android ç§»åŠ¨åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„å…´è¶£ï¼Œæˆ‘å†™äº†è¿™ç¯‡æ–‡ç« ã€‚è¿™ç¯‡æ–‡ç« æ˜¾ç„¶ä¼šåŒ…å«å…³äº*å®‰å…¨é“¶è¡Œ v2* Android åº”ç”¨ç¨‹åºä¸­å­˜åœ¨çš„æ¼æ´çš„å‰§é€ã€‚æˆ‘é¼“åŠ±è¯»è€…å°½å¯èƒ½å¤šåœ°åˆ©ç”¨æ¼æ´ï¼Œå¦‚æœæ‚¨é‡åˆ°å›°éš¾æˆ–å¸Œæœ›çœ‹åˆ°åˆ©ç”¨ä¸å®‰å…¨çš„æ½œåœ¨ä¸åŒæ–¹æ³•ï¼Œè¯·ç¨åå†æ¥é˜…è¯»æœ¬æ–‡ã€‚æ²¡æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„å»¶è¯¯ï¼Œè®©æˆ‘ä»¬å¼€å§‹è®¾ç½®ğŸ˜ƒï¼

# è®¾ç½®

è¯¥åº”ç”¨ç¨‹åºçš„åˆ›å»ºè€…åœ¨ä»–ä»¬çš„ GitHub ä¸Šæä¾›äº†å…³äºå¦‚ä½•è®¾ç½®åº”ç”¨ç¨‹åºåŠå…¶åç«¯æœåŠ¡å™¨çš„è¯¦ç»†æŒ‡å—(**å‚è§å‚è€ƒèµ„æ–™**)ã€‚å¯¹äºæœ¬æ–‡ï¼Œæˆ‘ä½¿ç”¨ä¸€ä¸ª *Kali Linux* è™šæ‹Ÿæœºä½œä¸ºæˆ‘çš„ä¸»æœºè®¾å¤‡ï¼Œä½¿ç”¨ Genymotion åˆ›å»ºçš„ä¸€ä¸ª *Samsung Galaxy S8* ä»¿çœŸå™¨ä½œä¸ºæˆ‘çš„æµ‹è¯•è®¾å¤‡ã€‚æˆ‘è¿˜é…ç½®äº†ä¸¤ä¸ªè™šæ‹Ÿæœºæ¥ä½¿ç”¨ **NAT** å’Œ**ä¸»æœºä¸“ç”¨**ç½‘ç»œé€‚é…å™¨ã€‚æˆ‘çš„ Android æ¨¡æ‹Ÿå™¨çš„è§„æ ¼å¯ä»¥åœ¨ä¸‹å›¾ä¸­çœ‹åˆ°ã€‚

![](img/f8da848c7c518812a58637f9502412ed.png)

ä¸ºäº†è®¾ç½® **AndroLab** æœåŠ¡å™¨ï¼Œæˆ‘é¦–å…ˆå°†åº”ç”¨ç¨‹åºçš„ GitHub åº“å…‹éš†åˆ°æˆ‘çš„ Kali æœºå™¨ä¸Šï¼Œç„¶åä½¿ç”¨ **pip** å®‰è£…å¿…è¦çš„éœ€æ±‚ã€‚

```
pip install -r requirements.txt
```

ä¸€æ—¦å®‰è£…äº†æ‰€æœ‰çš„éœ€æ±‚ï¼Œæˆ‘å°±åœ¨é»˜è®¤ç«¯å£ 8888 ä¸Šè¿è¡Œ HTTP æœåŠ¡å™¨ã€‚

```
python app.py
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä½¿ç”¨ **Android è°ƒè¯•æ¡¥** (ADB)è¿æ¥åˆ°æˆ‘çš„ä»¿çœŸå™¨ï¼Œå¹¶å®‰è£…äº† *InsecureBankv2* APK æ–‡ä»¶ã€‚

> æ³¨æ„:**Android Debug Bridge(ADB)**æ˜¯ä¸€æ¬¾å¤šåŠŸèƒ½å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯è®©æ‚¨ä¸è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚adb å‘½ä»¤æœ‰åŠ©äºå„ç§è®¾å¤‡æ“ä½œï¼Œå¦‚å®‰è£…å’Œè°ƒè¯•åº”ç”¨ç¨‹åºï¼Œå®ƒæä¾›äº†å¯¹ Unix shell çš„è®¿é—®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥ shell åœ¨è®¾å¤‡ä¸Šè¿è¡Œå„ç§å‘½ä»¤ã€‚

```
adb connect "your-host-only-ip-address"
adb install InsecureBankv2.apk
```

æˆåŠŸå®‰è£…åï¼Œåº”ç”¨ç¨‹åºå›¾æ ‡ä¼šå‡ºç°åœ¨æˆ‘çš„æ¨¡æ‹Ÿå™¨ä¸Š

![](img/b308df076b9fb4534a07e4b01778a127.png)

å®‰è£…å®Œæˆåï¼Œæœ€åä¸€æ­¥æ˜¯æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œå°†åº”ç”¨ç¨‹åºæŒ‡å‘è¿è¡Œ AndroLab æœåŠ¡å™¨çš„ IP åœ°å€å’Œç«¯å£ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œè¿™æ˜¯æˆ‘çš„ Kali æœºå™¨çš„å”¯ä¸€çš„ç½‘ç»œé€‚é…å™¨å’Œç«¯å£çš„ IP åœ°å€ã€‚

![](img/36ecdd0871669e68e8ab5190d64688ca.png)

å•å‡»æäº¤åï¼Œå°†æˆåŠŸé…ç½®ç½‘ç»œé¦–é€‰é¡¹è®¾ç½®ã€‚ä¸ºäº†æŸ¥çœ‹åº”ç”¨ç¨‹åºæ˜¯å¦è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæˆ‘å¯ä»¥å°è¯•ä½¿ç”¨ä¸€ç»„ä¸æ­£ç¡®å’Œæ­£ç¡®çš„å‡­æ®ç™»å½•ã€‚å½“æˆ‘å°è¯•ç™»å½•æ—¶ï¼Œä¼šç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼Œæ˜¾ç¤ºè¯¥åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸ AndroLab æœåŠ¡å™¨é€šä¿¡ã€‚

![](img/62ec19c06c38e2e74c6ecc994a4df58e.png)

ä¸ºäº†ç»“æŸæˆ‘çš„è®¾ç½®ï¼Œæˆ‘ä½¿ç”¨äº†**ç§»åŠ¨å®‰å…¨æ¡†æ¶** ( *MobSF* )å·¥å…·æ¥åç¼–è¯‘ *InsecureBankv2.apk* æ–‡ä»¶ã€‚è¿™ä½¿å¾—åç¼–è¯‘ APKã€è¯»å–æ¸…å•æ–‡ä»¶ã€è¯†åˆ«æºä»£ç å’Œæ¸…å•æ–‡ä»¶ä¸­çš„é—®é¢˜ã€æå–åº”ç”¨ç¨‹åºçš„è¯ä¹¦ç­‰è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚è®©æˆ‘ä¸å¿…æ‰‹åŠ¨å®Œæˆè¿™é¡¹å·¥ä½œã€‚

![](img/ad7e216eb241a266f992a8391f70f7cc.png)

æˆ‘çš„è®¾ç½®åˆ°æ­¤ç»“æŸï¼Œç°åœ¨æˆ‘å¯ä»¥ç»§ç»­æµ‹è¯•åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´äº†ã€‚

# ç™»å½•æ¼æ´

å½“ç”¨æˆ·å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œè¯¥åº”ç”¨ç¨‹åºä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç™»å½•åã€‚

![](img/a23b86ad52e90a6914e1422aff953f3c.png)

æ­¤ç™»å½•ä¼šå‘ç°è®¸å¤šä¸åŒçš„å®‰å…¨é—®é¢˜ï¼Œä¸‹é¢çš„å°èŠ‚å°†å¯¹æ­¤è¿›è¡Œæ¦‚è¿°ã€‚

## ç™»å½•æ—è·¯

åˆ©ç”¨ *MobSF* æ”¶é›†çš„ä¿¡æ¯ï¼Œæˆ‘å†³å®šä»æŸ¥çœ‹ **AndroidManifest.xml** æ–‡ä»¶å¼€å§‹ã€‚æµè§ˆè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæˆ‘æ³¨æ„åˆ°æœ‰å››ä¸ªæ´»åŠ¨è¢«å¯¼å‡ºã€‚

> æ³¨æ„:ä¸€ä¸ª **Android æ´»åŠ¨**æ˜¯ **Android** åº”ç”¨ç¨‹åºç”¨æˆ·ç•Œé¢çš„ä¸€ä¸ªå±å¹•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒAndroid æ´»åŠ¨éå¸¸ç±»ä¼¼äºæ¡Œé¢åº”ç”¨ç¨‹åºä¸­çš„ windowsã€‚ä¸€ä¸ª Android åº”ç”¨ç¨‹åºå¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ´»åŠ¨ï¼Œå³ä¸€ä¸ªæˆ–å¤šä¸ªå±å¹•ã€‚

![](img/a907561120ea3a6b5b9a78630ea77496.png)

æˆ‘å‡è®¾æ´»åŠ¨åç§°â€œ *PostLogin* â€è¡¨ç¤ºæˆ‘ç™»å½•(â€œpostâ€)åæ˜¾ç¤ºçš„æ´»åŠ¨ã€‚ä½¿ç”¨ ADBï¼Œæˆ‘å¯ä»¥è°ƒç”¨è¿™ä¸ªå¯¼å‡ºçš„æ´»åŠ¨ã€‚

```
adb shell am start -n com.android.insecurebankv2/com.android.insecurebankv2.PostLogin
```

è¿™è®©æˆ‘æƒ³åˆ°äº†ä¸€ä¸ªåªæœ‰åœ¨æˆåŠŸç™»å½•åæ‰å¯ç”¨çš„æ–°æ´»åŠ¨ï¼Œæ¼”ç¤ºäº†å¯ä»¥å®Œå…¨ç»•è¿‡ç™»å½•ã€‚

![](img/472372a0d64586c31bb07cc6675a8eb1.png)

## ä¸ºç®¡ç†å‘˜éšè—åˆ›å»ºç”¨æˆ·æŒ‰é’®

æˆ‘å†³å®šæŸ¥çœ‹ä¸€ä¸‹â€œ *LoginActivity* â€æºä»£ç ï¼Œçœ‹çœ‹æ˜¯å¦è¿˜æœ‰å…¶ä»–å¯åˆ©ç”¨çš„æ¼æ´ã€‚

![](img/7b38ac4e4dfdc4bf919fd08a112370c2.png)

æˆ‘å‘ç°ç™»å½•æ´»åŠ¨æœ‰ä¸€ä¸ªéšè—çš„æŒ‰é’®ã€‚æ‰§è¡Œæ£€æŸ¥ä»¥ç¡®å®šåä¸ºâ€œ *is_admin* â€çš„èµ„æºå­—ç¬¦ä¸²æ˜¯å¦è¢«è®¾ç½®ä¸ºâ€œ *no* â€ã€‚å¦‚æœè¿™æ˜¯çœŸçš„ï¼Œé‚£ä¹ˆä½¿ç”¨â€œ *setVisibility(8)* â€æ–¹æ³•å°†æŒ‰é’®è®¾ç½®ä¸ºä¸å¯è§ï¼Œè€Œä¸å ç”¨ä»»ä½•å¸ƒå±€ç©ºé—´ã€‚æˆ‘å¯ä»¥é€šè¿‡ä¿®è¡¥åº”ç”¨ç¨‹åºå¹¶å°†è¯¥å€¼ä»â€œ*å¦*â€æ›´æ”¹ä¸ºâ€œ*æ˜¯*â€(**å‚è§å‚è€ƒæ–‡çŒ®**)ã€‚æˆ‘ä½¿ç”¨ **apktool** æ¥åç¼–è¯‘ APKï¼Œè¿™å°†åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰åç¼–è¯‘çš„èµ„æºæ–‡ä»¶ã€‚

```
apktool d InsecureBankv2.apk
```

ç”±äºè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²èµ„æºï¼Œæˆ‘éœ€è¦ä¿®æ”¹çš„å€¼åº”è¯¥ä½äº **strings.xml** æ–‡ä»¶ä¸­çš„â€œ */res/values/* â€ç›®å½•ä¸‹ã€‚æˆ‘æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå°†â€œ*æ˜¯ _ ç®¡ç†*â€å€¼ä»â€œ*å¦*â€æ›´æ”¹ä¸ºâ€œ*æ˜¯*â€ï¼Œç„¶åä¿å­˜æ›´æ”¹ã€‚

![](img/fe5bc939ce224b4584f36fe3ee676129.png)

æˆ‘å†æ¬¡ä½¿ç”¨ **apktool** ç”¨ç°åœ¨ä¿®æ”¹è¿‡çš„ **strings.xml** æ–‡ä»¶é‡æ–°æ„å»ºåº”ç”¨ç¨‹åºã€‚

```
apktool b -f -d InsecureBankv2/
```

ç§»åŠ¨åº”ç”¨ç¨‹åºä¸å…è®¸æ‚¨åœ¨æ²¡æœ‰ç­¾åçš„æƒ…å†µä¸‹åœ¨æ¨¡æ‹Ÿå™¨/æ‰‹æœºä¸Šå®‰è£…é‡å»ºçš„ APKã€‚ä¸ºæ­¤ï¼Œæˆ‘éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ª**å¯†é’¥åº“**ã€‚åœ¨åˆ›å»ºå¯†é’¥åº“æ—¶ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ª**å¯†ç **ï¼Œç¨åä¼šç”¨åˆ°å®ƒã€‚åˆ›å»ºå¯†é’¥åº“æ—¶æ˜¾ç¤ºçš„å…¶ä»–å­—æ®µå¯ä»¥ç®€å•åœ°ç•™ç©ºã€‚

```
keytool -genkey -v -keystore ctf.keystore -alias ctfKeystore -keyalg RSA -keysize 2048 -validity 10000
```

åˆ›å»ºäº†å¯†é’¥åº“ä¹‹åï¼Œæˆ‘ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º **jarsigner** çš„å·¥å…·å¯¹ APK è¿›è¡Œç­¾åäº†ã€‚å½“æç¤ºè¾“å…¥å¯†ç æ—¶ï¼Œæˆ‘æä¾›äº†ä¹‹å‰åˆ›å»ºå¯†é’¥åº“æ—¶ä½¿ç”¨çš„å¯†ç ã€‚

```
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore ctf.keystore InsecureBankv2/dist/InsecureBankv2.apk ctfKeystore
```

æ¥ä¸‹æ¥ï¼Œæˆ‘éªŒè¯ APK å·²ç»ä½¿ç”¨ **jarsigner** ç­¾åäº†ã€‚

```
jarsigner -verify -verbose -certs InsecureBankv2.apk
```

æœ€åï¼Œä½¿ç”¨åä¸º **zipalign** çš„å·¥å…·å¯¹å‡† apkï¼Œä»¥å®ç°æœ€ä½³è£…è½½ã€‚

```
zipalign -v 4 InsecureBankv2.apk InsecureBankv2-aligned.apk
```

åœ¨ä½¿ç”¨ ADB å®‰è£…æˆ‘çš„æ–° APK ä¹‹å‰ï¼Œæˆ‘ä»æˆ‘çš„æ¨¡æ‹Ÿå™¨ä¸­å¸è½½äº†åº”ç”¨ç¨‹åºçš„æœªæ›´æ”¹ç‰ˆæœ¬ï¼Œå…¶ä¸­â€œ *is_admin* â€å­—ç¬¦ä¸²èµ„æºè®¾ç½®ä¸ºâ€œ *yes* â€ã€‚

```
adb install InsecureBankv2-aligned.apk
```

æˆåŠŸå®‰è£…åï¼Œæˆ‘æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªåä¸ºâ€œ*åˆ›å»ºç”¨æˆ·*çš„æ–°æŒ‰é’®å‡ºç°äº†ã€‚

![](img/03bc4767eda106d012be2364d2a4f881.png)

ç„¶è€Œï¼ŒæŸ¥çœ‹" *createUser()* "æ–¹æ³•çš„æºä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¯¥æŒ‰é’®å®é™…ä¸Šå¹¶ä¸å…è®¸æˆ‘ä»¬åˆ›å»ºç”¨æˆ·ï¼Œå› æ­¤è¿™å°±å¾—å‡ºè¯¥æ¼æ´çš„ç»“è®ºã€‚

![](img/ea7eea5cd3b74eacd60b6fa970b8242d.png)

## å¼€å‘è€…ç™»å½•

æˆ‘å†³å®šä»”ç»†çœ‹çœ‹å½“é€‰æ‹©ç™»å½•æŒ‰é’®æ—¶å¯åŠ¨çš„â€œ *LoginActivity* â€çš„â€œ *performLogin()* â€æ–¹æ³•ã€‚

![](img/97f2c9c21b0493ee7626e23eab74399c.png)

è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„ intentï¼Œè¯¥ intent å¯åŠ¨â€œ *DoLogin* â€æ´»åŠ¨ï¼Œå¹¶å°†ç”¨æˆ·è¾“å…¥çš„å‡­è¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥æ´»åŠ¨ã€‚æŸ¥çœ‹è¿™ä¸ªæ´»åŠ¨çš„æºä»£ç ï¼Œå‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„æ–¹æ³•ï¼Œå«åšâ€œ *postData()* â€ã€‚

![](img/ca4da50024c8fdb1fb75a25db9486fb2.png)

è¿™ä¸ªæ–¹æ³•ç”¨äºå‘æœåŠ¡å™¨å‘é€ç™»å½•å‡­è¯ï¼Œä½†æ˜¯æˆ‘å‘ç°å¦‚æœæä¾›äº†ç”¨æˆ·åâ€œ *devadmin* â€ï¼Œé‚£ä¹ˆå‡­è¯å°†è¢«å‘é€åˆ°å¦ä¸€ä¸ªåä¸ºâ€œ */devlogin* â€çš„ç«¯ç‚¹ã€‚æˆ‘å‘ç°ï¼Œå¦‚æœæˆ‘è¾“å…¥ç”¨æˆ·åâ€œ *devadmin* â€ï¼Œç„¶åæä¾›ä»»ä½•å¯†ç ï¼Œæˆ‘éƒ½å¯ä»¥æˆåŠŸç™»å½•ã€‚

![](img/9002b910cf1cccfadb6e9a481c2896c0.png)

æœ‰è¶£çš„æ˜¯ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œä½¿ç”¨â€œ *saveCreds()* â€æ–¹æ³•ä¿å­˜å‡­è¯ã€‚è¿™ä¸ªæ–¹æ³•çš„ä»£ç å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°ã€‚

![](img/ef755c3501a5769b66d24f9a31e9d3bc.png)

è¿™ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªåä¸ºâ€œ *mySharedPreferences* çš„æ–°æ–‡ä»¶ï¼Œå¦‚æœå®ƒè¿˜ä¸å­˜åœ¨çš„è¯ã€‚ç„¶åï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ **base64 ç¼–ç **ç”¨æˆ·åï¼Œå¹¶ä½¿ç”¨ **AES åŠ å¯†**åŠ å¯†å¯†ç ï¼Œç„¶åå°†å®ƒä»¬å­˜å‚¨åœ¨å…±äº«é¦–é€‰é¡¹æ–‡ä»¶ä¸­ã€‚æ¯å½“ç”¨æˆ·ä½¿ç”¨å…¶å‡­æ®æˆåŠŸç™»å½•æ—¶ï¼Œè¯¥æ–‡ä»¶éƒ½ä¼šè¢«è¦†ç›–ã€‚ç¨åçŸ¥é“è¿™ä¸€ç‚¹å¾ˆé‡è¦â€¦(ä¼ç¬”)ğŸ˜ã€‚

## å‡­è¯çš„ä¸å®‰å…¨å­˜å‚¨

ç™»å½•æ´»åŠ¨ä½¿ç”¨æˆ·èƒ½å¤Ÿè‡ªåŠ¨å¡«å……å‡­è¯ï¼Œä»¥é¿å…ä»–ä»¬æ¯æ¬¡ç™»å½•æ—¶éƒ½å¿…é¡»è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚æŸ¥çœ‹" *LoginActivity* "æºä»£ç ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º" *fillData()* "çš„æ–¹æ³•æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚

![](img/df7f3ba758638284ecfae1633667c2ce.png)

è¿™ä¸ªæ–¹æ³•çš„ä»£ç å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°ã€‚

![](img/c0579d84570cba05f6553d0d5dca751e.png)

â€œ *fillData()* â€æ–¹æ³•æ­£åœ¨æ‰“å¼€ä¸€ä¸ªåä¸ºâ€œ *mySharedPreferences* â€çš„æ–‡ä»¶ï¼Œæˆ‘ä¹‹å‰åœ¨æ£€æŸ¥â€œDoLoginâ€æ´»åŠ¨æºä»£ç æ—¶çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶æ˜¯ç”±â€œ *saveCreds()* â€æ–¹æ³•åˆ›å»ºçš„ã€‚åœ¨ç”¨äºå¡«å……ç™»å½•è¾“å…¥å­—æ®µä¹‹å‰ï¼Œç”¨æˆ·åå’Œå¯†ç åˆ†åˆ«è¢«è§£ç å’Œè§£å¯†ã€‚æˆ‘å¯ä»¥ä½¿ç”¨ **ADB** æ¥è¯†åˆ«â€œ *mySharedPreferences* â€æ–‡ä»¶å­˜å‚¨åœ¨ *Insecurebankv2* åº”ç”¨ç¨‹åºçš„ç§æœ‰ç›®å½•ä¸­çš„ä»€ä¹ˆä½ç½®

> æ³¨æ„:é™¤éæ‚¨è‡³å°‘æˆåŠŸç™»å½•ä¸€æ¬¡ï¼Œå¦åˆ™ä¸ä¼šåˆ›å»ºè¯¥æ–‡ä»¶ã€‚

![](img/45ab0745c19889306328079bf47ae7f8.png)

ä½¿ç”¨ **ADB** ï¼Œæˆ‘å¯ä»¥å°†æ–‡ä»¶æ‹‰åˆ°æˆ‘çš„æœ¬åœ°æœºå™¨ä¸Šè¿›è¡Œè¿›ä¸€æ­¥æ£€æŸ¥ã€‚

```
adb pull /data/data/com.android.insecurebankv2/shared_prefs/mySharedPreferences.xml
```

æŸ¥çœ‹æ–‡ä»¶ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ç”¨æˆ·åå’Œå¯†ç æ˜¯ base64 ç¼–ç çš„ã€‚

![](img/e6fb70725afb2b13425e8e768e0f3be2.png)

é€šè¿‡æŸ¥çœ‹ä¹‹å‰çš„æºä»£ç ï¼Œæˆ‘çŸ¥é“ç”¨æˆ·ååªè¿›è¡Œäº† base64 ç¼–ç ã€‚ä½¿ç”¨ä¸€ä¸ªåœ¨çº¿å·¥å…·ï¼Œå¦‚ **CyberChef** ï¼Œæˆ‘å¯ä»¥ç ´è§£ç”¨æˆ·åã€‚

![](img/b9403b057b9851986ac390cfd13d7ae9.png)

é˜…è¯»å‰é¢çš„æºä»£ç ï¼Œæˆ‘è¿˜å¯ä»¥çœ‹åˆ°å¯†ç æ˜¯ç”¨ä¸€ä¸ªåä¸ºâ€œ *CryptoClass* â€çš„ç±»ä¸­çš„ä¸€ä¸ªåä¸ºâ€œ*aesecuredtstring()*çš„æ–¹æ³•åŠ å¯†çš„ã€‚æŸ¥çœ‹è¿™ä¸ªç±»çš„æºä»£ç ï¼Œæˆ‘çœ‹åˆ°å¼€å‘äººå‘˜ä½¿ç”¨ AES åŠ å¯†å’Œ**å¯†ç å—é“¾æ¥(CBC)** æ¨¡å¼ï¼Œä½†æ˜¯ä½¿ç”¨äº†**é™æ€åˆå§‹åŒ–å‘é‡**å’Œ**ç¡¬ç¼–ç åŠ å¯†å¯†é’¥**ã€‚

![](img/618bf2ddad43815b60b56abaa17ec6f0.png)

å‡ºäºå­¦ä¹ ç›®çš„ï¼Œæˆ‘å†³å®šæ¼”ç¤ºå‡ ç§ä¸åŒçš„æ–¹æ³•æ¥æ£€ç´¢å¯†ç ğŸ˜ƒã€‚

ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ç®€å•åœ°ä½¿ç”¨ä¸€ä¸ªåœ¨çº¿å·¥å…·ï¼Œå¦‚ **CyberChef** å¹¶æ’å…¥æ‰€éœ€çš„ä¿¡æ¯(å³åŠ å¯†å¯†é’¥ã€ivã€å¯†æ–‡)æ¥è§£å¯†å¯†ç ã€‚å¯¹äºè¿™ç§æ–¹æ³•ï¼Œæˆ‘è§£ç äº† base64 å¯†ç ï¼Œå¹¶å°†å…¶ç¼–ç ä¸º**åå…­è¿›åˆ¶**ï¼Œç„¶åå°†å…¶è¾“å…¥åˆ°**ç½‘ç»œé»‘å®¢**å·¥å…·ä¸­ã€‚è¿™æ ·å°±æˆåŠŸè§£å¯†äº†å­˜å‚¨åœ¨â€œmySharedPreferencesâ€æ–‡ä»¶ä¸­çš„å¯†ç (å³ Jack@123$)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/3d25d7c8d4fde567a439e76b5b83e64a.png)

å¦ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªç®€å•çš„ python è„šæœ¬ï¼Œå¹¶ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„" *pycryptodome* "åŒ…æ¥è§£å¯†å¯†ç ã€‚

![](img/9d962dc5c988dd8f63d914ed23b6d3e1.png)

æˆ‘çš„æœ€åä¸€ä¸ªæ–¹æ³•æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªåä¸º **Frida** çš„å·¥å…·ï¼Œä½¿ç”¨åº”ç”¨ç¨‹åºè‡ªå·±çš„æ–¹æ³•ä¹‹ä¸€æ¥è§£å¯†å¯†ç ã€‚æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªæŒ‡å—ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæœ‰ç”¨çš„ä¾‹å­(**è§å‚è€ƒæ–‡çŒ®**)ï¼Œå‘Šè¯‰æˆ‘å¦‚ä½•ç”¨è‡ªå·±çš„å‚æ•°æŒ‚é’©å’Œè°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚è¿™å¯ä»¥ç”¨æ¥æŒ‚æ¥â€œ *CryptoClass* â€ä¸­ä¸€ä¸ªåä¸ºâ€œ *aesDeccryptedString()* â€çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°å–ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œç„¶åç”¨æˆ‘è‡ªå·±çš„å‚æ•°(å³åŠ å¯†çš„å¯†ç )è°ƒç”¨å®ƒï¼Œç„¶åè§£å¯†ã€‚JavaScript ä»£ç (æŒ‚é’©)å¦‚ä¸‹æ‰€ç¤º:

![](img/932d43d020a20967b383ce422a1cd7e6.png)

ä¸‹é¢æä¾›äº†ç”¨äºåŠ è½½è¿™ä¸ªé’©å­çš„ python è„šæœ¬ã€‚

![](img/bc0841c96319b5ccb3e6d2c3e157f2e3.png)

æˆ‘ç¡®ä¿ **Frida æœåŠ¡å™¨**æ­£åœ¨æˆ‘çš„æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œï¼Œç„¶åæ‰§è¡Œæˆ‘çš„ python è„šæœ¬æ¥æ³¨å…¥ JavaScript ä»£ç ã€‚ä¸€æ—¦æˆ‘çš„è„šæœ¬æˆåŠŸåŠ è½½ï¼Œæˆ‘éœ€è¦å•å‡»â€œ*è‡ªåŠ¨å¡«å……å‡­è¯*â€æŒ‰é’®ï¼Œè¿™å°†å¯¼è‡´â€œ *aesDeccryptedString()* â€æ–¹æ³•è¢«è°ƒç”¨ï¼Œå®ƒçš„å‚æ•°å°†è¢«æˆ‘çš„æ–°å‚æ•°(å³åŠ å¯†çš„å¯†ç )è¦†ç›–ã€‚è¿™æˆåŠŸåœ°è§£å¯†äº†å¯†ç ã€‚

![](img/0b93cc0aead51eaa736abb5a2faa3805.png)

åœ¨æˆ‘çš„è¾“å‡ºä¸­ï¼Œæˆ‘é¦–å…ˆå°è¯•è‡ªåŠ¨å¡«å……ç”¨æˆ·â€œ *jack* â€çš„å‡­è¯ï¼Œä½œä¸ºæ¦‚å¿µè¯æ˜ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ä»–çš„å¯†ç ã€‚ç„¶åï¼Œæˆ‘å°è¯•è‡ªåŠ¨å¡«å……ç”¨æˆ·" *dinesh* "çš„å‡­è¯ï¼Œä½†æ­£å¦‚ä¸Šé¢çš„è¾“å‡ºæ‰€ç¤ºï¼Œæˆ‘çš„ frida è„šæœ¬ç”¨ç”¨æˆ·" *jack* "çš„åŠ å¯†å¯†ç è¦†ç›–äº†ä»–çš„åŠ å¯†å¯†ç ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†è§£å¯†ã€‚

# ç»“æŸè¯­

æˆ‘çš„â€œinsecurebank v2â€Android åº”ç”¨ç¨‹åºæ¼”ç»ƒçš„ç¬¬ 1 éƒ¨åˆ†åˆ°æ­¤ç»“æŸã€‚åœ¨ç¬¬ 2 éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†ä¼šçœ‹åˆ°æ›´å¤šå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å‘ç°çš„æ¼æ´ï¼Œå¹¶è¯•å›¾å±•ç¤ºå®ƒä»¬æ˜¯å¦‚ä½•è¢«åˆ©ç”¨çš„ã€‚æ„Ÿè°¢æ‚¨é˜…è¯»åˆ°æœ€åï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬ 2 éƒ¨åˆ†å†è§ğŸ˜„ï¼

# å‚è€ƒ

*   [https://github.com/dineshshetty/Android-InsecureBankv2](https://github.com/dineshshetty/Android-InsecureBankv2)
*   (**è®¾ç½®æŒ‡å—**)[https://github . com/dineshshetty/Android-insecurebank v2/blob/master/Usage % 20g uide . pdf](https://github.com/dineshshetty/Android-InsecureBankv2/blob/master/Usage%20Guide.pdf)
*   (**æ‰“è¡¥ä¸ APK**)[https://medium . com/@ sandeepcirusanagunla/decompile-and-recompile-an-Android-apk-using-apk tool-3d 84c 2055 a82](https://medium.com/@sandeepcirusanagunla/decompile-and-recompile-an-android-apk-using-apktool-3d84c2055a82)
*   (**å¼—é‡Œè¾¾ä»£ç é“¾æ¥**)[https://book . hack tricks . XYZ/mobile-apps-pentest/Android-app-pentest/Frida-tutorial/Frida-tutorial-2](https://book.hacktricks.xyz/mobile-apps-pentesting/android-app-pentesting/frida-tutorial/frida-tutorial-2)