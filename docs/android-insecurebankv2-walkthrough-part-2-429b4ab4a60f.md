# Android å®‰å…¨é“¶è¡Œ 2 æ¼”ç»ƒ:ç¬¬ 2 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://infosecwriteups.com/android-insecurebankv2-walkthrough-part-2-429b4ab4a60f?source=collection_archive---------1----------------------->

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ç»§ç»­ä»‹ç»ç”± GitHub ç”¨æˆ· *dineshshetty* åˆ›å»ºçš„*å®‰å…¨é“¶è¡Œ v2* Android åº”ç”¨ç¨‹åºã€‚æŸ¥çœ‹**ç¬¬ 1 éƒ¨åˆ†**ï¼Œäº†è§£å¦‚ä½•è®¾ç½®åº”ç”¨ç¨‹åºä»¥åŠæˆ‘å·²ç»æ¼”ç¤ºè¿‡çš„ä¸€äº›åº”ç”¨ç¨‹åºçš„ä¸å®‰å…¨æ€§ã€‚æˆ‘åœ¨ä¸‹é¢çš„å‚è€ƒèµ„æ–™ä¸­ç•™ä¸‹äº†åº”ç”¨ç¨‹åº GitHub åº“çš„é“¾æ¥ã€‚

![](img/986c5446f38e14fc9a30a004832033dd.png)

# æ”¾å¼ƒ

æ­£å¦‚æˆ‘åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­æåˆ°çš„ï¼Œæˆ‘å†™è¿™ç¯‡æ–‡ç« æ˜¯å‡ºäºå­¦ä¹ æ›´å¤šå…³äº Android ç§»åŠ¨åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„å…´è¶£ã€‚è¿™ç¯‡æ–‡ç« æ˜¾ç„¶ä¼šåŒ…å«å…³äº*å®‰å…¨é“¶è¡Œ v2* Android åº”ç”¨ç¨‹åºä¸­å­˜åœ¨çš„æ¼æ´çš„å‰§é€ã€‚æˆ‘é¼“åŠ±è¯»è€…å°½å¯èƒ½å¤šåœ°åˆ©ç”¨æ¼æ´ï¼Œå¦‚æœæ‚¨é‡åˆ°å›°éš¾æˆ–å¸Œæœ›çœ‹åˆ°åˆ©ç”¨ä¸å®‰å…¨çš„æ½œåœ¨ä¸åŒæ–¹æ³•ï¼Œè¯·ç¨åå†æ¥é˜…è¯»æœ¬æ–‡ã€‚æˆ‘ä»¬å¼€å§‹å§ğŸ˜„ï¼

# æ˜“å—æ”»å‡»çš„ Android åº”ç”¨ç¨‹åºç»„ä»¶

ç»§ç»­æˆ‘åœ¨**ç¬¬ 1 éƒ¨åˆ†**ä¸­çš„ *InsecureBankv2* åº”ç”¨çš„æ¼”ç»ƒï¼Œæˆ‘å†³å®šä½¿ç”¨ä¸€ä¸ªåä¸º **Drozer** çš„å·¥å…·æ¥è¯†åˆ«åº”ç”¨çš„ Android ç»„ä»¶çš„ä»»ä½•æ¼æ´ã€‚æˆ‘å¯ä»¥ä½¿ç”¨ Drozer æ¥åˆ—ä¸¾åº”ç”¨ç¨‹åºçš„æ”»å‡»é¢ï¼Œå¹¶ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ‰¾åˆ°ä»»ä½•æ¼æ´ã€‚

```
run app.package.attacksurface com.android.insecurebankv2
```

è¿è¡Œä¸Šé¢çš„å‘½ä»¤åï¼Œä¼šæä¾›ä»¥ä¸‹è¾“å‡ºã€‚

![](img/f0b21788254a212815303cf70b977f89.png)

æŸ¥çœ‹è¾“å‡ºï¼Œæˆ‘å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºå·²ç»**å¯¼å‡ºäº†** **äº”ä¸ªæ´»åŠ¨**ã€**ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨**å’Œ**ä¸€ä¸ªå†…å®¹æä¾›è€…**ã€‚å¦‚æœç»„ä»¶æ˜¯åœ¨åº”ç”¨ç¨‹åºæ¸…å•æ–‡ä»¶ä¸­å¯¼å‡ºçš„ï¼Œé‚£ä¹ˆè®¾å¤‡ä¸Šçš„ä»»ä½•åº”ç”¨ç¨‹åºåªè¦æ‹¥æœ‰é€‚å½“çš„æƒé™ï¼Œå°±å¯ä»¥è®¿é—®è¿™äº›ç»„ä»¶ã€‚åº”ç”¨ç¨‹åºè¿˜å°†æ¸…å•å±æ€§**debuggeable**è®¾ç½®ä¸º trueï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¢«è°ƒè¯•ã€‚è¿™ä¸ºåˆ†æåº”ç”¨ç¨‹åºä¸­æ˜“å—æ”»å‡»çš„ç»„ä»¶æä¾›äº†ä¸€ä¸ªæœ‰ç”¨çš„èµ·ç‚¹ã€‚

> æ³¨æ„:å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ‰€æœ‰è¿™äº›ä¿¡æ¯ä¹Ÿå¯ä»¥æ‰‹åŠ¨åœ¨åº”ç”¨ç¨‹åºçš„ AndroidManifest.xml æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚

## å¯¼å‡ºçš„æ´»åŠ¨

Drozer æ ¹æ®ä¸Šè¿°ç»“æœç¡®å®šäº†äº”é¡¹è¾“å‡ºæ´»åŠ¨ã€‚æˆ‘å·²ç»åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­æåˆ°äº†åº”ç”¨ç¨‹åºçš„ç™»å½•åŠŸèƒ½æ˜¯å¦‚ä½•ç”±äºå¯¼å‡ºçš„æ´»åŠ¨è€Œè¢«ç»•è¿‡çš„ã€‚è¦æ‰¾åˆ°å…³äºè¿™äº›æ´»åŠ¨çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ Drozer åˆ—å‡ºåº”ç”¨ç¨‹åºçš„æ‰€æœ‰å¯¼å‡ºæ´»åŠ¨ã€‚

```
run app.activity.info -a com.android.insecurebankv2
```

ä¸‹é¢çš„è¾“å‡ºæ˜¾ç¤ºäº†åº”ç”¨ç¨‹åºå¯¼å‡ºçš„æ‰€æœ‰æ´»åŠ¨çš„åˆ—è¡¨ã€‚

![](img/e373679deb9857963813f70caf8ef951.png)

è¾“å‡ºæ˜¾ç¤ºäº†æ´»åŠ¨çš„åç§°ä»¥åŠå¯åŠ¨å®ƒæ‰€éœ€çš„æƒé™ã€‚è¿™äº›æ´»åŠ¨çš„æƒé™éƒ½æ˜¯ **null** ï¼Œè¿™æ„å‘³ç€ä»»ä½•åº”ç”¨ç¨‹åºéƒ½å¯ä»¥å¯åŠ¨å®ƒä»¬ã€‚ä½¿ç”¨ç¬¬ 1 éƒ¨åˆ†ä¸­çœ‹åˆ°çš„ ADB æˆ– Drozerï¼Œæˆ‘å¯ä»¥å¯åŠ¨è¿™äº›æ´»åŠ¨å¹¶ç»•è¿‡ç™»å½•æ´»åŠ¨ã€‚

```
run app.activity.start --component com.android.insecurebankv2 com.android.insecurebankv2.PostLogin
```

ä¸Šé¢çš„ Drozer å‘½ä»¤å¯ä»¥ç”¨æ¥å¯åŠ¨â€œ *PostLogin* æ´»åŠ¨ã€‚

![](img/472372a0d64586c31bb07cc6675a8eb1.png)

## å¯¼å‡ºçš„å¹¿æ’­æ¥æ”¶å™¨

åº”ç”¨ç¨‹åºå·²å¯¼å‡ºä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨ã€‚

> **æ³¨æ„:**å¹¿æ’­æ¥æ”¶å™¨è¢«è®¾è®¡ç”¨äºç›‘å¬ç³»ç»ŸèŒƒå›´å†…çš„å¹¿æ’­äº‹ä»¶(å¦‚ç½‘ç»œæ´»åŠ¨ã€åº”ç”¨ç¨‹åºæ›´æ–°ç­‰)ã€‚)ç„¶åå¦‚æœå¹¿æ’­æ¶ˆæ¯ä¸å¹¿æ’­æ¥æ”¶æœºå†…çš„å½“å‰å‚æ•°åŒ¹é…ï¼Œåˆ™è§¦å‘æŸä¸ªäº‹ä»¶ã€‚

ä½¿ç”¨ Drozerï¼Œæˆ‘å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ‰¾åˆ°å…³äºè¿™ä¸ªæ¥æ”¶å™¨çš„æ›´å¤šä¿¡æ¯ã€‚

```
run app.broadcast.info -a com.android.insecurebankv2 -i 
```

å°†è¿”å›ä»¥ä¸‹ä¿¡æ¯ã€‚

![](img/b0de6b8643984d6fc2b1e00eeeb050b0.png)

æˆ‘çœ‹åˆ°æ¥æ”¶è€…çš„åå­—å«åš" *MyBroadCastReceiver* "å¹¶ä¸”å·²ç»ç”¨ **null** æƒé™å¯¼å‡ºã€‚å·²ç»ä¸ºè¯¥ç»„ä»¶è®¾ç½®äº†ä¸€ä¸ª**æ„å›¾è¿‡æ»¤å™¨**ï¼Œå¸¦æœ‰æ¥æ”¶è€…è®¢é˜…çš„å¹¿æ’­åŠ¨ä½œ(å³â€œ *theBroadcast* â€)ã€‚åœ¨æˆ‘å¯ä»¥é€šè¿‡æŸ¥çœ‹æºä»£ç æ¥åˆ©ç”¨å®ƒä¹‹å‰ï¼Œç¡®å®šè¿™ä¸ªå¹¿æ’­æ¥æ”¶å™¨åšä»€ä¹ˆæ˜¯å¾ˆé‡è¦çš„ã€‚æ–‡ä»¶â€œ*MyBroadcastReciever.java*â€åŒ…å«æ¥æ”¶å¹¿æ’­æ—¶å°†æ‰§è¡Œçš„æºä»£ç ã€‚

![](img/1892b0ca498daefe97c296520a08eabe.png)

åœ¨æºä»£ç ä¸­ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ç”¨äºè§¦å‘å¹¿æ’­æ¥æ”¶å™¨çš„ intent æœ‰ä¸¤ä¸ªå‚æ•°(å³â€œ*phone number*â€&â€œ*new pass*â€)è¢«æ£€ç´¢ã€‚ç„¶å" *mySharedPreferences* "æ–‡ä»¶ä¸­çš„å‡­è¯è¢«æ£€ç´¢å’Œè§£ç /è§£å¯†ï¼Œç„¶åç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å°†ä½¿ç”¨" *smsManager* "ç±»ä½œä¸º**æ–‡æœ¬æ¶ˆæ¯**å‘é€ã€‚åˆ©ç”¨ç›®å‰æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥ç”¨ Drozer è§¦å‘å¹¿æ’­æ¥æ”¶å™¨ã€‚ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨äº†" *theBroadcast* "åŠ¨ä½œï¼Œå¹¶ä¼ é€’äº†ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯è§¦å‘æ¥æ”¶å™¨å’Œæ‰§è¡Œæ¥æ”¶å™¨ä»£ç æ‰€å¿…éœ€çš„ã€‚

```
run app.broadcast.send --action theBroadcast --extra string phonenumber 123456789 --extra string newpass supersecurepass
```

æˆ‘ç°åœ¨å¯ä»¥åœ¨æˆ‘çš„æ¨¡æ‹Ÿå™¨ä¸Šçœ‹åˆ°åº”ç”¨ç¨‹åºå·²ç»å‘é€äº†ä¸€æ¡ SMS æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·çš„æ—§å¯†ç å’Œæˆ‘æŒ‡å®šçš„æ–°å¯†ç ã€‚

![](img/f82856c4da7c71869acab85ee97b898c.png)

è¿™æ¼”ç¤ºäº†ä»»ä½•åº”ç”¨ç¨‹åº(åŒ…æ‹¬æ¶æ„åº”ç”¨ç¨‹åº)å¦‚ä½•èƒ½å¤Ÿå‘è¯¥å¹¿æ’­æ¥æ”¶å™¨å‘é€æ„å›¾ï¼Œä»è€Œä½¿å…¶ä¸å—ä»»ä½•é™åˆ¶åœ°è¢«è§¦å‘ã€‚

## å¯¼å‡ºçš„å†…å®¹æä¾›å•†

åº”ç”¨ç¨‹åºå·²å¯¼å‡ºå†…å®¹æä¾›è€…ã€‚

> **æ³¨æ„:**å†…å®¹æä¾›å•†ç”¨äºä¸å…¶ä»–åº”ç”¨ç¨‹åºå…±äº«åº”ç”¨ç¨‹åºæ•°æ®ï¼Œè¿™äº›æ•°æ®é€šå¸¸å­˜å‚¨åœ¨æ•°æ®åº“æˆ–æ–‡ä»¶ä¸­ã€‚

æˆ‘å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ Drozer æ¥äº†è§£è¿™ä¸ªå¯¼å‡ºçš„å†…å®¹æä¾›è€…çš„æ›´å¤šä¿¡æ¯ã€‚

```
run app.provider.info -a com.android.insecurebankv2
```

ä¸‹å›¾æ˜¾ç¤ºäº†è¿”å›çš„å…³äºå†…å®¹æä¾›å•†çš„ä¿¡æ¯ã€‚

![](img/b6cbcaefbbc9e6262196e6de62c1d5a8.png)

è¯»å†™æƒé™è¢«è®¾ç½®ä¸º **null** ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢æˆ‘é€šè¿‡å†…å®¹æä¾›è€…æŸ¥è¯¢æ•°æ®å­˜å‚¨ã€‚ä¸ºäº†æŸ¥è¯¢è¿™ä¸ªå†…å®¹æä¾›è€…ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ Drozer æ¥è¯†åˆ« URI çš„çš„ä»»ä½•å¯è®¿é—®çš„**å†…å®¹ã€‚**

> æ³¨æ„:å†…å®¹æä¾›å•† URI çš„ begin æ˜¯â€œ ***content://*** â€ï¼Œå¯ä»¥ç”¨æ¥é‡æ„ä¸€ä¸ªè·¯å¾„ï¼Œè¯¥è·¯å¾„å¯ä»¥ä»å†…å®¹æä¾›å•†é‚£é‡Œæ£€ç´¢æ•°æ®ã€‚

```
run scanner.provider.finduris -a com.android.insecurebankv2
```

å‘ç°äº†ä¸€ä¸ªå¯è®¿é—®çš„å†…å®¹æä¾›å•† URIï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/8eda8194a9dd6faf2ac4aab2b14c16e7.png)

ä½¿ç”¨ Drozerï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ ‡è¯†çš„**å†…å®¹ URI** æ¥æŸ¥è¯¢è¿™ä¸ªå†…å®¹æä¾›è€…ã€‚

```
run app.provider.query content://com.android.insecurebankv2.TrackUserContentProvider/trackusers
```

è¿™å°†ä» SQLite æ•°æ®åº“è¿”å›ä¸€ä¸ªç”¨æˆ·åå’Œç”¨æˆ· ID è¡¨ï¼Œè¯¥æ•°æ®åº“è·Ÿè¸ªå†…å®¹æä¾›è€…åç§°æ‰€æš—ç¤ºçš„ç”¨æˆ·ç™»å½•ã€‚

![](img/418ecdd7a8bdde41ca951d0765d759ea.png)

# Android æ¸…å•æ–‡ä»¶å®‰å…¨æ€§

é™¤äº†å£°æ˜åº”ç”¨ç¨‹åºçš„ç»„ä»¶(å³æ´»åŠ¨ã€æœåŠ¡ã€å¹¿æ’­æ¥æ”¶å™¨å’Œå†…å®¹æä¾›è€…)ä¹‹å¤–ï¼Œæ¸…å•æ–‡ä»¶è¿˜ç”¨äºå®šä¹‰å±æ€§ä»¥å¯ç”¨æŸäº›åŠŸèƒ½å¹¶å£°æ˜åº”ç”¨ç¨‹åºæ‰€éœ€çš„æƒé™ã€‚å¦‚æœå¼€å‘äººå‘˜å¯ç”¨æˆ–è¯¯ç”¨äº†æŸäº›å±æ€§ï¼Œä»–ä»¬çš„åº”ç”¨ç¨‹åºå°±å®¹æ˜“å—åˆ°æ”»å‡»ã€‚

## è°ƒè¯•æ¨¡å¼å·²å¯ç”¨

Drozer å‘ç°è¯¥åº”ç”¨ç¨‹åºæ˜¯å¯è°ƒè¯•çš„ã€‚è¿™æ˜¯ç”±äºå¼€å‘äººå‘˜åœ¨æ¸…å•æ–‡ä»¶ä¸­å°†**Android:debuggeable**å±æ€§è®¾ç½®ä¸º **true** ã€‚

![](img/78fc0f63bc0617d3fef7ddc843224593.png)

å¦‚æœæŸä¸ªåº”ç”¨ç¨‹åºè¢«æ ‡è®°ä¸ºå¯è°ƒè¯•ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡è·å–è¯¥åº”ç”¨ç¨‹åºçš„æƒé™æ¥è®¿é—®è¯¥åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘å¯ä»¥åœ¨æˆ‘çš„æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨ä¸€ä¸ª shellï¼Œç„¶ååˆ‡æ¢åˆ°é root ç”¨æˆ·ã€‚ç„¶åæˆ‘å¯ä»¥ä½¿ç”¨ **run-as** æ¥æŸ¥çœ‹è¿™ä¸ªåŒ…çš„ç›®å½•çš„å†…å®¹ï¼Œåœ¨è¿™é‡Œæˆ‘é€šå¸¸æ²¡æœ‰æƒé™ã€‚

![](img/436f908abfe230693db80741228730ec.png)

æˆ‘ç”šè‡³å¯ä»¥ä½¿ç”¨ run-as æ¥æ£€ç´¢é€šå¸¸å®‰å…¨å­˜å‚¨åœ¨åº”ç”¨ç¨‹åºæ•°æ®ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚

```
adb exec-out run-as com.android.insecurebankv2 cat databases/mydb > mydb-copy
```

å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨åä¸º **jdp** (Java è°ƒè¯•å™¨)çš„å·¥å…·æ¥è°ƒè¯•åº”ç”¨ç¨‹åºå¹¶å‘ç°æœ‰è¶£çš„ä¿¡æ¯ã€‚ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨ **jdwp** æ¥è¯†åˆ«åº”ç”¨ç¨‹åºè¿è¡Œåœ¨å“ªä¸ªç«¯å£ä¸Šã€‚åœ¨ç›®æ ‡åº”ç”¨ç¨‹åºå…³é—­æ—¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºå¤„äºæ´»åŠ¨çŠ¶æ€æ—¶å†æ¬¡è¿è¡Œè¯¥å‘½ä»¤ã€‚æ³¨æ„å·²ç»å‡ºç°çš„æ–°ç«¯å£å·ã€‚

> æ³¨æ„:åº”ç”¨ç¨‹åºç«¯å£å¾ˆå¯èƒ½ä¸æœ¬æ–‡ä¸­çœ‹åˆ°çš„ä¸åŒã€‚

```
adb jdwp
```

ç„¶åï¼Œæˆ‘å¯ä»¥åœ¨åº”ç”¨ç¨‹åºç«¯å£å’Œæˆ‘çš„å·¥ä½œç«™ä¹‹é—´åˆ›å»ºä¸€ä¸ªä¸ ADB çš„é€šä¿¡é€šé“ã€‚

```
adb forward tcp:7777 jdwp:2906
```

ä½¿ç”¨ **jdb** ï¼Œæˆ‘å°†è°ƒè¯•å™¨é™„åŠ åˆ°ç›®æ ‡åº”ç”¨ç¨‹åºã€‚

```
jdb -attach localhost:7777
```

å½“é™„åŠ è°ƒè¯•å™¨æ—¶ï¼Œåº”è¯¥æ˜¾ç¤ºä»¥ä¸‹è¾“å‡ºã€‚

![](img/549ef9e9c150fa8d983bf8c84218f8da.png)

æˆ‘å¯ä»¥é€šè¿‡ä½¿ç”¨â€œ*ç±»*â€å’Œâ€œ*æ–¹æ³•*â€å‘½ä»¤æ¥æŸ¥çœ‹åº”ç”¨ç¨‹åºä¸­æœ‰å“ªäº›ç±»å’Œæ–¹æ³•ã€‚æˆ‘è¿˜å¯ä»¥ä½¿ç”¨ **jdb** åœ¨æŸäº›æ–¹æ³•ä¸Šè®¾ç½®ä¸€ä¸ª**æ–­ç‚¹**ï¼Œå¹¶é€šè¿‡ä½¿ç”¨â€œ*stop inâ€*å‘½ä»¤æ¥æ§åˆ¶ app çš„æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°â€œ *LoginActivity* â€ç±»ä¸­æœ‰å“ªäº›æ–¹æ³•ã€‚

```
> methods com.android.InsecureBankv2.LoginActivity
```

è¿™æä¾›äº†ä¸€é•¿ä¸²æ–¹æ³•ã€‚æˆ‘å†³å®šä½¿ç”¨â€œ *creatUser()* â€æ–¹æ³•æ¥æ¼”ç¤ºå¦‚ä½•æ›´æ”¹å±€éƒ¨å˜é‡çš„å€¼ã€‚

![](img/9fa32bb68a8d5b2ee7028d7b4b0fc819.png)

æˆ‘åœ¨è¿™ä¸ªæ–¹æ³•ä¸Šè®¾ç½®äº†ä¸€ä¸ª**æ–­ç‚¹**ï¼Œç„¶åå•å‡» create user æŒ‰é’®ã€‚

> æ³¨æ„:å¦‚æœä½ æ²¡æœ‰çœ‹åˆ°ä¸€ä¸ªåˆ›å»ºç”¨æˆ·æŒ‰é’®ï¼Œé‚£ä¹ˆçœ‹çœ‹è¿™ä¸ªæ–‡ç« ç³»åˆ—çš„ç¬¬ 1 éƒ¨åˆ†å¦‚ä½•ä¿®è¡¥ APKã€‚

```
> stop in com.android.InsecureBankv2.LoginActivity.createUser()
```

è¿™ä¼šå¯¼è‡´å‘½ä¸­æ–­ç‚¹ã€‚æˆ‘å¯ä»¥ä½¿ç”¨â€œ *step* å‘½ä»¤æ¥æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ï¼Œå¹¶ä½¿ç”¨â€œ *locals* å‘½ä»¤æ¥æŸ¥çœ‹ä»£ç æ‰§è¡Œä¸­æŸä¸€ç‚¹çš„ä»»ä½•å±€éƒ¨å˜é‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/2dea323a094328d5e27019ff1628023e.png)

æˆ‘å¯ä»¥ä½¿ç”¨â€œ *set* æ›´æ”¹æ˜¾ç¤ºçš„æ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨â€œ *run* ç»§ç»­æ‰§è¡Œä»£ç ã€‚

![](img/78c5075e58fd5c4c731a12d1dfdaefae.png)

è¿™å°†æ‰“å°æˆ‘çš„æ–°é‚®ä»¶ï¼Œè€Œä¸æ˜¯åŸæ¥çš„ã€‚

![](img/2efbbe974575712dab41db3c19d17e7d.png)

## åº”ç”¨ç¨‹åºå¤‡ä»½å·²å¯ç”¨

åº”ç”¨ç¨‹åºåœ¨æ¸…å•æ–‡ä»¶ä¸­å°† **android:allowBackup** å±æ€§è®¾ç½®ä¸º **true** ã€‚

![](img/d1825176ad28e95b0c0f8b60d25c68e4.png)

è¿™ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ ADB å¤‡ä»½åº”ç”¨ç¨‹åºæ•°æ®ï¼Œå³ä½¿è¯¥è®¾å¤‡ä¸æ˜¯æ ¹è®¾å¤‡ã€‚æˆ‘å¯ä»¥ä½¿ç”¨ **adb backup** å‘½ä»¤æ¥åˆ›å»ºâ€œ*com . htbridge . insecurebank v2*â€åŒ…çš„å¤‡ä»½ã€‚æ ¹æ®æ‚¨ä½¿ç”¨çš„ Android æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæç¤ºæ‚¨è¾“å…¥å¯†ç ï¼Œç¨åæ‚¨å°†éœ€è¦è¾“å…¥å¯†ç æ¥è§£å‹ç¼©å¤‡ä»½æ–‡ä»¶ã€‚

```
adb backup com.android.insecurebankv2
```

è¿™å°†åˆ›å»ºä¸€ä¸ªå¿…é¡»è§£å‹ç¼©çš„â€œ *backup.ab* â€æ–‡ä»¶ã€‚æˆ‘å¯ä»¥é€šè¿‡ä½¿ç”¨ **abe.jar** æ–‡ä»¶å°†å¤‡ä»½æ–‡ä»¶è½¬æ¢æˆ tar æ–‡ä»¶æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚æˆ‘è¿˜æä¾›äº†åˆ›å»ºå¤‡ä»½æ–‡ä»¶æ—¶ä½¿ç”¨çš„å¯†ç (å³å¯†ç )ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```
java -jar abe.jar unpack backup.ab application-data.tar password
```

ç„¶åï¼Œæˆ‘å¯ä»¥è§£å‹ç¼©" *application-data.tar"* æ–‡ä»¶ï¼Œå¹¶æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶çš„å†…å®¹ã€‚

```
tar xvf application-data.tar
```

é€šè¿‡æŸ¥çœ‹å¤‡ä»½çš„å†…å®¹ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°è¯¸å¦‚â€œ *mySharedPreferences* â€å’Œâ€œ *mydb* â€ä¹‹ç±»çš„æ–‡ä»¶ï¼Œå®ƒä»¬åŒ…å«å…³äºç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ã€‚

![](img/7b48cd570a16cb07b0851a80e84a5285.png)

# ä¸å®‰å…¨æ—¥å¿—è®°å½•

åœ¨æœ¬æ–‡ä¹‹å‰å±•ç¤ºçš„ä¸€äº›æºä»£ç ç‰‡æ®µä¸­ï¼Œæ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°åº”ç”¨ç¨‹åºåœ¨æ‰§è¡Œå¤§é‡ä»»åŠ¡æ—¶ä¼šäº§ç”Ÿ**æ—¥å¿—æ¶ˆæ¯**ã€‚ä¾‹å¦‚ï¼Œæ¯å½“ç”¨æˆ·å°è¯•ç™»å½•æ—¶,â€œDoLoginâ€æ´»åŠ¨éƒ½ä¼šç”Ÿæˆä¸€æ¡è°ƒè¯•æ—¥å¿—æ¶ˆæ¯ã€‚

![](img/f7762e3351bba1547b2e54d044240d17.png)

è¿™äº›æ—¥å¿—å¯ä»¥ä½¿ç”¨**æ—¥å¿—ç›®å½•**è¿›è¡Œè½¬å‚¨ã€‚ä¸‹é¢çš„å‘½ä»¤å°†æ˜¾ç¤ºåº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„æ‰€æœ‰æ—¥å¿—æ¶ˆæ¯ã€‚

```
adb logcat | grep "$(adb shell ps | grep com.android.insecurebankv2  | awk '{print $2}')"
```

å¦‚æœæˆ‘è¯•å›¾åœ¨ **logcat** è¿è¡Œæ—¶ç™»å½•ï¼Œæˆ‘ä¼šçœ‹åˆ°ä¸€æ¡æ—¥å¿—æ¶ˆæ¯ï¼Œæ˜¾ç¤ºæˆ‘ç”¨æ¥æˆåŠŸç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç ã€‚

![](img/251db2ec16529cdaa3303fb98ae4a89a.png)

# æ„å›¾å—…æ¢å’Œæ³¨å…¥

åº”ç”¨ç¨‹åºå®¹æ˜“å—åˆ°æ„å›¾å—…æ¢å’Œæ„å›¾æ³¨å…¥çš„æ”»å‡»ã€‚

> æ³¨æ„:æ„å›¾æ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¼ é€’å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯·æ±‚å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºç»„ä»¶çš„æ“ä½œã€‚

åº”ç”¨ç¨‹åºåœ¨æ›´æ”¹ç”¨æˆ·å¯†ç æ—¶ä½¿ç”¨éšå«çš„æ„å›¾ã€‚è¯¥æ¶ˆæ¯è¢«å¹¿æ’­åˆ°è®¾å¤‡ä¸Šçš„æ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åŒ…å«æ•æ„Ÿæ•°æ®ã€‚

> æ³¨æ„:æœ‰ä¸¤ç§ç±»å‹çš„æ„å›¾ï¼Œéšå«çš„å’Œæ˜ç¡®çš„ã€‚ä¸€ä¸ª**æ˜ç¡®çš„æ„å›¾**æ˜¯ä½ ç”¨æ¥å¯åŠ¨ä¸€ä¸ªç‰¹å®šçš„åº”ç”¨ç»„ä»¶ï¼Œæ¯”å¦‚ä½ çš„åº”ç”¨ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„æ´»åŠ¨æˆ–æœåŠ¡ã€‚ä¸€ä¸ª**éšå«æ„å›¾**æŒ‡å®šä¸€ä¸ªåŠ¨ä½œï¼Œè¯¥åŠ¨ä½œå¯ä»¥è°ƒç”¨è®¾å¤‡ä¸Šèƒ½å¤Ÿæ‰§è¡Œè¯¥åŠ¨ä½œçš„ä»»ä½•åº”ç”¨ã€‚

æˆ‘å¯ä»¥ä½¿ç”¨ **Drozer** æ‰§è¡Œ**æ„å›¾å—…æ¢**ï¼Œå¹¶æŸ¥çœ‹æ„å›¾çš„æ•æ„Ÿå†…å®¹ã€‚ä»¥ä¸‹å‘½ä»¤ç”¨äºæ³¨å†Œä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨ï¼Œè¯¥æ¥æ”¶å™¨å¯ä»¥æ ¹æ®**åŠ¨ä½œ**å—…æ¢ç‰¹å®šæ„å›¾ã€‚é€šè¿‡å‰é¢å¯¹æ¸…å•æ–‡ä»¶çš„åˆ†æï¼Œæˆ‘çŸ¥é“äº†æ¥æ”¶è€…æ„å›¾è¿‡æ»¤å™¨æ‰€ä½¿ç”¨çš„åŠ¨ä½œ(å³â€œ *theBroadcast* â€)ç»„ä»¶

```
run app.broadcast.sniff --action "theBroadcast"
```

å½“æˆ‘è¯•å›¾æ›´æ”¹å¯†ç æ—¶ï¼ŒDrozer ä¼šæ”¶åˆ°æˆ‘çš„æ„å›¾ï¼Œæˆ‘å¯ä»¥æŸ¥çœ‹æ•æ„Ÿæ•°æ®ã€‚

![](img/7e98832dbdae6dd9a2cd3040ea1d3104.png)

**æ„å›¾æ³¨å…¥æ”»å‡»**é€šè¿‡å°†æ„å›¾æ³¨å…¥åº”ç”¨ç¨‹åºç»„ä»¶æ¥æ‰§è¡Œåº”ç”¨ç¨‹åºå·¥ä½œæµé€šå¸¸ä¸å…è®¸çš„ä»»åŠ¡ã€‚æˆ‘åœ¨å‰é¢æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡æ³¨å…¥åŒ…å«æˆ‘è‡ªå·±çš„æ•°æ®çš„ç»„ä»¶æ¥åˆ©ç”¨ä¸€ä¸ªæ˜“å—æ”»å‡»çš„å¹¿æ’­æ¥æ”¶å™¨ã€‚

```
run app.broadcast.send --action theBroadcast --extra string phonenumber 123456789 --extra string newpass supersecurepass
```

# ç»“æŸè¯­

è¿™å°±ç»“æŸäº†æˆ‘çš„ Android åº”ç”¨ç¨‹åºçš„ç¬¬ 2 éƒ¨åˆ†ã€‚åœ¨**ç¬¬ 3 éƒ¨åˆ†**ä¸­ï¼Œæˆ‘å°†ä¼šçœ‹åˆ°æ›´å¤šå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å‘ç°çš„æ¼æ´ï¼Œå¹¶æ¼”ç¤ºå®ƒä»¬æ˜¯å¦‚ä½•è¢«åˆ©ç”¨çš„ã€‚æ„Ÿè°¢æ‚¨é˜…è¯»åˆ°æœ€åï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬ 3 éƒ¨åˆ†å†è§ğŸ˜„ï¼

# å‚è€ƒ

*   [https://github.com/dineshshetty/Android-InsecureBankv2](https://github.com/dineshshetty/Android-InsecureBankv2)
*   [https://book . hack tricks . XYZ/mobile-apps-pentest/Android-app-pentest/drozer-tutorial](https://book.hacktricks.xyz/mobile-apps-pentesting/android-app-pentesting/drozer-tutorial)
*   [https://wiki . sei . CMU . edu/confluence/display/Android/drd 03-j .+Do+not+broadcast+sensitive+information+using+an+implicit+intent](https://wiki.sei.cmu.edu/confluence/display/android/DRD03-J.+Do+not+broadcast+sensitive+information+using+an+implicit+intent)