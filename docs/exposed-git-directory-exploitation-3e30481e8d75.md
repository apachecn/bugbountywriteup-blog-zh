# æš´éœ²äº†ã€‚git ç›®å½•åˆ©ç”¨

> åŸæ–‡ï¼š<https://infosecwriteups.com/exposed-git-directory-exploitation-3e30481e8d75?source=collection_archive---------0----------------------->

![](img/531543e0ba3caee0d775a0a42496492d.png)

([https://media . pitchfork . com/photos/5c 1 aaaaabe 35 c 444 aebf 1 AFB 3/1:1/w _ 320ï¼Œc _ limit/sick % 20 boy _ the % 20 chain smokers . jpg](https://media.pitchfork.com/photos/5c1aaaabe35c444aebf1afb3/1:1/w_320,c_limit/sick%20boy_the%20chainsmokers.jpg))

å°†è¿‘ä¸¤ç™¾ä¸‡ã€‚Cybernews ç ”ç©¶å°ç»„å‘ç°ï¼ŒåŒ…å«é‡è¦é¡¹ç›®ä¿¡æ¯çš„ git æ–‡ä»¶å¤¹è¢«å…¬å¼€ã€‚Git æ˜¯æœ€æµè¡Œçš„å¼€æºåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚å¦‚æœæ‚¨æˆ–æ‚¨çš„ç»„ç»‡å°† git ç”¨äºä»£ç æˆ–å­˜å‚¨åº“ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥è€ƒè™‘ã€‚git æ–‡ä»¶å¤¹æš´éœ²å¯èƒ½å¯¹æ‚¨çš„èµ„äº§æ„æˆé£é™©ã€‚

ç­”ã€‚git æ–‡ä»¶å¤¹åŒ…å«å…³äºè¿œç¨‹å­˜å‚¨åº“åœ°å€ã€æäº¤å†å²æ—¥å¿—å’Œå…¶ä»–å…ƒæ•°æ®çš„åŸºæœ¬ä¿¡æ¯ã€‚çš„è®¿é—®æ§åˆ¶ä¸å¥½ï¼Œæºä»£ç å°±ä¼šæ³„éœ²ã€‚git æ–‡ä»¶å¤¹ã€‚å€ŸåŠ©å·¥å…·ï¼Œä»£ç ä¸­ç¡¬ç¼–ç çš„æ•æ„Ÿæ•°æ®å¯ä»¥åœ¨å‡ ç§’é’Ÿå†…è¢«æŒ–æ˜å‡ºæ¥ã€‚è¿™ç¯‡åšå®¢æ–‡ç« å°†å‘Šè¯‰ä½ å¦‚ä½•æ‰¾åˆ°æš´éœ²çš„ã€‚git æ–‡ä»¶å¤¹å¹¶è¯†åˆ«é‡Œé¢çš„ç¡¬ç¼–ç ç§˜å¯†ã€‚git æ–‡ä»¶å¤¹ã€‚

# Git å†…éƒ¨

ç­”ã€‚git æ–‡ä»¶å¤¹æ˜¯åœ¨ä½ æ‰§è¡Œæ–°é¡¹ç›®çš„`git init`æˆ–è€…ä»å…¶ä»–åœ°æ–¹æ‹‰é¡¹ç›®çš„`git clone`æ—¶åˆ›å»ºçš„ã€‚

Git æ˜¯ä¸€ä¸ªç®€å•çš„é”®å€¼æ•°æ®å­˜å‚¨ã€‚. git ç›®å½•å¦‚ä¸‹æ‰€ç¤º:

```
config
description
HEAD
index
hooks/
info/
logs/
objects/
refs/
```

å½“æ‚¨å°†ä»»ä½•ç±»å‹çš„å†…å®¹æ’å…¥ Git å­˜å‚¨åº“æ—¶ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªæƒŸä¸€çš„é”®ï¼Œä¾›æ‚¨ä»¥åæ£€ç´¢è¯¥å†…å®¹ã€‚çš„ã€‚git æ–‡ä»¶å¤¹å­˜å‚¨é¡¹ç›®çš„å…ƒæ•°æ®å’Œå¯¹è±¡ã€‚è¿™é‡Œçš„â€œå¯¹è±¡â€åŒ…æ‹¬â€œäºŒè¿›åˆ¶å¤§å¯¹è±¡â€ã€â€œæ ‘â€ã€â€œæäº¤â€å’Œâ€œæ ‡ç­¾â€ã€‚

*   `blob` â€”ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨æ¥å­˜å‚¨æ–‡ä»¶æ•°æ®
*   `tree`â€”â€”åŸºæœ¬ä¸Šåƒä¸€ä¸ªç›®å½•â€”â€”å®ƒå¼•ç”¨äº†ä¸€å †å…¶ä»–çš„æ ‘å’Œ/æˆ–æ–‘ç‚¹
*   `commit` â€”ä¸€æ£µæ ‘ï¼Œæ ‡è®°é¡¹ç›®åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„æ ·å­ã€‚
*   `tag` â€”ä»¥æŸç§æ–¹å¼å°†ç‰¹å®šæäº¤æ ‡è®°ä¸ºç‰¹æ®Šçš„æ–¹æ³•

æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è¦åœ¨ Git ä¸­æ“ä½œçš„å“ˆå¸Œå€¼ã€‚

å¦‚æœæ‚¨æœ‰ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹ç›®å½•ç»“æ„çš„ç®€å•é¡¹ç›®:

```
$>tree
.
|-- README
`-- lib
    |-- inc
    |   `-- tricks.rb
    `-- mylib.rb
â€‹
2 directories, 3 files
```

åœ¨å°†å®ƒæäº¤åˆ° Git å­˜å‚¨åº“ä¹‹åï¼Œå®ƒä¼šè¢«è¡¨ç¤ºæˆè¿™æ ·:

![](img/9fd9693a4091438b35d79be00057aae5.png)

(æ¥è‡ª[http://shafiul . github . io/git book/assets/images/figure/objects-example . png](http://shafiul.github.io/gitbook/assets/images/figure/objects-example.png))

ä¸Šå›¾ä¸­`commit`å¯¹è±¡çš„`parent`ä»£è¡¨é¡¹ç›®å†å²ä¸­çš„ä¸Šä¸€æ­¥ã€‚åªæœ‰â€œæ ¹â€æäº¤æ²¡æœ‰çˆ¶çº§ï¼Œä»£è¡¨é¡¹ç›®çš„åˆå§‹ä¿®è®¢ã€‚

è¦æ¢³ç†æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥ä»ä¸€ä¸ª`commit`å¯¹è±¡å¼€å§‹ã€‚

ä½ ä¸å¿…è®°ä½è¿™äº›ä¼´éšå¯¹è±¡çš„æ•£åˆ—ï¼Œå› ä¸º Git æä¾›äº†å¼•ç”¨æˆ–`refs`ï¼Œä¸€ä¸ªå­˜å‚¨åœ¨`.git/refs`ä¸­çš„æ–‡ä»¶åŒ…å«äº†ä¸Šå›¾ä¸­`commit`å¯¹è±¡çš„æ•£åˆ—ã€‚

`.git/refs`æ–‡ä»¶å¤¹ç»“æ„å¦‚ä¸‹æ‰€ç¤º:

```
heads/
master
remotes/
tags/
```

åœ¨`.git/refs/heads/`ä¸­ï¼Œæ‚¨çš„å­˜å‚¨åº“ä¸­æœ‰æœ¬åœ°åˆ†æ”¯ï¼Œå…¶æ–‡ä»¶åä¸ç›¸åº”åˆ†æ”¯çš„åç§°ç›¸åŒ¹é…ã€‚

ä¾‹å¦‚ï¼Œæ‚¨æœ‰ä¸€ä¸ªåä¸º`main`çš„åˆ†æ”¯ï¼Œæ‚¨å¯ä»¥åœ¨`.git/refs/heads/main`æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹`main`åˆ†æ”¯çš„æœ€æ–°æäº¤çš„æ•£åˆ—ï¼Œå¹¶ä¸”æ¯æ¬¡æ‚¨æäº¤ä¸€ä¸ªæ–°çš„æäº¤æ—¶ï¼Œè¿™ä¸ª`main`æ–‡ä»¶ä¸­çš„æ•£åˆ—éƒ½ä¼šæ”¹å˜ã€‚

```
$ cat .git/refs/heads/main
da09407c30b6f378fb15e660ac80a282f61d466a
```

æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥å½“å‰çš„æäº¤

```
$ git log -1 main
commit da09407c30b6f378fb15e660ac80a282f61d466a
Author: ....
â€‹
â€‹
$ git show -s --pretty=raw da09407c30b6f3
commit da09407c30b6f378fb15e660ac80a282f61d466a
tree eb7a07fde7f8cf8dfd274bb6a5cf98997d91c5a6
parent 77fbaa460d95ba8144ebb75872c2fca865a41128
```

è¦æ£€ç´¢è¿™äº›å¯¹è±¡çš„å†…å®¹ï¼Œä½¿ç”¨å‘½ä»¤`git cat-file`æ£€æŸ¥å¯¹è±¡å†…å®¹ã€‚é€šè¿‡`-p`å‘å‘½ä»¤ä¼ é€’å¯¹è±¡æ•£åˆ—ï¼Œä»¥æŒ‡ç¤ºå‘½ä»¤æ˜¾ç¤ºå¯¹è±¡å†…å®¹ã€‚

```
$ git cat-file -p eb7a07fde7f8cf8dfd274bb6a5cf98997d91c5a6
040000 tree 559d614af20026a8191d078d2c409885dc0b7c54    Java
100755 blob b0292c7d67b7cd41f538bbc574bb8acb198f8083    init.txt
â€‹
$ git cat-file -p  b0292c7d67b7cd41f538bbc574bb8acb198f8083
function name: backend
languange: nodejs
```

è¿™äº›å¯¹è±¡ä½œä¸ºæ•°æ®æ–‡ä»¶å­˜å‚¨åœ¨`.git/objects/<First-2-bytes>/<Last-38-bytes>`æ–‡ä»¶å¤¹ä¸­ã€‚`<First-2-bytes>`å’Œ`<Last-38-bytes>`æ˜¯æŒ‡ç›®æ ‡å¯¹è±¡çš„ SHA1 å“ˆå¸Œã€‚æ¯”å¦‚å¯ä»¥åœ¨`.git\objects\b0`é‡Œé¢æ‰¾åˆ°å­˜å‚¨ä¸º 292 c 7d 67 b 7 CD 41 f 538 BBC 574 bb 8 ACB 198 f 8083 å¯¹è±¡çš„æ•°æ®æ–‡ä»¶ä¸º 292 c 7d 67 b 7 CD 41 f 538 BBC 574 bb 8 ACB 198 f 8083ã€‚ç”¨ Notepad ++æ‰“å¼€æ–‡ä»¶ 292 c 7d 67 b 7 CD 41 f 538 BBC 574 bb 8 ACB 198 f 8083 æ–‡ä»¶ï¼Œé‡Œé¢åªæ˜¯ä¹±ç ã€‚

![](img/c428e35d9759ff761dbf2dddcdfd6393.png)

è¿™æ˜¯å› ä¸ºç›®æ ‡æ–‡ä»¶ 292 c 7d 67 b 7 CD 41 f 538 BBC 574 bb 8 ACB 198 f 8083 æ˜¯å‹ç¼©æ–‡ä»¶ã€‚ä½ å¯ä»¥åœ¨é˜…è¯»ä¹‹å‰ç”¨ Ruby è§£å‹å®ƒã€‚

```
ruby -rzlib -e 'print Zlib::Inflate.new.inflate(STDIN.read)' < .git/objects/b0/292c7d67b7cd41f538bbc574bb8acb198f8083
```

# æœ‰è¶£çš„éƒ¨åˆ†:åˆ©ç”¨

æ­¥éª¤ 1:ä¸‹è½½ã€‚git å‚¨å­˜åº“

å»å¯»æ‰¾æš´éœ²çš„äººã€‚git åº“ï¼Œå¯ä»¥ç®€å•æ·»åŠ ã€‚git åœ¨ç›®æ ‡ç½‘ç«™çš„æ ¹ URLã€‚ä¸å¹¸çš„æ˜¯ï¼Œæœ‰æ—¶æ‚¨å¯èƒ½ä¼šé‡åˆ°ä¸¤ç§ä¸åŒçš„ HTTP é”™è¯¯:

*   **404 é”™è¯¯-ã€‚æœåŠ¡å™¨ä¸­ä¸å­˜åœ¨ git** æˆ–è·¯å¾„é”™è¯¯
*   **403 ç¦æ­¢-ã€‚git** å­˜åœ¨ï¼Œä½†æ˜¯æ‚¨æ— æ³•åˆ—å‡ºè¯¥æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶å¤¹

å¯¹äºç¬¬äºŒä¸ªé”™è¯¯ï¼Œå®ƒå¯èƒ½æ˜¯ç”±äºåœ¨æœåŠ¡å™¨ä¸Šç¦ç”¨ç›®å½•åˆ—è¡¨è€Œå¯¼è‡´çš„ï¼Œæ‚¨å¯ä»¥ç»§ç»­å°è¯•ã€‚git æ–‡ä»¶å¤¹ç±»ä¼¼`.git/config`ã€‚

ä¸€æ—¦è¯†åˆ«å‡ºæš´éœ²è€…ã€‚git å­˜å‚¨åº“ï¼Œä¸‹ä¸€æ­¥æ˜¯æå–ã€‚æ‰‹åŠ¨ git æ–‡ä»¶å¤¹æˆ–è€…ä½¿ç”¨å·¥å…·ï¼Œä¾‹å¦‚ [GitTools](https://github.com/internetwache/GitTools) åº“ä¸­çš„ dumper.sh æ¥è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚å‘½ä»¤è¡Œç±»ä¼¼äº:

```
bash gitdumper.sh [http://target/.git/](http://target/.git/) <dest-dir>
```

æ³¨æ„:åé¢çš„æ–œæ ã€‚ç›®æ ‡ URL `http://target/.git/`ä¸­çš„ git ä¸èƒ½çœç•¥ï¼Œå¦åˆ™ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯:

```
###########
# GitDumper is part of [https://github.com/internetwache/GitTools](https://github.com/internetwache/GitTools)
#
# Developed and maintained by @gehaxelt from @internetwache
#
# Use at your own risk. Usage might be illegal in certain circumstances.
# Only for educational purposes!
###########
â€‹
[-] /.git/ missing in url
```

ç¬¬äºŒæ­¥:æ¢æŸ¥ã€‚git æ–‡ä»¶å¤¹

ä¸€æ—¦ä¸‹è½½äº†ã€‚git å®Œæˆåï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹æ•´ä¸ªæœ¬åœ°çš„æ‰€æœ‰çŠ¶æ€å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå¼€å‘äººå‘˜åˆ é™¤äº†ä¸€ä¸ªåä¸º`credentials`çš„æ–‡ä»¶å¹¶æäº¤äº†æ›´æ”¹ï¼Œæ‚¨å°†ä¼šçœ‹åˆ°ç”¨`git status`å‘½ä»¤æäº¤å‡­è¯æ–‡ä»¶åˆ é™¤ã€‚

```
$ git status
â€‹
# On branch master
# Changes not staged for commit:
#   (use "git add/rm <file>..." to update what will be committed)
#   (use "git checkout -- <file>..." to discard changes in working directory)
#
#       deleted:    credentials
â€‹
no changes added to commit (use "git add" and/or "git commit -a")
â€‹
```

çŠ¶æ€ç»“æœåªæ˜¾ç¤ºè¢«åˆ é™¤çš„æ–‡ä»¶`credentials`ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ`git checkout -- .`æˆ–`git restore .`å°†æœ¬åœ°å­˜å‚¨åº“é‡ç½®ä¸ºæœ€åä¸€æ¬¡æäº¤ä»¥æ£€ç´¢è¢«åˆ é™¤çš„`credentials`æ–‡ä»¶ã€‚

```
$ git checkout -- . 
$ ls 
credentials
```

ä½†æ˜¯ï¼Œå¦‚æœåœ¨æœ€åä¸€æ¬¡æäº¤ä¹‹å‰å¾ˆä¹…ï¼Œè¿˜æœ‰å…¶ä»–åŒ…å«æ•æ„Ÿæ•°æ®çš„æ–‡ä»¶åœ¨å†å²æäº¤ä¸­è¢«åˆ é™¤ï¼Œé‚£ä¹ˆå¦‚ä½•æ£€ç´¢è¿™äº›æ–‡ä»¶ä¸­çš„æ•æ„Ÿæ•°æ®å‘¢ï¼Ÿæ‚¨å¯èƒ½æƒ³ä½¿ç”¨`git cat-file`å‘½ä»¤æ¥æ£€æŸ¥æ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶ï¼Œä½†æ˜¯æ‰‹åŠ¨æ¢æµ‹è¿‡ç¨‹æ˜¯å†—é•¿è€Œè´¹åŠ›çš„ã€‚

æœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©ä½ ï¼

é¦–å…ˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [GitTools](https://github.com/internetwache/GitTools) ä¸­çš„ extractor.sh æ¥æ¢å¤æºä»£ç ã€‚

```
$ extractor.sh ./ .git
###########
# Extractor is part of [https://github.com/internetwache/GitTools](https://github.com/internetwache/GitTools)
#
# Developed and maintained by @gehaxelt from @internetwache
#
# Use at your own risk. Usage might be illegal in certain circumstances.
# Only for educational purposes!
###########
[+] Found commit: bfe7e60fd375eddfc286e6aefdb360df0928aa0d
[+] Found file: /home/.../.git/0-bfe7e60fd375eddfc286e6aefdb360df0928aa0d/credentials
[+] Found commit: 6dba12c2c6f9fe9ad237cf25e5f7c82f7eac4adf
[+] Found commit: 30dbbdfb0e0eba2aa3f42b799d55cd35a2c431d6
...
```

ç„¶åç»§ç»­ç”¨ç®€å•çš„ cat å‘½ä»¤æ£€æŸ¥æ¢å¤æ–‡ä»¶çš„å†…å®¹ï¼Œç›´åˆ°æ‰¾åˆ°æœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚

```
$ cat .git/0-bfe7e60fd375eddfc286e6aefdb360df0928aa0d/credentials
â€‹
[default]
aws_access_key_id = AKIAY5LSWGTEN2Q4DRRFK
aws_secret_access_key = tJ9Ja....kJ/d9cktW
```

æ‚¨å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå·¥å…· [gitleak](https://github.com/zricethezav/gitleaks) ï¼Œè¿™æ˜¯ä¸€ä¸ª SAST å·¥å…·ï¼Œç”¨äºæ£€æµ‹å’Œé˜²æ­¢ç¡¬ç¼–ç çš„ç§˜å¯†ï¼Œå¦‚ git repos ä¸­çš„å¯†ç ã€api å¯†é’¥å’Œä»¤ç‰Œã€‚`gitleak`å·¥å…·ä½¿ç”¨è§„åˆ™æ¥æ£€æµ‹ç§˜å¯†ï¼Œæ‚¨å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰æ‚¨è‡ªå·±çš„è§„åˆ™ï¼Œå¹¶åœ¨å‘½ä»¤è¡Œä¸­ç”¨`-c`æˆ–`--config`æ ‡å¿—æŒ‡å®šå®ƒã€‚

ä½¿ç”¨`gitleak`åœ¨åƒåœ¾åœºä¸­æœå¯»ç§˜å¯†ã€‚git æ–‡ä»¶å¤¹ï¼Œå¯¼èˆªåˆ°ã€‚git æ–‡ä»¶å¤¹å¹¶å°è¯•ä»¥ä¸‹å‘½ä»¤:

```
$ docker pull zricethezav/gitleaks:latest
$ docker run --security-opt label:disable  -v $(pwd):/tmp:z zricethezav/gitleaks:latest detect --source="/tmp" -v
â€‹
    â—‹
    â”‚â•²
    â”‚ â—‹
    â—‹ â–‘
    â–‘    gitleaks
â€‹
â€‹
Finding:     ws_access_key_id = AKIAY5LSWGTEN2Q4DRRFK
Secret:      AKIAY5LSWGTEN2Q4DRRFK
RuleID:      aws-access-token
Entropy:     4.021928
File:        credentials
Line:        1
Commit:      30dbbdfb0e0eba2aa3f42b799d55cd35a2c431d6
Author:      ...
Email:       ...
Date:        2022-10-22T05:58:44Z
Fingerprint: 30dbbdfb0e0eba2aa3f42b799d55cd35a2c431d6:credentials:aws-access-token:1
```

å®ƒä½¿ç”¨å¸¦æœ‰ RuleID aws-access-token çš„è§„åˆ™æ¥æ ‡è¯† ws_access_key_idã€‚

ç”±äºæ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨å†…ç½®çš„é…ç½®æ–‡ä»¶ [gitleaks.toml](https://github.com/zricethezav/gitleaks/blob/master/config/gitleaks.toml) ï¼Œåœ¨ [gitleaks.toml](https://github.com/zricethezav/gitleaks/blob/master/config/gitleaks.toml) ä¸­çš„`aws-access-token`è§„åˆ™å¦‚ä¸‹:

```
[[rules]]
description = "AWS"
id = "aws-access-token"
regex = '''(A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}'''
keywords = [
    "akia","agpa","aida","aroa","aipa","anpa","anva","asia",
]
```

# æœ€åçš„æƒ³æ³•

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆï¼Œè¯·éšæ—¶å‘è¡¨è¯„è®ºã€‚å¦‚æœä½ è®¤ä¸ºè¿™ç¯‡åšæ–‡æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»æ‹æ‰‹ğŸ‘æŒ‰é’®ä¸‹é¢å‡ ä¸‹ï¼Œä»¥ç¤ºæ”¯æŒï¼ä¹Ÿå¯ä»¥é€šè¿‡ [LinkedIn](https://www.linkedin.com/in/yani-dong-041a1b120/) è”ç³»æˆ‘ã€‚

## æ¥è‡ª Infosec çš„æŠ¥é“:Infosec æ¯å¤©éƒ½æœ‰å¾ˆå¤šå†…å®¹ï¼Œå¾ˆéš¾è·Ÿä¸Šã€‚[åŠ å…¥æˆ‘ä»¬çš„æ¯å‘¨ç®€è®¯](https://weekly.infosecwriteups.com/)ä»¥ 5 ç¯‡æ–‡ç« ã€4 ä¸ªçº¿ç¨‹ã€3 ä¸ªè§†é¢‘ã€2 ä¸ª GitHub Repos å’Œå·¥å…·ä»¥åŠ 1 ä¸ªå·¥ä½œæé†’çš„å½¢å¼å…è´¹è·å–æ‰€æœ‰æœ€æ–°çš„ Infosec è¶‹åŠ¿ï¼