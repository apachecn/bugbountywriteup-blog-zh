# ä¸€ä¸ªæœ‰è¶£çš„è´¦æˆ·æ¥ç®¡ï¼ï¼

> åŸæ–‡ï¼š<https://infosecwriteups.com/an-interesting-account-takeover-3a33f42d609d?source=collection_archive---------2----------------------->

## IDOR å’Œå¼±åŠ å¯†å¯¼è‡´å¸æˆ·è¢«å®Œå…¨æ¥ç®¡ã€‚

ä½ å¥½ï¼Œæˆ‘çš„é»‘å®¢ä¼™ä¼´ä»¬ã€‚æˆ‘æ˜¯ Mayank Pandeyï¼Œä¸€ä¸ªè‡­è™«çŒäººï¼Œä¸€ä¸ªæœ‰æŠ±è´Ÿçš„çº¢é˜Ÿé˜Ÿå‘˜ã€‚è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™ä»»ä½•é”™è¯¯ï¼Œæ‰€ä»¥å¦‚æœæˆ‘çŠ¯äº†ä»»ä½•é”™è¯¯ï¼Œç„¶åå¿½ç•¥å®ƒã€‚

![](img/779751902f67950c708c5cb5a820bad5.png)

ç°åœ¨ç›´æ¥è¿›å…¥æœ‰è¶£çš„éƒ¨åˆ†ã€‚æœ€è¿‘ï¼Œæˆ‘åœ¨åª’ä½“ä¸Šè¯»åˆ°è®¸å¤šå¸æˆ·æ¥ç®¡ï¼Œä»–ä»¬é€šå¸¸ä½¿ç”¨â€œX-Forwarded-Hostâ€æ ‡é¢˜æ¥çªƒå–ä»¤ç‰Œã€‚æ‰€ä»¥æˆ‘æƒ³ä¸ºä»€ä¹ˆä¸è¯•ä¸€è¯•ï¼Œæ¢ä¸€ç§æ–¹å¼ã€‚æˆ‘æœ‰å‡ ä¸ªæœªå†³çš„ç§äººé‚€è¯·ï¼Œæ‰€ä»¥æˆ‘æ¥å—äº†ä¸€ä¸ªå¹¶å¼€å§‹å¯»æ‰¾å¸æˆ·æ¥ç®¡ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†å®çŸ³ã€‚

![](img/902f0cecfa0ca05143e678286cc60720.png)

è¿™ä¸ªé”™è¯¯å­˜åœ¨äºâ€œå¯†ç é‡ç½®â€åŠŸèƒ½ä¸­ï¼Œè¯¥åŠŸèƒ½å…è®¸å®Œå…¨æ¥ç®¡å¸æˆ·ï¼Œè€Œæ— éœ€ç”¨æˆ·è¿›è¡Œä»»ä½•äº¤äº’ã€‚å®ƒæ˜¯ IDORã€ä¸€ç‚¹å¯†ç å­¦å’Œå¤§é‡ç›®å½•æ¨¡ç³ŠåŒ–çš„ç»“åˆã€‚

æˆ‘ä»¬ç»™å…¬å¸æ‰“ä¸ªç”µè¯:â€œexample.comâ€ã€‚é¦–å…ˆï¼Œçœ‹çœ‹æ™®é€šçš„å¯†ç é‡ç½®æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

1:ç”¨æˆ·è½¬åˆ°â€œexample . com/PHP/log in _ or _ password _ forgotten â€,é€šè¿‡è¾“å…¥ä»–ä»¬çš„ä¸ªäººèµ„æ–™ ID å’Œå§“åè¯·æ±‚é‡ç½®å¯†ç ã€‚

2:éªŒè¯ä»–ä»¬çš„é…ç½®æ–‡ä»¶ ID å’Œåç§°ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª*çŠ¶æ€*å‚æ•°ã€‚

> STATE = ejxdkn 1 owzamhd 8 ldza 1 xfft 9 gpmde 2 gdmktuixm 4 paililjjhbo 747 dfjrxlfhzyp 9 zgphpbduaryixzqn 8 wd evhz 1% 2 bo V8 utxeimshftxatwcjfwyeoeepgkppxttzfiojgssg % 2 fqrmgvgxbc 8 H4 zdyq 8 hhnfmsnza lo 3 ckekwftuurh % 2 b 7 snxt 0 ylsd DP 9 arxo 1 e 6y 96h rar 4 uevy

3:æ­¤åï¼Œä¸€ä¸ªå¯†ç é‡ç½®é“¾æ¥è¢«å‘é€åˆ°ç”¨æˆ·æ³¨å†Œçš„ç”µå­é‚®ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º

> ã€https://example.com/php/login_or_password_forgotten? k = 789 c 0 DC 8610 a 80200 c 06d 0 bbec 049 BC 9d 26 f 870921834192 a4 FFA 2 bbd 7 fbf 90 a 029 e 810 c 9 adeea 98 a 5753287 a 844 e 16555 b 1016150 BF AFC 3 cf BAF 94 eff 2450 e 494 a 2 e 640 f 67 ebc 89137 aade 927d 25 a 020 ab

4:ç°åœ¨ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å•å‡»é“¾æ¥åè½¬åˆ°ä»ªè¡¨æ¿æ¥æ›´æ”¹ä»–ä»¬çš„å¯†ç ã€‚

# æœ‰è¶£çš„éƒ¨åˆ†

â€œ*ï¼Ÿk"* å‚æ•°å¯¹æˆ‘æ¥è¯´æœ‰ç‚¹å¯ç–‘ï¼Œæ‰€ä»¥æˆ‘è¿…é€Ÿå¤åˆ¶å¹¶ç²˜è´´åˆ° [CyberChef](https://gchq.github.io/CyberChef/) ä¸Šï¼Œçœ‹çœ‹å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªåŠ å¯†çš„å­—ç¬¦ä¸²ã€‚ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåŠ å¯†+å‹ç¼©çš„å­—ç¬¦ä¸²

![](img/171df77d24466363ec600aee9929c76d.png)

å®ƒé¦–å…ˆè¢« **Zlib-deflated** ï¼Œç„¶åä½¿ç”¨ **Hex å°†è¢«å‹ç¼©çš„å­—ç¬¦ä¸²åŠ å¯†å›å»ã€‚**ç”±æ­¤å¯è§ä¸€æ–‘

> "*789 c 0 DC 8610 a 80200 c 06d 0 bbec 049 BC 9d 26 f 870921834192 a4 FFA 2 bbd 7 fbf 90 a 029 e 810 c 9 ade ea 98 a 5753287 a 844 e 16555 b 1016150 BF AFC 3 cf BAF 94 eff 2450 e 494 a2 e 640 f 67 ebc 89137 aade 927d 25 a 020*

è§£å¯†å›

> *â€œa:2:{ s:9:â€œæ—¶é—´æˆ³â€ï¼›æˆ‘:1614104013ï¼›s:10:" profile _ id "ï¼›s:8:â€œ40884692â€ï¼›}* â€

è§£å¯†åçš„å­—ç¬¦ä¸²ç”±ä¸¤ä¸ªé‡è¦å˜é‡â€œprofile_idâ€å’Œâ€œtimestampâ€ç»„æˆã€‚æˆ‘å¾ˆé«˜å…´çœ‹åˆ°è¿™ä¸ªï¼Œä»¥ä¸ºæˆ‘æ‰¾åˆ°äº†å®çŸ³ã€‚æˆ‘ç«‹å³ä¼ªé€ äº†æˆ‘çš„ç¬¬äºŒä¸ªå¸æˆ·çš„ä»¤ç‰Œï¼Œç”¨å®ƒæ¥æ›´æ”¹å¯†ç ã€‚

> ä¼ªé€ ä»¤ç‰Œâ€”789 c 0 DC 8510 a 85201005d 0 bdcc 0 AC 6 f 25 da 6 EB 62427806034992 Fe 457 bb 7 df 93 b 9 f0e 9 DC 28 c 36 be 923d 726 c 919107 EC 0 aa 40 ea 0 C4 a69 f 775 f 85976 ffcb 2746891 a 610693 f 44 ebe 171387

ä½†æ˜¯æˆ‘å®Œå…¨é”™äº†ã€‚è¯¥é“¾æ¥æ— æ•ˆã€‚

![](img/736ce008a91a307d921e84138827568f.png)

æ²¡æœ‰ä»€ä¹ˆæ¥çš„è¿™ä¹ˆå®¹æ˜“â€¦å¯¹å—ï¼Ÿ

# è½¬æŠ˜

å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šå‘ç°åŸå§‹ä»¤ç‰Œå’Œä¼ªé€ ä»¤ç‰Œçš„é•¿åº¦ä¸åŒ

![](img/20e44cc9592597baa7e96849b7ab8350.png)

åŸå§‹ä»¤ç‰Œå’Œä¼ªé€ ä»¤ç‰Œç›¸å·® 32 ä¸ªå­—ç¬¦ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸æ¥å—ä»»ä½•åƒåœ¾å€¼æ¥ä»£æ›¿è¿™ 32 ä¸ªå­—ç¬¦ã€‚ä¸¤ä¸ªä»¤ç‰Œéƒ½è¢«è§£å¯†ä¸ºç›¸åŒçš„å€¼

> " *a:2:{s:9:"æ—¶é—´æˆ³"ï¼›æˆ‘:1614104013ï¼›s:10:" profile _ id "ï¼›s:8:â€œ40884692â€ï¼›}".*

è¿™è®©æˆ‘éå¸¸æ²®ä¸§ğŸ˜« ğŸ˜«ã€‚æˆ‘å¼€å§‹æœç´¢æ›´å¤šå…³äº Zlib å‹ç¼©çš„å†…å®¹ã€‚æˆ‘å»äº† Redditï¼Œå‘å¸ƒäº†æˆ‘çš„é—®é¢˜ï¼Œä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œæˆ‘çš„æ”¶ä»¶ç®±è¢«æ— æ•°ä»¤äººæƒŠè®¶çš„åšå®¢å¸–å­å’Œå¦‚ä½•å¤„ç† Zlib çš„æƒ³æ³•æ·¹æ²¡äº†ã€‚

åœ¨ç½‘ä¸Šé˜…è¯»äº† 2 ä¸ªå°æ—¶åï¼Œæˆ‘å‘ç° Zlib åŒ…å«ä¸€ä¸ª **ADLER32 æ ¡éªŒå’Œ**å¦‚æœä½ åœ¨è†¨èƒ€åä½¿ç”¨ Adler-32_Checksum()å‡½æ•°ï¼Œä½ ä¼šå¾—åˆ° **BC89137Aï¼Œ**æ³¨æ„ï¼Œè¿™ä¸ªæ ¡éªŒå’Œå­˜åœ¨äºåŸå§‹ä»¤ç‰Œä¸­ã€‚åœ¨ Zlib ä¸­ï¼Œè¯¥æ ¡éªŒå’Œä¹‹åçš„æ‰€æœ‰å†…å®¹éƒ½ä¸æ˜¯å‹ç¼©æµçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å°†è¢«å¿½ç•¥ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå³ä½¿é•¿åº¦ä¸åŒï¼Œä¸¤ä¸ªä»¤ç‰Œä¹Ÿä¼šç»™å‡ºç›¸åŒçš„ç»“æœã€‚

æ‰€ä»¥ç°åœ¨çš„æŒ‘æˆ˜æ˜¯æ‰¾åˆ° 32 ä½çš„å­—ç¬¦ä¸²ã€‚å› ä¸ºæ‰€æœ‰ä¸ä»¤ç‰Œç›¸å…³çš„å·¥ä½œéƒ½å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥æˆ‘éå¸¸ç¡®å®šèƒ½åœ¨ JS æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸€äº›ä¸œè¥¿ã€‚

åœ¨ JS æ–‡ä»¶ä¸­æŸ¥çœ‹äº†å‡ ä¸ªå°æ—¶åï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªç«¯ç‚¹**â€œ/PHP/userâ€ã€‚**æˆ‘å†³å®šå¼ºè¡Œæ‰“å¼€ç›®å½•ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†ç«¯ç‚¹â€œ[**https://example.com**](https://example.com)**/PHP/user/example/â€ï¼Œ**è¿™ä¸ªç«¯ç‚¹æœ‰ä¸€ä¸ªåä¸ºâ€œTransction _ Tokenâ€çš„å­—ç¬¦ä¸²ï¼Œè¿™ç¡®å®æ˜¯æˆ‘è¦æ‰¾çš„æœ€åä¸€ä¸ªéƒ¨åˆ†ã€‚

![](img/552ef287c78ec42a4e0d702c3ab45323.png)

# å°†ç¢ç‰‡æ‹¼åœ¨ä¸€èµ·

ç°åœ¨æ˜¯æŠŠæ‰€æœ‰ä¸œè¥¿æ”¾åœ¨ä¸€èµ·å¹¶åŠ ä»¥åˆ©ç”¨çš„æ—¶å€™äº†ã€‚

è¿™ç§æ”»å‡»éœ€è¦ç²¾ç¡®ï¼Œå› ä¸ºæ¯æ¬¡é¡µé¢åˆ·æ–°æ—¶,â€œTransaction _Tokenâ€éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥æˆ‘åšäº†ä¸€ä¸ª python è„šæœ¬æ¥è‡ªåŠ¨åŒ–æ•´ä¸ªè¿‡ç¨‹ã€‚

æˆ‘ä¸ºæˆ‘çš„ç¬¬äºŒä¸ªå¸æˆ·ç”Ÿæˆäº†ä»¤ç‰Œï¼Œå¹¶ç”¨å®ƒæ¥æ›´æ”¹å¯†ç ï¼Œå¹¶ä¸”**æˆåŠŸäº†ï¼ï¼ï¼ï¼**

![](img/cb1deb5268f611f859baaf5273a9e008.png)

# é‡è¦æç¤º

*   å¦‚æœæœ‰ä»¤ç‰Œï¼Œå°±æœ‰å¯èƒ½è¢«ç ´è§£ã€‚
*   æ‰‹åŠ¨è¯»å– JS æ–‡ä»¶ä¸€æ¬¡ï¼Œå› ä¸ºè¿™äº›æ–‡ä»¶åŒ…å«å…³äº Web åº”ç”¨ç¨‹åºå·¥ä½œçš„éå¸¸é‡è¦çš„ä¿¡æ¯
*   å°è¯•åœ¨ Reddit ä¸Šè¯¢é—®æŠ€æœ¯ç»†èŠ‚ï¼Œè¿™è‚¯å®šä¼šè®©ä½ å¤§åƒä¸€æƒŠï¼Œè€Œä¸”äººä»¬åœ¨å›å¤ä½ ä¹‹å‰ä¸ä¼šçœ‹åˆ°ä½ çš„ç²‰ä¸æ•°ğŸ˜… ğŸ˜‰ã€‚

> ç›¸ä¿¡ä½ çš„ç›´è§‰ï¼Œæ°¸è¿œå¤šèµ°ä¸€æ­¥ğŸ˜‡

éå¸¸æ„Ÿè°¢ä½ çš„é˜…è¯»ã€‚å–œæ¬¢å°±åˆ†äº«

å¯ä»¥åœ¨æ¨ç‰¹ä¸Šæ‰¾æˆ‘: [**mayank_pandey01**](https://twitter.com/mayank_pandey01)