# ç°ä»£äºŒè¿›åˆ¶å¼€å‘æ–‡ç« -0x04

> åŸæ–‡ï¼š<https://infosecwriteups.com/binary-writeup-0x04-baeed833ddf?source=collection_archive---------0----------------------->

è¿™æ˜¯**ç°ä»£äºŒè¿›åˆ¶å¼€å‘**è¯¾ç¨‹çš„å­éƒ¨åˆ† [RPISEC](https://rpis.ec/) å…³äº**å·¥å…·å’ŒåŸºæœ¬é€†å‘å·¥ç¨‹**çš„ç¬¬å››ç¯‡ç»¼è¿°ã€‚

è®²åº§é“¾æ¥:-[http://security.cs.rpi.edu/courses/binexp-spring2015/](http://security.cs.rpi.edu/courses/binexp-spring2015/)

æ‰€æœ‰çš„è¯¾å ‚ææ–™å’Œå…¶ä»–å¿…è¦çš„æ–‡ä»¶éƒ½å¯ä»¥åœ¨ä¸Šé¢çš„é“¾æ¥ä¸­æ‰¾åˆ°ã€‚

[â¬…ï¸](https://medium.com/bugbountywriteup/binary-writeup-0x03-9a9546711ef2) **ä¸Šä¸€ç¯‡æŠ¥é“**_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _**ä¸‹ä¸€ç¯‡æŠ¥é“**

# crackme0x02

```
$ ./crackme0x02
```

![](img/86b4f5df99de20745994a7a8761c3ba2.png)

crackme0x02

**ä½¿ç”¨ *rabin2* å·¥å…·æ”¶é›†ä¿¡æ¯ã€‚**

```
rabin2 -I crackme0x02
```

![](img/d2d6fd78ccd3480cb84eef1ebfb24fe0.png)

man rabin2

![](img/6e0e3025cddc357a0b7e2f7a8c5df060.png)

ä¿¡æ¯

# ä½¿ç”¨é›·è¾¾ 2 è¿›è¡Œç ´è§£

```
radare2 crackme0x02
[0x08048330]> aaa
[0x08048330]> pdf @ main
```

*   **aa:-** åˆ†æå…¨éƒ¨ã€‚
*   aaa:- åˆ†ææ›´å¤šä¿¡æ¯ã€‚
*   **pdf:-** æ‰“å°æ‹†è§£åŠŸèƒ½ã€‚

![](img/f424af5885e7356cf645abf765068e11.png)

ä¸»è¦åŠŸèƒ½

```
[0x08048330]> dr
```

**dr:-** æ‰“å°å¸¦æœ‰æ•°å€¼çš„æ•°æ®å¯„å­˜å™¨ã€‚

![](img/b323d3df4e5c4d9c3cee708c66881399.png)

æ•°æ®å¯„å­˜å™¨

å®ƒæ˜¾ç¤ºå¸¦æœ‰â€œ0â€çš„ eaxï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ï¼Œå®ƒå¿…é¡»åŒ…å«ä¸€äº›å€¼ã€‚radar 2 åœ¨é™æ€æ¨¡å¼ä¸‹åˆ†æäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ radar 2 è°ƒè¯•æ¨¡å¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ç¨‹åºä¹‹é—´è®¾ç½®æ–­ç‚¹å¹¶æ‰¾åˆ°æ›´å¤šä¿¡æ¯ã€‚

# ä½¿ç”¨ radare2 è°ƒè¯•æ¨¡å¼ç ´è§£

```
$radare2 -d crackme0x02
```

![](img/2237d8a50d804aa35c221569204d92f3.png)

man radare2

*   **aa:-** åˆ†æå…¨éƒ¨ã€‚
*   aaa:- ç”¨æ›´å¤šä¿¡æ¯åˆ†ææ‰€æœ‰å†…å®¹ã€‚
*   **pdf:-** æ‰“å°æ‹†è§£åŠŸèƒ½ã€‚

![](img/8678dac6f101463eac7701c770c7d6c9.png)

è°ƒè¯•æ–¹å¼

![](img/49eedf79feebb5bdab1bea050d8279e0.png)

ä¸»è¦åŠŸèƒ½

åœ¨åœ°å€â€œ0x0804844eâ€å¤„æœ‰ cmp æŒ‡ä»¤ï¼Œå› æ­¤è®©æˆ‘ä»¬åœ¨é‚£é‡Œè®¾ç½®æ–­ç‚¹ã€‚

![](img/e693e5a5ef8ae8c1addb07e716de4e9a.png)

åœ¨ cmp æ—¶ä¸­æ–­

*   **db *flag* :-** åœ¨*æ ‡å¿—*å¤„æ”¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œå…¶ä¸­*æ ‡å¿—*å¯ä»¥æ˜¯åœ°å€ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°åã€‚
*   **dc :-** è¿è¡Œç¨‹åºã€‚

*cmp eaxï¼Œdword [local_ch]ï¼Œ*ç°åœ¨æˆ‘ä»¬è¯•ç€æ‰¾å‡º$ **eax** å¯„å­˜å™¨å’Œ **local_0xc çš„å€¼ã€‚**

å¯»æ‰¾ **eax** çš„å€¼ã€‚

```
[0x0804844e]> ? eax
```

![](img/2fb0684837ef21c6d087e6f02752c892.png)

eax å¯„å­˜å™¨

è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è·å¾— eax å¯„å­˜å™¨çš„å€¼ã€‚

```
[0x0804844e]> dr eax
[0x0804844e]> ? 0x00000539
```

*   **dr flag:-** æ‰“å°æ•°æ®å¯„å­˜å™¨å€¼ã€‚

![](img/e8ac785c8ee2d7b7897f541fbdab6113.png)

eax å¯„å­˜å™¨

æ±‚ **local_ch çš„å€¼ã€‚**

```
[0x0804844e]> afvd local_ch
[0x0804844e]> pxr $w [@ebp](http://twitter.com/ebp)-0xc
[0x0804844e]> ? 0x00052b24
```

*   **afvd:-** afvd name è¾“å‡º r2 å‘½ä»¤ï¼Œç”¨äºåœ¨è°ƒè¯•å™¨ä¸­æ˜¾ç¤º args/locals çš„å€¼ã€‚

![](img/240bd2808936e136b44943fb940863fb.png)

æœ¬åœ°é¢‘é“

æ±‚ local_ch å€¼çš„å¦ä¸€ç§æ–¹æ³•ã€‚

```
[0x0804844e]> afvd
[0x0804844e]> ? 0x00052b24
```

*   **afvd:-** afvd name è¾“å‡º r2 å‘½ä»¤ï¼Œç”¨äºæ˜¾ç¤ºè°ƒè¯•å™¨ä¸­ args/locals çš„å€¼ã€‚

![](img/a70f349b69c14d39b380fbb64528fe50.png)

afvd

![](img/3ee114d92beda18547f7dbd54c5ec40f.png)

å˜²ç¬‘

# ä½¿ç”¨ gdb è£‚è§£

```
$gdb crackme0x02
gdb-peda$ disassemble main
```

![](img/7c07f82333fe31a79c38c28ce562812f.png)

å¹¿å‘é“¶è¡Œä¸»é¡µ

```
gdb-peda$ break *0x0804844e
```

![](img/7fb7e6bbe334ab237522e8ba5a678f33.png)

break @ cmp æŒ‡ä»¤

![](img/55d83c6d8019886999a7cf044a7366a2.png)

å¯„å­˜å™¨|ä»£ç |å †æ ˆ

**cmp eaxï¼ŒDWORD PTR [ebp-0xc]**

*   **eax** :- eax å¯„å­˜å™¨åŒ…å« **0x539ï¼Œ** *0x* æ˜¾ç¤ºä¸ºåå…­è¿›åˆ¶ã€‚
*   **DWORD:-** æŒ‡çš„æ˜¯åŒå­—ï¼ŒåŒå­—æ˜¯ 32 ä½æˆ– 4 å­—èŠ‚(8 ä½=1 å­—èŠ‚)ã€‚
*   **PTR:-** æŒ‡é’ˆçš„ç¼©å†™ã€‚
*   **ebp-0xc:-** ä» ebp(åŸºå€æŒ‡é’ˆ)ä¸­å‡å» 0xc(åè¿›åˆ¶ 12)ã€‚

å› æ­¤ï¼Œåœ¨è¯¥æŒ‡ä»¤ä¸­ï¼Œeax ä¸å­˜å‚¨åœ¨åœ°å€ **ebp-0xc** ä¸­çš„*å­—(æ•°å­—)*è¿›è¡Œæ¯”è¾ƒã€‚

è®©æˆ‘ä»¬æ¥çœ‹çœ‹ ***eax*** å’Œ ***ebp-0xc ä¸­å­˜å‚¨äº†ä»€ä¹ˆã€‚***

ä»ä¸Šå›¾æ¥çœ‹ï¼Œ **eax** æ˜¾ç¤ºå€¼ ***0x539***

```
p/d 0x539
```

*   **p:-** æ‰“å°å‘½ä»¤(ç¼©å†™ä¸º **p** )ã€‚
*   **d:-** æ‰“å°ä¸ºå¸¦ç¬¦å·åè¿›åˆ¶çš„æ•´æ•°ã€‚

![](img/a2a15ac1ef8572cfa2145b5fd34e8d8f.png)

è½¬å˜

**1337** å­˜å‚¨åœ¨ **$eax** ä¸­ï¼Œæˆ‘ä»¬ç»™å®ƒä¸€ä¸ªè¾“å…¥ã€‚

```
gdb-peda$ x/x $ebp-0xc
0xffffd1ec: 0x00052b24
gdb-peda$ p/d 0x00052b24
$9 = 338724
```

**x** å‘½ä»¤ç”¨äº e **X** èƒºã€‚

*   **/x:-** ä»¥åå…­è¿›åˆ¶æ‰“å°åœ°å€$ebp å’Œè¯¥åœ°å€çš„å†…å®¹ã€‚

**p** å‘½ä»¤ç”¨äº **P** æ‰“å°ã€‚

*   **/d:-** ä»¥å°æ•°å½¢å¼æ‰“å°å†…å®¹ã€‚

![](img/60a5ddc5de312f55af9a50d34fbccafe.png)

è½¬å˜

```
$./crackme0x02
```

![](img/3ee114d92beda18547f7dbd54c5ec40f.png)

å˜²ç¬‘

ä½¿ç”¨ python è½¬æ¢ **'0x00052b24'**

```
python -c "print 0x00052b24"
```

![](img/920a638de51afdee0d098da3230284bf.png)

å¤§èŸ’

ä½¿ç”¨ **rax2** è½¬æ¢ **'0x00052b24'**

```
rax2 0x00052b24
```

![](img/55a54c79d9d2e5d13aacc98f5b49bcb6.png)![](img/886643263123f7af15baf5d5778bc542.png)

rax2

*æ„Ÿè°¢é˜…è¯»ï¼å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•…äº‹ï¼Œè¯·ç‚¹å‡»**ğŸ‘ ***æŒ‰é’®ï¼Œåˆ†äº«*** *å¸®åŠ©ä»–äººï¼æ¬¢è¿ç•™è¨€è¯„è®º*ğŸ’¬*ä¸‹å›¾ã€‚æœ‰åé¦ˆï¼Ÿä¸‹é¢æˆ‘ä»¬è¿çº¿ä¸Š* [*æ¨ç‰¹*](https://twitter.com/yashanand155) *ã€‚**

## *â¤ï¸æŒ‰[inco gnito](https://twitter.com/yashanand155)*