# åŒ»ç”Ÿ:é»‘å®¢ç›’å­æ¼”ç»ƒ

> åŸæ–‡ï¼š<https://infosecwriteups.com/doctor-htb-walkthrough-70bcb9eedefd?source=collection_archive---------0----------------------->

## æè¿°

åšå£«æ˜¯ [**ä¸Šä¸€ä¸ªä¸é”™çš„ VM é»‘å®¢ç›’å­**](https://app.hackthebox.eu/machines/278) **ã€‚**æˆ‘å¿…é¡»è¯´ HTB ä¸Šçš„ç®€å•ç›’å­æ¯” TryHackMe ä¸Šçš„ä¸­ç­‰ç›’å­æ›´éš¾æ‡‚ã€‚åªéœ€åœ¨/etc/hosts æ–‡ä»¶ä¸­æ·»åŠ  doctors.htbï¼Œå°±å¯ä»¥äº†ã€‚

![](img/9353e222ce7aaead0eed0e179538305e.png)

> è·å¾—çš„çŸ¥è¯†

1.  åˆ—ä¸¾
2.  æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥
3.  åœ¨**ä¸­è·å¾—åå‘å¤–å£³çš„ä¸¤ç§æ–¹å¼**
4.  æšä¸¾ adm ç›¸å…³æ–‡ä»¶
5.  ä½¿ç”¨ SplunkWhisperer2 æå‡æƒé™

> ç«¯å£æ‰«æ

åƒå¾€å¸¸ä¸€æ ·ï¼Œé¦–å…ˆç”¨ Nmap æ‰«æç½‘ç»œï¼Œå¯»æ‰¾å¼€æ”¾çš„ç«¯å£å’ŒæœåŠ¡ã€‚

![](img/1109764a552d001c63a79859cd89feb4.png)

> ç½‘ç»œä¾¦å¯Ÿ

æ‰€ä»¥æˆ‘ä»¬å…ˆåˆ—ä¸¾ä¸€ä¸‹ 80 ç«¯å£ã€‚æˆ‘å†³å®šå¯åŠ¨ä¸€ä¸ª gobuster æ‰«æï¼Œå¾—åˆ°äº†ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚

![](img/febbf475dd6d0d466f637578f8874b3d.png)

æ‰€ä»¥æˆ‘ä»¬æœ‰ä¸€ä¸ªç™»å½•é—¨æˆ·ã€‚

![](img/aba07e6bf6028ed30a1a2d18ef02aab3.png)

æˆ‘å…ˆè¯•ç€å»äº† SQL æ³¨å…¥ï¼Œä½†æ˜¯ä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿã€‚ç„¶åæˆ‘æ³¨å†Œäº†ä¸€ä¸ªæ–°è´¦å·ï¼Œè¿™æ¬¡æˆ‘å¾ˆå¹¸è¿ã€‚

![](img/c0c97c8d0ef60958ce49c379fc31a1cd.png)

ç°åœ¨ï¼Œå¦‚æœä½ è®°å¾—æˆ‘ä»¬åœ¨ç›®å½•æ‰«æä¸­å¾—åˆ° URI**/å­˜æ¡£**ã€‚æˆ‘æ‰“å¼€äº†å®ƒï¼Œä½†ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œä½†é¡µé¢æºæœ‰ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚æ— è®ºæˆ‘åœ¨**â€œæ–°æ¶ˆæ¯â€** - > **æ ‡é¢˜**å­—æ®µä¸­é”®å…¥ä»€ä¹ˆï¼Œéƒ½ä¼šåœ¨/archive é¡µé¢æºä¸­å¾—åˆ°åæ˜ ã€‚

> äº†è§£æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥

Web åº”ç”¨ç¨‹åºç»å¸¸ä½¿ç”¨æ¨¡æ¿ç³»ç»Ÿï¼Œå¦‚ [Twig](http://twig.sensiolabs.org/) å’Œ [FreeMarker](http://freemarker.org/) åœ¨ç½‘é¡µå’Œç”µå­é‚®ä»¶ä¸­åµŒå…¥åŠ¨æ€å†…å®¹ã€‚å½“ç”¨æˆ·è¾“å…¥ä»¥ä¸å®‰å…¨çš„æ–¹å¼åµŒå…¥æ¨¡æ¿æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ¨¡æ¿æ³¨å…¥ã€‚åœ¨æ¨¡æ¿ä¸­ä¸å®‰å…¨åœ°åµŒå…¥ç”¨æˆ·è¾“å…¥ä½¿å¾— [**æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥**](https://portswigger.net/web-security/server-side-template-injection) ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å®¹æ˜“è¢«è¯¯è®¤ä¸º[è·¨ç«™è„šæœ¬](https://portswigger.net/web-security/cross-site-scripting) (XSS)æˆ–å®Œå…¨é—æ¼çš„è‡´å‘½æ¼æ´ã€‚æ¨¡æ¿æ³¨å…¥å¯èƒ½æ˜¯ç”±å¼€å‘äººå‘˜çš„é”™è¯¯å¼•èµ·çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸ºäº†æä¾›ä¸°å¯Œçš„åŠŸèƒ½è€Œæ•…æ„æš´éœ²æ¨¡æ¿å¼•èµ·çš„ï¼Œå°±åƒç»´åŸºã€åšå®¢ã€è¥é”€åº”ç”¨ç¨‹åºå’Œå†…å®¹ç®¡ç†ç³»ç»Ÿé€šå¸¸æ‰€åšçš„é‚£æ ·ã€‚ä¸€äº›æœ€å¸¸ç”¨çš„æœåŠ¡å™¨ç«¯æ¨¡æ¿å¼•æ“æœ‰ **Smartyã€æ¨±äº•çœŸå­ã€Twig å’Œ Jinja2ã€‚**

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒå®¹æ˜“å—åˆ° SSTI æ¼æ´çš„æ”»å‡»ï¼Œä½†æˆ‘ä»¬ä¸çŸ¥é“è¿™é‡Œä½¿ç”¨çš„æ˜¯å“ªç§æ¨¡æ¿ã€‚

> **è¯†åˆ«æ¨¡æ¿æ–¹æ³• 1**

æ­¤å›¾æ˜¾ç¤ºäº†å¦‚ä½•è¯†åˆ«æ¨¡æ¿ç±»å‹çš„æ­¥éª¤ã€‚

![](img/b42c273a73398db32330850d7a2d0fb0.png)

åœ¨æ ‡é¢˜å­—æ®µ{ 5 * 5 }--> { { 5 * 5 } }--> { { 5 * ' 5 ' } }-->ç»“æœ 55555 ä¸­è¾“å…¥ã€‚è¿™è¯æ˜æˆ‘ä»¬æœ‰ Jinja2ã€‚

> **è¯†åˆ«æ¨¡æ¿æ–¹æ³• 2**

è¿™ä¸€æ¬¡æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå·¥å…·å¯ä»¥ä¸ºæˆ‘ä»¬åšè¿™ä»¶äº‹ï¼Œä½†æˆ‘ä»¬ä¹Ÿåº”è¯¥çŸ¥é“æ‰‹åŠ¨è¿‡ç¨‹ã€https://github.com/epinna/tplmap[](https://github.com/epinna/tplmap)

**åªéœ€è¾“å…¥å‘½ä»¤**ã€‚/TPL map . py-u '**[**http://doctors.htb/home\?page\=1'**](http://doctors.htb/home\?page\=1')**ä½ å°±èƒ½çŸ¥é“æ‰€ç”¨çš„æ¨¡æ¿åäº†ã€‚ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°**åå£³**ä¹Ÿä½†æ˜¯æˆ‘å¤±è´¥äº†ã€‚ä½ å¯ä»¥è¯•è¯•è¿™ä¸ªã€‚****

> ****è·å¾—åå‘å¤–å£³-æ–¹æ³• 1****

****ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†è¶³å¤Ÿçš„åå‘å¤–å£³ä¿¡æ¯ã€‚ä½¿ç”¨[**python payload**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#methodology)ï¼Œåªä¿®æ”¹ IP_addressã€‚å‘å¸ƒæ¶ˆæ¯â€¦****

****![](img/e86fd1cac9b3b30b6d7834af046e8c7e.png)****

****â€¦å¹¶åˆ·æ–°**URI/æ¡£æ¡ˆåº“**ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„ç»ˆç«¯å¹¶ç›‘å¬è¿æ¥ã€‚****

****![](img/79609efbc3bd66b9dcbca62b087ce8ad.png)****

> ****è·å¾—åå‘å¤–å£³-æ–¹æ³• 2****

****åœ¨æœç´¢è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘åœ¨ youtube ä¸Šçœ‹åˆ°äº†ä¸€ä¸ªè§†é¢‘ï¼Œæ˜¾ç¤ºäº†åˆ©ç”¨**å†…å®¹å­—æ®µ**æ¥è·å¾—ä¸€ä¸ªåå‘å¤–å£³ã€‚****

****![](img/93708fa0eb41ffb72d2bf1005fa7a88a.png)****

****æˆ‘ä¸çŸ¥é“æ€ä¹ˆåšï¼Œä½†å¦‚æœæœ‰äººçŸ¥é“ï¼Œè¯·åœ¨è¯„è®ºåŒºå‘æˆ‘è§£é‡Šã€‚****

****ç»§ç»­ï¼Œæˆ‘åˆ—ä¸¾äº†æœºå™¨ï¼Œæ˜¾ç¤ºæˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·å shaunã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨å›¢ä½“ä¸­æœ‰(adm)ã€‚****

****![](img/6edc7efd4c4ba35481456437e2561a25.png)****

****æˆ‘åœ¨ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼Œå¾—çŸ¥ [**adm**](https://superuser.com/questions/86347/whats-difference-between-group-admin-and-adm) æ˜¯ Ubuntu ä¸Šä¸€ä¸ªåªå¯¹æŸ¥çœ‹/var/log(å†å²ä¸Šæ›¾å«/var/adm)ä¸­æ‰€æœ‰æ—¥å¿—æ–‡ä»¶æœ‰å¥½å¤„çš„ç»„ã€‚****

****å¯¼èˆªåˆ°/var/log/apache2 è·¯å¾„å¹¶è·å¾—æ–‡ä»¶**å¤‡ä»½ã€‚******

****![](img/4e342fc068ca0f9ababdc52350507c8c.png)****

****ç”±äºè¿™æ˜¯ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ï¼Œæˆ‘è¯•å›¾é€šè¿‡ **grep è·å–ç”¨æˆ· shaun çš„å‡­è¯ã€‚******

****![](img/d65dd0063dd2b4ffc8b8182670ee43d0.png)****

> ****æƒé™æå‡****

****åˆ‡æ¢åˆ° shaun å¸æˆ·ï¼Œå¹¶å°è¯•ä»–æ˜¯å¦æœ‰ sudo æƒé™ï¼Œä½†æ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿ï¼Œè€Œæ˜¯é¦–å…ˆè®¿é—®ç¬¬ä¸€ä¸ª flag **/home/shaun** è·¯å¾„ã€‚****

****![](img/768067d1d095c30024de33c4218fb320.png)****

****åœ¨äº’è”ç½‘ä¸Šæœç´¢å¦‚ä½•æ»¥ç”¨ Splunk æ¥æå‡ç‰¹æƒï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªä¸é”™çš„ [**åšå®¢**](https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/) ï¼Œå®ƒæŒ‡å¼•æˆ‘ä½¿ç”¨**[**pysplunkwhisper 2**](https://github.com/cnotin/SplunkWhisperer2)**ã€‚********

****å…‹éš†è¯¥å·¥å…·ï¼Œåƒæˆ‘ä¸€æ ·æŒ‡å®šæœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶åœ¨æ–°çš„ç»ˆç«¯ä¸­ç›‘å¬ä¼ å…¥çš„è¿æ¥ã€‚****

****![](img/aa891afe4f3b6474fb3bbefca0fe60a0.png)****

****å¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†æ ¹è®¿é—®æƒé™ã€‚å¯¼èˆªåˆ°æœ€åä¸€ä¸ªæ ‡å¿—çš„/æ ¹ç›®å½•ã€‚****

****![](img/e87081562e611b526d763c897afc2419.png)****

****å¦‚éœ€æ›´å¤šæ¼”ç»ƒï¼Œè¯·ç»§ç»­å…³æ³¨â€¦****

# ****åœ¨ä½ èµ°ä¹‹å‰****

****è®¿é—®æˆ‘çš„ Funbox ç³»åˆ—æ¼«æ¸¸çš„:-****

****[](https://shubham-singh.medium.com/funbox-7-easyenum-walkthrough-vulnhub-3c1ef0f1c2ef) [## FUNBOX-7: EASYENUM æ¼«æ¸¸(Vulnhub)

### æè¿°

shubham-singh.medium.com](https://shubham-singh.medium.com/funbox-7-easyenum-walkthrough-vulnhub-3c1ef0f1c2ef) [](https://github.com/Mr-Lazzy/Funbox-Walkthrough-s) [## æ‡’è™«å…ˆç”Ÿ/fun box-æ¼«æ¸¸-s

### æ­¤æ—¶æ‚¨ä¸èƒ½æ‰§è¡Œè¯¥æ“ä½œã€‚æ‚¨å·²ä½¿ç”¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæˆ–çª—å£ç™»å½•ã€‚æ‚¨å·²åœ¨å¦ä¸€ä¸ªé€‰é¡¹å¡ä¸­æ³¨é”€ï¼Œæˆ–è€…â€¦

github.com](https://github.com/Mr-Lazzy/Funbox-Walkthrough-s) [](https://github.com/Mr-Lazzy/Vulnhub_Walkthrough) [## æ‡’äººå…ˆç”Ÿ/Vulnhub _ æ¼”ç»ƒ

### GitHub æ˜¯è¶…è¿‡ 5000 ä¸‡å¼€å‘äººå‘˜çš„å®¶å›­ï¼Œä»–ä»¬ä¸€èµ·å·¥ä½œæ¥æ‰˜ç®¡å’Œå®¡æŸ¥ä»£ç ã€ç®¡ç†é¡¹ç›®å’Œæ„å»ºâ€¦

github.com](https://github.com/Mr-Lazzy/Vulnhub_Walkthrough) 

é¼“æŒğŸ‘å¦‚æœä½ å–œæ¬¢ä½ æ‰€è¯»çš„ã€‚æ¬¢è¿åé¦ˆã€‚****