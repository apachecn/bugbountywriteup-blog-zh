# æˆ‘æ˜¯å¦‚ä½•ä¾µå…¥ç”µä¿¡ç½‘ç»œçš„â€”â€”ç¬¬å››éƒ¨åˆ†(è®¿é—® cdrã€SS7 åº”ç”¨ç¨‹åºå’Œ vlr)

> åŸæ–‡ï¼š<https://infosecwriteups.com/how-i-hacked-into-a-telecom-network-part-4-getting-access-to-cdrs-ss7-applications-vlrs-9a8cf95e2648?source=collection_archive---------0----------------------->

> *TLDRï¼›ä¸€å®¶ç”µä¿¡å…¬å¸çš„çº¢é˜Ÿé¡¹ç›®ã€‚åœ¨å…¬å¸çš„ç½‘ç»œç›‘æ§ç³»ç»Ÿ(NMS)ä¸Šè·å¾—äº†ç«‹è¶³ç‚¹ã€‚é€šè¿‡ HTTP éš§é“ä¼ è¾“ SSH çš„åå‘å¤–å£³é—®é¢˜å·²æ’åºã€‚å½“é€šè¿‡ HTTP è·å¾— SSH æ—¶å˜æˆäº†å®Œå…¨å¿è€…ã€‚åœ¨ç½‘ç»œå†…éƒ¨ä»£ç†ä»¥è·å–å†…éƒ¨ç½‘ç»œæ‰«æã€‚ä½¿ç”¨ SS7 åº”ç”¨ç¨‹åºè®¿é—® CDRs å’Œ VLRã€‚*

## å›é¡¾:ä¸€å®¶ç”µä¿¡å…¬å¸çš„çº¢é˜Ÿé¡¹ç›®ã€‚æ‰¾åˆ°äº†æ„Ÿå…´è¶£çš„å­åŸŸï¼Œåœ¨é‚£ä¸ªå­åŸŸä¸Šåšäº†å…¨ç«¯å£æ‰«æï¼Œæ‰¾åˆ°äº†ç«¯å£ 12000/tcpï¼Œ14000/tcpï¼Œ14100/tcp æ‰¾åˆ°äº† JBoss çš„ä¸€ä¸ªè¿è¡Œå®ä¾‹(æˆ‘çœŸå¹¸è¿ï¼)ï¼Œä¸º RCE å¼€å‘äº† JBossï¼Œä¸ºå¤–å£³ç¨³å®šæ€§å®ç°äº† HTTP ä¸Šçš„ TCP éš§é“ã€‚

è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹
[***ç¬¬ä¸€éƒ¨åˆ†â€”è·å– RCE***](https://medium.com/bugbountywriteup/how-i-hacked-into-a-telecom-network-part-1-getting-the-rce-167c2bb320e6)[***ç¬¬äºŒéƒ¨åˆ†â€”ç©è½¬éš§é“:TCP éš§é“***](https://medium.com/bugbountywriteup/how-i-hacked-into-a-telecom-network-part-2-playing-with-tunnels-tcp-tunneling-b4cef2837938) [***ç¬¬ä¸‰éƒ¨åˆ†â€”ç©è½¬éš§é“:éšèº« SSH &åŠ¨æ€ SSH éš§é“***](https://medium.com/bugbountywriteup/how-i-hacked-into-a-telecom-network-part-3-playing-with-tunnels-stealthy-ssh-dynamic-tunnels-5ac26557d0eb)

åœ¨å‰é¢çš„ [***éƒ¨åˆ†***](https://medium.com/@TheCyb3rAlpha/how-i-hacked-into-a-telecom-network-part-3-playing-with-tunnels-stealthy-ssh-dynamic-tunnels-5ac26557d0eb)***(***[***ç©éš§é“:éšèº« SSH &åŠ¨æ€ SSH éš§é“***](https://medium.com/bugbountywriteup/how-i-hacked-into-a-telecom-network-part-3-playing-with-tunnels-stealthy-ssh-dynamic-tunnels-5ac26557d0eb)***)***ä¸­ï¼Œæˆ‘æåˆ°äº†ä½¿ç”¨ç«¯å£ 2222/tcp ä»æˆ‘çš„æœåŠ¡å™¨åˆ›å»ºå…·æœ‰éšèº« SSH è®¿é—®çš„ SSH éš§é“çš„æ­¥éª¤ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ SOCKS éš§é“è¿›è¡Œå†…éƒ¨ç½‘ç»œä¾¦å¯Ÿï¼Œå¹¶åˆ©ç”¨å†…éƒ¨æœåŠ¡å™¨æ¥è®¿é—®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„ cdrã€‚

# æ€åŠ¿æ„ŸçŸ¥(å†…éƒ¨ç½‘ç»œ)

åœ¨å‚ä¸è¿‡ç¨‹ä¸­ï¼Œæˆ‘èƒ½å¤Ÿé€šè¿‡ HTTP ä¸Šçš„ TCP éš§é“åˆ›å»ºä¸€ä¸ªåŠ¨æ€çš„ SSH éš§é“ï¼Œç›¸ä¿¡æˆ‘ï¼Œè¿™ä¸ª shell éå¸¸æ£’ï¼

![](img/3b01a46e295fe9df9745ee483b22bda3.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘é€šè¿‡ç«¯å£ 9090/tcp é…ç½®äº† SOCKS éš§é“ï¼Œç„¶åä¸º NMap æ‰«æè¿æ¥äº† proxychainsã€‚

![](img/00340edb050c00cf684b5bb1a1324570.png)

è™½ç„¶æˆ‘æ›´å–œæ¬¢ Metasploit è€Œä¸æ˜¯ NMapï¼Œå› ä¸ºå®ƒæä¾›äº†æ›´å¤šçš„æ‰«æèŒƒå›´ï¼Œå¹¶ä¸”æˆ‘èƒ½å¤Ÿä½¿ç”¨å®ƒè½»æ¾åœ°ç®¡ç†å†…éƒ¨ IP æ‰«æã€‚ä¸ºäº†ä½¿ç”¨æ‰€æœ‰æ¨¡å—çš„ä»£ç†ï¼Œæˆ‘ä½¿ç”¨äº†"**setg Proxies socks 4:127 . 0 . 0 . 1:9090 "**å‘½ä»¤(å…¨å±€è®¾ç½®ä»£ç†é€‰é¡¹)ã€‚æˆ‘å¯»æ‰¾å†…éƒ¨ç½‘ç»œæœåŠ¡å™¨ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨äº†**è¾…åŠ©/æ‰«æä»ª/http/http_version** æ¨¡å—ã€‚

![](img/eccf696eaf104c63edd1e7dd9b41504e.png)

å› ä¸º setgï¼Œä»£ç†é€‰é¡¹å·²ç»è®¾ç½®å¥½äº†ï¼Œç°åœ¨æˆ‘éœ€è¦åšçš„å°±æ˜¯ç»™å‡º IP å­ç½‘èŒƒå›´å¹¶è¿è¡Œæ¨¡å—ã€‚

![](img/7d9cae5dd36462698602759d4975c75a.png)

æˆ‘æ‰¾åˆ°äº†ä¸€äº›è¿œç¨‹ç®¡ç†æ§åˆ¶å™¨(iRMC)ã€ä¸€äº› SAN äº¤æ¢æœº(switchExplorer.html)å’Œä¸€ä¸ª JBoss å®ä¾‹â€¦

![](img/0df03bb52bfd35562452b25f82522c3b.png)

è¿˜æœ‰ä¸€ä¸ªå†…éƒ¨ä½¿ç”¨çš„ JBoss å®ä¾‹ï¼ŸğŸ¤£

# åˆ©ç”¨å†…éƒ¨ç½‘ç»œæœåŠ¡

å› æ­¤ï¼Œåœ¨å†…éƒ¨ IP 10.x.x.x ä¸Šçš„ç«¯å£ 80/tcp ä¸Šè¿è¡Œäº†å¦ä¸€ä¸ª JBoss å®ä¾‹ã€‚å› æ­¤ï¼Œæˆ‘æ‰€è¦åšçš„å°±æ˜¯ä½¿ç”¨ proxychains å¹¶åœ¨å†…éƒ¨ IP ä¸Šå†æ¬¡è¿è¡Œ JexBoss(æˆ‘ä¹Ÿå¯ä»¥åœ¨ JexBoss ä¸­ä½¿ç”¨-P å¼€å…³æ¥æä¾›ä»£ç†åœ°å€)ã€‚

è¿™å¯¹æˆ‘æ¥è¯´æ˜¯è½»è€Œæ˜“ä¸¾çš„èƒœåˆ©ï¼Œå› ä¸ºè¿è¡Œçš„å†…éƒ¨ JBoss æœåŠ¡å™¨ä¹Ÿå®¹æ˜“å—åˆ°æ”»å‡»ï¼Œå› æ­¤ï¼Œæˆ‘èƒ½å¤Ÿå°† RCE ä»æˆ‘çš„ pivotal æœºå™¨(æœ€åˆçš„è½è„šç‚¹æœºå™¨)è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªå†…éƒ¨ JBoss æœåŠ¡å™¨ğŸ˜

![](img/bc4238fd221c062f45fd8e619bcdc3e5.png)

**ç‰›é€¼ï¼**ç°åœ¨ï¼Œå½“æˆ‘å¾—åˆ° shell æ—¶ï¼Œæˆ‘ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä»¥ç»“æ„åŒ–çš„æ–¹å¼åˆ—å‡ºäº†/home/ <ç”¨æˆ·>ä½ç½®ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•:

***cd /home/ <ç”¨æˆ·> |æŸ¥æ‰¾ã€‚-æ‰“å°| sed-e " sï¼›[^/]*/;|_ _ _ _;gï¼›sï¼›_ _ _ _|;|;g" 2 > & 1***

![](img/7af75febc8da64af1f833fe038207a4b.png)

åœ¨è¾“å‡ºä¸­ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ã€‚bat æ–‡ä»¶â€” **ss7-cli.bat** (è¯¥è„šæœ¬é…ç½® ss7 ç®¡ç†å¤–å£³å¼•å¯¼ç¯å¢ƒ)

åœ¨åŒä¸€å†…éƒ¨ JBoss æœåŠ¡å™¨ä¸­ï¼Œè¿˜å­˜å‚¨äº†ä¸€ä¸ª [**è®¿é—®è€…ä½ç½®å¯„å­˜å™¨(VLR)**](https://en.wikipedia.org/wiki/Network_switching_subsystem#Visitor_location_register_(VLR)) æ§åˆ¶å°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œä»¥ä»æ•°æ®åº“ä¸­è®¿é—® VLR ä¿¡æ¯ã€‚

![](img/379f3b91f5dd951bfaf7ab431cc8c040.png)

## ä»€ä¹ˆæ˜¯ SS7ï¼Ÿ

> **ä¿¡ä»¤ç³»ç»Ÿâ„–7** ( **SS7** )æ˜¯ 1975 å¹´å¼€å‘çš„ä¸€å¥—[ç”µè¯](https://en.wikipedia.org/wiki/Telephony) [ä¿¡ä»¤](https://en.wikipedia.org/wiki/Signaling_(telecommunications))åè®®ï¼Œç”¨äºåœ¨å…¨çƒ[å…¬å…±äº¤æ¢ç”µè¯ç½‘](https://en.wikipedia.org/wiki/Public_switched_telephone_network) (PSTN)çš„å¤§éƒ¨åˆ†åœ°åŒºå»ºç«‹å’Œ[æ‹†é™¤](https://en.wikipedia.org/wiki/Clearing_(telecommunications))ç”µè¯å‘¼å«ã€‚è¯¥åè®®è¿˜æ‰§è¡Œå·ç è½¬æ¢ã€[æœ¬åœ°å·ç å¯ç§»æ¤æ€§](https://en.wikipedia.org/wiki/Local_number_portability)ã€é¢„ä»˜è´¹è®¡è´¹ã€[çŸ­æ¶ˆæ¯æœåŠ¡](https://en.wikipedia.org/wiki/Short_Message_Service) (SMS)å’Œå…¶ä»–æœåŠ¡ã€‚æ¥æº:[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Signalling_System_No._7)

ä¸ºäº†ç›‘æ§ SS7/ISDN é“¾è·¯ï¼Œè§£ç åè®®æ ‡å‡†å¹¶ç”Ÿæˆ cdr ç”¨äºè®¡è´¹ï¼Œéœ€è¦ä¸€ä¸ªæ§åˆ¶å°å®¢æˆ·ç«¯ä¸ç³»ç»Ÿäº¤äº’ã€‚

> ä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆ JBoss ä¸Šè¿è¡Œç€ SS7 å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Ÿä¸€ä¸ªè¯â€”â€”â€œç§»åŠ¨â€

## æµåŠ¨äººå£

> Mobicents æ˜¯ä¸€ä¸ªç”¨ Java ç¼–å†™çš„å¼€æº VoIP å¹³å°ï¼Œç”¨äºå¸®åŠ©åˆ›å»ºã€éƒ¨ç½²ã€ç®¡ç†æœåŠ¡å’Œåº”ç”¨ç¨‹åºï¼Œè¿™äº›æœåŠ¡å’Œåº”ç”¨ç¨‹åºé›†æˆäº†ä¸€ç³»åˆ— IP å’Œä¼ ç»Ÿé€šä¿¡ç½‘ç»œä¸­çš„è¯­éŸ³ã€è§†é¢‘å’Œæ•°æ®ã€‚æ¥æº:[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Mobicents)
> 
> ç§»åŠ¨å†…å®¹æ”¯æŒæœåŠ¡æ„å»ºæ¨¡å—(SBB)çš„ç»„åˆï¼Œä¾‹å¦‚**å‘¼å«æ§åˆ¶ã€è®¡è´¹ã€ç”¨æˆ·ä¾›åº”ã€ç®¡ç†å’Œåœ¨çº¿çŠ¶æ€æ•æ„Ÿç‰¹æ€§**ã€‚è¿™ä½¿å¾—ç§»åŠ¨æœåŠ¡å™¨æˆä¸ºç”µä¿¡è¿è¥æ”¯æŒç³»ç»Ÿ(OSS)å’Œ**ç½‘ç»œç®¡ç†ç³»ç»Ÿ(NMS)** çš„è½»æ¾é€‰æ‹©ã€‚æ¥æº:[design.jboss.org](https://design.jboss.org/mobicents/html/faq.html)

å› æ­¤ï¼Œçœ‹èµ·æ¥å†…éƒ¨ JBoss æœåŠ¡å™¨æ­£åœ¨è¿è¡Œä¸€ä¸ª VoIP ç½‘å…³åº”ç”¨ç¨‹åº( [SIP æœåŠ¡å™¨](https://en.wikipedia.org/wiki/Session_Initiation_Protocol))ï¼Œè¯¥åº”ç”¨ç¨‹åºä½¿ç”¨ **SS7** ä¸ [**å…¬å…±äº¤æ¢ç”µè¯ç½‘(PSTN)**](https://en.wikipedia.org/wiki/Public_switched_telephone_network) è¿›è¡Œäº¤äº’ã€‚(åœ¨æ²¡æœ‰ä»»ä½•ç½‘ç»œä½“ç³»ç»“æ„å›¾çš„æƒ…å†µä¸‹ï¼Œäº†è§£å†…éƒ¨ç½‘ç»œç»“æ„æ˜¯å¾ˆç´¯çš„)

![](img/322709726b21a93a7245cf501c5d3eb5.png)

# è¶…è¶Š

å½“åœ¨è¿è¡Œ VoIP ç½‘å…³çš„å†…éƒ¨ JBoss åº”ç”¨ç¨‹åºä¸­åšæ›´å¤šçš„è°ƒæŸ¥æ—¶ï¼Œæˆ‘å‘ç°æœ‰ä¸€äº›å†…éƒ¨ç½‘å…³æœåŠ¡å™¨ã€CDR å¤‡ä»½æ•°æ®åº“ã€å­˜å‚¨ SS7 å’Œ USSD åè®®å¤‡ä»½é…ç½®çš„ FTP æœåŠ¡å™¨ç­‰ã€‚(æ„Ÿè°¢ **/etc/hosts** )

![](img/6be9907cd8b190420d7d3fe646bab17b.png)

ä» hosts æ–‡ä»¶ä¸­ï¼Œæˆ‘å‘ç°äº†è®¸å¤š FTP æœåŠ¡å™¨ï¼Œèµ·åˆæˆ‘å¹¶ä¸è§‰å¾—å®ƒä»¬å¾ˆé‡è¦ï¼Œä½†åæ¥æˆ‘å‘ç°äº† CDR-S å’Œ CDR-L FTP æœåŠ¡å™¨ã€‚è¿™äº›æœåŠ¡å™¨åˆ†åˆ«å­˜å‚¨ç€å¤‡ä»½çš„ [**CDR S è®°å½•**](https://downloads.avaya.com/css/P8/documents/100096784) å’Œ [**CDR** **L è®°å½•**](https://downloads.avaya.com/css/P8/documents/100096784) ã€‚

> ä½ å¯ä»¥ä»[è¿™é‡Œ](https://downloads.avaya.com/css/P8/documents/100096784):**CDR S-Records:Page 157**&**CDR L-Records:Page 168**

ä½¿ç”¨ Metasploitï¼Œæˆ‘å¿«é€Ÿæ‰«æäº†è¿™äº› FTP æœåŠ¡å™¨å¹¶æ£€æŸ¥äº†å®ƒä»¬çš„è®¤è¯çŠ¶æ€ã€‚

![](img/9b4b564c0bc967c75d0863ebd4da3e46.png)

æ— éœ€ä»»ä½•è®¤è¯å°±å¯ä»¥è®¿é—® FTP æœåŠ¡å™¨ğŸ¤£ğŸ¤£

![](img/bfd2c10d5af7162a2779a76ab18abf11.png)

ä¹Ÿè®¸ FTP æœåŠ¡å™¨æ˜¯ä¾› VoIP åº”ç”¨ç¨‹åºæˆ–å…¶ä»–ä¸œè¥¿å†…éƒ¨ä½¿ç”¨çš„ï¼Œä½†æ˜¯èƒœåˆ©å°±æ˜¯èƒœåˆ©ï¼

å› æ­¤ï¼Œæˆ‘èƒ½å¤Ÿè·å¾—å‡ ä¹æ‰€æœ‰ç§»åŠ¨ç”¨æˆ·çš„ä»¥ XLS æ ¼å¼å­˜å‚¨çš„ **CDR å¤‡ä»½**ã€‚(æŠ±æ­‰ï¼Œæˆ‘ä¸å¾—ä¸ç¼–è¾‘äº†å¾ˆå¤šï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯éå¸¸é‡è¦)

![](img/ab2b979d86f92adbb450298f0e2f6795.png)

ä»æˆªå›¾æ¥çœ‹ï¼Œ **A å·ç **æ˜¯å‘èµ·å‘¼å«çš„åœ°æ–¹(å‘¼å«è€…)ï¼Œè€Œ **B å·ç **æ˜¯è¢«æ‹¨çš„å·ç ã€‚CDR è®°å½•è¿˜åŒ…æ‹¬ **IMSI & IMEI å·ç ã€å‘¼å«å¼€å§‹/ç»“æŸæ—¥æœŸ&æ—¶é—´æˆ³ã€å‘¼å«æŒç»­æ—¶é—´ã€å‘¼å«ç±»å‹**(å‘¼å…¥æˆ–å‘¼å‡º)ã€**æœåŠ¡ç±»å‹**(ç”µä¿¡æœåŠ¡å…¬å¸)ã€**èœ‚çª ID-A** (å‘èµ·å‘¼å«çš„èœ‚çªå¡”)å’Œ**ä½ç½®-A** (å‘¼å«è€…çš„ä½ç½®)

ä¸€æ—¦æˆ‘ä»¬çš„å›¢é˜Ÿé€šçŸ¥å®¢æˆ·æˆ‘ä»¬å¯ä»¥è®¿é—® CDR å¤‡ä»½æœåŠ¡å™¨ï¼Œå®¢æˆ·å°±è¦æ±‚æˆ‘ä»¬ç»“æŸåœ¨é‚£é‡Œçš„å·¥ä½œã€‚æˆ‘æƒ³ä»–ä»¬æ‰¿å—ä¸äº†ğŸ¤£

æˆ‘å¸Œæœ›ä½ ä»¬å–œæ¬¢å®ƒï¼

# æ¨å¹¿æ—¶é—´ï¼

å¦‚æœä½ ä»¬æƒ³äº†è§£æ›´å¤šå…³äºæˆ‘ä½¿ç”¨çš„æŠ€æœ¯åŠå…¶èƒŒåçš„åŸºæœ¬æ¦‚å¿µï¼Œå¯ä»¥é˜…è¯»æˆ‘çš„ä¹¦(ä¸***@ himan Shu _ hax****)*

> ***åŠ¨æ‰‹çº¢é˜Ÿæˆ˜æœ¯****â€”â€”*[*äºšé©¬é€Š*](https://www.amazon.in/Hands-Penetration-Testing-Metasploit-vulnerabilities-ebook/dp/B07MT8DDBR) *ï¼Œ*[*PacktPub*](https://www.packtpub.com/in/networking-and-servers/hands-red-team-tactics)

![](img/219160c1b668ab6f008b7cf8ca8b99e9.png)

> ***ç”¨ Metasploit****â€”*[*äºšé©¬é€Š*](https://www.amazon.in/Hands-Penetration-Testing-Metasploit-vulnerabilities-ebook/dp/B07MT8DDBR) *ã€*[*PacktPub*](https://www.packtpub.com/in/networking-and-servers/hands-web-penetration-testing-metasploit)

![](img/2d8e60d33784d41c958ec8512c48e6a7.png)