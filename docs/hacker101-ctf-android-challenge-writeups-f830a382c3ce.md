# é»‘å®¢ 101 CTF:å®‰å“æŒ‘æˆ˜æŠ¥é“

> åŸæ–‡ï¼š<https://infosecwriteups.com/hacker101-ctf-android-challenge-writeups-f830a382c3ce?source=collection_archive---------0----------------------->

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•è§£å†³ Android ç±»åˆ«çš„*é»‘å®¢ 101**(æ•æ‰æ——å¸œ)æŒ‘æˆ˜ã€‚ [Hacker101](https://www.hacker101.com/) æ˜¯ä¸€ä¸ªå…è´¹çš„é»‘å®¢æ•™è‚²ç½‘ç«™ï¼Œç”± [HackerOne](https://www.hackerone.com/) è¿è¥ã€‚*

*![](img/c7553fbebf1bd89b895554eada677747.png)*

# *æ”¾å¼ƒ*

*æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„åŠ¨æœºæ˜¯æƒ³äº†è§£æ›´å¤šå…³äº Android ç§»åŠ¨åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„çŸ¥è¯†ã€‚è¿™ç¯‡æ–‡ç« æ˜¾ç„¶ä¼šåŒ…å«å‰§é€ï¼Œæˆ‘é¼“åŠ±è¯»è€…åœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« ä¹‹å‰å°è¯•è¿™ä¸ª CTFã€‚è¯•ç€å°½å¯èƒ½å¤šåœ°è§£å†³è¿™äº›æŒ‘æˆ˜ï¼Œå¦‚æœä½ é‡åˆ°å›°éš¾æˆ–è€…æƒ³çœ‹çœ‹è§£å†³æŒ‘æˆ˜çš„ä¸åŒæ–¹æ³•ï¼Œç¨åå†æ¥é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚ä¸è¦å†æ‹–å»¶äº†ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ğŸ˜ƒï¼*

# *H1 æ’æ¸©å™¨(ç®€æ˜“ï¼ŒåŒæ——)*

*æˆ‘é€šè¿‡ä¸‹è½½åº”ç”¨ç¨‹åº APK æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ **Android è°ƒè¯•æ¡¥** ( **ADB** )å°†å…¶å®‰è£…åœ¨æˆ‘çš„ä»¿çœŸå™¨è®¾å¤‡ä¸Šï¼Œå¼€å§‹äº†è¿™ä¸ªæŒ‘æˆ˜*

```
*adb install thermostat.apk*
```

*æ‰“å¼€åº”ç”¨ç¨‹åºæ˜¾ç¤ºï¼Œå®ƒåªæœ‰ä¸€ä¸ªå¸¦æœ‰æ’æ¸©å™¨å’Œæ¸©åº¦è®¡çš„æ´»åŠ¨ï¼Œå…è®¸ç”¨æˆ·æé«˜æˆ–é™ä½æ¸©åº¦è®¾ç½®ã€‚*

*![](img/bbfce290c356a3d7ff0b0cf2e0cbf33a.png)*

*æ¥ä¸‹æ¥ï¼Œæˆ‘ä½¿ç”¨**ç§»åŠ¨å®‰å…¨æ¡†æ¶** ( **MobSF** )å·¥å…·ä¸º APK æ–‡ä»¶ç”Ÿæˆäº†ä¸€ä¸ªé™æ€åˆ†ææŠ¥å‘Šã€‚æˆ‘é€šè¿‡æ£€æŸ¥ *AndroidManifest.xml* æ–‡ä»¶å¼€å§‹å®¡æŸ¥æŠ¥å‘Šã€‚*

*![](img/0221be9fe7297bce0486a9a0d2ff0cfc.png)*

*æŸ¥çœ‹æ¸…å•æ–‡ä»¶ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåªè¯·æ±‚äº†**Android . permission . internet**æƒé™ï¼Œè¯¥æƒé™å…è®¸åº”ç”¨ç¨‹åºåˆ›å»ºç½‘ç»œå¥—æ¥å­—ã€‚å¼€å‘äººå‘˜å·²ç»å°†å±æ€§**Android:usesCleartextTraffic**å’Œ **android:allowBackup** è®¾ç½®ä¸º **true** ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºæ‰“ç®—ä½¿ç”¨æ˜æ–‡æµé‡ï¼Œå¹¶ä¸”å¯ä»¥è®©ç”¨æˆ·å¤‡ä»½å…¶å†…å®¹ã€‚*

*è¯¥åº”ç”¨ç¨‹åºä¼¼ä¹ä¹Ÿåªæœ‰ä¸¤ä¸ªç»„ä»¶ã€‚ä¸€ä¸ªåä¸º*com . hacker 101 . level 11 . thermoseactivity*çš„**æ´»åŠ¨**å·²ç»ç”¨æ„å›¾è¿‡æ»¤å™¨å£°æ˜ã€‚åä¸º*ProcessLifecycleOwnerInitializer*çš„**å†…å®¹æä¾›è€…**ä¹Ÿå·²å£°æ˜ï¼Œä½†æœªå¯¼å‡ºã€‚æˆ‘å†³å®šæ£€æŸ¥ä¸€ä¸‹*com . hacker 101 . level 11 . thermoseactivity .*çš„ java æºä»£ç *

*![](img/7b1a4244fceecdcc55df5bc80f23435e.png)*

*åœ¨æŸ¥çœ‹æ´»åŠ¨çš„æºä»£ç æ—¶ï¼Œæˆ‘æ³¨æ„åˆ°æ­£åœ¨å‘å‡ºä¸€ä¸ªç½‘ç»œè¯·æ±‚ã€‚è¿™ä¸ªç½‘ç»œè¯·æ±‚ä¸­ä½¿ç”¨äº†ä¸€ä¸ªåä¸º *PayloadRequest* çš„ç±»ï¼Œç”¨ç»¿è‰²çªå‡ºæ˜¾ç¤ºã€‚æ£€æŸ¥ *PayloadRequest* ç±»çš„æºä»£ç ï¼Œæˆ‘å‘ç°äº†æŒ‘æˆ˜çš„ä¸¤ä¸ªæ ‡å¿—ã€‚*

*![](img/6a559e34c852451439c5b4a37abb41e6.png)*

*çœ‹èµ·æ¥ä¸€ä¸ªæ ‡å¿—ä½¿ç”¨ **MD5** æ•£åˆ—ï¼Œç„¶å **base64** ç¼–ç ï¼Œç„¶åä½œä¸ºä¸€ä¸ªå€¼æ·»åŠ åˆ°åä¸º *X-MAC* çš„å¤´ä¸­ã€‚å¦ä¸€ä¸ªæ ‡å¿—åªæ˜¯ä½œä¸ºæ˜æ–‡å€¼æ·»åŠ åˆ°æŠ¥å¤´ *X æ ‡å¿—*ä¸­ã€‚åœ¨ä¸åº”ç”¨ç¨‹åºäº¤äº’æ—¶ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨å·¥å…· **BurpSuite** æ¥æ‹¦æˆªè¿™ä¸ªç½‘ç»œè¯·æ±‚ã€‚*

*![](img/f7d5b509a19d8fb6860a7ae029220f5b.png)*

*å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆªå–çš„ç½‘ç»œè¯·æ±‚æ˜¾ç¤ºäº† *X-MAC* å’Œ *X-Flag* æŠ¥å¤´åŠå…¶ç­‰å€¼ã€‚ç¬¬ä¸€æ¬¡æŒ‘æˆ˜å¾ˆç®€å•ğŸ˜ƒï¼*

# *æœ‰æ„é”»ç‚¼(ä¸­åº¦ï¼Œ1 é¢æ——)*

*æŒ‰ç…§å‰é¢æŒ‘æˆ˜ä¸­çœ‹åˆ°çš„ç±»ä¼¼æ–¹æ³•ï¼Œæˆ‘ä½¿ç”¨ ADB å®‰è£…äº†åº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨ MobSF ç”Ÿæˆäº† APK æ–‡ä»¶çš„é™æ€åˆ†ææŠ¥å‘Šã€‚æ‰“å¼€åº”ç”¨ç¨‹åºä¼šæ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰æ¬¢è¿æ¶ˆæ¯å’Œä¸€ä¸ªåä¸º**ã€Flagã€‘***çš„é“¾æ¥çš„æ´»åŠ¨ã€‚**

*![](img/a13f4562bac24a46a21abf80d9861c5a.png)*

*ç‚¹å‡»é“¾æ¥å¯¼è‡´**â€œæ— æ•ˆè¯·æ±‚â€**é”™è¯¯ã€‚æˆ‘çŒœä¸ä¼šé‚£ä¹ˆå®¹æ˜“ğŸ˜ã€‚*

*![](img/51b8a24f54c067f473c3d86a3762b335.png)*

*æ­£å¦‚åœ¨å‰é¢çš„æŒ‘æˆ˜ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„æ¸…å•æ–‡ä»¶å¼€å§‹ã€‚æ¸…å•æ–‡ä»¶ä¸­åªå£°æ˜äº†ä¸€ä¸ª**æ´»åŠ¨**ã€‚è¯¥æ´»åŠ¨çš„çªå‡ºä¹‹å¤„åœ¨äºï¼Œå®ƒå·²ç»é€šè¿‡ä¸‰ä¸ª**æ„å›¾è¿‡æ»¤å™¨**è¿›è¡Œäº†å£°æ˜ã€‚ä¸‹å›¾ä¸­è¢«ç»¿è‰²åŒ…å›´çš„ä¸¤ä¸ªæ„å›¾è¿‡æ»¤å™¨å±•ç¤ºäº†ä½ å¦‚ä½•ä¸ºä½ çš„åº”ç”¨ç¨‹åºå†…å®¹åˆ›å»ºä¸€ä¸ª**æ·±åº¦é“¾æ¥**(**å‚è§å‚è€ƒæ–‡çŒ®**)ã€‚*

> *æ³¨æ„:æ·±åº¦é“¾æ¥æ˜¯ä¸€ä¸ªå¸®åŠ©ç”¨æˆ·åœ¨ç½‘ç»œå’Œåº”ç”¨ä¹‹é—´å¯¼èˆªçš„æ¦‚å¿µã€‚å®ƒä»¬åŸºæœ¬ä¸Šæ˜¯å°†ç”¨æˆ·ç›´æ¥å¯¼èˆªåˆ°**åº”ç”¨ç¨‹åºä¸­ç‰¹å®šå†…å®¹çš„ URLã€‚***

*![](img/64a972bc98e2198dc8fcd76a87140a7e.png)*

*ä¸ºäº†æµ‹è¯•ç¬¬ä¸€ä¸ªæ·±åº¦é“¾æ¥(å³ http)ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ **ADB** å’Œæ´»åŠ¨ç®¡ç†å™¨(am)å·¥å…·æ¥æµ‹è¯•ä¸ºæ·±åº¦é“¾æ¥æŒ‡å®šçš„æ„å›¾è¿‡æ»¤å™¨ URI æ˜¯å¦è§£æåˆ°æ­£ç¡®çš„åº”ç”¨æ´»åŠ¨ã€‚ä¸‹é¢çš„å‘½ä»¤æˆåŠŸåœ°å¯åŠ¨äº†åº”ç”¨ç¨‹åºçš„ä¸»æ´»åŠ¨ã€‚*

```
*adb shell am start -W -a "android.intent.action.VIEW" -d "http://level13.hacker101.com" com.hacker101.level13*
```

*æˆ‘å†³å®šçœ‹çœ‹ *MainActivity çš„æºä»£ç ã€‚æµè§ˆ java ä»£ç ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºåˆ›å»ºäº†ä¸€ä¸ª **WebView** ã€‚è¿˜å£°æ˜äº†ä¸¤ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼Œå˜é‡ ***str*** åŒ…å«ä¸€ä¸ªç¡¬ç¼–ç çš„ URLã€‚**

> *æ³¨æ„:æ‚¨çš„åº”ç”¨ç¨‹åºçš„ URL ä¼šæœ‰æ‰€ä¸åŒã€‚*

*![](img/dd3a0abaaa598aa5510f596c2f6e3242.png)*

*å°†è¿™ä¸ª URL è¾“å…¥åˆ°æµè§ˆå™¨ä¸­ï¼Œä¼šè°ƒå‡ºä¹‹å‰åœ¨åº”ç”¨ç¨‹åºä¸»æ´»åŠ¨ä¸­çœ‹åˆ°çš„ç›¸åŒé¡µé¢ã€‚*

*![](img/479dc9d7e7898d5848201a070a4d7ff1.png)*

*å•å‡»æ ‡å¿—é“¾æ¥ä»ä¼šè¿”å›æ— æ•ˆè¯·æ±‚ã€‚*

*![](img/3901bed31ee0c527aa3e2ec851fa3856.png)*

*å†æ¬¡æŸ¥çœ‹æºä»£ç ï¼Œæˆ‘çœ‹åˆ°åº”ç”¨ç¨‹åºæ£€ç´¢äº†ç”¨äºå¯åŠ¨ä¸»æ´»åŠ¨çš„ i **ntent** ä¸­å­˜å‚¨çš„æ•°æ®ã€‚æ£€æŸ¥å‰é¢çš„æ¸…å•æ–‡ä»¶ï¼Œæˆ‘çŸ¥é“è¿™ä¸ªæ•°æ®æ˜¯ http://level13.hacker101.com çš„***URLã€‚ç„¶åï¼Œåº”ç”¨ç¨‹åºç»§ç»­ä½¿ç”¨ java **subString(28)** æ–¹æ³•æ¥å¿½ç•¥ä» intent æ£€ç´¢çš„æ•°æ®å­—ç¬¦ä¸²ä¸­çš„å‰ 28 ä¸ªå­—ç¬¦(å³***ã€http://level13.hacker101.comã€‘***URL)ï¼Œå¹¶å°†å‰©ä½™çš„å­—ç¬¦ä¸²å€¼é™„åŠ åˆ° **str2** å˜é‡ä¸­ï¼Œå¹¶åœ¨ **str** å˜é‡ä¸­æ·»åŠ ç¡¬ç¼–ç çš„ URL é“¾æ¥å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œåº”ç”¨ç¨‹åºæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«â€œ**ï¼Ÿ** *"* å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°å­—ç¬¦ä¸²çš„æœ«å°¾ã€‚****

****![](img/3fab96d014b492caf346a4c5f6415f7f.png)****

****æ ¹æ®æˆ‘ç›®å‰çš„é™æ€åˆ†æï¼Œæˆ‘è¿˜ä¸çŸ¥é“ **str2** çš„å€¼æ˜¯å¤šå°‘ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ **str** çš„æœ€ç»ˆå€¼æ˜¯ç”±**ç¡¬ç¼–ç çš„ URL é“¾æ¥**ã€ **str2 *ã€å€¼***(æ­¤æ—¶å®ƒåªæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²)å’Œ**â€œï¼Ÿâ€**åœ¨å­—ç¬¦ä¸²çš„æœ«å°¾ã€‚****

```
****http://34.74.105.127/398abac4c8/appRoot**'empty str2 value'**?****
```

****æœ€åä¸€ä¸ªä»£ç å—åŒ…æ‹¬ä½¿ç”¨ SHA-256 å“ˆå¸Œç®—æ³•åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯æ‘˜è¦ã€‚æ•£åˆ—è¢«æ›´æ–°ä¸¤æ¬¡ã€‚ç¬¬ä¸€ä¸ªæ˜¯ç”¨åä¸º**s 00 p 3s 3c 3r tk3 y***çš„é”®ï¼Œç¬¬äºŒä¸ªæ˜¯ç”¨**str2 å€¼** *ã€‚*WebView éšåå°†åŠ è½½ä¸€ä¸ªæ–°æ„å»ºçš„ URLï¼Œå…¶ä¸­åŒ…æ‹¬ **str** å€¼(å³ **URL** )ã€å­—ç¬¦ä¸²â€œ**&hashâ€**å’Œ **SHA-256 hash** å€¼ã€‚*****

****![](img/9f68a36b68a86d50e4ab50b225758dff.png)****

****åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ€ç»ˆæ„å»ºçš„ URL å¦‚ä¸‹æ‰€ç¤º:****

```
**http://34.94.3.143/398abac4c8/appRoot'**empty** **str2 value**'?&hash="**hash value**"**
```

****ä½¿ç”¨ä¸€ä¸ªåä¸º **BurpSuite** çš„å·¥å…·ï¼Œæˆ‘å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æ‹¦æˆªå®ƒå‘å‡ºçš„è¯·æ±‚ï¼Œå¹¶è§‚å¯Ÿç”± *MainActivity* æºä»£ç æ„å»ºçš„ URLã€‚****

****![](img/52d426c2b5be4d09e79bb09e582757a6.png)****

****æŸ¥çœ‹åº”ç”¨ç¨‹åºå‘å‡ºçš„ä¸»æœºå€¼å’Œ GET è¯·æ±‚ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ URLã€‚****

```
**http://35.227.24.107/3ef212b832/appRoot?&hash=61f4518d...etc**
```

> ****æ³¨æ„:ç”±äºæˆ‘ä¸‹è½½äº†æ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼ŒURL ä¸­çš„æ•°å€¼(å³ 3ef212b832)å·²å‘ç”Ÿå˜åŒ–ã€‚****

****åœ¨ URL ä¸­è¾“å…¥è¿™ä¸ªå€¼ä»ç„¶ä¼šæŠŠæˆ‘å¸¦åˆ°é»˜è®¤çš„ WebViewï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ªè·å–æ ‡å¿—çš„é“¾æ¥ã€‚æˆ‘çŸ¥é“è¿™ä¸ªé“¾æ¥ä»¥æŸç§æ–¹å¼ç”¨äºè·å–æ ‡å¿—ï¼Œé€šè¿‡æŸ¥çœ‹é“¾æ¥çš„é¡µé¢æºä»£ç ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°å®ƒä½¿ç”¨ **/flagBearer** ä½œä¸º URL åœ°å€çš„ä¸€éƒ¨åˆ†ã€‚è¯¥å€¼ä½äº**é€¼è¿‘**ä¹‹åï¼Œå¯èƒ½æ˜¯ç¼ºå¤±çš„ **str2** å€¼ã€‚****

****![](img/97b60b8dd2672f18b9730f0fc0125230.png)****

****å¦‚æœæˆ‘å°† **/flagBearer** æ·»åŠ åˆ°ç¼ºå°‘çš„ **str2** å€¼æ‰€åœ¨çš„ä½ç½®ï¼Œæˆ‘ä¼šå¾—åˆ°ä¸‹é¢çš„ URL è·¯å¾„ã€‚****

```
**http://35.227.24.107/3ef212b832/appRoot/flagBearer?&hash=61f4518d...etc**
```

****åœ¨æˆ‘çš„æµè§ˆå™¨ä¸­è¾“å…¥è¿™ä¸ª URL è·¯å¾„ä¼šå‡ºç°ä¸€ä¸ªæ–°çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸Šé¢å†™ç€â€œ**æ— æ•ˆå“ˆå¸Œ** *â€ã€‚*****

****![](img/8ef9c1fe7a187d7c2cc451fb0bbc5753.png)****

****è¿™æ„å‘³ç€ **/flagBearer** æ˜¯æœªçŸ¥çš„ **str2** å€¼ï¼Œå¯ä»¥é€šè¿‡åœ¨å…¶ä½ç½®é”®å…¥å…¶ä»–å€¼æ¥ç¡®è®¤ï¼Œè¿™å°†å¯¼è‡´ä¸€ä¸ªæœªæ‰¾åˆ°çš„é”™è¯¯ã€‚****

****![](img/4ac54f179e868a6ac5cbe73fce26eda1.png)****

****å°½ç®¡æœ‰äº†æ­£ç¡®çš„ URL è·¯å¾„ï¼Œæˆ‘ä»ç„¶çœ‹åˆ°ä¸€ä¸ªæ•£åˆ—é”™è¯¯ã€‚å¦‚å‰æ‰€è¿°ï¼Œåœ¨é™æ€åˆ†æ *MainActivity* æºä»£ç æ—¶ï¼Œä½¿ç”¨ **str2** å€¼(å³ */flagBearer* )å’Œé”®**s 00 p 3s 3c r tk3 y***æ¥ç»„æˆå®Œæ•´çš„ SHA-256 æ•£åˆ—ã€‚ç„¶è€Œï¼Œç”±äºæ„å›¾è¿‡æ»¤å™¨ä¸­æŒ‡å®šçš„æ•°æ® URL è·¯å¾„(å³*http://level13.hacker101.com*)ä¸åŒ…å«å­—ç¬¦ä¸² **/flagBearer** ï¼Œå¹¶ä¸”è¢« java **subString(28)** æ–¹æ³•å®Œå…¨å¿½ç•¥ï¼Œå› æ­¤ **str2** å€¼ä¸ºç©ºã€‚è¿™æ„å‘³ç€å“ˆå¸Œä¸æ­£ç¡®ï¼Œå› ä¸ºåœ¨ **str2** ä¸­æ²¡æœ‰å€¼(å³ */flagBearer* )ã€‚*****

****è¿™å°±æ˜¯**æ·±å±‚é“¾æ¥**å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚çœ‹äº†ä¸€ç¯‡åä¸ºã€Š*å®‰å“æ·±åº¦é“¾æ¥çš„ Zaheckï¼* " ( **å‚è§å‚è€ƒæ–‡çŒ®**)ï¼Œæˆ‘äº†è§£åˆ°ï¼Œå¦‚æœæ­£åœ¨è¿›è¡Œçš„**URL éªŒè¯**ä¸å……åˆ†ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥åŠ è½½è‡ªå·±çš„**ä»»æ„ URL** ã€‚æˆ‘çŸ¥é“æ²¡æœ‰å¯¹ç”¨äºè§¦å‘æ„å›¾è¿‡æ»¤å™¨å’Œå¯åŠ¨åº”ç”¨ç¨‹åºä¸»æ´»åŠ¨çš„ URL æ‰§è¡Œ URL éªŒè¯ã€‚è¿™æ„å‘³ç€æˆ‘å¯ä»¥æä¾›è‡ªå·±çš„ URLï¼Œå¹¶é™„ä¸Š **/flagBearer** è·¯å¾„ï¼Œè¿™å°†å¯åŠ¨ä¸»æ´»åŠ¨å¹¶å¯¼è‡´ **str2** å€¼ç­‰äº **/flagBearer** *ã€‚*æˆ‘å¯ä»¥é€šè¿‡ä½¿ç”¨ **ADB** æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå°±åƒä¹‹å‰åœ¨æµ‹è¯• URI æ„å›¾è¿‡æ»¤å™¨æ—¶çœ‹åˆ°çš„é‚£æ ·ã€‚****

```
**adb shell am start -W -a "android.intent.action.VIEW" -d "http://level13.hacker101.com/flagBearer" com.hacker101.level13**
```

****è¿™å¯¼è‡´è¯¥æ ‡å¿—è¢«å‘ˆç°ğŸ˜„ã€‚****

****![](img/a7b49fbd154ab88c7f2a238cc0b9678f.png)****

****å¦ä¸€ç§ä¸ä½¿ç”¨æ·±å±‚é“¾æ¥æ¥è§£å†³è¿™ä¸€æŒ‘æˆ˜çš„æ–¹æ³•æ˜¯ï¼Œé€šè¿‡ç»„åˆå¯†é’¥**s 00 p 3s 3c r tk3 y***å’Œ **/flagBearer** å­—ç¬¦ä¸²ï¼Œç®€å•åœ°**è‡ªå·±åˆ›å»ºæ•£åˆ—****ã€‚æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªåä¸º **CyberChef** çš„åœ¨çº¿å·¥å…·æ¥åˆ›å»º SHA-256 æ•£åˆ—ã€‚*******

*******![](img/f944d5718658cc01e3aad8e9ed77928c.png)*******

*******ç„¶åï¼Œæˆ‘å°†è¿™ä¸ªæ–°æ•£åˆ—æ·»åŠ åˆ°æˆ‘çš„ URL è·¯å¾„ä¸­ï¼Œç»™æˆ‘ä¸€ä¸ªæ ‡å¿—ã€‚*******

*******![](img/f4c44ddf4f1314e14c466444099722fb.png)*******

# *******Oauthbreaker(ä¸­ç­‰ï¼Œ2 ä¸ªæ ‡å¿—)*******

*******ä½¿ç”¨ ADB å’Œ MobSFï¼Œæˆ‘å†æ¬¡å®‰è£…äº†åº”ç”¨ç¨‹åºå¹¶ç”Ÿæˆäº†ä¸€ä¸ªé™æ€åˆ†ææŠ¥å‘Šã€‚æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œæˆ‘çœ‹åˆ°ä¸€ä¸ªæ´»åŠ¨ï¼Œä¸Šé¢æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå†™ç€ authenticateã€‚*******

*******![](img/d6fc5b82ad7b8b3d9e6e7946ef0d86aa.png)*******

*******ç‚¹å‡»æ­¤æŒ‰é’®ï¼Œæˆ‘çš„ä»¿çœŸå™¨ä¸Šçš„ WebView æµè§ˆå™¨æ‰“å¼€ï¼Œåœ¨ URL æ ä¸­æœ‰ä¸€ä¸ªåœ°å€å’Œä¸€ä¸ªæˆæƒæˆ‘çš„ç§»åŠ¨åº”ç”¨ç¨‹åºçš„é“¾æ¥ã€‚*******

*******![](img/6b414dc618b85598fc555f5255b31d4f.png)*******

*******URL æ ä¸­çš„å®Œæ•´åœ°å€å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°ã€‚*******

```
*****[http://34.74.105.127/81857ddddb/oauth?redirect_url=oauth%3A%2F%2Ffinal%2Flogin&response_type=token&scope=all](http://34.74.105.127/81857ddddb/oauth?redirect_url=oauth%3A%2F%2Ffinal%2Flogin&response_type=token&scope=all)*****
```

*******ç‚¹å‡»*æˆæƒç§»åŠ¨åº”ç”¨*é“¾æ¥ï¼Œæˆ‘ä¼šè¿›å…¥ä¸€ä¸ªæ–°çš„æ´»åŠ¨ï¼Œæ¶ˆæ¯æ˜¾ç¤ºæˆ‘å·²ç»é€šè¿‡ OAuth æˆåŠŸè®¤è¯äº†â€œ**â€!**â€ã€‚*******

******![](img/2bf1345ce125e158bb74382ea124f4ca.png)******

******åœ¨æ¢ç´¢åº”ç”¨ç¨‹åºçš„åŠŸèƒ½æ—¶ï¼Œæˆ‘å†³å®šåœ¨æˆ‘çš„æ¨¡æ‹Ÿå™¨ä¸Šæ‰“å¼€ WebView æµè§ˆå™¨ä¸­æ˜¾ç¤ºçš„ URLã€‚åœ¨æŸ¥çœ‹è¿™ä¸ªé¡µé¢çš„æºä»£ç æ—¶ï¼Œæˆ‘å‘ç°äº†**çš„ç¬¬ä¸€ä¸ªæ ‡å¿—**ã€‚******

******![](img/f01ddc7de4bec2d164dcfdc400b708d2.png)******

******æ£€æŸ¥ Android æ¸…å•æ–‡ä»¶æ˜¾ç¤ºï¼Œ**ä¸¤ä¸ªåä¸ºâ€œ*com . hacker 101 . oauth . browser*â€å’Œâ€œ*com . hacker 101 . oauth . main activity*â€çš„æ´»åŠ¨**æ˜¯ç”¨**æ„å›¾è¿‡æ»¤å™¨**å£°æ˜çš„ã€‚æ­£å¦‚å‰é¢çš„æŒ‘æˆ˜æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›æ„å›¾è¿‡æ»¤å™¨ç”¨äºåˆ›å»ºæ·±å±‚é“¾æ¥ã€‚******

******![](img/c6d1e497b69e54e20dbeeaf8ade4d506.png)******

******æŸ¥çœ‹å®Œæ¸…å•æ–‡ä»¶åï¼Œæˆ‘å¼€å§‹æŸ¥çœ‹ *MainActivity çš„æºä»£ç ã€‚*åˆ›å»ºä¸»æ´»åŠ¨æ—¶ï¼Œåä¸º **authRedirectUri** çš„å˜é‡ç­‰äºå€¼â€œ***oauth://final/***â€ã€‚è¿™æ˜¯ç”¨äºå°†ç”¨æˆ·å¸¦åˆ°*æµè§ˆå™¨*æ´»åŠ¨çš„æ·±å±‚é“¾æ¥ URLã€‚æ£€ç´¢å¹¶æ£€æŸ¥åŒ…å«åœ¨ç”¨äºå¯åŠ¨ä¸»æ´»åŠ¨çš„æ„å›¾ä¸­çš„æ•°æ®ï¼Œä»¥æŸ¥çœ‹å®ƒæ˜¯å¦æœ‰ä»»ä½•æ•°æ®æˆ–è€…æŸ¥è¯¢å‚æ•° ***redirect_uri*** æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœ intent å‚æ•° ***redirect_uri*** ä¸ä¸ºç©ºï¼Œåˆ™å°†è¯¥å‚æ•°çš„å€¼èµ‹ç»™ **authRedirectUri** ã€‚******

******![](img/75cabfa93a418f5f1d6a0c7d0a2be3d2.png)******

******å†å¾€ä¸‹ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘å•å‡»æŒ‰é’®" **Authenticate** *"ï¼Œ*æ—¶ï¼Œä¸€ä¸ª URL è¢«æ„å»ºï¼Œå…¶ä¸­åŒ…æ‹¬ URL ç¼–ç çš„ **authRedirectUri** å€¼ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„æ„å‘ï¼Œå¹¶å°† URL ä½œä¸ºæ•°æ®æ·»åŠ åˆ°è¯¥æ„å‘ä¸­ã€‚è¿™ä¸ªæ„å›¾ç„¶åè¢«ç”¨æ¥è§¦å‘**æµè§ˆå™¨æ´»åŠ¨**ã€‚******

******![](img/7f526bc2cd277fffa9a8f25550176da3.png)******

******ä»è¿™æ®µæºä»£ç ä¸­ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°æ— è®º ***redirect_uri*** å‚æ•°å€¼æ˜¯ä»€ä¹ˆï¼Œç”¨æˆ·éƒ½ä¼šè¢«**é‡å®šå‘**åˆ°ã€‚ä¸ºäº†æµ‹è¯•è¿™ä¸€ç‚¹ï¼Œæˆ‘å¯ä»¥ç»™***redirect _ uri***intent å‚æ•°èµ‹å€¼ï¼Œå¹¶è§‚å¯Ÿå®ƒæ˜¯å¦æˆåŠŸåœ°é‡å®šå‘äº†æˆ‘ã€‚******

```
****adb shell am start -W -a "android.intent.action.VIEW" -d "oauth://final/redirect_uri=https://ctftime.org/" com.hacker101.oauth****
```

******è¿™å¾ˆç®¡ç”¨ï¼Œæˆ‘æˆåŠŸåœ°è¢«é‡å®šå‘åˆ°äº†*ctftime.org*ç½‘ç«™ã€‚ç¬¬ä¸€ä¸ªæ ‡å¿—ä¹Ÿæ˜¾ç¤ºåœ¨ URL ä¸­ã€‚******

******![](img/5dba096c3ab6c4b75a4555b46095e8bc.png)******

******æˆ‘ä»ç„¶ä¸ç¡®å®šå¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œæ‰€ä»¥æˆ‘å†³å®šå¼€å§‹æŸ¥çœ‹**æµè§ˆå™¨æ´»åŠ¨**ã€‚æˆ‘çœ‹åˆ°åˆ›å»ºäº†ä¸€ä¸ªåä¸º *SSLTolerentWebViewClient* çš„ç§æœ‰ç±»ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œå£°æ˜äº†*shouldoverrideulroading()*æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸ä¸»æœºåº”ç”¨ç¨‹åºæœ‰æœºä¼šåœ¨ URL å°†è¦è¢«åŠ è½½åˆ°å½“å‰ WebView ä¸­æ—¶è¿›è¡Œæ§åˆ¶(**å‚è§å‚è€ƒæ–‡çŒ®**)ã€‚è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ WebView æµè§ˆå™¨åœ¨æˆ‘çš„æ¨¡æ‹Ÿå™¨ä¸Šæ‰“å¼€ã€‚æ–¹æ³• *SslErrorHandler()* ä¹Ÿè¢«å£°æ˜ï¼Œç”¨äºç®€å•åœ°å¿½ç•¥ SSL é”™è¯¯ã€‚******

******![](img/e3025a8c2f59c0b1a7d27622db883484.png)******

******åœ¨æºä»£ç ä¸­ç»§ç»­å¾€ä¸‹ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º **str** çš„å˜é‡è¢«å£°æ˜ä¸ºä¸€ä¸ª URL åœ°å€ã€‚è¿™ä¸ª URL åœ°å€å°±æ˜¯æˆ‘ä¹‹å‰çœ‹åˆ°çš„æˆåŠŸæ¶ˆæ¯ï¼Œå®ƒå‘Šè¯‰æˆ‘æˆ‘é€šè¿‡äº†èº«ä»½éªŒè¯ã€‚æ£€æŸ¥ç”¨äºå¯åŠ¨æ´»åŠ¨çš„æ¥è‡ª intent çš„æ•°æ®å’Œåä¸º **uri** çš„ intent å‚æ•°ï¼Œçœ‹å®ƒæ˜¯å¦ä¸ºç©ºã€‚ç„¶åï¼Œä½¿ **str** å€¼ç­‰äºåŒ…å«åœ¨ **uri** intent å‚æ•°ä¸­çš„æ•°æ®ã€‚******

******![](img/a3fa3fa740bf84f6377ea995e854d6b0.png)******

******åœ¨è¿™ä¸‹é¢ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ WebViewã€‚åˆ›å»º WebView æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸¤æ¡é‡è¦çš„ä¿¡æ¯ã€‚é¦–å…ˆæ˜¯ WebView å·²ç»ä½¿ç”¨ *setJavascriptEnabled()* å¯ç”¨äº† **JavaScript æ‰§è¡Œ**ã€‚ç¬¬äºŒä¸ªæ˜¯å£°æ˜äº†æ–¹æ³•*addJavascriptInterface()*ã€‚è¿™å°†æä¾›çš„ Java å¯¹è±¡æ³¨å…¥åˆ° WebView ä¸­ï¼Œå¹¶ä¸”**å…è®¸ä» JavaScript** è®¿é—® Java å¯¹è±¡çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°:******

1.  ******è¦ç»‘å®šåˆ° JavaScript çš„ç±»å®ä¾‹(å³ *WebAppInterface* )******
2.  ******ç”¨äºåœ¨ JavaScript ä¸­å…¬å¼€å®ä¾‹çš„åç§°(å³ *iface* )ã€‚******

******![](img/3ead02a0f167cfa77c1f7cabbe8bb2b6.png)******

******è¿™å…è®¸æˆ‘æ§åˆ¶ **WebAppInterface** ç±»ä¸­çš„ä»»ä½•æ–¹æ³•ã€‚çœ‹è¿™ä¸ªç±»ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªæœ‰è¶£çš„æ–¹æ³•å«åš **getFlagPath()** ã€‚è¿™ä¸ªæ–¹æ³•åŒ…å«äº†ä¸€ä¸ªå¤§çš„ int å€¼æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚******

******![](img/7730f5d02cb0678e7564d78ac22b7533.png)******

******ä¸‹é¢çš„ä»£ç ä¼¼ä¹æ‰§è¡Œäº†å„ç§æ“ä½œï¼Œè¿™äº›æ“ä½œä¼šå¯¼è‡´åˆ›å»ºä¸€ä¸ª html æ–‡ä»¶çš„è·¯å¾„ã€‚******

******![](img/93f0a838d8f25ef1ef86696c300e884b.png)************![](img/fee6701372cf62bf82dea86ded21d396.png)******

******ä¸ºäº†è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ **Github Pages** åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘é¡µã€‚ç„¶åï¼Œæˆ‘å¯ä»¥å°†ä¸‹é¢çš„ JavaScript æ·»åŠ åˆ°ç½‘é¡µä¸­ï¼Œå®ƒå°†ä½¿ç”¨æš´éœ²ç±»å®ä¾‹çš„" **iface** "åç§°è°ƒç”¨ **getFlagPath()** æ–¹æ³•ã€‚******

******![](img/e054f175cce284c5ef3ea02054c44132.png)******

******æ¥ä¸‹æ¥ï¼Œæˆ‘å¯ä»¥é‡å®šå‘åˆ°æˆ‘çš„ Github Pages ç½‘ç«™ï¼Œå¦‚å‰æ‰€è¿°ï¼Œæ–¹æ³•æ˜¯åœ¨è°ƒç”¨**æµè§ˆå™¨æ´»åŠ¨**æ—¶ï¼Œä¸º **uri** å‚æ•°åˆ†é…ç«™ç‚¹ URL åœ°å€ä½œä¸ºå…¶å€¼ã€‚******

```
****adb shell am start -W -a "android.intent.action.VIEW" -d "oauth://final/uri=https://**github.website.url"** com.hacker101.oauth****
```

******è¿™å°†äº§ç”Ÿä¸€ä¸ª HTML é¡µé¢çš„è·¯å¾„ã€‚******

******![](img/2e8416a9715974a6aae5255eb987857c.png)******

******æˆ‘å¯ä»¥ç®€å•åœ°å°† HTML æ–‡ä»¶çš„è·¯å¾„æ·»åŠ åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„åœ°å€çš„æœ«å°¾ã€‚******

```
****http://34.94.3.143/cb1f155695/**path-to-flag.html******
```

******è¿™ç»™äº†æˆ‘ç¬¬äºŒé¢æ——å¸œğŸ˜ƒã€‚******

******![](img/eb458587762e0ee4bf67335f93502a78.png)******

# ******ç§»åŠ¨ç½‘ç«™å¼€å‘(ä¸­ç­‰ï¼ŒåŒæ ‡å¿—)******

******å†æ¬¡ä½¿ç”¨ ADB å’Œ MobSFï¼Œæˆ‘å®‰è£…äº†åº”ç”¨ç¨‹åºå¹¶ç”Ÿæˆäº†ä¸€ä¸ªé™æ€åˆ†ææŠ¥å‘Šã€‚æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œæˆ‘çœ‹åˆ°ä¸€ä¸ªå…è®¸æˆ‘åˆ·æ–°é¡µé¢å’Œç¼–è¾‘é¡µé¢å†…å®¹çš„æ´»åŠ¨ã€‚******

******![](img/b9a75520ed3a513f2b219cac682faaff.png)******

******å•å‡»â€œç¼–è¾‘â€æŒ‰é’®ä¼šæ˜¾ç¤ºä¸€ä¸ªæ–°é¡µé¢ï¼Œå…¶ä¸­æ˜¾ç¤ºäº†æˆ‘å¯ä»¥ç¼–è¾‘çš„æ–‡ä»¶ã€‚******

******![](img/22e3992dcc7acc107dce0ed3c7d40132.png)******

******ç‚¹å‡»æ–‡ä»¶å¯ä»¥è®©æˆ‘ç¼–è¾‘å®ƒã€‚******

******![](img/dff3de5938178556e0be899a0a4fbc9b.png)******

******å¦‚æœæˆ‘å•å‡»ä¿å­˜å¹¶è¿”å›è§†å›¾ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°æˆ‘çš„ç¼–è¾‘å·²è¢«åº”ç”¨ã€‚******

******![](img/2dfbee526bf8c6807e1c4666d7ed7e03.png)******

******åœ¨æŸ¥çœ‹äº†åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ä¹‹åï¼Œæˆ‘ç»§ç»­æ£€æŸ¥åº”ç”¨ç¨‹åºçš„ Android æ¸…å•æ–‡ä»¶ã€‚åªæœ‰**ä¸€ä¸ªåä¸º*ä¸»æ´»åŠ¨*çš„æ´»åŠ¨**è¢«å£°æ˜ã€‚******

******![](img/6a5c20452af4001fb2db647b1818e394.png)******

******æˆ‘å†³å®šçœ‹çœ‹ *MainActivity çš„æºä»£ç ã€‚*é˜…è¯»æºä»£ç æ—¶ï¼Œæˆ‘é¦–å…ˆæ³¨æ„åˆ°ä¸€ä¸ªåä¸º **HmacKey** çš„å˜é‡ï¼Œå®ƒæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œä¼¼ä¹æ˜¯ä¸€ä¸ªç§é’¥ã€‚******

******![](img/2575567d74c2fa232dc848bfdd965385.png)******

******å†å¾€ä¸‹ï¼Œæˆ‘çœ‹åˆ°ä¸€ä¸ªåä¸º *Hmac()* çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿˜æ²¡æœ‰å®ç°ï¼Œæ­£å¦‚å¼‚å¸¸æ¶ˆæ¯æ‰€æš—ç¤ºçš„ã€‚******

******![](img/dd8f6cca2d44f47e61c7b9a4a34e0d86.png)******

******åœ¨æ­¤ä¹‹ä¸‹ï¼Œæˆ‘æ‰¾åˆ°äº†æºä»£ç çš„å…¶ä½™éƒ¨åˆ†ï¼Œå¦‚å‰æ‰€è¿°ï¼Œå®ƒä»¬ä¿ƒè¿›äº†åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚æˆ‘å¯ä»¥çœ‹åˆ°ç”¨äºæŸ¥çœ‹å’Œç¼–è¾‘å†…å®¹çš„ä¸åŒ URLã€‚æˆ‘è¿˜çœ‹åˆ°æ˜¾ç¤ºå†…å®¹çš„ WebView å¯ç”¨äº† JavaScriptã€‚******

******![](img/c2bc01da69843173df21668b1ed6cbb7.png)******

******èµ·åˆï¼Œæˆ‘çœŸçš„ä¸ç¡®å®šå¦‚ä½•ä½¿ç”¨ HMAC é”®ï¼Œæ‰€ä»¥æˆ‘æœ€ç»ˆå°è¯•äº†ä¸€äº›ä¸åŒçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘æœ€åˆçš„ç›´è§‰æ˜¯çœ‹çœ‹æˆ‘æ˜¯å¦å¯ä»¥æ‰§è¡Œ XSS æ”»å‡»ï¼Œå› ä¸ºæˆ‘å¯ä»¥ç¼–è¾‘é¡µé¢çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨ WebView ä¸­å¯ç”¨äº† JavaScript æ‰§è¡Œã€‚æˆ‘è®¤ä¸ºå¦‚æœæˆ‘èƒ½æ‰§è¡Œä¸€äº› JavaScriptï¼Œä¸€ä¸ªæ ‡å¿—å¯èƒ½ä¼šè‡ªå·±å‡ºç°ã€‚æˆ‘ç»™ index.html é¡µé¢æ·»åŠ äº†ä¸€äº› JavaScriptï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚******

******![](img/a821d0bc3bcefc5afb274c5cb3be07eb.png)******

******ä¿å­˜æ–‡ä»¶å¹¶åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å†…å®¹é¡µé¢åï¼Œæˆ‘å¯ä»¥çœ‹åˆ° XSS æ”»å‡»èµ·ä½œç”¨äº†ï¼Œä½†æ²¡æœ‰æ˜¾ç¤ºä»»ä½•æ ‡å¿—ã€‚******

******![](img/e55aaf756c110cb4f1f8199a16cac17f.png)******

******åœ¨å››å¤„å¯»æ‰¾ä¹‹åï¼Œæˆ‘ç»ˆäºåœ¨ edit.php çš„é¡µé¢ä¸Šæ‰¾åˆ°äº†çº¿ç´¢ã€‚å¼€å‘è€…ç•™ä¸‹çš„è¯„è®ºæåˆ°äº†ä¸€ä¸ªåä¸º*upload.php*çš„é¡µé¢ã€‚******

******![](img/d9c72b470bad494a4e84885a820ead2c.png)******

******é¡¾åæ€ä¹‰ï¼Œå½“æˆ‘è®¿é—®è¿™ä¸ªé¡µé¢æ—¶ï¼Œæˆ‘å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ã€‚******

******![](img/5f5364fea490b756e22eead7d3c2a921.png)******

******æŸ¥çœ‹é¡µé¢æºä»£ç ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ä¸Šä¼ è¡¨å•æ¥å— zip æ–‡ä»¶ã€‚******

******![](img/97eb3769f4328b1b47fe44a9959fa6b7.png)******

******ç„¶è€Œï¼Œå½“æˆ‘è¯•å›¾ä¸Šä¼ ä¸€ä¸ª zip æ–‡ä»¶æ—¶ï¼Œå‡ºç°äº†ä»¥ä¸‹é”™è¯¯ã€‚******

******![](img/d78148a1e7aad9957f2488b77fc8983b.png)******

******ä¸Šä¼  zip æ–‡ä»¶æ—¶ï¼Œæˆ‘ä¼¼ä¹éœ€è¦æä¾› HMAC ç­¾åã€‚******

> ******æ³¨æ„: **HMAC ç®—æ³•**å¯ç”¨äºéªŒè¯åœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’æˆ–å­˜å‚¨åœ¨æ½œåœ¨æ˜“å—æ”»å‡»ä½ç½®çš„ä¿¡æ¯çš„**å®Œæ•´æ€§**ã€‚åŸºæœ¬æ€æƒ³æ˜¯**ç”Ÿæˆå®é™…**æ•°æ®**ä¸å…±äº«**ç§˜å¯†å¯†é’¥**çš„åŠ å¯†æ•£åˆ—**ã€‚**äº§ç”Ÿçš„æ•£åˆ—**ç„¶åå¯ç”¨äºæ£€æŸ¥ä¼ è¾“æˆ–å­˜å‚¨çš„æ¶ˆæ¯ä»¥ç¡®å®šä¿¡ä»»çº§åˆ«ï¼Œè€Œæ— éœ€ä¼ è¾“å¯†é’¥ã€‚******

****ç°åœ¨æˆ‘çŸ¥é“äº† HMAC ç§é’¥çš„ç”¨é€”ï¼Œæˆ‘å¯ä»¥ç»§ç»­åˆ›å»º HMAC ç­¾åäº†ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„åœ¨çº¿ python è„šæœ¬(**å‚è§å‚è€ƒæ–‡çŒ®**)æ¥è®¡ç®— HMAC ç­¾åã€‚****

****![](img/ef63c50ee0ab2945109c56b26e3d80a1.png)****

****æ‰§è¡Œè¿™ä¸ªè„šæœ¬ä¼šç”Ÿæˆæˆ‘çš„ **HMAC ç­¾å**ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚****

****![](img/c1771375b11508f06dff4151550e5257.png)****

****ä½¿ç”¨ Burpsuiteï¼Œæˆ‘å¯ä»¥å†æ¬¡ä¸Šä¼ æˆ‘çš„ zip æ–‡ä»¶ï¼Œè¿™æ¬¡å°†æˆ‘çš„ HMAC ç­¾åæ·»åŠ åˆ° POST è¯·æ±‚ä¸­ï¼Œä½œä¸ºè¯·æ±‚æ­£æ–‡çš„å¦ä¸€éƒ¨åˆ†ã€‚****

****![](img/d42d721d4bffb3fc1e02da50507fba24.png)****

****è¿™æ˜¯æˆåŠŸçš„ï¼Œå¹¶å¯¼è‡´ç¬¬ä¸€ä¸ªæ ‡å¿—**è¢«æ˜¾ç¤ºã€‚******

****![](img/f6bfb16f267f6945489717c6ad8e3d9a.png)****

****æˆåŠŸä¸Šä¼  zip æ–‡ä»¶åï¼Œä¼šæ˜¾ç¤ºä¸€æ¡ä¿¡æ¯ï¼Œè¯´æ˜ zip æ–‡ä»¶å·²ç»è§£å‹åˆ°ä¸€ä¸ªåä¸º/ *temp* çš„æ–‡ä»¶å¤¹ä¸­ï¼Œä½†éœ€è¦**å¤åˆ¶**åˆ° */content* æ–‡ä»¶å¤¹ä¸­ã€‚****

****![](img/9cc3b9569ad8cda425f4da72bf9a903b.png)****

****åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€äº› zip æ–‡ä»¶ä¸Šä¼ ç›®å½•éå†æ¼æ´åï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªå«åš **Zip Slip æ¼æ´**çš„æ¼æ´ã€‚****

> ****æ³¨æ„:Zip Slip æ¼æ´å…è®¸æ”»å‡»è€…åˆ›å»º Zip å­˜æ¡£ï¼Œä½¿ç”¨**è·¯å¾„éå†**æ¥è¦†ç›–å—å½±å“ç³»ç»Ÿä¸Šçš„é‡è¦æ–‡ä»¶ï¼Œæˆ–è€…ç ´åå®ƒä»¬ï¼Œæˆ–è€…ç”¨æ¶æ„æ›¿ä»£æ–‡ä»¶æ›¿æ¢å®ƒä»¬ã€‚****

****ä¸ºäº†æµ‹è¯•è¿™ä¸ªæ¼æ´æ˜¯å¦å­˜åœ¨ï¼Œæˆ‘ä½¿ç”¨äº† Github ä¸Šçš„ **Snyk** æä¾›çš„ zip slip æ–‡ä»¶(**å‚è§å‚è€ƒæ–‡çŒ®**)ã€‚æˆ‘ç”¨æˆ‘çš„ python è„šæœ¬å†æ¬¡åˆ›å»ºäº†ä¸€ä¸ª HMAC ç­¾åï¼Œä½†è¿™æ¬¡æ˜¯ç”¨ *zip-slip.zip* æ–‡ä»¶ã€‚ç„¶åï¼Œæˆ‘ä½¿ç”¨ BurpSuite æ‹¦æˆª POST è¯·æ±‚ï¼Œå¹¶åƒå‰é¢çœ‹åˆ°çš„é‚£æ ·æ·»åŠ  HMAC ç­¾åã€‚æˆåŠŸä¸Šä¼  zip æ–‡ä»¶åï¼Œæˆ‘æ”¶åˆ°äº†**ç¬¬äºŒä¸ªæ ‡å¿—**ï¼****

****![](img/865f7ac256ac4bca1103252b531ec829.png)****

# ****ç»“æŸè¯­****

****æˆ‘çœŸçš„å¾ˆå–œæ¬¢è§£å†³è¿™äº›æŒ‘æˆ˜ï¼Œå¹¶å‘ç°å®ƒä»¬å¯¹äºæ•™æˆå¦‚ä½•åˆ©ç”¨ Android åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´éå¸¸æœ‰ç”¨ã€‚æˆ‘å¸Œæœ› HackerOne å°†æ¥ä¼šç»§ç»­å‘å¸ƒæ›´å¤šåŸºäº Android çš„ CTF æŒ‘æˆ˜èµ›ï¼Œæ„Ÿè°¢æ‚¨é˜…è¯»åˆ°æœ€åğŸ˜„ï¼****

# ****å‚è€ƒ****

*   ****[https://developer . Android . com/training/app-links/æ·±å±‚é“¾æ¥](https://developer.android.com/training/app-links/deep-linking)****
*   ****[https://medium . com/bugbountywriteup/the-za heck-of-Android-deep-links-a5f 57 DC 4 AE 4c](https://medium.com/bugbountywriteup/the-zaheck-of-android-deep-links-a5f57dc4ae4c)****
*   ****[https://developer . Android . com/reference/Android/WebKit/webview client # shouldoverrideulroading(Android . WebKit . webviewï¼Œ% 20 Android . WebKit . webresourcerequest)](https://developer.android.com/reference/android/webkit/WebViewClient#shouldOverrideUrlLoading(android.webkit.WebView,%20android.webkit.WebResourceRequest))****
*   ****[https://developer . Android . com/reference/Android/WebKit/SslErrorHandler # proceed()](https://developer.android.com/reference/android/webkit/SslErrorHandler#proceed())****
*   ****[https://developer . Android . com/reference/Android/WebKit/web settings # set JavaScript enabled(boolean)](https://developer.android.com/reference/android/webkit/WebSettings#setJavaScriptEnabled(boolean))****
*   ****[https://www . code project . com/Articles/392603/Android-addJavaScriptInterface](https://www.codeproject.com/Articles/392603/Android-addJavaScriptInterface)****
*   ****[https://pymotw.com/2/hmac/](https://pymotw.com/2/hmac/)****
*   ****[https://stack overflow . com/questions/8659808/how-do-http-file-upload-work](https://stackoverflow.com/questions/8659808/how-does-http-file-upload-work)****
*   ****[https://github . com/snyk/zip-slip-vulnerability/blob/master/archives/zip-slip . zip](https://github.com/snyk/zip-slip-vulnerability/blob/master/archives/zip-slip.zip)****