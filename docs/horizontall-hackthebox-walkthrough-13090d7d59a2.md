# horizontal:HackTheBox æ¼”ç»ƒ

> åŸæ–‡ï¼š<https://infosecwriteups.com/horizontall-hackthebox-walkthrough-13090d7d59a2?source=collection_archive---------0----------------------->

## æè¿°

Horizontall æ˜¯ HackTheBox ä¸Šå¦ä¸€ä¸ªä¸é”™çš„ç›’å­ã€‚åªéœ€åœ¨/etc/hosts æ–‡ä»¶ä¸­æ·»åŠ  horizontall.htbï¼Œå°±å¯ä»¥å¼€å§‹äº†ã€‚

![](img/e62f571b9df1c8dad5c2218945b62957.png)

> ç«¯å£æ‰«æ

åœ¨æˆ‘çš„ç«¯å£æ‰«æè¿‡ç¨‹ä¸­ï¼Œæˆ‘é¦–å…ˆä½¿ç”¨ [**rustscan**](https://tryhackme.com/room/rustscan) å¿«é€Ÿæ‰¾å‡ºå¼€æ”¾ç«¯å£çš„æ•°é‡â€¦

![](img/04c9b9a1fa2e0373646b7601f8ccb6d5.png)

â€¦ç„¶ååœ¨é‚£äº›å¼€æ”¾çš„ç«¯å£ä¸Šå¼€å§‹è¯¦ç»†çš„ **Nmap** æ‰«æã€‚

![](img/f8b280c820ae341ae4def20dd0d428a0.png)

> ç½‘ç»œä¾¦å¯Ÿ

æ‰€ä»¥æˆ‘ä»¬å…ˆåˆ—ä¸¾ä¸€ä¸‹ 80 ç«¯å£ã€‚ç´¢å¼•é¡µå¦‚ä¸‹æ‰€ç¤ºã€‚é¡µé¢æºä»£ç ä¸åŒ…å«ä»»ä½•æœ‰ç”¨çš„å†…å®¹ã€‚

![](img/5fb4f115cb55f0562ed93eeaae3e56b3.png)

è®©æˆ‘ä»¬å¼€å§‹å¯¹ URLâ†’[http://horizontall.htb/](http://writer.htb/)è¿›è¡Œ **ffuf** æ‰«æ

![](img/1d7440675d634a0faf4da10ca7cd7818.png)

ä»¥ä¸Šéƒ½æ²¡æœ‰ç”¨ã€‚æˆ‘å°è¯•çš„ä¸‹ä¸€ä»¶äº‹æ˜¯ä½¿ç”¨ wfuzz å·¥å…·æšä¸¾å­åŸŸã€‚

![](img/09cccbce27e412048ffbc33f02d14ab1.png)

æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå­åŸŸï¼Œè®©æˆ‘ä»¬è®¿é—®å®ƒï¼Œçœ‹çœ‹æˆ‘ä»¬èƒ½å¾—åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ä¸œè¥¿ã€‚

![](img/b51a72dcdb0c7413b75aaf88826e7861.png)

æ‰€ä»¥è¿™é‡Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ï¼Œä½†æˆ‘å†æ¬¡è¯•å›¾åˆ—ä¸¾ä»»ä½•éšè—ç›®å½•çš„ FQDNã€‚

![](img/46c1e935e6ad6ef5423d30471f90b1c5.png)

ç°åœ¨æˆ‘ä»¬åˆ°äº†ç›®å½•ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª strapi CMS çš„ç™»å½•é¡µé¢ã€‚

![](img/8865afac6bd7e095a1b0168e2d5cdb82.png)

è°·æ­Œæœç´¢ strapi ç™»å½•çš„é»˜è®¤å‡­è¯æ˜¾ç¤º admin: adminï¼Œä½†åœ¨è¿™é‡Œæ²¡æœ‰ç”¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘è¯•å›¾æœç´¢è¯¥ CMS å¯ç”¨çš„ä»»ä½•å…¬å¼€æ¼æ´ï¼Œæˆ‘å¾—åˆ°äº†è¿™ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œ [**æ¼æ´**](https://www.exploit-db.com/exploits/50239) ä½†ä¸ç¡®å®šï¼Œå› ä¸ºæˆ‘è¿˜ä¸çŸ¥é“ç‰ˆæœ¬ã€‚

è¯¥æ¼æ´å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ç½‘å€(å­åŸŸä¸€)ï¼Œè„šæœ¬ä¼šå‘Šè¯‰ä½¿ç”¨ CMS ç‰ˆæœ¬ç¬¬ä¸€ï¼Œå¦‚æœè¯¥ç‰ˆæœ¬æ˜¯ç­‰åŒäºâ€œ3 . 0 . 0-æµ‹è¯•ç‰ˆ 17.4â€ï¼Œç„¶ååˆ©ç”¨å°†å·¥ä½œã€‚åœ¨ä¸‹ä¸€ä¸ª password_reset()å‡½æ•°ä¸­ï¼Œæ¼æ´è¯•å›¾é‡ç½®ç”¨æˆ·â€œadminâ€çš„å¯†ç ï¼Œå¹¶ä¸ºæˆ‘ä»¬æä¾›å¸¦æœ‰æ–°å‡­è¯çš„ JSON Web ä»¤ç‰Œã€‚

å› æ­¤ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬æœ‰ä¸€ä¸ª JSON web ä»¤ç‰Œï¼Œç”¨äºåœ¨åŒæ–¹ä¹‹é—´å…±äº«å®‰å…¨ä¿¡æ¯ï¼Œå¹¶åœ¨ä¿æŠ¤ API æ–¹é¢å˜å¾—è¶Šæ¥è¶Šæµè¡Œã€‚ [**JWT**](https://www.akana.com/blog/what-is-jwt) æœ‰ç±»ä¼¼ x.y.z çš„æ ¼å¼ï¼Œå›æ¥åˆ©ç”¨æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®è¿™ä¸ª URLâ†’[http://[å­åŸŸ]. horizontal . htb/[å‘ç°è·¯å¾„]/auth/reset-password](http://api-prod.horizontall.htb/admin/auth/reset-password) æ¥ç¡®è®¤è¿™ä¸ªå¯†ç å‰©ä½™è·¯å¾„

![](img/a87418dd7bff3e11ddf5afdd9583b8e5.png)

æœ€åä¸€ä¸ªå‡½æ•° code_exec(cmd)ç”¨äºè§¦å‘ RCEï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å¾—åˆ°å·²ç»æåˆ°çš„äº¤äº’å¼ shellã€‚æ ·æœ¬è¾“å‡ºã€‚

![](img/a7dbd725f3dd775ae58d05a1564c5586.png)

åœ¨å½“å‰çš„æ¼æ´åˆ©ç”¨ä¸­ï¼Œæåˆ°äº†ä¸¤ä¸ª CVEï¼Œå› æ­¤ç¬¬ä¸€ä¸ª [CVE-2019-18818](https://www.cybersecurity-help.cz/vulnerabilities/22788/) åŸºäºæˆ‘ä»¬å·²ç»åšè¿‡çš„å¼±å¯†ç æ¢å¤ï¼Œå¯¹äºä¸‹ä¸€ä¸ª[CVE-2019â€“1609](https://www.cybersecurity-help.cz/vdb/SB2019120606)RCEï¼Œæˆ‘ä»¬å¿…é¡»æ‰¾åˆ°æ¼æ´åˆ©ç”¨ä»£ç ã€‚å†æ¬¡è°·æ­Œæˆ‘èƒ½å¤Ÿæ‰¾åˆ° [**æ¼æ´**](https://github.com/dasithsv/CVE-2019-19609/blob/main/exploit.py) ã€‚

> è·å¾—åˆå§‹è®¿é—®æƒé™

ç°åœ¨ï¼Œå¯¹äºè¿™ä¸ªæ¼æ´ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‰ç…§<subdomain.horizontall.htb>ã€<kali_ip>ã€<jwt earlier="">ã€<[http://subdomain.horizontall.htb/](http://api-prod.horizontall.htb/)>çš„é¡ºåºä¼ é€’è¾“å…¥ï¼Œæ¼æ´è®¾ç½®ä¸€ä¸ªâ€œæ•°æ®â€å˜é‡ï¼Œåœ¨ç«¯å£â€œ9001â€ä¸Šé™„åŠ åå‘å¤–å£³ï¼Œå¹¶åœ¨å¤´éƒ¨åˆ†å‘å¸ƒå¸¦æœ‰ jwt ä»¤ç‰Œçš„æ•°æ®ã€‚</jwt></kali_ip></subdomain.horizontall.htb>

ç°åœ¨ï¼Œåœ¨è¿è¡Œæ¼æ´ä¹‹å‰ï¼Œåªéœ€åœ¨æ–°ç»ˆç«¯çš„ç«¯å£ 9001 ä¸Šå¯åŠ¨ä¸€ä¸ª nc ç›‘å¬å™¨ã€‚

![](img/3870716d9349359bf56f82405b6f7775.png)

å› æ­¤ï¼Œæˆ‘ä»¬ä»¥ç”¨æˆ· strapi èº«ä»½è¿›è¡Œè¿œç¨‹è®¿é—®ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ª"**python 3-c ' import ptyï¼›pty.spawn("/bin/bash")'** "ã€‚

ä½¿ç”¨è¿™ä¸ª"**find/-type f-user strapi-perm 600 2>/dev/null**å‘½ä»¤æ¥æŸ¥æ‰¾ä»»ä½•å…·æœ‰è¯»å†™æƒé™çš„æ–‡ä»¶ï¼Œæˆ‘å¾—åˆ°äº†è·¯å¾„" **/opt/strapi/ã€‚ssh/authorized_keys** â€ã€‚å› ä¸ºæˆ‘ä»¬æœ‰å†™è®¿é—®æƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ SSH é™„åŠ æˆ‘ä»¬è‡ªå·±çš„ id_rsa å¯†é’¥æ¥è·å¾—è®¿é—®æƒã€‚

ä½¿ç”¨ ssh-keygen åˆ›å»º id_rsa å¯†é’¥ï¼Œå¹¶å°† id_rsa.pub å¯†é’¥å¤åˆ¶åˆ°æ–‡ä»¶ **/opt/strapi/ã€‚ssh/authorized _ keyã€‚**å°†æ–‡ä»¶ id_rsa çš„æƒé™æˆäºˆ chmod 600 id_rsaã€‚ç°åœ¨é€šè¿‡ SSH ç™»å½•å¾—åˆ°ä¸€ä¸ªå¥½çœ‹çš„ shellã€‚

![](img/9fa75c8b2c37eb8212205d7c9521f52d.png)

æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[**linPEAS**](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS)**è„šæœ¬ï¼Œä½†æ˜¯ä½¿ç”¨è¯¸å¦‚â€˜netstatâ€™ï¼Œâ€˜PSâ€™ï¼Œâ€˜tcpdumpâ€™ä¹‹ç±»çš„å‘½ä»¤è¿›è¡Œæ£€æŸ¥æ€»æ˜¯æœ‰ç”¨çš„ã€‚æ‰€ä»¥ä½¿ç”¨ netstat ç»™äº†æˆ‘**

**![](img/b165e64451d3ee6be58674addc880e60.png)**

**æˆ‘è¯•å›¾æ‰¾åˆ° MySQL çš„å‡­è¯ï¼Œä½†æ²¡æœ‰å¾—åˆ°ä»»ä½•å‡­è¯ã€‚å…¶æ¬¡ï¼Œæˆ‘ä½¿ç”¨ [**å‡¿å­**](https://github.com/andrew-d/static-binaries) å·¥å…·è½¬å‘ç«¯å£ 8000ã€‚ä¸ºäº†è®©å‡¿å­è¿›å…¥è¿œç¨‹æœºå™¨ï¼Œæˆ‘ä½¿ç”¨äº† [**æ›´æ–°**](https://github.com/sc0tfree/updog) å·¥å…·ã€‚**

**![](img/b469aa5fd848a117cc03cc4f63677447.png)**

**ç°åœ¨ï¼Œè¦è½¬å‘æ‰€éœ€çš„ç«¯å£ï¼Œé¦–å…ˆå¿…é¡»è¿è¡Œ"**ã€‚/chisel server-p[ç«¯å£å·] â€”åœ¨ kali æœºå™¨ä¸Šåè½¬&** â€**

**![](img/6b967cb7713b89f88434d241250fbe8a.png)**

**â€¦ç„¶åè¿è¡Œ"**ã€‚/chisel client[kali _ IP]:[kali _ port]R:[port _ to _ listen _ connection]:127 . 0 . 0 . 1:[port _ to _ forward]**"åœ¨æ”»å‡»è€…æ¡†ä¸Šã€‚**

**![](img/74a251511d9d13a7475bc09e47988609.png)**

**è®¿é—®ç½‘å€â†’ [http://127.0.0.1:6001](http://127.0.0.1:6001) åœ¨æµè§ˆå™¨ä¸Šè®¿é—®è½¬å‘ç«¯å£ 8000ã€‚**

**![](img/fa43db5ddbe301f86c882705e209212d.png)**

**æˆ‘åœ¨è¿™é‡Œæ²¡ä»€ä¹ˆå¯åšçš„ï¼Œæ‰€ä»¥æˆ‘åªæ˜¯è°·æ­Œâ€œå¦‚ä½•åœ¨ç«¯å£è½¬å‘ååˆ©ç”¨ Laravel â€,å¾—åˆ°äº†è¿™ä¸ª[é¡µé¢](https://book.hacktricks.xyz/pentesting/pentesting-web/laravel)è¯´[CVE-2021â€“3129ã€‚](https://github.com/hungnt199/CVE-2021-3129_exploit)å› æ­¤ï¼ŒLaravel å®¹æ˜“å—åˆ°ä¸æ­£ç¡®è¾“å…¥éªŒè¯çš„æ”»å‡»ï¼Œè¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ç‰¹åˆ¶çš„è¯·æ±‚æ¥è¯»å–å’Œå†™å…¥ç³»ç»Ÿä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚å¤åˆ¶æ¼æ´ä»£ç ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚**æ³¨æ„:-** ä½¿ç”¨ URL ä¸­è½¬å‘ç«¯å£ 8000 çš„ç«¯å£ã€‚**

**![](img/a054b190bd8001672afcd9e4907cd97d.png)**

**è·å–æ ¹æ ‡å¿—å¾ˆå®¹æ˜“ï¼Œå› ä¸ºæ‚¨å¿…é¡»ä½¿ç”¨ cat å‘½ä»¤ä»£æ›¿ whoami æ¥è¯»å–æ ‡å¿—ã€‚**

# **åœ¨ä½ èµ°ä¹‹å‰**

**è¿™æ˜¯æˆ‘çš„å¦ä¸€ä¸ªé»‘å®¢æœºå™¨æ¼”ç»ƒ:-**

**[](https://shubham-singh.medium.com/writer-hackthebox-walkthrough-1ff86b33799a) [## ç¼–å‰§:é»‘å®¢ç›’å­æ¼”ç»ƒ

### æè¿°

shubham-singh.medium.com](https://shubham-singh.medium.com/writer-hackthebox-walkthrough-1ff86b33799a) [](https://shubham-singh.medium.com/armageddon-hackthebox-walkthrough-6d8e2261a676) [## ä¸–ç•Œæœ«æ—¥:é»‘å®¢ç›’å­æ¼”ç»ƒ

### æè¿°

shubham-singh.medium.com](https://shubham-singh.medium.com/armageddon-hackthebox-walkthrough-6d8e2261a676) [](https://github.com/Mr-Lazzy) [## æ‡’äººå…ˆç”Ÿ-æ¦‚è¿°

### ç½‘ç»œå®‰å…¨çˆ±å¥½è€…ğŸ±â€ğŸ’»ã€‚æ‹‰å…¹å…ˆç”Ÿæœ‰ 7 ä¸ªå­˜å‚¨åº“å¯ç”¨ã€‚åœ¨ GitHub ä¸Šå…³æ³¨ä»–ä»¬çš„ä»£ç ã€‚

github.com](https://github.com/Mr-Lazzy) 

é¼“æŒğŸ‘å¦‚æœä½ å–œæ¬¢çš„è¯ã€‚**