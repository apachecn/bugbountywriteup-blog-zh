# æ”»å‡»ç›®å½•:TryHackMe æ¼”ç»ƒ-ç¬¬ 2 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://infosecwriteups.com/attacktive-directory-tryhackme-walkthrough-part-2-3ab8f4d4a9bf?source=collection_archive---------0----------------------->

![](img/838ac4dd58f61e1d0e47e2442936e9e0.png)

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯è‹è¿ªå¸•Â·ç™½æœ—å¡”å¡ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å®Œæˆ TryHackMe ä¸Šæ”»å‡»æ€§ç›®å½•å®¤çš„æœ€åä»»åŠ¡ã€‚å¦‚æœæ‚¨é”™è¿‡äº†ç¬¬ 1 éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¸‹é¢çš„ URL æ‰¾åˆ°å®ƒã€‚

[](/attacktive-directory-tryhackme-walkthrough-part-1-accfac4bf70f) [## æ”»å‡»ç›®å½•:TryHackMe æ¼”ç»ƒ-ç¬¬ 1 éƒ¨åˆ†

### å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯è‹è¿ªå¸•Â·ç™½æœ—å¡”å¡ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬è¦è°ˆè°ˆ TryHackMe ä¸Šçš„æ”»å‡»æ€§ç›®å½•å®¤ã€‚æ‰€ä»¥â€¦

infosecwriteups.com](/attacktive-directory-tryhackme-walkthrough-part-1-accfac4bf70f) 

ä»»åŠ¡ 05:æ»¥ç”¨ Kerberos

**ç®€ä»‹ **

*åœ¨æšä¸¾å®Œç”¨æˆ·å¸æˆ·åï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ»¥ç”¨ Kerberos ä¸­çš„ä¸€ä¸ªç‰¹æ€§ï¼Œä½¿ç”¨ä¸€ç§å«åš* ***çš„æ”»å‡»æ–¹æ³•è¿›è¡Œé‡å†™ã€‚*** *å½“ç”¨æˆ·å¸æˆ·å…·æœ‰â€œä¸éœ€è¦é¢„éªŒè¯â€æƒé™è®¾ç½®æ—¶ï¼Œä¼šå‘ç”Ÿé‡æ–°å‘å¸ƒã€‚è¿™æ„å‘³ç€å¸æˆ·***åœ¨è¯·æ±‚æŒ‡å®šç”¨æˆ·å¸æˆ·ä¸Šçš„ Kerberos ç¥¨æ®ä¹‹å‰ä¸éœ€è¦æä¾›æœ‰æ•ˆçš„èº«ä»½è¯æ˜ã€‚**

****æ£€ç´¢ Kerberos ç¥¨è¯****

*[*Impacket*](https://github.com/SecureAuthCorp/impacket)*æœ‰ä¸€ä¸ªåä¸ºâ€œGetNPUsers.pyâ€çš„å·¥å…·(ä½äº Impacket/examples/getnpusers . py ä¸­)ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬ä»å¯†é’¥åˆ†å‘ä¸­å¿ƒæŸ¥è¯¢ä½œä¸ºå¯æ¢å¤å¸æˆ·ã€‚æŸ¥è¯¢å¸æˆ·å”¯ä¸€éœ€è¦çš„æ˜¯ä¸€ç»„æœ‰æ•ˆçš„ç”¨æˆ·åï¼Œè¿™æ˜¯æˆ‘ä»¬ä¹‹å‰é€šè¿‡ Kerbrute åˆ—ä¸¾çš„ã€‚**

*é€šè¿‡è°·æ­Œæœç´¢â€œæ£€ç´¢ Kerberos ç¥¨è¯â€ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„å¤‡å¿˜å•ã€‚ä½ å¯ä»¥å‚è€ƒä¸€ä¸‹ä½ çš„çŸ¥è¯†ã€‚*

*æˆ‘ä»¬å°†ä½¿ç”¨â€œGetNPUsers.pyâ€æ¥è·å–ç”¨æˆ·çš„å¯†ç æ•£åˆ—ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹è„šæœ¬çš„ä½ç½®ã€‚*

*![](img/60de8f58f3c6596b8393cf8c98a210db.png)*

*ç„¶åï¼Œæ‚¨å¯ä»¥ç»™å‡ºä¸‹é¢çš„å‘½ä»¤æ¥æ£€ç´¢æ•£åˆ—ã€‚*

*![](img/56c6f5e4fdb6728aebc003176442718e.png)*

*è¿™å°†ä¸ºæ‚¨æä¾›å“ˆå¸Œï¼Œæˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œæ˜¾ç¤ºå®ƒğŸ™‚ã€‚ä¹‹åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•å“ˆå¸Œç ´è§£å·¥å…·(æ¯”å¦‚:hashcatï¼Œjohntheripper)æ¥ç ´è§£æˆ‘ä»¬çš„å“ˆå¸Œã€‚ä½†æ˜¯ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥ç¡®å®šæ•£åˆ—çš„æ¨¡å¼ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ hashcat wiki é¡µé¢ã€‚*

 *[## example_hashes [hashcat wiki]

### å¦‚æœæ‚¨åœ¨ hashcat ä¸­å¾—åˆ°ä¸€ä¸ªâ€œè¡Œé•¿åº¦å¼‚å¸¸â€é”™è¯¯ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºæ‚¨æ‰€è¯·æ±‚çš„æ•£åˆ—æ¨¡å¼â€¦

hashcat.net](https://hashcat.net/wiki/doku.php?id=example_hashes)* 

> *æˆ‘ä»¬æœ‰ä¸¤ä¸ªç”¨æˆ·å¸æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥ä»å…¶ä¸­æŸ¥è¯¢ç¥¨è¯ã€‚æ‚¨å¯ä»¥ä»å“ªä¸ªç”¨æˆ·å¸æˆ·æŸ¥è¯¢ç¥¨è¯è€Œæ— éœ€å¯†ç ï¼Ÿ*

*é€šè¿‡ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·(svc-admin å’Œ backup)å°è¯•æ‰€æœ‰å¯èƒ½çš„å°è¯•ï¼Œæˆ‘å‘ç°æˆ‘ä»¬å¯ä»¥åªä¸º svc-admin æŸ¥è¯¢ä¸€ä¸ªæ²¡æœ‰å¯†ç çš„ç¥¨è¯*

***ç­”æ¡ˆ:** svc-admin*

> *æŸ¥çœ‹ Hashcat ç¤ºä¾‹ Wiki é¡µé¢ï¼Œæˆ‘ä»¬ä» KDC ä¸­æ£€ç´¢åˆ°äº†ä»€ä¹ˆç±»å‹çš„ Kerberos å“ˆå¸Œï¼Ÿ(æŒ‡å®šå…¨å)*

*åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ ¹æ®ç­”æ¡ˆæ ¼å¼(ç­”æ¡ˆç©ºæ ¼ä¸Šçš„***æ ‡è®°)å¯¹ç­”æ¡ˆè¿›è¡Œæ ¼å¼åŒ–ğŸ˜‰)*

***å›ç­”:** Kerberos 5 AS-REP etype 23*

> *å“ˆå¸Œæ˜¯ä»€ä¹ˆæ¨¡å¼ï¼Ÿ*

*![](img/cf09ba7cd253205303eb2fa47bf5f692.png)*

***ç­”æ¡ˆ:** 18200*

> *ç°åœ¨ç”¨æä¾›çš„ä¿®æ”¹è¿‡çš„å¯†ç åˆ—è¡¨ç ´è§£å“ˆå¸Œï¼Œç”¨æˆ·è´¦æˆ·å¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ*

*![](img/eea7dce1c725ba66517aaebffd128c5e.png)*

***ç­”:**ç®¡ç† 2005*

*å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº hashcat å’Œå…¶ä»–å¯†ç ç ´è§£å·¥å…·çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒ TryHackMe ä¸‹é¢çš„æˆ¿é—´ã€‚*

*[](https://tryhackme.com/room/crackthehash) [## å°è¯•ç ´è§£æ‚å‡‘

### ç ´è§£å“ˆå¸ŒæŒ‘æˆ˜

tryhackme.com](https://tryhackme.com/room/crackthehash) [](https://tryhackme.com/room/johntheripper0) [## ç½‘ç»œå®‰å…¨åŸ¹è®­

### TryHackMe æ˜¯ä¸€ä¸ªå…è´¹çš„å­¦ä¹ ç½‘ç»œå®‰å…¨çš„åœ¨çº¿å¹³å°ï¼Œä½¿ç”¨åŠ¨æ‰‹ç»ƒä¹ å’Œå®éªŒå®¤ï¼Œé€šè¿‡æ‚¨çš„â€¦

tryhackme.com](https://tryhackme.com/room/johntheripper0) 

**ä»»åŠ¡ 06:è¿”ç’å½’çœŸ**

***æšä¸¾:***

*æœ‰äº†ç”¨æˆ·çš„å¸æˆ·å‡­è¯ï¼Œæˆ‘ä»¬ç°åœ¨åœ¨åŸŸå†…æœ‰äº†æ›´å¤šçš„è®¿é—®æƒé™ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥å°è¯•æšä¸¾åŸŸæ§åˆ¶å™¨å¯èƒ½å‘å‡ºçš„ä»»ä½•å…±äº«ã€‚*

è¦å®Œæˆæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬åº”è¯¥æšä¸¾ç›®æ ‡ä¸Šçš„ SMB(æœåŠ¡å™¨æ¶ˆæ¯å—)å…±äº«ã€‚

> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»€ä¹ˆå·¥å…·æ¥æ˜ å°„è¿œç¨‹ SMB å…±äº«ï¼Ÿ

æç¤ºå‘Šè¯‰æˆ‘ä»¬ä½¿ç”¨ smbclientã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç”¨å®ƒå‘¢ğŸ˜‰ã€‚

**å›ç­”** :smbclient

> å“ªä¸ªé€‰é¡¹å°†åˆ—å‡ºè‚¡ä»½ï¼Ÿ

é€šè¿‡æŸ¥çœ‹å·¥å…·çš„æ‰‹å†Œé¡µï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚

![](img/34609cebbb29a4f36b62518244d192e4.png)

**ç­”æ¡ˆ:** -L

> æœåŠ¡å™¨åˆ—å‡ºäº†å¤šå°‘ä¸ªè¿œç¨‹å…±äº«ï¼Ÿ

å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥åˆ—ä¸¾æˆ‘ä»¬çš„ç›®æ ‡ä¸Šçš„ smb ä»½é¢ã€‚

![](img/8d1e65a26a5588b177afdcc38de62ebf.png)

**ç­”æ¡ˆ:** 6

> æˆ‘ä»¬å¯ä»¥è®¿é—®ä¸€ä¸ªåŒ…å«æ–‡æœ¬æ–‡ä»¶çš„ç‰¹å®šå…±äº«ã€‚æ˜¯å“ªä¸€ä»½ï¼Ÿ

é€šè¿‡æŸ¥çœ‹è‚¡ç¥¨ï¼Œæˆ‘æ‰¾åˆ°äº†æ²¡æœ‰ä»»ä½•è¯„è®ºçš„è‚¡ç¥¨ã€‚æˆ‘è¯•äº†ä¸€ä¸‹ï¼Œå¹¸è¿çš„æ˜¯è¿™æ˜¯æˆ‘ä»¬é—®é¢˜çš„æ­£ç¡®ç­”æ¡ˆã€‚

**å›ç­”:**å¤‡ä»½

> æ–‡ä»¶çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ

é€šè¿‡æšä¸¾å¤‡ä»½å…±äº«ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å¤‡ä»½ç”¨æˆ·çš„å‡­æ®ã€‚

![](img/53bd4dc673831781265dd069971294df.png)

åœ¨è¿™é‡Œä»£æ›¿åŸŸå(spookysec.local)ï¼Œå¯ä»¥ä½¿ç”¨ IP åœ°å€ã€‚è¦ä¸‹è½½ smb ä¸­å¯ç”¨çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ get å‘½ä»¤ã€‚

![](img/0d52812d02026857f13b5edbd1211a66.png)

æ‚¨å¯ä»¥å‚è€ƒä¸‹é¢çš„å¤‡å¿˜å•æ¥æé«˜æ‚¨çš„çŸ¥è¯†ã€‚

[](https://github.com/irgoncalves/smbclient_cheatsheet) [## GitHub-irgoncalves/SMB client _ cheat sheet:ä½¿ç”¨ smbclient/nmap çš„æœ‰ç”¨å‘½ä»¤/æŠ€å·§â€¦

### è¿™æ˜¯ä½¿ç”¨ smbclientã€enum4linux å’Œ nmap smb è„šæœ¬çš„æœ‰ç”¨å‘½ä»¤/æŠ€å·§åˆ—è¡¨â€”â€”åœ¨æµ‹è¯•ä¸­éå¸¸æœ‰ç”¨â€¦

github.com](https://github.com/irgoncalves/smbclient_cheatsheet) 

é€šè¿‡æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥è·å¾—å†…å®¹ã€‚

**ç­”æ¡ˆ:**YmFja * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * w %

> è§£ç æ–‡ä»¶çš„å†…å®¹ï¼Œå®Œæ•´çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ

é€šè¿‡æŸ¥çœ‹å®Œæ•´çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç¡®å®šè¿™æ˜¯ base 64 ç¼–ç æ ¼å¼ã€‚(æˆ‘ä»¬æœ‰å¤§å†™å­—æ¯ã€ç®€å•å­—æ¯ã€0-9 æ•°å­—å’Œ%=)ã€‚å¦‚æœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ **CyberChef** ã€‚

[](https://gchq.github.io/CyberChef/) [## ç½‘ç»œå’–å•¡é¦†

### ç½‘ç»œç‘å£«å†›åˆ€-ä¸€ä¸ªç”¨äºåŠ å¯†ã€ç¼–ç ã€å‹ç¼©å’Œæ•°æ®åˆ†æçš„ç½‘ç»œåº”ç”¨ç¨‹åº

gchq.github.io](https://gchq.github.io/CyberChef/) 

é€šè¿‡è§£ç ç¼–ç å†…å®¹ä½ å¯ä»¥å¾—åˆ°ç­”æ¡ˆã€‚

![](img/cadc7c01dfc94514f9b65cd4a50d802e.png)

**ç­”æ¡ˆ:**backup @ spooky sec . local:b * * * * * * * * * * * 60

**ä»»åŠ¡ 07:** **æå‡åŸŸå†…æƒé™**

*æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Impacket ä¸­çš„å¦ä¸€ä¸ªå·¥å…·â€œsecretsdump.pyâ€ã€‚è¿™å°†å…è®¸æˆ‘ä»¬æ£€ç´¢è¯¥ç”¨æˆ·å¸æˆ·(ä¸åŸŸæ§åˆ¶å™¨åŒæ­¥)å¿…é¡»æä¾›çš„æ‰€æœ‰å¯†ç å“ˆå¸Œã€‚åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†æœ‰æ•ˆåœ°å®Œå…¨æ§åˆ¶å¹¿å‘Šé¢†åŸŸã€‚*

æç¤ºå°†å‘Šè¯‰æˆ‘ä»¬â€œè¯»å– secretsdump è¾“å‡ºï¼â€

> æ˜¯ä»€ä¹ˆæ–¹æ³•è®©æˆ‘ä»¬ç”©æ‰äº† NTDSï¼ŸDITï¼Ÿ

![](img/9af4d12edeeb544c81ee6c69654d472e.png)![](img/70695b181f4656787ebfbf15c83b7f10.png)

**å›ç­”:** DRSUAPI

> ç®¡ç†å‘˜çš„ NTLM æ•£åˆ—æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸ºäº†è·å¾—ç®¡ç† NTLM æ•£åˆ—ï¼Œæˆ‘å°è¯•äº†åŸŸæ§åˆ¶å™¨çš„-dc-ip (IP åœ°å€ã€‚å¦‚æœå…è®¸ï¼Œä½¿ç”¨ç›®æ ‡å‚æ•°ä¸­æŒ‡å®šçš„åŸŸéƒ¨åˆ†(FQDN)

![](img/53002a4e1368654d3aaae2eb0595347a.png)![](img/82e3ff14402c8fd27a8b8a31b07a2251.png)

**ç­”æ¡ˆ:**0e 0363213 e 37 b 94221497260 b 0 BC B4 fc

> å“ªç§æ”»å‡»æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬åœ¨æ²¡æœ‰å¯†ç çš„æƒ…å†µä¸‹éªŒè¯ç”¨æˆ·èº«ä»½ï¼Ÿ

é€šè¿‡åœ¨äº’è”ç½‘ä¸Šæœç´¢ï¼Œæˆ‘å‘ç°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œä¼ é€’å“ˆå¸Œâ€çš„æ–¹æ³•æ¥éªŒè¯ç”¨æˆ·æ²¡æœ‰å¯†ç ã€‚

**å›ç­”:**ä¼ é€’å“ˆå¸Œ

> ä½¿ç”¨ä¸€ä¸ªå«åš Evil-WinRM çš„å·¥å…·ï¼Œå“ªä¸ªé€‰é¡¹å…è®¸æˆ‘ä»¬ä½¿ç”¨æ•£åˆ—ï¼Ÿ

å¯¹äºè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ evil-winrm å·¥å…·ã€‚

*WinRM (Windows è¿œç¨‹ç®¡ç†)æ˜¯å¾®è½¯å®ç°çš„ WS-Management åè®®ã€‚ä¸€ç§åŸºäº SOAP çš„æ ‡å‡†åè®®ï¼Œå…è®¸ä¸åŒä¾›åº”å•†çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿè¿›è¡Œäº’æ“ä½œã€‚å¾®è½¯å°†å®ƒåŒ…å«åœ¨ä»–ä»¬çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œä»¥ä½¿ç³»ç»Ÿç®¡ç†å‘˜çš„å·¥ä½œæ›´å®¹æ˜“ã€‚*

[](https://github.com/Hackplayers/evil-winrm) [## GitHub - Hackplayers/evil-winrm:é»‘å®¢/æµ‹è¯•çš„ç»ˆæ WinRM shell

### ç”¨äºé»‘å®¢æ”»å‡»/æµ‹è¯•çš„ç»ˆæ WinRM å¤–å£³è¿™ä¸ªå¤–å£³æ˜¯ç”¨äºé»‘å®¢æ”»å‡»/æµ‹è¯•çš„ç»ˆæ WinRM å¤–å£³ã€‚WinRMâ€¦

github.com](https://github.com/Hackplayers/evil-winrm) 

è¦å®‰è£… evil-winrmï¼Œæ‚¨å¯ä»¥ä½¿ç”¨â€œgem install evil-winrmâ€å‘½ä»¤ã€‚

![](img/14c800605f3e667666eb4cea841a1763.png)

å®‰è£…åï¼Œæˆ‘ä»¬å°†å‘½ä»¤å’Œæ§åˆ¶æˆ‘ä»¬çš„åŸŸæ§åˆ¶å™¨ã€‚

![](img/e26701dc89cc4c104474abc3a0c9a79e.png)

**ç­”æ¡ˆ:** -H

é€šè¿‡ä½¿ç”¨ç®¡ç†å‘˜ NTLM å“ˆå¸Œè¿è¡Œ evil-winrmï¼Œæˆ‘ä»¬å°†è·å¾—å¯¹ç›®æ ‡æœºå™¨çš„å‘½ä»¤å’Œæ§åˆ¶ã€‚

![](img/cf20cfdc4098a4efd5256301753cf840.png)

**ä»»åŠ¡ 08:æ——å¸œæäº¤é¢æ¿**

æˆ‘ä»¬åœ¨æˆ¿é—´çš„æœ€åä¸€éƒ¨åˆ†ã€‚é€šè¿‡å¯¼èˆªç‰¹å®šçš„ç”¨æˆ·ï¼Œæ¡Œé¢ä¼šç»™æˆ‘ä»¬ç›¸å…³çš„æ ‡å¿—ã€‚

è·å– svc-admin:

![](img/b0af8d07487c4e796b80430fd2b626fb.png)

è·å–å¤‡ä»½:

![](img/a6f94b97bb8ef3644f8717af12634d3d.png)

è·å–ç®¡ç†å‘˜

![](img/144dd985341bb67e5a68418290b85734.png)

ä»Šå¤©å°±åˆ°è¿™é‡Œï¼Œå¸Œæœ›ä½ èƒ½ä»è¿™ç¯‡æ–‡ç« ä¸­å­¦åˆ°ä¸€äº›ä¸œè¥¿ã€‚ä¸‹æ¬¡å†è§ï¼Œæ³¨æ„å®‰å…¨ï¼Œå†è§ğŸ‘‹ã€‚

ä½ å¯ä»¥åœ¨ä¸Šæ‰¾åˆ°æˆ‘ğŸ˜Šï¼š

é¢†è‹±:[www.linkedin.com/in/sudeepashiranthaka](http://www.linkedin.com/in/sudeepashiranthaka)

ä¸­:[https://sudeepashiranthaka97.medium.com/](https://sudeepashiranthaka97.medium.com/)

æ¨ç‰¹:[https://twitter.com/sudeepashiran97](https://twitter.com/sudeepashiran97)*