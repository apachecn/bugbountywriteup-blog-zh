# CRLF æ³¨å°„â€”â€”XXX ç¾å…ƒâ€”â€”æˆ‘æ€ä¹ˆå¯èƒ½é€šè¿‡ Cloudflare WAF è·å¾—å¥–é‡‘ï¼Ÿ

> åŸæ–‡ï¼š<https://infosecwriteups.com/crlf-injection-xxx-how-was-it-possible-for-me-to-earn-a-bounty-with-the-cloudflare-waf-f581506f97f5?source=collection_archive---------1----------------------->

æˆ‘æœ€è¿‘åœ¨ä¸€ä¸ªæµè¡Œçš„ç½‘ç«™ä¸Šå‘ç°äº†ä¸€ä¸ª CRLF æ³¨å°„æ¼æ´ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘å°†æè¿°æˆ‘èƒ½å¤Ÿæ¼”ç¤ºçš„æ¼æ´å’Œæ”»å‡»åœºæ™¯ã€‚æˆ‘è¿˜å°†è®¨è®º CRLF æ³¨å…¥æ¼æ´çš„æ½œåœ¨å½±å“ã€‚

![](img/b7027e9fb7b06117a8db373b4935646d.png)

## ä»€ä¹ˆæ˜¯ CRLFï¼Ÿ

CRLF(å›è½¦å’Œæ¢è¡Œ)æ˜¯ç”±ä¸¤ä¸ªç‰¹æ®Šå­—ç¬¦ç»„æˆçš„åºåˆ—ï¼Œåœ¨è®¸å¤šè®¡ç®—ç¯å¢ƒä¸­ç”¨æ¥è¡¨ç¤ºä¸€è¡Œæ–‡æœ¬çš„ç»“æŸã€‚åœ¨ç½‘ç»œå®‰å…¨èƒŒæ™¯ä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ CRLF æ”»å‡»å‘ç½‘ç«™æ³¨å…¥æ¶æ„å†…å®¹ã€‚ä¸ºäº†é˜²èŒƒè¿™äº›æ”»å‡»ï¼Œweb å¼€å‘äººå‘˜éœ€è¦æ­£ç¡®å¤„ç† CRLF åºåˆ—å¹¶å‡€åŒ–ç”¨æˆ·ç”Ÿæˆçš„å†…å®¹ã€‚

CRLF æ³¨å…¥æ”»å‡»æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„ç”¨ä¾‹:

*   **æ—¥å¿—åˆ†å‰²:**æ”»å‡»è€…æ’å…¥ä¸€ä¸ªè¡Œå°¾å­—ç¬¦å’Œä¸€ä¸ªé¢å¤–çš„è¡Œæ¥ä¼ªé€ æ—¥å¿—æ–‡ä»¶æ¡ç›®ï¼Œä»¥ä¾¿é€šè¿‡éšè—å…¶ä»–æ”»å‡»æ¥æ¬ºéª—ç³»ç»Ÿç®¡ç†å‘˜ã€‚
*   **HTTP å“åº”æ‹†åˆ†:** CRLF æ³¨å…¥ç”¨äºåœ¨ HTTP å“åº”ä¸­æ·»åŠ  HTTP æŠ¥å¤´ï¼Œä¾‹å¦‚æ‰§è¡Œå¯¼è‡´ä¿¡æ¯æ³„éœ²çš„ XSS æ”»å‡»ã€‚

# è¯¥æŠ¥å‘Š

![](img/1901e1069241cdc66e896a6b01c956b7.png)

## æˆ‘æ˜¯å¦‚ä½•æ‰¾åˆ° CRLF çš„ï¼Ÿ

æˆ‘ä½¿ç”¨ https://github.com/dwisiswant0/crlfuzz[çš„ crlfuzz å·¥å…·æ‰¾åˆ°äº†ç½‘ç«™ä¸Šçš„ CRLF æ³¨å…¥æ¼æ´ã€‚crlfuzz å·¥å…·æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å°† CRLF åºåˆ—æ³¨å…¥ HTTP å¤´æ¥æµ‹è¯• CRLF æ³¨å…¥æ¼æ´ã€‚](https://github.com/dwisiswant0/crlfuzz)

è¦ä½¿ç”¨ crlfuzz å·¥å…·ï¼Œæˆ‘é¦–å…ˆå¿…é¡»å…‹éš†å­˜å‚¨åº“å¹¶å®‰è£…å¿…è¦çš„ä¾èµ–é¡¹ã€‚ç„¶åï¼Œæˆ‘ä½¿ç”¨ç›®æ ‡ URL å’ŒæœŸæœ›çš„æœ‰æ•ˆè´Ÿè½½ä½œä¸ºå‚æ•°è¿è¡Œè¯¥å·¥å…·ã€‚è¯¥å·¥å…·å°†æœ‰æ•ˆè´Ÿè½½æ³¨å…¥ HTTP æŠ¥å¤´ï¼Œå¹¶å°†è¯·æ±‚å‘é€åˆ°ç›®æ ‡ç½‘ç«™ã€‚

```
â–¶ crlfuzz -u "http://target"
```

![](img/fc8cea064f07325aa37ccff00e23057e.png)

å¦‚æœç½‘ç«™æ˜“å— CRLF æ³¨å…¥çš„æ”»å‡»ï¼Œè¯¥å·¥å…·å°†æ”¶åˆ°ä¸€ä¸ªå“åº”ï¼ŒæŒ‡ç¤ºæ³¨å…¥çš„æœ‰æ•ˆè´Ÿè½½å·²æˆåŠŸæ‰§è¡Œã€‚

ä½¿ç”¨ crlfuzz å·¥å…·ï¼Œæˆ‘èƒ½å¤Ÿå¿«é€Ÿè½»æ¾åœ°æµ‹è¯•ç½‘ç«™ä¸Šçš„ CRLF æ³¨å…¥æ¼æ´ã€‚è¿™ä¸ªå·¥å…·å¯¹äºå¯»æ‰¾å’ŒæŠ¥å‘Š CRLF æ³¨å°„æ¼æ´çš„ bug èµé‡‘çŒäººæ¥è¯´æ˜¯ä¸€ä¸ªæœ‰ä»·å€¼çš„èµ„æºã€‚

# æ”»å‡»åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ

## é¥¼å¹²ç‚¸å¼¹

åœ¨ç¬¬ä¸€ä¸ªæ”»å‡»åœºæ™¯ä¸­ï¼Œæˆ‘åœ¨ç½‘ç«™ä¸­æ³¨å…¥äº†ä¸€ä¸ª cookie ç‚¸å¼¹ã€‚cookie ç‚¸å¼¹æ˜¯ä¸€ç§æ”»å‡»ç±»å‹ï¼Œæ—¨åœ¨é€šè¿‡å°†å¤§é‡ cookie æ³¨å…¥ç”¨æˆ·çš„æµè§ˆå™¨æ¥æ·¹æ²¡ç½‘ç«™çš„æœåŠ¡å™¨ã€‚å¯¹äºå—å½±å“çš„ç”¨æˆ·ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç½‘ç«™é€Ÿåº¦å˜æ…¢æˆ–æ— å“åº”ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½å¯ç”¨äºåˆ›å»º cookie ç‚¸å¼¹:

```
Set-Cookie: bomb=1
Set-Cookie: bomb=2
Set-Cookie: bomb=3
â€¦
Set-Cookie: bomb=10000
```

è¯¥æœ‰æ•ˆè´Ÿè½½ä¼šå‘ç”¨æˆ·çš„æµè§ˆå™¨æ³¨å…¥ 10000 ä¸ª cookiesï¼Œå¯èƒ½ä¼šå¯¼è‡´ç½‘ç«™å˜æ…¢æˆ–æ— å“åº”ã€‚ç½‘ç«™å¼€å‘äººå‘˜é‡‡å–æªæ–½é˜²èŒƒ cookie ç‚¸å¼¹å’Œå…¶ä»–ç±»å‹çš„æ³¨å…¥æ”»å‡»æ˜¯éå¸¸é‡è¦çš„ã€‚

## Cloudflare æ™¶ç‰‡å—

åœ¨ç¬¬äºŒä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘è®¾ç½®äº†ä¸€ä¸ª cookie å¹¶è§¦å‘äº†ä¸€ä¸ª Cloudflare WAF å—ã€‚Cloudflare WAF (Web åº”ç”¨é˜²ç«å¢™)æ˜¯ä¸€ç§å®‰å…¨æªæ–½ï¼Œå¯ä»¥ä¿æŠ¤ç½‘ç«™å…å—å„ç§ç½‘ç»œå¨èƒï¼ŒåŒ…æ‹¬æ³¨å…¥æ”»å‡»ã€‚å½“ WAF é˜»æ­¢è¢«è§¦å‘æ—¶ï¼Œæ„å‘³ç€ç½‘ç«™çš„æœåŠ¡å™¨æ£€æµ‹åˆ°æ½œåœ¨çš„æ¶æ„æ´»åŠ¨ï¼Œå¹¶é˜»æ­¢å¯¹ç½‘ç«™çš„è®¿é—®ä»¥ä¿æŠ¤å®ƒã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½å¯ç”¨äºè§¦å‘ Cloudflare WAF å—:

```
Set-Cookie: crlf=attack
```

æ­¤æœ‰æ•ˆè´Ÿè½½è®¾ç½®äº†ä¸€ä¸ªå€¼ä¸ºâ€œæ”»å‡»â€çš„ cookieï¼Œè¯¥ cookie å¯èƒ½ä¼šè¢«ç½‘ç«™çš„æœåŠ¡å™¨æ£€æµ‹ä¸ºæ¶æ„ï¼Œå¹¶è§¦å‘ Cloudflare WAF é˜»æ­¢ã€‚å¯¹äºç½‘ç«™å¼€å‘è€…æ¥è¯´ï¼Œç¡®ä¿ä»–ä»¬çš„ WAF é…ç½®æ­£ç¡®å¹¶ä¸”èƒ½å¤Ÿæœ‰æ•ˆæŠµå¾¡æ½œåœ¨çš„æ”»å‡»æ˜¯éå¸¸é‡è¦çš„ã€‚

# æ—¶é—´çº¿:

*æäº¤*:2021 å¹´ 11 æœˆ 16 æ—¥

*å—ç†*:2021 å¹´ 11 æœˆ 17 æ—¥

*å®¡åˆ¤*:2021 å¹´ 11 æœˆ 17 æ—¥

éœ€è¦æ›´å¤šä¿¡æ¯:2021 å¹´ 12 æœˆ 13 æ—¥->æˆ‘æä¾›äº†æ›´å¤šä¿¡æ¯

*å†æ¬¡åˆ†ç±»*:2022 å¹´ 8 æœˆ 19 æ—¥- >èµé‡‘ 500 ç¾å…ƒ

*å·²è§£å†³/å·²å…³é—­* : â€”

# å½±å“

CRLF æ³¨å…¥çš„å½±å“æ˜¯å¤šæ–¹é¢çš„ï¼Œä¹ŸåŒ…æ‹¬ä»è·¨ç«™ç‚¹è„šæœ¬åˆ°ä¿¡æ¯æŠ«éœ²çš„ä¸€åˆ‡ã€‚å®ƒè¿˜å¯ä»¥ç¦ç”¨æŸäº›å®‰å…¨é™åˆ¶ï¼Œå¦‚å—å®³è€…æµè§ˆå™¨ä¸­çš„ XSS è¿‡æ»¤å™¨å’ŒåŒæºç­–ç•¥ï¼Œä½¿ä»–ä»¬å®¹æ˜“å—åˆ°æ¶æ„æ”»å‡»ã€‚ä½¿ç”¨æˆ‘æè¿°çš„æ”»å‡»åœºæ™¯ï¼Œæˆ‘èƒ½å¤Ÿå±•ç¤ºå¦‚ä½•å¿«é€Ÿåœ°ä½¿ç«™ç‚¹å¯¹å•ä¸ªç”¨æˆ·ä¸å¯ç”¨ã€‚

## å·¥å…·/æœ‰æ•ˆè½½è·:

[https://github.com/dwisiswant0/crlfuzz](https://github.com/dwisiswant0/crlfuzz)T12[https://github.com/Proviesec/crlf-payloads](https://github.com/Proviesec/crlf-payloads)

## æŠ¥å‘Š:

[https://hackerone.com/reports/1575912](https://hackerone.com/reports/1575912)â€”cloud flareâ€”3100 ç¾å…ƒ

https://hackerone.com/reports/446271â€”â€”æ¨ç‰¹â€”â€”2940 ç¾å…ƒ

[https://hackerone.com/reports/197279](https://hackerone.com/reports/197279)â€”â€”Airbnbâ€”â€”2500 ç¾å…ƒ

https://hackerone.com/reports/192667â€”â€”æ˜Ÿå·´å…‹

https://hackerone.com/reports/237357:Snapchat:500 ç¾å…ƒ

# æ‘˜è¦

CRLF æ³¨å…¥æ¼æ´å¯èƒ½ä¼šç»™ç½‘ç«™è¿è¥å•†å’Œç”¨æˆ·å¸¦æ¥ä¸¥é‡åæœï¼Œå› æ­¤å¯¹äº bug èµé‡‘çŒäººæ¥è¯´ï¼Œè­¦æƒ•è¿™äº›ç±»å‹çš„æ¼æ´éå¸¸é‡è¦ã€‚å¦‚æœæ‚¨å¯¹å‘ç°å’ŒæŠ¥å‘Š CRLF æ³¨å…¥æ¼æ´æ„Ÿå…´è¶£ï¼Œè¯·è®°ä½ä»¥ä¸‹å‡ ä¸ªæç¤º:

*   ç ”ç©¶ CRLF æ³¨å…¥æ”»å‡»ï¼Œäº†è§£å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¿™å°†å¸®åŠ©æ‚¨è¯†åˆ«æ½œåœ¨çš„æ¼æ´ï¼Œå¹¶æå‡ºæœ‰æ•ˆçš„æµ‹è¯•ç”¨ä¾‹ã€‚
*   æ³¨æ„ HTTP å¤´å’Œ cookiesã€‚CRLF æ³¨å…¥æ”»å‡»é€šå¸¸æ¶‰åŠæ“çºµè¿™äº›å…ƒç´ ï¼Œå› æ­¤åœ¨æµ‹è¯•æ¼æ´æ—¶ä»”ç»†æ£€æŸ¥å®ƒä»¬éå¸¸é‡è¦ã€‚
*   æµ‹è¯•ä¸åŒçš„æµè§ˆå™¨å’Œåº”ç”¨ç¨‹åºã€‚CRLF æ³¨å…¥æ¼æ´å¯èƒ½ä¼šä»¥ä¸åŒçš„æ–¹å¼å½±å“ä¸åŒçš„æµè§ˆå™¨å’Œåº”ç”¨ç¨‹åºï¼Œå› æ­¤æµ‹è¯•å°½å¯èƒ½å¤šçš„ç»„åˆéå¸¸é‡è¦ã€‚
*   è´Ÿè´£ä»»åœ°æŠ¥å‘Šæ¼æ´ã€‚å¦‚æœæ‚¨ç¡®å®å‘ç°äº† CRLF æ³¨å…¥æ¼æ´ï¼Œè¯·ç¡®ä¿éµå¾ªè´Ÿè´£ä»»çš„æŠ«éœ²å‡†åˆ™ï¼Œå¹¶å°½å¿«å‘å—å½±å“ç½‘ç«™çš„å®‰å…¨å›¢é˜ŸæŠ¥å‘Šè¯¥é—®é¢˜ã€‚

é€šè¿‡éµå¾ªè¿™äº›æç¤ºï¼Œæ‚¨å¯ä»¥å¸®åŠ©ä¿æŠ¤ç½‘ç«™å’Œç”¨æˆ·å…å— CRLF æ³¨å…¥æ¼æ´çš„æ½œåœ¨å½±å“ã€‚

è¿™æ˜¯æˆ‘çš„ä¸ªäººèµ„æ–™:[https://hackerone.com/proviesec](https://hackerone.com/proviesec)

è¯·éšæ—¶é—®æˆ‘ï¼Œå¹¶å»ºè®®æˆ‘ä¸‹æ¬¡åº”è¯¥è€ƒè™‘çš„æ›´æ”¹ã€‚ä¸ç®¡æ€æ ·ï¼Œè°¢è°¢ä½ çš„é˜…è¯»ğŸ‘‹ã€‚

è¿˜éœ€è¦ä¸€ç¯‡å¥½æ–‡ç« å—ï¼Ÿ->[https://infosecwriteups . com/broken-link-jacking-404-Google-play-store-XXX-bounty-96e 79 A8 DFD 71](/broken-link-hijacking-404-google-play-store-xxx-bounty-96e79a8dfd71)

## æ¥è‡ª Infosec çš„æŠ¥é“:Infosec æ¯å¤©éƒ½æœ‰å¾ˆå¤šå†…å®¹ï¼Œå¾ˆéš¾è·Ÿä¸Šã€‚[åŠ å…¥æˆ‘ä»¬çš„æ¯å‘¨æ—¶äº‹é€šè®¯](https://weekly.infosecwriteups.com/)ä»¥ 5 ç¯‡æ–‡ç« ã€4 ä¸ªçº¿ç¨‹ã€3 ä¸ªè§†é¢‘ã€2 ä¸ª GitHub Repos å’Œå·¥å…·ä»¥åŠ 1 ä¸ªå·¥ä½œæé†’çš„å½¢å¼å…è´¹è·å–æ‰€æœ‰æœ€æ–°çš„ Infosec è¶‹åŠ¿ï¼